<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>Grow-with-Core Dashboard</title>
    <!-- Tailwind CSS CDN for easy styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN for portfolio allocation chart -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Paystack Checkout.js CDN for payment integration -->
    <script src="https://js.paystack.co/v1/inline.js"></script>
    <style>
        /* Custom styles for the dashboard with darker theme and enhanced imagery */
        body {
            font-family: "Inter", sans-serif; /* Using Inter font */
            /* Deeper, more vibrant gradient background for a premium feel */
            background: linear-gradient(135deg, #121212 0%, #202020 100%); /* Very dark grey to black gradient */
            min-height: 100vh;
            margin: 0;
            padding: 1rem; /* Smaller padding on mobile */
            box-sizing: border-box;
            color: #e0e0e0; /* Lighter text for dark background */
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to top for better content flow */
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        .dashboard-container {
            background-color: #2a2a2a; /* Darker container background */
            border-radius: 2.5rem; /* Even more rounded corners */
            /* More pronounced shadow for depth */
            box-shadow: 0 30px 70px rgba(0, 0, 0, 0.45), inset 0 0 15px rgba(255, 255, 255, 0.03);
            padding: 2rem; /* Adjusted padding for mobile */
            max-width: 1280px; /* Slightly wider max width */
            width: 100%;
            display: grid;
            gap: 2rem; /* Adjusted gap between sections for mobile */
            grid-template-columns: 1fr; /* Single column for mobile */
            margin-top: 1.5rem; /* Space from top */
            margin-bottom: 1.5rem; /* Space from bottom */
            border: 1px solid rgba(255, 255, 255, 0.08); /* Subtle border for definition */
        }

        @media (min-width: 768px) {
            body {
                padding: 20px; /* Restore larger padding on desktop */
            }
            .dashboard-container {
                padding: 3rem; /* Restore larger padding on desktop */
                gap: 3rem; /* Restore larger gap on desktop */
                grid-template-columns: 2fr 1fr; /* Two columns for tablet/desktop */
            }
        }

        .card {
            /* Richer card gradient with subtle inner shadow */
            background: linear-gradient(45deg, #333333 0%, #444444 100%);
            border-radius: 2rem; /* More rounded card corners */
            padding: 1.5rem; /* Adjusted card padding for mobile */
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3), inset 0 0 10px rgba(255, 255, 255, 0.02); /* Enhanced card shadow */
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            border: 1px solid rgba(255, 255, 255, 0.06); /* Subtle light border for definition */
        }

        @media (min-width: 768px) {
            .card {
                padding: 2.5rem; /* Restore larger card padding on desktop */
            }
        }

        .card:hover {
            transform: translateY(-8px); /* More pronounced lift effect on hover */
            box-shadow: 0 20px 45px rgba(0, 0, 0, 0.45);
        }

        .section-title {
            font-size: 1.8rem; /* Smaller title on mobile */
            font-weight: 800; /* Bolder */
            color: #b0c4de; /* Softer blue-grey for titles */
            margin-bottom: 1.5rem; /* Adjusted space below title */
            text-align: center;
            position: relative;
            padding-bottom: 0.5rem; /* Adjusted padding */
            letter-spacing: 0.05em; /* Slight letter spacing */
        }

        @media (min-width: 768px) {
            .section-title {
                font-size: 2.5rem; /* Restore larger title on desktop */
                margin-bottom: 2rem; /* Restore larger space */
                padding-bottom: 0.75rem; /* Restore padding */
            }
        }

        .section-title::after {
            content: '';
            position: absolute;
            left: 50%;
            bottom: 0;
            transform: translateX(-50%);
            width: 80px; /* Smaller underline on mobile */
            height: 4px; /* Thinner underline on mobile */
            /* Vibrant green gradient underline */
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            border-radius: 3px;
        }

        @media (min-width: 768px) {
            .section-title::after {
                width: 100px; /* Restore wider underline on desktop */
                height: 5px; /* Restore thicker underline on desktop */
            }
        }

        .btn-primary {
            /* More vibrant green gradient button with stronger shadow */
            background: linear-gradient(90deg, #4CAF50 0%, #689F38 100%);
            color: white;
            font-weight: 700; /* Bolder text */
            padding: 0.8rem 1.5rem; /* Smaller padding on mobile */
            border-radius: 0.75rem; /* Slightly less rounded */
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.6); /* Stronger green shadow */
            border: none;
            cursor: pointer;
            text-transform: uppercase; /* Uppercase text */
            letter-spacing: 0.05em; /* Slight letter spacing */
            font-size: 0.9rem; /* Smaller font on mobile */
        }

        @media (min-width: 768px) {
            .btn-primary {
                padding: 1rem 2.2rem; /* Restore larger padding on desktop */
                border-radius: 1rem; /* Restore more rounded */
                font-size: 1rem; /* Restore font size */
            }
        }

        .btn-primary:hover {
            transform: translateY(-3px); /* More pronounced lift */
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.45);
            filter: brightness(1.1); /* Slight brightness increase on hover */
        }

        .btn-primary:active {
            transform: translateY(0); /* Press effect */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
        }

        input[type="number"], input[type="text"], input[type="email"], select {
            background-color: #3a3a3a; /* Darker input background */
            border: 1px solid #555555; /* Darker, more defined border */
            color: #e0e0e0; /* Lighter text in inputs */
            border-radius: 0.5rem; /* Slightly less rounded on mobile */
            padding: 0.75rem 1rem; /* Smaller padding on mobile */
            width: 100%;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3); /* Deeper inner shadow */
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            font-size: 0.9rem; /* Smaller font on mobile */
        }

        @media (min-width: 768px) {
            input[type="number"], input[type="text"], input[type="email"], select {
                border-radius: 0.75rem; /* Restore rounded inputs on desktop */
                padding: 0.9rem 1.2rem; /* Restore larger padding on desktop */
                font-size: 1rem; /* Restore font size */
            }
        }

        input[type="number"]:focus, input[type="text"]:focus, input[type="email"]:focus, select:focus {
            border-color: #4CAF50; /* Vibrant green focus border */
            box-shadow: 0 0 0 4px rgba(76, 175, 80, 0.5), inset 0 2px 5px rgba(0, 0, 0, 0.3); /* Green focus ring with inner shadow */
            outline: none;
        }

        .metric-box {
            /* Metric box gradient with more contrast */
            background: linear-gradient(135deg, #4a4a4a 0%, #3a3a3a 100%);
            border-radius: 1rem; /* Slightly less rounded on mobile */
            padding: 1.2rem; /* Adjusted padding for mobile */
            text-align: center;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255, 255, 255, 0.08); /* Subtle light border */
        }

        @media (min-width: 768px) {
            .metric-box {
                border-radius: 1.25rem; /* Restore rounded on desktop */
                padding: 1.8rem; /* Restore padding on desktop */
            }
        }

        .metric-value {
            font-size: 2rem; /* Smaller metric values on mobile */
            font-weight: 900; /* Extra bold */
            color: #66BB6A; /* Brighter, more prominent green for key values */
            margin-bottom: 0.4rem; /* Adjusted margin */
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3); /* Text shadow for depth */
        }

        @media (min-width: 768px) {
            .metric-value {
                font-size: 2.8rem; /* Restore larger metric values on desktop */
                margin-bottom: 0.6rem; /* Restore margin */
            }
        }

        .metric-label {
            font-size: 0.9rem; /* Smaller label on mobile */
            color: #b0c4de; /* Softer grey for labels */
            font-weight: 600; /* Bolder label */
        }

        @media (min-width: 768px) {
            .metric-label {
                font-size: 1.1rem; /* Restore larger label on desktop */
            }
        }

        /* SVG Icon styling */
        .icon-svg {
            width: 28px; /* Smaller icons on mobile */
            height: 28px;
            fill: currentColor; /* Use parent's text color */
            margin-right: 8px; /* Adjusted space */
            vertical-align: middle;
            color: #66BB6A; /* Green for icons */
            filter: drop-shadow(0 0 5px rgba(102, 187, 106, 0.5)); /* Subtle glow for icons */
        }

        @media (min-width: 768px) {
            .icon-svg {
                width: 32px; /* Restore larger icons on desktop */
                height: 32px;
                margin-right: 10px; /* Restore space */
            }
        }

        /* Investment item styling */
        .investment-item {
            display: grid; /* Use CSS Grid for better control */
            grid-template-columns: auto 1fr; /* Icon + content */
            grid-template-rows: auto auto; /* Name/Type and Value/Profit */
            gap: 0.4rem 1rem; /* Adjusted gaps for mobile */
            align-items: center;
            padding: 1rem 1.2rem; /* Adjusted padding for mobile */
            background-color: #3a3a3a; /* Darker background for list items */
            border-radius: 0.75rem; /* Slightly less rounded on mobile */
            margin-bottom: 1rem; /* Adjusted space between items */
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            transition: background-color 0.2s ease, transform 0.1s ease;
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative; /* For pseudo-elements or absolute positioning */
            overflow: hidden; /* Hide overflow for subtle effects */
            cursor: pointer; /* Indicate clickable */
        }

        @media (min-width: 768px) {
            .investment-item {
                gap: 0.5rem 1.2rem; /* Restore gaps on desktop */
                padding: 1.5rem 1.8rem; /* Restore padding on desktop */
                border-radius: 1rem; /* Restore rounded on desktop */
                margin-bottom: 1.2rem; /* Restore margin */
            }
        }

        .investment-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px; /* Thinner vertical line on mobile */
            height: 100%;
            background: linear-gradient(to bottom, #66BB6A, #4CAF50); /* Green gradient line */
            border-radius: 0.5rem 0 0 0.5rem; /* Rounded top-left, bottom-left */
            transition: width 0.2s ease-in-out;
        }

        @media (min-width: 768px) {
            .investment-item::before {
                width: 5px; /* Restore width on desktop */
            }
        }

        .investment-item:hover::before {
            width: 8px; /* Slightly wider on hover */
        }

        .investment-item:hover {
            background-color: #4a4a4a; /* Slightly lighter on hover */
            transform: translateX(5px); /* Slide effect on hover */
        }

        .investment-icon-wrapper {
            grid-row: 1 / span 2; /* Span two rows */
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px; /* Smaller width for icon area on mobile */
            height: 36px; /* Smaller height for icon area on mobile */
            background-color: #2d3748; /* Darker background for icon */
            border-radius: 50%; /* Circular icon background */
            box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.3); /* Inner shadow for icon circle */
        }

        @media (min-width: 768px) {
            .investment-icon-wrapper {
                width: 40px; /* Restore width on desktop */
                height: 40px; /* Restore height on desktop */
            }
        }

        .investment-icon {
            width: 20px; /* Smaller icon inside wrapper on mobile */
            height: 20px;
            fill: #66BB6A; /* Green color for the icon itself */
            filter: drop-shadow(0 0 3px rgba(102, 187, 106, 0.5)); /* Subtle glow */
        }

        @media (min-width: 768px) {
            .investment-icon {
                width: 24px; /* Restore icon size on desktop */
                height: 24px;
            }
        }

        .investment-name {
            font-weight: 700; /* Bolder name */
            color: #d0d0d0; /* Lighter text for name */
            font-size: 1.1rem; /* Smaller font on mobile */
            grid-column: 2 / 3; /* Place in second column */
        }

        @media (min-width: 768px) {
            .investment-name {
                font-size: 1.2rem; /* Restore font size on desktop */
            }
        }

        .investment-type {
            font-size: 0.85rem; /* Smaller type text on mobile */
            color: #a0a0a0; /* Softer grey */
            grid-column: 2 / 3; /* Place in second column */
        }

        @media (min-width: 768px) {
            .investment-type {
                font-size: 0.95rem; /* Restore font size on desktop */
            }
        }

        .investment-values {
            grid-column: 2 / 3; /* Place in second column */
            display: flex;
            flex-direction: column; /* Stack values vertically on mobile */
            align-items: flex-start; /* Align to start on mobile */
            width: 100%; /* Take full width of its grid cell */
            padding-top: 0.4rem; /* Adjusted space from type */
            border-top: 1px solid rgba(255, 255, 255, 0.05); /* Separator line */
            margin-top: 0.4rem; /* Adjusted space from separator */
        }

        @media (min-width: 768px) {
            .investment-values {
                flex-direction: row; /* Restore horizontal layout on desktop */
                justify-content: space-between; /* Restore space-between on desktop */
                align-items: center; /* Restore alignment on desktop */
                padding-top: 0.5rem; /* Restore padding */
                margin-top: 0.5rem; /* Restore margin */
            }
        }

        .investment-value {
            font-weight: 800; /* Extra bold for value */
            color: #e0e0e0; /* Even lighter for value */
            font-size: 1rem; /* Smaller font on mobile */
            margin-bottom: 0.2rem; /* Space between stacked values */
        }

        @media (min-width: 768px) {
            .investment-value {
                font-size: 1.2rem; /* Restore font size on desktop */
                margin-bottom: 0; /* Remove margin when horizontal */
            }
        }

        .profit {
            color: #66BB6A; /* Brighter green for profit */
            font-weight: 700;
            text-shadow: 0 0 3px rgba(102, 187, 106, 0.4); /* Subtle glow for profit text */
        }

        .loss {
            color: #EF5350; /* Brighter red for loss */
            font-weight: 700;
            text-shadow: 0 0 3px rgba(239, 83, 80, 0.4); /* Subtle glow for loss text */
        }

        /* Expanded Investment Details */
        .investment-details-expanded {
            grid-column: 1 / -1; /* Span full width */
            background-color: #2d2d2d;
            border-radius: 0.75rem;
            padding: 0.8rem; /* Adjusted padding for mobile */
            margin-top: 0.8rem; /* Adjusted margin */
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: slideDown 0.3s ease-out forwards;
            overflow: hidden; /* Ensure content doesn't overflow during animation */
        }
        @keyframes slideDown {
            from { max-height: 0; opacity: 0; padding-top: 0; padding-bottom: 0; }
            to { max-height: 200px; opacity: 1; padding-top: 0.8rem; padding-bottom: 0.8rem; } /* Max height to allow content */
        }

        .investment-details-expanded p {
            display: flex;
            align-items: center;
            margin-bottom: 0.4rem; /* Adjusted margin */
            font-size: 0.85rem; /* Smaller font on mobile */
            color: #c0c0c0;
        }
        .investment-details-expanded p svg {
            margin-right: 6px; /* Adjusted margin */
            color: #80CBC4; /* Teal for detail icons */
            width: 16px; /* Smaller icons */
            height: 16px;
        }
        .investment-details-expanded .detail-label {
            font-weight: 600;
            color: #b0c4de;
            margin-right: 4px; /* Adjusted margin */
        }

        @media (min-width: 768px) {
            .investment-details-expanded {
                padding: 1rem; /* Restore padding on desktop */
                margin-top: 1rem; /* Restore margin */
            }
            .investment-details-expanded p {
                margin-bottom: 0.5rem; /* Restore margin */
                font-size: 0.9rem; /* Restore font size */
            }
            .investment-details-expanded p svg {
                margin-right: 8px; /* Restore margin */
                width: 18px; /* Restore icon size */
                height: 18px;
            }
            .investment-details-expanded .detail-label {
                margin-right: 5px; /* Restore margin */
            }
        }


        /* Calculator result styling */
        #projectedReturnDisplay {
            /* Darker gradient for result display with more vibrant teal */
            background: linear-gradient(90deg, #004d40 0%, #00695c 100%);
            padding: 1.5rem; /* Adjusted padding for mobile */
            border-radius: 1rem; /* Slightly less rounded on mobile */
            margin-top: 1.5rem; /* Adjusted space */
            border: 1px solid #26A69A; /* Vibrant teal border */
            text-align: center;
            font-size: 1.1rem; /* Smaller font on mobile */
            font-weight: 600;
            color: #E0F2F7; /* Lighter text for result */
            box-shadow: 0 5px 15px rgba(0, 105, 92, 0.5); /* Teal shadow */
        }

        @media (min-width: 768px) {
            #projectedReturnDisplay {
                padding: 1.8rem; /* Restore padding on desktop */
                border-radius: 1.25rem; /* Restore rounded on desktop */
                margin-top: 2rem; /* Restore space */
                font-size: 1.35rem; /* Restore font size */
            }
        }

        #projectedReturnDisplay span {
            font-size: 1.8rem; /* Smaller for main result on mobile */
            font-weight: 900; /* Extra bold */
            color: #80CBC4; /* Brighter teal for the main result */
            display: block;
            margin-top: 0.5rem; /* Adjusted margin */
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3); /* Text shadow for depth */
        }

        @media (min-width: 768px) {
            #projectedReturnDisplay span {
                font-size: 2.2rem; /* Restore larger on desktop */
                margin-top: 0.75rem; /* Restore margin */
            }
        }

        /* Quick Links */
        .sidebar-content a {
            color: #90CAF9; /* Lighter blue for links */
            font-weight: 600;
        }
        .sidebar-content a:hover {
            color: #BBDEFB; /* Even lighter on hover */
            text-decoration: underline; /* Underline on hover */
        }

        /* Daily Percentage Animation */
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.9; }
            100% { transform: scale(1); opacity: 1; }
        }

        .daily-percentage-animated {
            animation: pulse 2s infinite ease-in-out;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* Darker overlay */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px); /* Frosted glass effect */
            padding: 1rem; /* Add padding to overlay for small screens */
            box-sizing: border-box;
        }

        .modal-content {
            background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%); /* Darker modal background */
            padding: 1.5rem; /* Adjusted padding for mobile */
            border-radius: 1rem; /* Slightly less rounded on mobile */
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5); /* Stronger shadow */
            width: 100%; /* Full width on mobile */
            max-width: 500px; /* Default max-width */
            position: relative;
            animation: fadeIn 0.3s ease-out;
            border: 1px solid rgba(255, 255, 255, 0.1); /* Subtle border */
            overflow-y: auto; /* Allow scrolling if content overflows */
            max-height: 95vh; /* Limit height on mobile */
        }

        @media (min-width: 768px) {
            .modal-content {
                padding: 2.5rem; /* Restore padding on desktop */
                border-radius: 1.5rem; /* Restore rounded on desktop */
                max-height: auto; /* Remove max height on desktop */
            }
        }

        /* Specific style for the Invest Modal to make it larger */
        #investModal .modal-content {
            max-width: 800px; /* Larger width for invest modal */
            display: grid;
            grid-template-columns: 1fr; /* Single column on mobile */
            gap: 1.5rem; /* Adjusted gap for mobile */
        }

        @media (min-width: 768px) {
            #investModal .modal-content {
                grid-template-columns: 1fr 1.5fr; /* Two columns for larger screens */
                gap: 2rem; /* Restore gap on desktop */
            }
        }

        .modal-close-btn {
            position: absolute;
            top: 0.75rem; /* Adjusted position for mobile */
            right: 0.75rem; /* Adjusted position for mobile */
            background: none;
            border: none;
            font-size: 1.5rem; /* Smaller close button on mobile */
            color: #a0a0a0;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        @media (min-width: 768px) {
            .modal-close-btn {
                top: 1rem; /* Restore position on desktop */
                right: 1rem; /* Restore position on desktop */
                font-size: 1.8rem; /* Restore size on desktop */
            }
        }

        .modal-title {
            font-size: 1.6rem; /* Smaller modal title on mobile */
            font-weight: 700;
            color: #b0c4de;
            margin-bottom: 1.5rem; /* Adjusted space */
            text-align: center;
            grid-column: 1 / -1; /* Span all columns in grid */
        }

        @media (min-width: 768px) {
            .modal-title {
                font-size: 2rem; /* Restore size on desktop */
                margin-bottom: 1.8rem; /* Restore space */
            }
        }

        .transaction-item {
            background-color: #3a3a3a;
            border-radius: 0.75rem;
            padding: 1rem 1.2rem; /* Adjusted padding for mobile */
            margin-bottom: 0.6rem; /* Adjusted margin */
            display: flex;
            flex-direction: column; /* Stack details vertically on mobile */
            align-items: flex-start; /* Align to start on mobile */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        @media (min-width: 768px) {
            .transaction-item {
                padding: 1rem 1.5rem; /* Restore padding on desktop */
                margin-bottom: 0.8rem; /* Restore margin */
                flex-direction: row; /* Restore horizontal layout on desktop */
                justify-content: space-between; /* Restore space-between on desktop */
                align-items: center; /* Restore alignment on desktop */
            }
        }

        .transaction-item div {
            flex-grow: 1;
        }

        .transaction-type {
            font-weight: 700;
            color: #66BB6A; /* Green for positive transactions */
            font-size: 1rem; /* Adjusted font size */
        }
        .transaction-type.withdrawal {
            color: #EF5350; /* Red for negative transactions */
        }

        .transaction-amount {
            font-weight: 700;
            text-align: left; /* Align left on mobile */
            font-size: 1rem; /* Adjusted font size */
            margin-top: 0.2rem; /* Space when stacked */
        }
        @media (min-width: 768px) {
            .transaction-amount {
                text-align: right; /* Restore align right on desktop */
                margin-top: 0; /* Remove margin when horizontal */
            }
        }
        .transaction-date {
            font-size: 0.75rem; /* Smaller font on mobile */
            color: #a0a0a0;
            text-align: left; /* Align left on mobile */
        }
        @media (min-width: 768px) {
            .transaction-date {
                font-size: 0.85rem; /* Restore font size on desktop */
                text-align: right; /* Restore align right on desktop */
            }
        }

        /* User ID display */
        #userIdDisplay {
            word-break: break-all; /* Ensures long IDs wrap */
            font-size: 0.7rem; /* Smaller font on mobile */
            color: #888;
            margin-top: 0.8rem; /* Adjusted margin */
            text-align: center;
            padding: 0.4rem; /* Adjusted padding */
            background-color: #333;
            border-radius: 0.4rem; /* Adjusted rounded corners */
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
        }
        @media (min-width: 768px) {
            #userIdDisplay {
                font-size: 0.8rem; /* Restore font size on desktop */
                margin-top: 1rem; /* Restore margin */
                padding: 0.5rem; /* Restore padding */
                border-radius: 0.5rem; /* Restore rounded corners */
            }
        }

        /* New styles for investment details in modal */
        .investment-details-card {
            background-color: #3a3a3a;
            border-radius: 0.75rem; /* Slightly less rounded on mobile */
            padding: 1.2rem; /* Adjusted padding for mobile */
            box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        @media (min-width: 768px) {
            .investment-details-card {
                border-radius: 1rem; /* Restore rounded on desktop */
                padding: 1.5rem; /* Restore padding on desktop */
            }
        }

        .investment-details-card h4 {
            font-size: 1.3rem; /* Smaller h4 on mobile */
            font-weight: 700;
            color: #66BB6A;
            margin-bottom: 0.8rem; /* Adjusted margin */
        }
        @media (min-width: 768px) {
            .investment-details-card h4 {
                font-size: 1.5rem; /* Restore size on desktop */
                margin-bottom: 1rem; /* Restore margin */
            }
        }

        .investment-details-card p {
            font-size: 0.85rem; /* Smaller font on mobile */
            color: #d0d0d0;
            margin-bottom: 0.4rem; /* Adjusted margin */
            display: flex;
            align-items: flex-start; /* Align to start for multi-line descriptions */
        }
        @media (min-width: 768px) {
            .investment-details-card p {
                font-size: 0.95rem; /* Restore font size on desktop */
                margin-bottom: 0.5rem; /* Restore margin */
                align-items: center; /* Restore alignment on desktop */
            }
        }
        .investment-details-card p svg {
            margin-right: 6px; /* Adjusted margin */
            color: #b0c4de;
            flex-shrink: 0; /* Prevent icon from shrinking */
            width: 18px; /* Adjusted size */
            height: 18px;
        }
        @media (min-width: 768px) {
            .investment-details-card p svg {
                margin-right: 8px; /* Restore margin */
                width: 20px; /* Restore size */
                height: 20px;
            }
        }

        .investment-details-card .detail-label {
            font-weight: 600;
            color: #b0c4de;
        }

        /* Flex container for duration input and unit */
        .duration-input-group {
            display: flex;
            flex-direction: column; /* Stack on mobile */
            gap: 0.5rem; /* Adjusted gap */
            align-items: flex-start;
        }
        @media (min-width: 768px) {
            .duration-input-group {
                flex-direction: row; /* Restore row on desktop */
                gap: 10px; /* Restore gap */
                align-items: center;
            }
        }
        .duration-input-group input {
            flex-grow: 1;
        }
        .duration-input-group select {
            width: 100%; /* Full width on mobile */
            min-width: unset; /* Remove min-width on mobile */
        }
        @media (min-width: 768px) {
            .duration-input-group select {
                width: auto; /* Restore auto width on desktop */
                min-width: 100px; /* Restore min-width on desktop */
            }
        }

        /* Styles for confirmation modal */
        .confirmation-modal-content {
            background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%);
            padding: 1.5rem; /* Adjusted padding for mobile */
            border-radius: 1rem; /* Slightly less rounded on mobile */
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
            width: 90%;
            max-width: 400px;
            text-align: center;
            position: relative;
            animation: fadeIn 0.3s ease-out;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        @media (min-width: 768px) {
            .confirmation-modal-content {
                padding: 2.5rem; /* Restore padding on desktop */
                border-radius: 1.5rem; /* Restore rounded on desktop */
            }
        }
        .confirmation-modal-content h3 {
            font-size: 1.5rem; /* Smaller h3 on mobile */
            color: #b0c4de;
            margin-bottom: 1rem; /* Adjusted margin */
        }
        @media (min-width: 768px) {
            .confirmation-modal-content h3 {
                font-size: 1.8rem; /* Restore size on desktop */
                margin-bottom: 1.5rem; /* Restore margin */
            }
        }
        .confirmation-modal-content p {
            color: #d0d0d0;
            margin-bottom: 1.5rem; /* Adjusted margin */
            font-size: 0.9rem; /* Smaller font on mobile */
        }
        @media (min-width: 768px) {
            .confirmation-modal-content p {
                margin-bottom: 2rem; /* Restore margin */
                font-size: 1rem; /* Restore font size */
            }
        }
        .confirmation-modal-buttons {
            display: flex;
            flex-direction: column; /* Stack buttons on mobile */
            gap: 0.8rem; /* Adjusted gap */
        }
        @media (min-width: 768px) {
            .confirmation-modal-buttons {
                flex-direction: row; /* Restore row on desktop */
                justify-content: space-around;
                gap: 1rem; /* Restore gap */
            }
        }

        /* Success/Error Message in Modals */
        .modal-message {
            margin-top: 0.8rem; /* Adjusted margin */
            font-weight: 600;
            padding: 0.6rem; /* Adjusted padding */
            border-radius: 0.4rem; /* Adjusted rounded corners */
            text-align: center;
            font-size: 0.85rem; /* Smaller font on mobile */
        }
        @media (min-width: 768px) {
            .modal-message {
                margin-top: 1rem; /* Restore margin */
                padding: 0.75rem; /* Restore padding */
                border-radius: 0.5rem; /* Restore rounded corners */
                font-size: 1rem; /* Restore font size */
            }
        }
        .modal-message.success {
            background-color: rgba(76, 175, 80, 0.2); /* Green background */
            color: #66BB6A; /* Green text */
        }
        .modal-message.error {
            background-color: rgba(239, 83, 80, 0.2); /* Red background */
            color: #EF5350; /* Red text */
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Main Content Area -->
        <div class="main-content">
            <h1 class="section-title text-center mb-6">Grow-with-Core Dashboard</h1>
            <p class="text-center text-gray-400 mb-8 max-w-2xl mx-auto text-sm sm:text-base">
                Welcome to your Grow-with-Core investment hub. Explore real-time investment simulations, manage your portfolio, and track your financial journey.
            </p>

            <!-- User ID Display -->
            <div id="userIdDisplay" class="mb-8">
                Loading User ID...
            </div>

            <!-- Investment Overview Section -->
            <div class="card mb-10">
                <h2 class="section-title">Investment Overview</h2>
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-8">
                    <div class="metric-box">
                        <div class="icon-svg">
                            <!-- Wallet icon for available balance -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-wallet"><path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h12a2 2 0 0 1 0 4H5a2 2 0 0 0 0 4h12a2 2 0 0 0 2-2v-3"/><path d="M10 12h6"/></svg>
                        </div>
                        <div class="metric-value" id="availableBalance">₦0.00</div>
                        <div class="metric-label">Available Balance</div>
                    </div>
                    <div class="metric-box">
                        <div class="icon-svg">
                            <!-- Hand holding dollar icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-hand-holding-dollar"><path d="M11 15h2a2 2 0 0 0 2-2V7h-2.5a2 2 0 0 1-2-2M12 7V4m-3 6H6a2 2 0 1 0 0 4h3"/><path d="M18 13h2a2 2 0 0 1 0 4h-3l-5 5V3l5 5z"/></svg>
                        </div>
                        <div class="metric-value" id="totalInvested">₦0.00</div>
                        <div class="metric-label">Total Invested</div>
                    </div>
                    <div class="metric-box">
                        <div class="icon-svg">
                            <!-- Trending Up icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trending-up"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
                        </div>
                        <div class="metric-value" id="currentValue">₦0.00</div>
                        <div class="metric-label">Current Value</div>
                    </div>
                    <div class="metric-box">
                        <div class="icon-svg">
                            <!-- Piggy Bank icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-piggy-bank"><path d="M19 5c-1.5 0-2.8 1.4-3 2H4"/><path d="M2 8v8a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-1.5"/><path d="M22 12a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v.5c0 2.2 1.8 4 4 4h12a4 4 0 0 0 4-4V12z"/><path d="M2 16h.01"/><path d="M21 16h.01"/></svg>
                        </div>
                        <div class="metric-value" id="totalProfitLoss">₦0.00</div>
                        <div class="metric-label">Total Profit/Loss</div>
                    </div>
                </div>

                <h3 class="text-xl font-semibold text-gray-400 mb-4 text-center">Your Active Investments</h3>
                <div id="investmentList">
                    <!-- Investment items will be populated here by JavaScript -->
                    <p class="text-center text-gray-500" id="noInvestmentsMessage">No active investments yet. Start by investing!</p>
                </div>
            </div>

            <!-- Portfolio Allocation Chart Section -->
            <div class="card mb-10">
                <h2 class="section-title">Portfolio Allocation</h2>
                <div class="p-2 sm:p-4">
                    <canvas id="portfolioChart"></canvas>
                </div>
                <p class="text-sm text-gray-400 mt-4 text-center">Visual representation of your investment distribution.</p>
            </div>

            <!-- Investment Calculator Section -->
            <div class="card mb-10">
                <h2 class="section-title">Investment Calculator (Projection)</h2>
                <p class="text-gray-400 mb-6 text-center text-sm sm:text-base">
                    Use this calculator to project potential returns for new investments.
                    Actual growth is simulated in real-time in your active investments.
                </p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6">
                    <div>
                        <label for="calcInitialInvestment" class="block text-gray-300 text-sm font-bold mb-2">Initial Investment (₦)</label>
                        <input type="number" id="calcInitialInvestment" class="form-input" placeholder="e.g., 5000" value="5000" min="5000">
                    </div>
                    <div>
                        <label for="calcInvestmentDuration" class="block text-gray-300 text-sm font-bold mb-2">Duration (Years)</label>
                        <input type="number" id="calcInvestmentDuration" class="form-input" placeholder="e.g., 5" value="5" min="1">
                    </div>
                    <div class="md:col-span-2">
                        <label for="calcAnnualReturnRate" class="block text-gray-300 text-sm font-bold mb-2">Expected Annual Return Rate (%)</label>
                        <input type="number" id="calcAnnualReturnRate" class="form-input" placeholder="e.g., 8" value="8" min="0" step="0.1">
                    </div>
                </div>
                <button id="calculateBtn" class="btn-primary w-full mt-6 sm:mt-8">Calculate Projected Return</button>
                <div id="projectedReturnDisplay" class="hidden">
                    Your Projected Return: <span id="calculatedValue">₦0.00</span>
                </div>
            </div>

            <!-- Transaction History Section -->
            <div class="card">
                <h2 class="section-title">Transaction History</h2>
                <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 mb-4 sm:mb-6">
                    <div class="flex-grow">
                        <label for="transactionFilter" class="block text-gray-300 text-sm font-bold mb-2">Filter by Type</label>
                        <select id="transactionFilter" class="form-select">
                            <option value="All">All</option>
                            <option value="Deposit">Deposit</option>
                            <option value="Investment">Investment</option>
                            <option value="Cash Out">Cash Out</option>
                            <option value="Withdrawal">Withdrawal</option>
                        </select>
                    </div>
                    <div class="flex-grow">
                        <label for="transactionSort" class="block text-gray-300 text-sm font-bold mb-2">Sort by</label>
                        <select id="transactionSort" class="form-select">
                            <option value="dateDesc">Date (Newest First)</option>
                            <option value="dateAsc">Date (Oldest First)</option>
                            <option value="amountDesc">Amount (High to Low)</option>
                            <option value="amountAsc">Amount (Low to High)</option>
                        </select>
                    </div>
                </div>
                <div id="transactionHistoryList" class="space-y-2 sm:space-y-3">
                    <!-- Transaction items will be populated here by JavaScript -->
                    <p class="text-center text-gray-500" id="noTransactionsMessage">No transactions recorded yet.</p>
                </div>
            </div>
        </div>

        <!-- Sidebar / Daily Performance & Quick Links -->
        <div class="sidebar-content">
            <!-- Daily Performance Section -->
            <div class="card mb-6 sm:mb-10">
                <h2 class="section-title">Daily Performance</h2>
                <div class="metric-box">
                    <div class="icon-svg">
                        <!-- Activity icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-activity"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
                    </div>
                    <div class="metric-value text-green-400 daily-percentage-animated" id="dailyPercentage">+0.35%</div>
                    <div class="metric-label">Today's Market Gain</div>
                    <p class="text-xs text-gray-400 mt-1 sm:mt-2">Based on simulated market data.</p>
                </div>
            </div>

            <!-- Quick Actions Section -->
            <div class="card">
                <h2 class="section-title">Quick Actions</h2>
                <ul class="space-y-3 sm:space-y-4">
                    <li>
                        <button id="openInvestModalBtn" class="btn-primary w-full flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-wallet-plus mr-2"><path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h12a2 2 0 0 1 0 4H5a2 2 0 0 0 0 4h12a2 2 0 0 0 2-2v-3"/><path d="M10 12h6"/><path d="M12 10v4"/></svg>
                            Invest Now
                        </button>
                    </li>
                    <li>
                        <button id="openCashOutModalBtn" class="btn-primary w-full flex items-center justify-center !bg-red-600 hover:!bg-red-700">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-wallet-minus mr-2"><path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h12a2 2 0 0 1 0 4H5a2 2 0 0 0 0 4h12a2 2 0 0 0 2-2v-3"/><path d="M10 12h6"/></svg>
                            Cash Out
                        </button>
                    </li>
                    <li>
                        <button id="openDepositModalBtn" class="btn-primary w-full flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-dollar-sign mr-2"><circle cx="12" cy="12" r="10"/><path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"/><path d="M12 3v18"/></svg>
                            Deposit Funds
                        </button>
                    </li>
                    <li>
                        <button id="openWithdrawModalBtn" class="btn-primary w-full flex items-center justify-center !bg-red-600 hover:!bg-red-700">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-credit-card mr-2"><rect width="20" height="14" x="2" y="5" rx="2"/><path d="M2 10h20"/></svg>
                            Withdraw Funds
                        </button>
                    </li>
                    <li>
                        <button id="openResetDataModalBtn" class="btn-primary w-full flex items-center justify-center !bg-gray-700 hover:!bg-gray-800">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-rotate-ccw mr-2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.76 2.75L3 8"/><path d="M3 3v5h5"/></svg>
                            Reset All Data
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Modals -->

    <!-- Invest Modal -->
    <div id="investModal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-btn" id="closeInvestModalBtn">&times;</button>
            <h3 class="modal-title">Make a New Investment</h3>

            <!-- Left column: Investment Details & Inputs -->
            <div class="space-y-4">
                <div>
                    <label for="investmentCategory" class="block text-gray-300 text-sm font-bold mb-2">Investment Category</label>
                    <select id="investmentCategory" class="form-select">
                        <option value="">Select Category</option>
                        <option value="Farming">Farming</option>
                        <option value="Rearing">Rearing</option>
                        <option value="Other Opportunities">Other Opportunities</option>
                    </select>
                </div>
                <div>
                    <label for="investmentType" class="block text-gray-300 text-sm font-bold mb-2">Investment Type</label>
                    <select id="investmentType" class="form-select" disabled>
                        <option value="">Select Type</option>
                    </select>
                </div>

                <!-- Investment Details Display -->
                <div id="investmentTypeDetails" class="investment-details-card hidden">
                    <h4 id="detailsTypeName"></h4>
                    <p><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-info"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg><span class="detail-label">Description:</span> <span id="detailsDescription"></span></p>
                    <p><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-dollar-sign"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg><span class="detail-label">Typical Annual Return:</span> <span id="detailsReturnRange"></span></p>
                    <p><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg><span class="detail-label">Minimum Duration:</span> <span id="detailsMinDuration"></span></p>
                </div>

                <div>
                    <label for="investmentAmount" class="block text-gray-300 text-sm font-bold mb-2">Investment Amount (₦)</label>
                    <input type="number" id="investmentAmount" class="form-input" placeholder="e.g., 10000" min="1000">
                </div>
                <div>
                    <label for="investmentDuration" class="block text-gray-300 text-sm font-bold mb-2">Investment Duration</label>
                    <div class="duration-input-group">
                        <input type="number" id="investmentDuration" class="form-input" placeholder="e.g., 12" min="1">
                        <select id="investmentDurationUnit" class="form-select">
                            <option value="months">Months</option>
                            <option value="years">Years</option>
                        </select>
                    </div>
                </div>
                <button id="submitInvestmentBtn" class="btn-primary w-full">Invest</button>
                <p id="investMessage" class="text-center text-sm mt-2 modal-message hidden"></p>
            </div>

            <!-- Right column: Projection Chart -->
            <div class="investment-details-card flex flex-col justify-between">
                <h4 class="text-center">Projected Investment Growth</h4>
                <div class="p-2 sm:p-4 flex-grow flex items-center justify-center">
                    <canvas id="investmentProjectionChart"></canvas>
                </div>
                <p class="text-sm text-gray-400 text-center mt-2 sm:mt-4" id="projectionInfo">
                    Adjust amount and duration to see your potential growth.
                </p>
            </div>
        </div>
    </div>

    <!-- Cash Out Modal -->
    <div id="cashOutModal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-btn" id="closeCashOutModalBtn">&times;</button>
            <h3 class="modal-title">Cash Out Investment</h3>
            <div class="space-y-4">
                <div>
                    <label for="cashOutInvestmentSelect" class="block text-gray-300 text-sm font-bold mb-2">Select Investment</label>
                    <select id="cashOutInvestmentSelect" class="form-select">
                        <option value="">Select an active investment</option>
                    </select>
                </div>
                <div>
                    <label for="cashOutAmount" class="block text-gray-300 text-sm font-bold mb-2">Amount to Cash Out (₦)</label>
                    <input type="number" id="cashOutAmount" class="form-input" placeholder="e.g., 5000" min="100">
                </div>
                <button id="submitCashOutBtn" class="btn-primary w-full !bg-red-600 hover:!bg-red-700">Confirm Cash Out</button>
                <p id="cashOutMessage" class="text-center text-sm mt-2 modal-message hidden"></p>
            </div>
        </div>
    </div>

    <!-- Deposit Funds Modal -->
    <div id="depositModal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-btn" id="closeDepositModalBtn">&times;</button>
            <h3 class="modal-title">Deposit Funds via Paystack</h3>
            <div class="space-y-4">
                <div>
                    <label for="depositEmail" class="block text-gray-300 text-sm font-bold mb-2">Your Email</label>
                    <input type="email" id="depositEmail" class="form-input" placeholder="e.g., your@email.com" required>
                </div>
                <div>
                    <label for="depositAmount" class="block text-gray-300 text-sm font-bold mb-2">Deposit Amount (₦)</label>
                    <input type="number" id="depositAmount" class="form-input" placeholder="e.g., 20000" min="100" required>
                </div>
                <button id="submitDepositBtn" class="btn-primary w-full">Proceed to Paystack</button>
                <p id="depositMessage" class="text-center text-sm mt-2 modal-message hidden"></p>
            </div>
        </div>
    </div>

    <!-- Withdraw Funds Modal -->
    <div id="withdrawModal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-btn" id="closeWithdrawModalBtn">&times;</button>
            <h3 class="modal-title">Withdraw Funds</h3>
            <div class="space-y-4">
                <div>
                    <label for="withdrawAmount" class="block text-gray-300 text-sm font-bold mb-2">Withdraw Amount (₦)</label>
                    <input type="number" id="withdrawAmount" class="form-input" placeholder="e.g., 5000" min="100">
                </div>
                <button id="submitWithdrawBtn" class="btn-primary w-full !bg-red-600 hover:!bg-red-700">Confirm Withdrawal</button>
                <p id="withdrawMessage" class="text-center text-sm mt-2 modal-message hidden"></p>
            </div>
        </div>
    </div>

    <!-- Reset Data Confirmation Modal -->
    <div id="resetDataModal" class="modal-overlay hidden">
        <div class="confirmation-modal-content">
            <button class="modal-close-btn" id="closeResetDataModalBtn">&times;</button>
            <h3>Confirm Data Reset</h3>
            <p>Are you sure you want to reset all your investment data? This action cannot be undone.</p>
            <div class="confirmation-modal-buttons">
                <button id="confirmResetDataBtn" class="btn-primary !bg-red-600 hover:!bg-red-700">Yes, Reset All</button>
                <button id="cancelResetDataBtn" class="btn-primary !bg-gray-500 hover:!bg-gray-600">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Global state for investments, transactions, and account balance
        let userInvestments = [];
        let userTransactions = [];
        let userAccountBalance = 0;
        let currentUserId; // Will be generated or retrieved from localStorage

        // Paystack Public Key (from user's request)
        const paystackPublicKey = 'pk_live_fa0e4bf22ce6b0279a243185d983ec121b99979c';

        // DOM Elements
        const availableBalanceEl = document.getElementById('availableBalance'); // New element
        const totalInvestedEl = document.getElementById('totalInvested');
        const currentValueEl = document.getElementById('currentValue');
        const totalProfitLossEl = document.getElementById('totalProfitLoss');
        const investmentListEl = document.getElementById('investmentList');
        const noInvestmentsMessage = document.getElementById('noInvestmentsMessage');
        const transactionHistoryListEl = document.getElementById('transactionHistoryList');
        const noTransactionsMessage = document.getElementById('noTransactionsMessage');
        const userIdDisplay = document.getElementById('userIdDisplay');

        // Modals
        const investModal = document.getElementById('investModal');
        const cashOutModal = document.getElementById('cashOutModal');
        const depositModal = document.getElementById('depositModal');
        const withdrawModal = document.getElementById('withdrawModal');
        const resetDataModal = document.getElementById('resetDataModal');

        // Invest Modal specific elements
        const investmentCategorySelect = document.getElementById('investmentCategory');
        const investmentTypeSelect = document.getElementById('investmentType');
        const investmentAmountInput = document.getElementById('investmentAmount');
        const investmentDurationInput = document.getElementById('investmentDuration');
        const investmentDurationUnitSelect = document.getElementById('investmentDurationUnit');
        const investMessage = document.getElementById('investMessage');
        const investmentTypeDetails = document.getElementById('investmentTypeDetails');
        const detailsTypeName = document.getElementById('detailsTypeName');
        const detailsDescription = document.getElementById('detailsDescription');
        const detailsReturnRange = document.getElementById('detailsReturnRange');
        const detailsMinDuration = document.getElementById('detailsMinDuration');
        const projectionInfo = document.getElementById('projectionInfo');

        // Transaction History Filter/Sort elements
        const transactionFilterSelect = document.getElementById('transactionFilter');
        const transactionSortSelect = document.getElementById('transactionSort');


        // Investment types data with more details
        const investmentTypes = {
            "Farming": {
                "Crop Farming": {
                    description: "Invest in staple crops like maize, rice, or cassava. High demand, steady returns.",
                    minDurationMonths: 6,
                    typicalAnnualReturn: 12.5, // Average for projection
                    returnRange: "10-15%"
                },
                "Organic Farming": {
                    description: "Support eco-friendly farming practices. Premium market, sustainable growth.",
                    minDurationMonths: 9,
                    typicalAnnualReturn: 15,
                    returnRange: "12-18%"
                },
                "Livestock Feed Production": {
                    description: "Invest in the production of animal feed. Essential for rearing, consistent demand.",
                    minDurationMonths: 8,
                    typicalAnnualReturn: 11,
                    returnRange: "9-13%"
                },
                "Greenhouse Farming": {
                    description: "Modern farming technique for controlled environments. High yield, less weather dependent.",
                    minDurationMonths: 12,
                    typicalAnnualReturn: 16,
                    returnRange: "14-18%"
                },
                "Aquaponics": {
                    description: "Sustainable system combining aquaculture and hydroponics. Efficient and eco-friendly.",
                    minDurationMonths: 15,
                    typicalAnnualReturn: 17,
                    returnRange: "15-19%"
                },
                "Hydroponics": {
                    description: "Growing plants without soil using mineral nutrient solutions. Water-efficient, high-density yields.",
                    minDurationMonths: 10,
                    typicalAnnualReturn: 14,
                    returnRange: "12-16%"
                },
                "Vertical Farming": {
                    description: "Growing crops in vertically stacked layers. Maximizes space, ideal for urban areas.",
                    minDurationMonths: 18,
                    typicalAnnualReturn: 19,
                    returnRange: "17-21%"
                },
                "Sustainable Farming": {
                    description: "Focuses on long-term productivity and environmental health. Ethical investment.",
                    minDurationMonths: 12,
                    typicalAnnualReturn: 13,
                    returnRange: "11-15%"
                },
                "Specialty Crops": {
                    description: "Invest in high-value, niche crops. Higher potential returns, but can be more volatile.",
                    minDurationMonths: 7,
                    typicalAnnualReturn: 18,
                    returnRange: "16-20%"
                },
                "Fruit and Vegetable Farming": {
                    description: "Direct investment in fresh produce. Consistent local market demand.",
                    minDurationMonths: 6,
                    typicalAnnualReturn: 10,
                    returnRange: "8-12%"
                }
            },
            "Rearing": {
                "Cattle Rearing": {
                    description: "Invest in cattle for meat and dairy. Long-term growth potential.",
                    minDurationMonths: 12,
                    typicalAnnualReturn: 10,
                    returnRange: "8-12%"
                },
                "Poultry Farming": {
                    description: "Fast-cycle investment in chicken production. Quick returns.",
                    minDurationMonths: 3,
                    typicalAnnualReturn: 17.5,
                    returnRange: "15-20%"
                },
                "Pig Farming": {
                    description: "Investment in pig breeding and fattening. Good demand for pork products.",
                    minDurationMonths: 9,
                    typicalAnnualReturn: 14,
                    returnRange: "12-16%"
                },
                "Sheep or Goat Rearing": {
                    description: "Flexible investment in small ruminants. Lower initial capital, steady market.",
                    minDurationMonths: 7,
                    typicalAnnualReturn: 13,
                    returnRange: "11-15%"
                },
                "Fish Farming": {
                    description: "Aquaculture investment for various fish species. Growing demand for protein.",
                    minDurationMonths: 6,
                    typicalAnnualReturn: 16,
                    returnRange: "14-18%"
                },
                "Beekeeping": {
                    description: "Invest in honey production and pollination services. Environmentally friendly.",
                    minDurationMonths: 10,
                    typicalAnnualReturn: 11,
                    returnRange: "9-13%"
                },
                "Rabbit Rearing": {
                    description: "Quick breeding cycle, low space requirement. Niche market potential.",
                    minDurationMonths: 4,
                    typicalAnnualReturn: 15,
                    returnRange: "13-17%"
                },
                "Game Farming": {
                    description: "Rearing of wild animals for meat or tourism. Specialized, potentially high returns.",
                    minDurationMonths: 18,
                    typicalAnnualReturn: 20,
                    returnRange: "18-22%"
                },
                "Dairy Goat Farming": {
                    description: "Focus on milk production from goats. Growing market for dairy alternatives.",
                    minDurationMonths: 10,
                    typicalAnnualReturn: 12,
                    returnRange: "10-14%"
                },
                "Quail Farming": {
                    description: "Small-scale, high-density farming for meat and eggs. Very quick turnover.",
                    minDurationMonths: 2,
                    typicalAnnualReturn: 22,
                    returnRange: "20-25%"
                }
            },
            "Other Opportunities": {
                "Agricultural Technology": {
                    description: "Fund innovative tech solutions for agriculture. High growth, higher risk.",
                    minDurationMonths: 18,
                    typicalAnnualReturn: 20,
                    returnRange: "18-25%"
                },
                "Farm Equipment": {
                    description: "Invest in modern farm machinery. Essential infrastructure, steady income.",
                    minDurationMonths: 24,
                    typicalAnnualReturn: 9,
                    returnRange: "8-10%"
                },
                "Agricultural Processing": {
                    description: "Value-addition to raw agricultural products. Stable demand, diverse markets.",
                    minDurationMonths: 15,
                    typicalAnnualReturn: 16,
                    returnRange: "14-18%"
                },
                "Farm-to-Table": {
                    description: "Support direct consumer access to farm produce. Growing trend, community focus.",
                    minDurationMonths: 10,
                    typicalAnnualReturn: 13,
                    returnRange: "11-15%"
                },
                "Agricultural Consulting": {
                    description: "Invest in expertise and advisory services for farmers. Intellectual capital growth.",
                    minDurationMonths: 12,
                    typicalAnnualReturn: 14,
                    returnRange: "12-16%"
                },
                "Farm Management": {
                    description: "Professional management services for agricultural enterprises. Operational efficiency.",
                    minDurationMonths: 12,
                    typicalAnnualReturn: 11,
                    returnRange: "10-12%"
                },
                "Agricultural Education": {
                    description: "Invest in training and development for future farmers. Long-term societal impact.",
                    minDurationMonths: 36,
                    typicalAnnualReturn: 8,
                    returnRange: "7-9%"
                },
                "Sustainable Agriculture": {
                    description: "Projects promoting environmentally sound farming. Impact investing, long-term returns.",
                    minDurationMonths: 20,
                    typicalAnnualReturn: 15,
                    returnRange: "13-17%"
                },
                "Agricultural Research": {
                    description: "Funding R&D for new crop varieties, pest control, etc. High risk, potentially high reward.",
                    minDurationMonths: 30,
                    typicalAnnualReturn: 18,
                    returnRange: "15-20%"
                }
            }
        };

        // Chart.js instances
        let portfolioChart;
        let projectionChart; // New chart for investment modal

        /**
         * Generates a simple UUID for local storage user ID.
         * @returns {string} A unique ID.
         */
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        /**
         * Initializes user data from localStorage or sets defaults.
         */
        function initializeUserData() {
            currentUserId = localStorage.getItem('growWithCoreUserId');
            if (!currentUserId) {
                currentUserId = generateUUID();
                localStorage.setItem('growWithCoreUserId', currentUserId);
            }
            userIdDisplay.textContent = `User ID: ${currentUserId}`;

            const storedInvestments = localStorage.getItem(`growWithCoreInvestments_${currentUserId}`);
            const storedTransactions = localStorage.getItem(`growWithCoreTransactions_${currentUserId}`);
            const storedBalance = localStorage.getItem(`growWithCoreAccountBalance_${currentUserId}`);

            userInvestments = storedInvestments ? JSON.parse(storedInvestments) : [];
            userTransactions = storedTransactions ? JSON.parse(storedTransactions) : [];
            userAccountBalance = storedBalance ? parseFloat(storedBalance) : 0;

            // Simulate growth for existing investments on load
            userInvestments.forEach(inv => {
                // Ensure annualReturnRate is a number
                const annualReturnRate = parseFloat(inv.annualReturnRate);
                if (isNaN(annualReturnRate)) {
                    console.warn(`Invalid annualReturnRate for investment ${inv.id}: ${inv.annualReturnRate}`);
                    inv.currentValue = inv.initialAmount; // Reset to initial if rate is bad
                    inv.profit = 0;
                    return;
                }

                const daysSinceInvest = Math.floor((new Date().getTime() - new Date(inv.investDate).getTime()) / (1000 * 60 * 60 * 24));
                const dailyRate = annualReturnRate / 365 / 100;
                inv.currentValue = inv.initialAmount * Math.pow(1 + dailyRate, daysSinceInvest);
                inv.profit = inv.currentValue - inv.initialAmount;
            });

            saveUserData(); // Save updated current values back
            updateDashboard(); // Render the dashboard with loaded data
        }

        /**
         * Saves current user data to localStorage.
         */
        function saveUserData() {
            localStorage.setItem(`growWithCoreInvestments_${currentUserId}`, JSON.stringify(userInvestments));
            localStorage.setItem(`growWithCoreAccountBalance_${currentUserId}`, userAccountBalance.toString());
            // Only save transactions after filtering/sorting logic is applied, to keep the original array clean
            localStorage.setItem(`growWithCoreTransactions_${currentUserId}`, JSON.stringify(userTransactions));
        }

        /**
         * Updates all dashboard metrics and lists.
         */
        function updateDashboard() {
            // Update Investment Overview
            availableBalanceEl.textContent = formatNaira(userAccountBalance); // Display available balance
            let totalInvested = userInvestments.reduce((sum, inv) => sum + inv.initialAmount, 0);
            let currentValue = userInvestments.reduce((sum, inv) => sum + inv.currentValue, 0);
            let totalProfitLoss = currentValue - totalInvested;

            totalInvestedEl.textContent = formatNaira(totalInvested);
            currentValueEl.textContent = formatNaira(currentValue);
            totalProfitLossEl.textContent = formatNaira(totalProfitLoss);
            totalProfitLossEl.classList.toggle('profit', totalProfitLoss >= 0);
            totalProfitLossEl.classList.toggle('loss', totalProfitLoss < 0);

            // Render Investment List
            investmentListEl.innerHTML = '';
            if (userInvestments.length === 0) {
                noInvestmentsMessage.classList.remove('hidden');
            } else {
                noInvestmentsMessage.classList.add('hidden');
                userInvestments.forEach(inv => {
                    const profitLossClass = inv.profit >= 0 ? 'profit' : 'loss';
                    const investmentItemDiv = document.createElement('div');
                    investmentItemDiv.classList.add('investment-item');
                    investmentItemDiv.dataset.investmentId = inv.id; // Store ID for click handling

                    investmentItemDiv.innerHTML = `
                        <div class="investment-icon-wrapper">${investmentCategoryIcons[inv.category] || ''}</div>
                        <div class="investment-name">${inv.type}</div>
                        <div class="investment-type">Category: ${inv.category}</div>
                        <div class="investment-values">
                            <span class="investment-value">Invested: ${formatNaira(inv.initialAmount)}</span>
                            <span class="investment-value">Current: ${formatNaira(inv.currentValue)}</span>
                            <span class="${profitLossClass}">P/L: ${formatNaira(inv.profit)}</span>
                        </div>
                        <div class="investment-details-expanded hidden">
                            <p><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg><span class="detail-label">Start Date:</span> ${new Date(inv.investDate).toLocaleDateString()}</p>
                            <p><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trending-up"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg><span class="detail-label">Annual Return:</span> ${inv.annualReturnRate}%</p>
                            <p><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg><span class="detail-label">Duration:</span> ${inv.durationMonths} months</p>
                        </div>
                    `;
                    investmentListEl.appendChild(investmentItemDiv);
                });

                // Add event listeners for expanding investment details
                document.querySelectorAll('.investment-item').forEach(item => {
                    item.addEventListener('click', (event) => {
                        // Prevent click on children from toggling parent
                        if (event.target.closest('.investment-details-expanded')) return;

                        const detailsDiv = item.querySelector('.investment-details-expanded');
                        if (detailsDiv) {
                            detailsDiv.classList.toggle('hidden');
                        }
                    });
                });
            }

            // Render Transaction History with filters and sorting
            renderTransactionHistory();

            updatePortfolioChart();
        }

        /**
         * Renders the transaction history based on current filter and sort settings.
         */
        function renderTransactionHistory() {
            transactionHistoryListEl.innerHTML = '';
            let filteredTransactions = [...userTransactions];

            // Apply filter
            const filterType = transactionFilterSelect.value;
            if (filterType !== 'All') {
                filteredTransactions = filteredTransactions.filter(tx => tx.type === filterType);
            }

            // Apply sort
            const sortOrder = transactionSortSelect.value;
            filteredTransactions.sort((a, b) => {
                const dateA = new Date(a.date).getTime();
                const dateB = new Date(b.date).getTime();
                const amountA = a.amount;
                const amountB = b.amount;

                switch (sortOrder) {
                    case 'dateDesc': return dateB - dateA;
                    case 'dateAsc': return dateA - dateB;
                    case 'amountDesc': return amountB - amountA;
                    case 'amountAsc': return amountA - amountB;
                    default: return 0;
                }
            });

            if (filteredTransactions.length === 0) {
                noTransactionsMessage.classList.remove('hidden');
            } else {
                noTransactionsMessage.classList.add('hidden');
                filteredTransactions.forEach(tx => {
                    const typeClass = (tx.type === 'Withdrawal' || tx.type === 'Cash Out') ? 'withdrawal' : '';
                    transactionHistoryListEl.innerHTML += `
                        <div class="transaction-item">
                            <div>
                                <div class="transaction-type ${typeClass}">${tx.type}</div>
                                <div class="text-gray-500 text-sm">${tx.description}</div>
                            </div>
                            <div class="text-right">
                                <div class="transaction-amount ${typeClass}">${formatNaira(tx.amount)}</div>
                                <div class="transaction-date">${new Date(tx.date).toLocaleString()}</div>
                            </div>
                        </div>
                    `;
                });
            }
        }

        // Event listeners for transaction filters/sort
        transactionFilterSelect.addEventListener('change', renderTransactionHistory);
        transactionSortSelect.addEventListener('change', renderTransactionHistory);


        /**
         * Updates the portfolio allocation chart.
         */
        function updatePortfolioChart() {
            const portfolioData = {};
            userInvestments.forEach(inv => {
                portfolioData[inv.category] = (portfolioData[inv.category] || 0) + inv.currentValue;
            });

            const labels = Object.keys(portfolioData);
            const data = Object.values(portfolioData);

            const backgroundColors = [
                '#4CAF50', '#2196F3', '#FFC107', '#E91E63', '#9C27B0',
                '#00BCD4', '#FF9800', '#795548', '#607D8B', '#F44336'
            ];

            if (portfolioChart) {
                portfolioChart.data.labels = labels;
                portfolioChart.data.datasets[0].data = data;
                portfolioChart.data.datasets[0].backgroundColor = labels.map((_, i) => backgroundColors[i % backgroundColors.length]);
                portfolioChart.update();
            } else {
                const ctx = document.getElementById('portfolioChart').getContext('2d');
                portfolioChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: labels.map((_, i) => backgroundColors[i % backgroundColors.length]),
                            hoverOffset: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#e0e0e0', // Legend text color
                                    font: {
                                        size: 14
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed !== null) {
                                            label += formatNaira(context.parsed);
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        /**
         * Formats a number as Nigerian Naira (₦).
         * @param {number} amount The amount to format.
         * @returns {string} The formatted currency string.
         */
        function formatNaira(amount) {
            return new Intl.NumberFormat('en-NG', {
                style: 'currency',
                currency: 'NGN',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount);
        }

        /**
         * Displays a temporary message in a modal.
         * @param {HTMLElement} messageElement The HTML element to display the message in.
         * @param {string} message The message text.
         * @param {string} type 'success' or 'error'.
         */
        function showModalMessage(messageElement, message, type) {
            messageElement.textContent = message;
            messageElement.classList.remove('hidden', 'success', 'error');
            messageElement.classList.add(type);
            setTimeout(() => {
                messageElement.classList.add('hidden');
            }, 3000); // Hide after 3 seconds
        }

        // Event Listeners for Modals
        // Buttons to open modals
        document.getElementById('openInvestModalBtn').addEventListener('click', () => openModal('investModal'));
        document.getElementById('openCashOutModalBtn').addEventListener('click', () => openModal('cashOutModal'));
        document.getElementById('openDepositModalBtn').addEventListener('click', () => openModal('depositModal'));
        document.getElementById('openWithdrawModalBtn').addEventListener('click', () => openModal('withdrawModal'));
        document.getElementById('openResetDataModalBtn').addEventListener('click', () => openModal('resetDataModal'));

        // Buttons to close modals
        document.getElementById('closeInvestModalBtn').addEventListener('click', () => closeModal('investModal'));
        document.getElementById('closeCashOutModalBtn').addEventListener('click', () => closeModal('cashOutModal'));
        document.getElementById('closeDepositModalBtn').addEventListener('click', () => closeModal('depositModal'));
        document.getElementById('closeWithdrawModalBtn').addEventListener('click', () => closeModal('withdrawModal'));
        document.getElementById('closeResetDataModalBtn').addEventListener('click', () => closeModal('resetDataModal'));
        document.getElementById('cancelResetDataBtn').addEventListener('click', () => closeModal('resetDataModal'));

        // Close modal when clicking outside content
        investModal.addEventListener('click', (e) => { if (e.target === investModal) closeModal('investModal'); });
        cashOutModal.addEventListener('click', (e) => { if (e.target === cashOutModal) closeModal('cashOutModal'); });
        depositModal.addEventListener('click', (e) => { if (e.target === depositModal) closeModal('depositModal'); });
        withdrawModal.addEventListener('click', (e) => { if (e.target === withdrawModal) closeModal('withdrawModal'); });
        resetDataModal.addEventListener('click', (e) => { if (e.target === resetDataModal) closeModal('resetDataModal'); });

        /**
         * Opens a specified modal by removing the 'hidden' class.
         * @param {string} modalId The ID of the modal to open.
         */
        function openModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
            // Populate dropdowns if it's the cash out modal
            if (modalId === 'cashOutModal') {
                populateCashOutInvestments();
            }
            // Reset invest modal fields and chart when opened
            if (modalId === 'investModal') {
                investmentCategorySelect.value = '';
                investmentTypeSelect.innerHTML = '<option value="">Select Type</option>';
                investmentTypeSelect.disabled = true;
                investmentAmountInput.value = '';
                investmentDurationInput.value = '';
                investmentDurationUnitSelect.value = 'months';
                investmentTypeDetails.classList.add('hidden');
                investMessage.classList.add('hidden'); // Ensure message is hidden
                updateProjectionChart(0, 0, 0); // Reset chart
            }
            // Hide all modal messages when opening any modal
            document.querySelectorAll('.modal-message').forEach(el => el.classList.add('hidden'));
        }

        /**
         * Closes a specified modal by adding the 'hidden' class.
         * @param {string} modalId The ID of the modal to close.
         */
        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
            // Clear messages and inputs on close
            const messageEl = document.getElementById(modalId.replace('Modal', 'Message'));
            if (messageEl) messageEl.classList.add('hidden'); // Hide message
            const inputs = document.getElementById(modalId).querySelectorAll('input[type="number"], input[type="text"], input[type="email"], select');
            inputs.forEach(input => {
                if (input.id !== 'calcInitialInvestment' && input.id !== 'calcInvestmentDuration' && input.id !== 'calcAnnualReturnRate') {
                    input.value = '';
                }
            });
            // Reset investment type dropdown if it's the invest modal
            if (modalId === 'investModal') {
                document.getElementById('investmentCategory').value = '';
                document.getElementById('investmentType').innerHTML = '<option value="">Select Type</option>';
                document.getElementById('investmentType').disabled = true;
            }
        }

        // Investment Category and Type Logic
        investmentCategorySelect.addEventListener('change', () => {
            const selectedCategory = investmentCategorySelect.value;
            investmentTypeSelect.innerHTML = '<option value="">Select Type</option>'; // Clear previous options
            investmentTypeSelect.disabled = true;
            investmentTypeDetails.classList.add('hidden'); // Hide details when category changes
            updateProjectionChart(0, 0, 0); // Reset chart
            investMessage.classList.add('hidden'); // Hide message

            if (selectedCategory && investmentTypes[selectedCategory]) {
                // Populate types based on selected category
                for (const type in investmentTypes[selectedCategory]) {
                    const option = document.createElement('option');
                    option.value = type;
                    option.textContent = type;
                    investmentTypeSelect.appendChild(option);
                }
                investmentTypeSelect.disabled = false;
            }
        });

        investmentTypeSelect.addEventListener('change', () => {
            const selectedCategory = investmentCategorySelect.value;
            const selectedType = investmentTypeSelect.value;
            const details = investmentTypes[selectedCategory]?.[selectedType];
            investMessage.classList.add('hidden'); // Hide message

            if (details) {
                detailsTypeName.textContent = selectedType;
                detailsDescription.textContent = details.description;
                detailsReturnRange.textContent = details.returnRange;
                detailsMinDuration.textContent = `${details.minDurationMonths} months`;
                investmentTypeDetails.classList.remove('hidden');

                // Set minimum duration input based on selected type
                investmentDurationInput.min = details.minDurationMonths;
                investmentDurationInput.value = details.minDurationMonths; // Pre-fill with min duration
                investmentDurationUnitSelect.value = 'months'; // Default to months for new types

                // Update projection chart with initial values
                updateProjectionChart(
                    parseFloat(investmentAmountInput.value || 0),
                    parseInt(investmentDurationInput.value || 0),
                    details.typicalAnnualReturn,
                    investmentDurationUnitSelect.value
                );
            } else {
                investmentTypeDetails.classList.add('hidden');
                updateProjectionChart(0, 0, 0); // Reset chart
            }
        });

        // Listen for changes in amount and duration to update the projection chart
        investmentAmountInput.addEventListener('input', updateProjection);
        investmentDurationInput.addEventListener('input', updateProjection);
        investmentDurationUnitSelect.addEventListener('change', updateProjection);

        function updateProjection() {
            const amount = parseFloat(investmentAmountInput.value);
            const duration = parseInt(investmentDurationInput.value);
            const unit = investmentDurationUnitSelect.value;
            const selectedCategory = investmentCategorySelect.value;
            const selectedType = investmentTypeSelect.value;
            const details = investmentTypes[selectedCategory]?.[selectedType];
            const annualRate = details ? details.typicalAnnualReturn : 0;

            updateProjectionChart(amount, duration, annualRate, unit);
        }

        // Projection Chart
        function updateProjectionChart(initialAmount, duration, annualRate, unit = 'months') {
            const ctx = document.getElementById('investmentProjectionChart').getContext('2d');
            let labels = [];
            let data = [];

            if (initialAmount > 0 && duration > 0 && annualRate > 0) {
                projectionInfo.textContent = 'Projected growth over time.';
                let currentAmount = initialAmount;
                const monthlyRate = annualRate / 12 / 100; // Convert annual percentage to monthly decimal

                let totalMonths = duration;
                if (unit === 'years') {
                    totalMonths = duration * 12;
                }

                // Ensure at least one data point for initial amount
                labels.push('Start');
                data.push(initialAmount);

                for (let i = 1; i <= totalMonths; i++) {
                    currentAmount *= (1 + monthlyRate);
                    labels.push(`Month ${i}`);
                    data.push(currentAmount);
                }
            } else {
                projectionInfo.textContent = 'Adjust amount and duration to see your potential growth.';
            }

            if (projectionChart) {
                projectionChart.data.labels = labels;
                projectionChart.data.datasets[0].data = data;
                projectionChart.update();
            } else {
                projectionChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Projected Value',
                            data: data,
                            borderColor: '#66BB6A',
                            backgroundColor: 'rgba(102, 187, 106, 0.2)',
                            fill: true,
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false // Hide legend
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `Value: ${formatNaira(context.parsed.y)}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                ticks: {
                                    color: '#a0a0a0'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.05)'
                                }
                            },
                            y: {
                                ticks: {
                                    color: '#a0a0a0',
                                    callback: function(value) {
                                        return formatNaira(value);
                                    }
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.05)'
                                }
                            }
                        }
                    }
                });
            }
        }


        // Submit New Investment
        document.getElementById('submitInvestmentBtn').addEventListener('click', () => {
            const category = investmentCategorySelect.value;
            const type = investmentTypeSelect.value;
            const amount = parseFloat(investmentAmountInput.value);
            let duration = parseInt(investmentDurationInput.value);
            const durationUnit = investmentDurationUnitSelect.value;
            const details = investmentTypes[category]?.[type];

            if (!category || !type || isNaN(amount) || amount <= 0 || isNaN(duration) || duration <= 0 || !details) {
                showModalMessage(investMessage, 'Please fill in all investment details correctly.', 'error');
                return;
            }

            // Convert duration to months for internal consistency
            let durationInMonths = duration;
            if (durationUnit === 'years') {
                durationInMonths = duration * 12;
            }

            if (durationInMonths < details.minDurationMonths) {
                showModalMessage(investMessage, `Minimum duration for ${type} is ${details.minDurationMonths} months.`, 'error');
                return;
            }

            if (userAccountBalance < amount) {
                showModalMessage(investMessage, `Insufficient funds. Your balance is ${formatNaira(userAccountBalance)}.`, 'error');
                return;
            }

            // Use the typicalAnnualReturn from the detailed info
            const annualReturnRate = details.typicalAnnualReturn;

            const newInvestment = {
                id: Date.now().toString(), // Simple unique ID
                category,
                type,
                initialAmount: amount,
                currentValue: amount, // Starts at initial amount
                annualReturnRate,
                investDate: new Date().toISOString(),
                durationMonths: durationInMonths, // Store duration in months
                profit: 0
            };

            userInvestments.push(newInvestment);
            userAccountBalance -= amount;

            userTransactions.push({
                id: Date.now().toString() + '-tx',
                type: 'Investment',
                amount: amount,
                description: `Invested in ${type} (${category}) for ${duration} ${durationUnit}`,
                date: new Date().toISOString()
            });

            saveUserData();
            updateDashboard();
            showModalMessage(investMessage, `Successfully invested ${formatNaira(amount)} in ${type}!`, 'success');
            setTimeout(() => closeModal('investModal'), 1500);
        });

        // Populate Cash Out Investments Dropdown
        function populateCashOutInvestments() {
            const cashOutInvestmentSelect = document.getElementById('cashOutInvestmentSelect');
            cashOutInvestmentSelect.innerHTML = '<option value="">Select an active investment</option>'; // Clear previous options

            if (userInvestments.length === 0) {
                const option = document.createElement('option');
                option.value = "";
                option.textContent = "No active investments available";
                option.disabled = true;
                cashOutInvestmentSelect.appendChild(option);
                return;
            }

            userInvestments.forEach(inv => {
                const option = document.createElement('option');
                option.value = inv.id;
                option.textContent = `${inv.type} (${inv.category}) - Current Value: ${formatNaira(inv.currentValue)}`;
                cashOutInvestmentSelect.appendChild(option);
            });
        }

        // Submit Cash Out
        document.getElementById('submitCashOutBtn').addEventListener('click', () => {
            const investmentId = document.getElementById('cashOutInvestmentSelect').value;
            const cashOutAmount = parseFloat(document.getElementById('cashOutAmount').value);
            const cashOutMessage = document.getElementById('cashOutMessage');

            if (!investmentId || isNaN(cashOutAmount) || cashOutAmount <= 0) {
                showModalMessage(cashOutMessage, 'Please select an investment and enter a valid amount.', 'error');
                return;
            }

            const investmentIndex = userInvestments.findIndex(inv => inv.id === investmentId);
            if (investmentIndex === -1) {
                showModalMessage(cashOutMessage, 'Selected investment not found.', 'error');
                return;
            }

            const investment = userInvestments[investmentIndex];

            if (cashOutAmount > investment.currentValue) {
                showModalMessage(cashOutMessage, `You can only cash out up to ${formatNaira(investment.currentValue)}.`, 'error');
                return;
            }

            userAccountBalance += cashOutAmount;
            investment.currentValue -= cashOutAmount;
            // For partial cash out, adjust initial amount proportionally.
            // This is a simplified approach; a more complex system might track original investment units.
            if (investment.initialAmount > 0) {
                investment.initialAmount = investment.initialAmount * (investment.currentValue / (investment.currentValue + cashOutAmount));
            } else {
                investment.initialAmount = 0; // If initial was already 0 or negative
            }

            investment.profit = investment.currentValue - investment.initialAmount; // Recalculate profit

            userTransactions.push({
                id: Date.now().toString() + '-tx',
                type: 'Cash Out',
                amount: cashOutAmount,
                description: `Cashed out from ${investment.type} (${investment.category})`,
                date: new Date().toISOString()
            });

            // Remove investment if fully cashed out (or very close to zero due to float precision)
            if (investment.currentValue < 0.01) {
                userInvestments.splice(investmentIndex, 1);
            }

            saveUserData();
            updateDashboard();
            showModalMessage(cashOutMessage, `Successfully cashed out ${formatNaira(cashOutAmount)}!`, 'success');
            setTimeout(() => closeModal('cashOutModal'), 1500);
        });

        // Submit Deposit (modified for Paystack)
        document.getElementById('submitDepositBtn').addEventListener('click', () => {
            const depositEmail = document.getElementById('depositEmail').value;
            const depositAmount = parseFloat(document.getElementById('depositAmount').value);
            const depositMessage = document.getElementById('depositMessage');

            if (!depositEmail || !depositAmount || isNaN(depositAmount) || depositAmount <= 0) {
                showModalMessage(depositMessage, 'Please enter a valid email and amount.', 'error');
                return;
            }

            // Paystack requires amount in kobo (cents)
            const amountInKobo = depositAmount * 100;

            showModalMessage(depositMessage, 'Redirecting to Paystack...', 'info'); // Use 'info' for neutral message

            // Initialize Paystack Pop
            const handler = PaystackPop.setup({
                key: paystackPublicKey,
                email: depositEmail,
                amount: amountInKobo,
                currency: 'NGN',
                ref: '' + Math.floor((Math.random() * 1000000000) + 1), // unique ref
                onClose: function(){
                    showModalMessage(depositMessage, 'Payment cancelled.', 'error');
                },
                callback: function(response){
                    // IMPORTANT: In a real application, you MUST verify this transaction on your backend server
                    // using Paystack's verify endpoint to prevent fraud.
                    // For this client-side only demonstration, we're assuming success directly.
                    if (response.status === 'success') {
                        userAccountBalance += depositAmount;

                        userTransactions.push({
                            id: Date.now().toString() + '-tx',
                            type: 'Deposit',
                            amount: depositAmount,
                            description: `Funds deposited via Paystack (Ref: ${response.reference})`,
                            date: new Date().toISOString()
                        });

                        saveUserData();
                        updateDashboard();
                        showModalMessage(depositMessage, `Successfully deposited ${formatNaira(depositAmount)}!`, 'success');
                        setTimeout(() => closeModal('depositModal'), 2000);
                    } else {
                        showModalMessage(depositMessage, 'Payment failed. Please try again.', 'error');
                    }
                }
            });
            handler.openIframe();
        });

        // Submit Withdrawal
        document.getElementById('submitWithdrawBtn').addEventListener('click', () => {
            const withdrawAmount = parseFloat(document.getElementById('withdrawAmount').value);
            const withdrawMessage = document.getElementById('withdrawMessage');

            if (isNaN(withdrawAmount) || withdrawAmount <= 0) {
                showModalMessage(withdrawMessage, 'Please enter a valid withdrawal amount.', 'error');
                return;
            }

            if (userAccountBalance < withdrawAmount) {
                showModalMessage(withdrawMessage, `Insufficient balance. Your balance is ${formatNaira(userAccountBalance)}.`, 'error');
                return;
            }

            userAccountBalance -= withdrawAmount;

            userTransactions.push({
                id: Date.now().toString() + '-tx',
                type: 'Withdrawal',
                amount: withdrawAmount,
                description: 'Funds withdrawn from account',
                date: new Date().toISOString()
            });

            saveUserData();
            updateDashboard();
            showModalMessage(withdrawMessage, `Successfully withdrew ${formatNaira(withdrawAmount)}!`, 'success');
            setTimeout(() => closeModal('withdrawModal'), 1500);
        });

        // Investment Calculator Logic
        document.getElementById('calculateBtn').addEventListener('click', () => {
            const initialInvestment = parseFloat(document.getElementById('calcInitialInvestment').value);
            const durationYears = parseInt(document.getElementById('calcInvestmentDuration').value);
            const annualReturnRate = parseFloat(document.getElementById('calcAnnualReturnRate').value);
            const calculatedValueEl = document.getElementById('calculatedValue');
            const projectedReturnDisplay = document.getElementById('projectedReturnDisplay');

            if (isNaN(initialInvestment) || initialInvestment <= 0 ||
                isNaN(durationYears) || durationYears <= 0 ||
                isNaN(annualReturnRate) || annualReturnRate < 0) {
                calculatedValueEl.textContent = 'Invalid input';
                calculatedValueEl.style.color = '#EF5350';
                projectedReturnDisplay.classList.remove('hidden');
                return;
            }

            const finalValue = initialInvestment * Math.pow(1 + (annualReturnRate / 100), durationYears);
            calculatedValueEl.textContent = formatNaira(finalValue);
            calculatedValueEl.style.color = '#80CBC4';
            projectedReturnDisplay.classList.remove('hidden');
        });

        // Reset Data Functionality
        document.getElementById('confirmResetDataBtn').addEventListener('click', () => {
            localStorage.removeItem('growWithCoreUserId');
            localStorage.removeItem(`growWithCoreInvestments_${currentUserId}`);
            localStorage.removeItem(`growWithCoreTransactions_${currentUserId}`);
            localStorage.removeItem(`growWithCoreAccountBalance_${currentUserId}`);
            // Reload the page to fully reset the state
            window.location.reload();
        });


        // SVG icons for investment types (simplified for categories)
        const investmentCategoryIcons = {
            "Farming": `<svg class="investment-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-leaf"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z"/><path d="M2 21c0-3 1.85-4.5 6-4.5C15.25 16.5 17 18 17 21"/></svg>`,
            "Rearing": `<svg class="investment-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-cow"><path d="M9 18.5V20h6v-1.5"/><path d="M12 13V2"/><path d="M22 8c0 3.5-2 6-2 6H4s-2-2.5-2-6c0-3.5 2-6 2-6h16c0 0 2 2.5 2 6Z"/><path d="M7 13v.5a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5V13c0-1.5 1-2.5 2-2.5h2"/><path d="M17 13v.5a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5V13c0-1.5-1-2.5-2-2.5h-2"/></svg>`,
            "Other Opportunities": `<svg class="investment-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-lightbulb"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1.3.5 2.6 1.5 3.5.8.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/><path d="M12 22v-4"/></svg>`
        };

        // Initialize the dashboard when the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', initializeUserData);

        // Ensure charts resize properly
        window.addEventListener('resize', () => {
            if (portfolioChart) portfolioChart.resize();
            if (projectionChart) projectionChart.resize();
        });
    </script>
</body>
</html>
