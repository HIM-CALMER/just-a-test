<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COREVEST Games Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Universal box-sizing for easier responsive layouts */
        *, *::before, *::after {
            box-sizing: border-box;
        }

        :root {
            --primary-color: #007bff;
            --secondary-color: #28a745;
            --accent-color: #84dcc6;
            --dark-text: #333;
            --light-text: #f0f0f0;
            --background-light: #f0f8ff;
            --card-background: #fff;
            --shadow: rgba(0, 0, 0, 0.1);
            --glow-win: 0 0 15px 5px #4CAF50, 0 0 30px 10px #8bc34a;
            --glow-lose: 0 0 15px 5px #F44336, 0 0 30px 10px #FF5252;
            --glow-draw: 0 0 15px 5px #FFC107, 0 0 30px 10px #FFD700;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-light);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            box-sizing: border-box;
            color: var(--dark-text);
        }

        .header {
            background: linear-gradient(135deg, var(--accent-color), #a5ffd2);
            color: var(--dark-text);
            padding: 1.5rem 1rem;
            border-bottom-left-radius: 10px;
            border-bottom-right-radius: 10px;
            box-shadow: 0 4px 8px var(--shadow);
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
            max-width: 100vw;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .header p {
            font-size: 1rem;
            color: #555;
        }

        .header-actions {
            margin-top: 1rem;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .header-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .header-btn.deposit {
            background-color: var(--secondary-color);
            color: var(--light-text);
        }
        .header-btn.deposit:hover {
            background-color: #218838;
            transform: translateY(-2px);
        }

        .header-btn.withdraw {
            background-color: #dc3545;
            color: var(--light-text);
        }
        .header-btn.withdraw:hover {
            background-color: #c82333;
            transform: translateY(-2px);
        }

        /* User Profile Info in Header */
        .user-profile-info {
            position: absolute;
            top: 10px;
            left: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 5px 10px;
            border-radius: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .user-profile-info:hover {
            background-color: rgba(255, 255, 255, 1);
        }

        .user-profile-info .profile-photo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            object-fit: cover;
            overflow: hidden;
        }
        .user-profile-info .profile-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .user-profile-info .profile-name {
            font-weight: 600;
            color: var(--dark-text);
            font-size: 0.95rem;
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 1rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            width: 100%; 
            padding-left: 1rem;
            padding-right: 1rem;
            box-sizing: border-box;
        }

        /* Common Page Styles (Profile Setup, Game Views, Withdrawal) */
        .page-container {
            display: none; /* Controlled by JS explicitly */
            background-color: var(--card-background);
            border-radius: 10px;
            box-shadow: 0 2px 5px var(--shadow);
            padding: 2rem;
            text-align: center;
            max-width: 650px; 
            margin: 0 auto;
            position: relative; 
            overflow: hidden; 
            width: calc(100% - 2rem); 
            margin-left: auto;
            margin-right: auto;
            box-sizing: border-box;
        }

        .page-container h2 {
            color: var(--dark-text);
            font-size: 2rem;
            margin-bottom: 1.5rem;
        }

        /* Profile Setup View */
        #profileSetupView {
            /* This will be explicitly set to display:flex by JS if no profile */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            min-height: 500px;
        }
        #profileSetupView h2 {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 1.5rem;
        }
        #profileSetupView .form-group {
            margin-bottom: 1.5rem;
            width: 80%;
            max-width: 400px;
            text-align: left;
        }
        #profileSetupView .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #555;
        }
        #profileSetupView .form-group input {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1rem;
            box-sizing: border-box;
        }
        #profileSetupView .submit-button {
            padding: 1rem 2rem;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
            margin-top: 1rem;
        }
        #profileSetupView .submit-button:hover {
            background-color: #218838;
            transform: translateY(-2px);
        }
        #profileSetupMessage {
            margin-top: 1rem;
            font-weight: bold;
            color: #555;
            min-height: 20px;
        }


        /* Dashboard specific styles */
        #dashboardView {
            /* This will be explicitly set to display:block by JS when loaded */
            width: 100%;
        }

        .game-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
            gap: 1.5rem;
            justify-content: center; 
            width: 100%;
            max-width: 100%;
        }

        .game-card {
            background-color: var(--card-background);
            border-radius: 10px;
            box-shadow: 0 2px 5px var(--shadow);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            width: 100%; 
            max-width: 100%;
        }

        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .game-card.locked {
            opacity: 0.6;
            cursor: not-allowed;
            filter: grayscale(100%);
        }

        .game-card.locked .play-button {
            background-color: #6c757d;
            cursor: not-allowed;
        }

        .game-card.locked .play-button:hover {
            background-color: #6c757d;
        }

        .icon-container {
            font-size: 3rem;
            color: var(--secondary-color);
            background-color: #f0fff0;
            padding: 1rem;
            border-radius: 50%;
            margin-bottom: 1rem;
            display: flex;
            justify-content: center;
            align-items: center;
            min-width: 6rem; 
            min-height: 6rem;
        }

        .game-card h3 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--dark-text);
            margin-bottom: 0.75rem;
        }

        .game-card p {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.6;
            margin-bottom: 1rem;
            flex-grow: 1;
        }

        .play-button {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background-color: var(--primary-color);
            color: var(--light-text);
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: background-color 0.3s ease;
            cursor: pointer;
            border: none; 
        }

        .play-button:hover {
            background-color: #0056b3;
        }

        /* Game specific styles (already existing, but grouped for clarity) */
        #spinTheWheelGame, #visualSoccerGame, #soccerMatchListView {
            /* Inherit from .page-container for common properties and default display:none */
        }
        
        .game-container.win-glow {
            box-shadow: var(--glow-win);
        }

        .game-container.lose-glow {
            box-shadow: var(--glow-lose);
        }
        .game-container.draw-glow { 
            box-shadow: var(--glow-draw);
        }

        .game-balance-info {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .game-balance-info span {
            color: var(--secondary-color);
        }

        .bet-section {
            margin-bottom: 1.5rem;
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center;
            align-items: center;
            gap: 10px; 
        }

        .bet-section label {
            display: block; 
            width: 100%; 
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark-text);
        }

        .bet-section input[type="number"] {
            padding: 0.75rem;
            border: 1px solid #ccc;
            border-radius: 8px;
            width: 150px; 
            max-width: 100%; 
            text-align: center;
            font-size: 1rem;
            box-sizing: border-box; 
        }

        .bet-section button {
            padding: 0.75rem 1.5rem;
            background-color: var(--secondary-color);
            color: var(--light-text);
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .bet-section button:hover:not(:disabled) {
            background-color: #218838;
        }
        .bet-section button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        #gameMessage {
            margin-top: 1.5rem;
            font-size: 1.1rem;
            font-weight: 600;
            color: #555;
            min-height: 25px;
        }
        
        /* Soccer Match List View */
        .match-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        .match-card {
            background-color: var(--card-background);
            border-radius: 10px;
            box-shadow: 0 2px 5px var(--shadow);
            padding: 1.5rem;
            text-align: center;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            cursor: pointer;
        }
        .match-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }
        .match-card h4 {
            font-size: 1.2rem;
            color: #555;
            margin-bottom: 0.5rem;
        }
        .match-card .teams {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        .match-card .odds-display {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 1rem;
            font-size: 0.95rem;
            font-weight: 600;
        }
        .match-card .odd-item {
            padding: 5px 10px;
            border-radius: 5px;
            background-color: #e9ecef;
            white-space: nowrap;
        }


        /* Visual Soccer Game Details View */
        .visual-soccer-match-details {
            margin-top: 2rem;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background-color: #f8f8f8;
            border-radius: 8px;
            border: 1px dashed #ccc;
        }
        .visual-soccer-match-details h3 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            color: #007bff;
        }
        .visual-soccer-match-details .match-info {
            font-size: 1rem;
            color: #666;
            margin-bottom: 1rem;
        }
        .team-names {
            display: flex;
            justify-content: space-around;
            align-items: center;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            gap: 10px;
        }
        .team-names span {
            flex: 1;
            text-align: center;
            padding: 5px;
        }
        .vs {
            font-size: 1.2rem;
            font-weight: 600;
            color: #666;
            padding: 0 10px;
        }
        .match-score {
            font-size: 2.5rem;
            font-weight: 900;
            color: #333;
            margin-top: 1rem;
            min-height: 40px;
        }
        .bet-options {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-top: 1.5rem;
        }
        .bet-option-btn {
            padding: 0.8rem 1.5rem;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
            flex: 1 1 calc(33% - 10px);
            min-width: 120px;
            max-width: 180px;
            box-sizing: border-box;
        }
        .bet-option-btn:hover:not(:disabled) {
            background-color: #0056b3;
            transform: translateY(-2px);
        }
        .bet-option-btn.selected {
            background-color: #0056b3;
            border: 2px solid var(--accent-color);
            box-shadow: 0 0 8px rgba(0, 123, 255, 0.5);
        }
        .bet-option-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background-color: #6c757d;
        }
        #simulateMatchButton {
            margin-top: 2rem;
            padding: 1rem 2rem;
            background-color: var(--primary-color);
            color: var(--light-text);
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        #simulateMatchButton:hover:not(:disabled) {
            background-color: #0056b3;
        }
        #simulateMatchButton:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* LLM Commentary section */
        #llmCommentarySection {
            margin-top: 2rem;
            padding: 1.5rem;
            background-color: #f0f8ff;
            border-radius: 10px;
            border: 1px solid var(--accent-color);
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.1);
        }
        #llmCommentarySection h4 {
            font-size: 1.4rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        #getCommentaryBtn {
            padding: 0.8rem 1.8rem;
            background-color: #6f42c1; /* Purple */
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-top: 1rem;
        }
        #getCommentaryBtn:hover:not(:disabled) {
            background-color: #563d7c;
            transform: translateY(-2px);
        }
        #getCommentaryBtn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        #llmCommentaryDisplay {
            font-size: 1rem;
            color: #444;
            line-height: 1.6;
            min-height: 50px;
            text-align: left;
            margin-top: 1rem;
        }
        #placeNewBetBtn { /* Style for new bet button */
            padding: 0.8rem 1.8rem;
            background-color: #17a2b8; /* Info blue */
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-top: 1rem;
        }
        #placeNewBetBtn:hover:not(:disabled) {
            background-color: #138496;
            transform: translateY(-2px);
        }
        #placeNewBetBtn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Visual Match Simulation Canvas */
        #soccerVisualCanvas {
            border: 1px solid #ccc;
            background-color: #4CAF50;
            margin: 1.5rem auto;
            display: block;
            border-radius: 5px;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.1);
        }


        /* Payment Overlay and Withdrawal Overlay (common styling) */
        #paymentOverlay, #withdrawalOverlay, #editProfileOverlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            overflow: auto;
        }

        .payment-box, .withdrawal-box, .edit-profile-box {
            background-color: var(--card-background);
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            max-width: 450px;
            width: 90%;
            color: var(--dark-text);
            box-sizing: border-box;
            margin: 20px auto;
        }

        .payment-box h3, .withdrawal-box h3, .edit-profile-box h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.8rem;
        }
        .payment-box p, .withdrawal-box p, .edit-profile-box p {
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .payment-box .account-details {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            margin-bottom: 20px;
            font-family: 'monospace', sans-serif;
            text-align: left;
            word-break: break-all;
        }

        .payment-box .account-details strong {
            display: block;
            margin-bottom: 5px;
            color: #555;
        }
        .payment-box .form-group input { /* Style for depositAmountInput */
            padding: 0.75rem;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1rem;
            box-sizing: border-box;
            width: 180px; /* Specific width */
            text-align: center; /* Center text */
            display: block; /* Make it a block element */
            margin: 0 auto; /* Center the input itself */
        }

        /* NEW: Quick Deposit Buttons Styling */
        .quick-deposit-options {
            margin-top: 15px;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }

        .quick-deposit-btn {
            padding: 0.7rem 1.2rem;
            background-color: #e0e0e0;
            color: #333;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
            flex: 1 1 auto; /* Allow buttons to grow and shrink */
            min-width: 80px; /* Ensure a minimum width */
            max-width: 120px; /* Limit max width */
        }

        .quick-deposit-btn:hover {
            background-color: #d0d0d0;
            transform: translateY(-1px);
        }


        /* Withdrawal Form styling */
        .withdrawal-form {
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
            margin-top: 1.5rem;
        }
        .withdrawal-form .form-group {
            background-color: #f8f8f8; /* Lighter background for form groups */
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #eee;
            text-align: left;
        }
        .withdrawal-form .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--dark-text);
        }
        .withdrawal-form .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1rem;
            box-sizing: border-box;
        }

        .edit-profile-box .form-group { /* Styling for edit profile form groups */
            background-color: #f8f8f8;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #eee;
            text-align: left;
            margin-bottom: 1.2rem;
        }
        .edit-profile-box .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--dark-text);
        }
        .edit-profile-box .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1rem;
            box-sizing: border-box;
        }


        .payment-buttons, .withdrawal-buttons, .edit-profile-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .payment-button, .withdrawal-button, .edit-profile-button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            flex-grow: 1;
            min-width: 150px;
        }

        .payment-button.confirm, .withdrawal-button.confirm, .edit-profile-button.save {
            background-color: var(--secondary-color);
            color: var(--light-text);
        }
        .payment-button.confirm:hover, .withdrawal-button.confirm:hover, .edit-profile-button.save:hover:not(:disabled) {
            background-color: #218838;
        }

        .payment-button.cancel, .withdrawal-button.cancel, .edit-profile-button.cancel {
            background-color: #f44336;
            color: var(--light-text);
        }
        .payment-button.cancel:hover, .withdrawal-button.cancel:hover, .edit-profile-button.cancel:hover {
            background-color: #da190b;
        }
        .payment-button.simulate-success {
            background-color: #007bff; /* Blue */
            color: white;
        }
        .payment-button.simulate-success:hover {
            background-color: #0056b3;
        }
        .payment-button.simulate-fail {
            background-color: #ffc107; /* Orange */
            color: #333;
        }
        .payment-button.simulate-fail:hover {
            background-color: #e0a800;
        }


        .edit-profile-button.save:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background-color: #6c757d;
        }

        #paymentStatusMessage, #withdrawalStatusMessage, #editProfileStatusMessage {
            margin-top: 15px;
            font-weight: bold;
            min-height: 20px;
        }
        
        .withdrawal-policy-message, .edit-policy-message {
            margin-top: 1.5rem;
            font-size: 0.9rem;
            color: #666;
            font-style: italic;
            border: 1px dashed #ccc;
            padding: 10px;
            border-radius: 5px;
            background-color: #fefefe;
        }
        .withdrawal-policy-message strong, .edit-policy-message strong {
            color: var(--primary-color);
        }

        .footer {
            background-color: #333;
            color: var(--light-text);
            text-align: center;
            padding: 1rem 0;
            margin-top: 30px;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            box-shadow: 0 -2px 5px var(--shadow);
            width: 100%;
            max-width: 100vw;
        }

        .footer p {
            margin: 0;
            font-size: 0.9rem;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            .header p {
                font-size: 1rem;
            }
            .header-actions {
                flex-direction: column;
                gap: 0.75rem;
            }
            .header-btn {
                width: 80%;
                max-width: 250px;
            }
            .user-profile-info {
                top: 5px;
                left: 5px;
                padding: 3px 8px;
                gap: 5px;
            }
            .user-profile-info .profile-photo {
                width: 30px;
                height: 30px;
                font-size: 0.9rem;
            }
            .user-profile-info .profile-name {
                font-size: 0.8rem;
            }
            .game-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
            .game-card {
                padding: 1rem;
            }
            .game-card h3 {
                font-size: 1.3rem;
            }
            .game-card p {
                font-size: 0.85rem;
            }
            .bet-section input[type="number"],
            .bet-section input[type="text"] {
                width: 100%;
                max-width: 180px;
            }
            .bet-section button {
                padding: 0.75rem 1rem;
            }
            .page-container {
                padding: 1.5rem;
            }
            #profileSetupView {
                padding: 2rem;
            }
            #profileSetupView h2 {
                font-size: 2rem;
            }
            .visual-soccer-match-details h3 {
                font-size: 1.5rem;
            }
            .team-names {
                font-size: 1.2rem;
            }
            .vs {
                font-size: 1rem;
            }
            .match-score {
                font-size: 2rem;
            }
            .bet-option-btn {
                min-width: unset;
                max-width: unset;
                flex: 1 1 45%;
            }
            .match-card .teams {
                font-size: 1.3rem;
            }
            .match-card h4 {
                font-size: 1.1rem;
            }
            .match-card .odds-display {
                font-size: 0.9rem;
            }
            #soccerVisualCanvas {
                width: 250px;
                height: 150px;
            }
            .payment-buttons, .withdrawal-buttons, .edit-profile-buttons {
                flex-direction: column;
            }
            .payment-button, .withdrawal-button, .edit-profile-button {
                min-width: 100%;
            }
            .quick-deposit-btn {
                flex: 1 1 45%; /* More balanced on smaller screens */
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 1.5rem 0.5rem;
            }
            .header h1 {
                font-size: 1.8rem;
            }
            .header p {
                font-size: 0.9rem;
            }
            .user-profile-info {
                position: static;
                margin-bottom: 0.5rem;
                justify-content: center;
                width: 100%;
                background-color: transparent;
                box-shadow: none;
            }
            .container {
                padding: 0.5rem;
            }
            .game-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            .bet-section {
                flex-direction: column;
                gap: 10px;
            }
            .bet-section label {
                margin-bottom: 0;
            }
            .bet-section input[type="number"],
            .bet-section input[type="text"],
            .bet-section button {
                width: calc(100% - 10px);
                margin: 0 auto;
            }
            #spinButton, #simulateMatchButton {
                padding: 0.8rem 1.5rem;
                font-size: 1.1rem;
            }
            .payment-box, .withdrawal-box, .edit-profile-box {
                padding: 20px;
            }
            .bet-options {
                flex-direction: column;
            }
            .bet-option-btn {
                width: 100%;
                max-width: unset;
            }
            #soccerVisualCanvas {
                width: 200px;
                height: 120px;
            }
            .match-list {
                grid-template-columns: 1fr;
            }
            #profileSetupView .form-group {
                width: 100%;
            }
            .quick-deposit-btn {
                flex: 1 1 45%; 
            }
        }
    </style>
</head>
<body class="font-inter">

    <header class="header">
        <div class="user-profile-info" id="userProfileInfo">
            <div class="profile-photo" id="userPhotoDisplay"></div>
            <span class="profile-name" id="userNameDisplay">Guest User</span>
        </div>
        <h1>COREVEST Games</h1>
        <p>Your ultimate destination for exciting games!</p>
        <div class="header-actions">
            <button class="header-btn deposit" id="depositFundsBtn"><i class="fas fa-wallet"></i> Deposit Funds</button>
            <button class="header-btn withdraw" id="withdrawFundsBtn"><i class="fas fa-money-bill-wave"></i> Withdraw Funds</button>
        </div>
    </header>

    <main class="container">
        <!-- Profile Setup View (Shown initially if no profile) -->
        <div id="profileSetupView" class="page-container">
            <h2>Welcome to COREVEST Games!</h2>
            <p>Please set up your profile to get started.</p>
            <div class="form-group">
                <label for="profileNameInput">Your Name:</label>
                <input type="text" id="profileNameInput" placeholder="e.g., John Doe" required>
            </div>
            <div class="form-group">
                <label for="profilePhotoUrlInput">Profile Photo URL (Optional):</label>
                <input type="text" id="profilePhotoUrlInput" placeholder="e.g., https://example.com/your-pic.jpg">
            </div>
            <button id="saveProfileBtn" class="submit-button"><i class="fas fa-user-plus"></i> Save Profile</button>
            <div id="profileSetupMessage"></div>
        </div>

        <div id="dashboardView" class="page-container">
            <div class="game-grid" id="gameList">
            </div>
        </div>

        <!-- Visual Soccer Match List View -->
        <div id="soccerMatchListView" class="page-container">
            <button class="go-back-button" id="backToDashboardBtnSoccerList"><i class="fas fa-arrow-left"></i> Back to Dashboard</button>
            <h2>Available Soccer Matches</h2>
            <div class="game-balance-info">
                <div>Current Balance: <span id="soccerListBalanceDisplay">₦0.00</span></div>
            </div>
            <div class="match-list" id="soccerMatchListContainer">
                <!-- Matches will be dynamically loaded here -->
            </div>
        </div>

        <!-- Spin the Wheel Game Section -->
        <div id="spinTheWheelGame" class="page-container">
            <button class="go-back-button" id="backToDashboardBtn"><i class="fas fa-arrow-left"></i> Back to Dashboard</button>
            <h2>Spin the Wheel</h2>
            <div class="game-balance-info">
                <div>Current Balance: <span id="gameBalanceDisplay">₦0.00</span></div>
            </div>

            <div class="bet-section">
                <label for="betAmount">Bet Amount (₦):</label>
                <input type="number" id="betAmount" value="700" min="700" max="1000000" step="100">
                <button id="placeBetButton">Place Bet</button>
            </div>

            <canvas id="wheelCanvas" width="400" height="400"></canvas>
            <button id="spinButton" disabled>SPIN</button>

            <div id="gameMessage" class="game-message">Place your bet to activate the wheel!</div>
        </div>

        <!-- Visual Soccer Game Details View -->
        <div id="visualSoccerGame" class="page-container">
            <button class="go-back-button" id="backToSoccerListBtn"><i class="fas fa-arrow-left"></i> Back to Matches</button>
            <h2>Match Details & Bet</h2>
            <div class="game-balance-info">
                <div>Current Balance: <span id="soccerGameBalanceDisplay">₦0.00</span></div>
            </div>

            <div class="bet-section">
                <label for="soccerBetAmount">Bet Amount (₦):</label>
                <input type="number" id="soccerBetAmount" value="1000" min="1000" max="1000000" step="100">
                <button id="placeSoccerBetButton">Place Bet</button>
            </div>

            <div class="visual-soccer-match-details">
                <h3 id="currentMatchTeams">Team A vs Team B</h3>
                <p class="match-info"><span id="currentMatchLeague">League: Premier League</span> | <span id="currentMatchTime">Today 18:00</span></p>
                
                <!-- Visual Match Simulation Canvas (NEW) -->
                <canvas id="soccerVisualCanvas" width="300" height="180"></canvas>
                <div class="match-score" id="matchScoreDisplay">0 - 0</div>
                <div id="visualMatchMessage" class="game-message" style="margin-top:10px; font-weight:normal;">Kick-off!</div>

                <div class="bet-options">
                    <button class="bet-option-btn" data-outcome="home" id="betHomeButton">Home Win (x<span id="oddHome">1.8</span>)</button>
                    <button class="bet-option-btn" data-outcome="draw" id="betDrawButton">Draw (x<span id="oddDraw">3.5</span>)</button>
                    <button class="bet-option-btn" data-outcome="away" id="betAwayButton">Away Win (x<span id="oddAway">2.5</span>)</button>
                    <button class="bet-option-btn" data-outcome="over1_5" id="betOver1_5Button">Over 1.5 Goals (x<span id="oddOver1_5">1.5</span>)</button>
                    <button class="bet-option-btn" data-outcome="under1_5" id="betUnder1_5Button">Under 1.5 Goals (x<span id="oddUnder1_5">2.2</span>)</button>
                    <button class="bet-option-btn" data-outcome="btts_yes" id="betBttsYesButton">BTTS Yes (x<span id="oddBttsYes">1.7</span>)</button>
                    <button class="bet-option-btn" data-outcome="btts_no" id="betBttsNoButton">BTTS No (x<span id="oddBttsNo">2.0</span>)</button>
                </div>
            </div>

            <button id="simulateMatchButton" disabled>Simulate Match</button>
            <div id="soccerGameMessage" class="game-message">Place your bet and select an outcome.</div>

            <!-- LLM Commentary Section -->
            <div id="llmCommentarySection" style="display:none;">
                <h4>✨ Match Highlights & Commentary ✨</h4>
                <div id="llmCommentaryDisplay"></div>
                <button id="getCommentaryBtn" disabled><i class="fas fa-robot"></i> Get Match Commentary</button>
                <button id="placeNewBetBtn" style="display: none;"><i class="fas fa-redo"></i> Place New Bet</button> <!-- NEW BUTTON -->
            </div>
        </div>

        <!-- Withdrawal Section -->
        <div id="withdrawalView" class="page-container">
            <button class="go-back-button" id="backToDashboardBtnWithdrawal"><i class="fas fa-arrow-left"></i> Back to Dashboard</button>
            <h2>Withdraw Funds</h2>
            <div class="game-balance-info">
                <div>Current Balance: <span id="withdrawalBalanceDisplay">₦0.00</span></div>
            </div>

            <div class="withdrawal-form">
                <div class="form-group">
                    <label for="withdrawalAmount">Amount (₦):</label>
                    <input type="number" id="withdrawalAmount" min="1000" step="1000" placeholder="e.g., 5000">
                </div>
                <div class="form-group">
                    <label for="bankName">Bank Name:</label>
                    <input type="text" id="bankName" placeholder="e.g., COREVEST Bank">
                </div>
                <div class="form-group">
                    <label for="accountNumber">Account Number:</label>
                    <input type="text" id="accountNumber" pattern="\d{10}" title="Account number must be 10 digits" placeholder="e.g., 0123456789">
                </div>
                <div class="form-group">
                    <label for="accountName">Account Name:</label>
                    <input type="text" id="accountName" placeholder="e.g., John Doe">
                </div>
                <div class="withdrawal-policy-message">
                    <strong>Important:</strong> Your Account Name (e.g., John Doe) must exactly match the Name on your COREVEST Account for successful withdrawal. Funds will be processed within 24 hours.
                </div>
                <button class="withdrawal-button confirm" id="initiateWithdrawalButton"><i class="fas fa-paper-plane"></i> Initiate Withdrawal</button>
            </div>
            <div id="withdrawalStatusMessage" class="game-message"></div>
        </div>

    </main>

    <footer class="footer">
        <p>&copy; 2025 COREVEST Games. All rights reserved.</p>
    </footer>

    <div id="paymentOverlay">
        <div class="payment-box">
            <h3>Complete Your Payment</h3>
            <p>Please make a transfer to the account details below. Your balance will be updated automatically once payment is authenticated.</p>
            <div class="account-details">
                <strong>Bank Name:</strong> COREVEST Bank<br>
                <strong>Account Name:</strong> COREVEST Games<br>
                <strong>Account Number:</strong> 0123456789<br>
                <strong>Amount:</strong> <span id="paymentAmountDisplay">₦0.00</span>
            </div>
            <div class="form-group" style="margin-top: 15px;">
                <label for="depositAmountInput" style="text-align: center;">Enter Amount to Deposit:</label>
                <input type="number" id="depositAmountInput" value="5000" min="1000" max="1000000" step="1000" placeholder="₦1,000 - ₦1,000,000">
            </div>
            <!-- NEW: Quick Deposit Amounts -->
            <div class="quick-deposit-options">
                <button class="quick-deposit-btn" data-amount="1000">₦1,000</button>
                <button class="quick-deposit-btn" data-amount="5000">₦5,000</button>
                <button class="quick-deposit-btn" data-amount="10000">₦10,000</button>
                <button class="quick-deposit-btn" data-amount="20000">₦20,000</button>
                <button class="quick-deposit-btn" data-amount="50000">₦50,000</button>
            </div>
            <p id="paymentStatusMessage" style="color: grey;">Waiting for payment confirmation...</p>
            <div class="payment-buttons">
                <button class="payment-button confirm" id="confirmPaymentButton"><i class="fas fa-check-circle"></i> Auto-Authenticate Payment</button>
                <button class="payment-button simulate-success" id="simulateSuccessBtn"><i class="fas fa-money-check-alt"></i> Simulate Successful Deposit</button>
                <button class="payment-button simulate-fail" id="simulateFailBtn"><i class="fas fa-exclamation-triangle"></i> Simulate Failed Deposit</button>
                <button class="payment-button cancel" id="cancelPaymentButton"><i class="fas fa-times-circle"></i> Cancel Payment</button>
            </div>
        </div>
    </div>

    <!-- Edit Profile Overlay -->
    <div id="editProfileOverlay">
        <div class="edit-profile-box">
            <h3>Edit Your Profile</h3>
            <p id="editProfileMessage">Update your name and profile photo.</p>
            <div class="form-group">
                <label for="editProfileNameInput">Your Name:</label>
                <input type="text" id="editProfileNameInput" placeholder="e.g., John Doe" required>
            </div>
            <div class="form-group">
                <label for="editProfilePhotoUrlInput">Profile Photo URL (Optional):</label>
                <input type="text" id="editProfilePhotoUrlInput" placeholder="e.g., https://example.com/your-pic.jpg">
            </div>
            <div class="edit-policy-message">
                <strong>Note:</strong> Profile changes can only be made every 7 days. Next edit available: <span id="nextEditDateDisplay">Loading...</span>
            </div>
            <div class="edit-profile-buttons">
                <button class="edit-profile-button save" id="saveEditedProfileBtn"><i class="fas fa-save"></i> Save Changes</button>
                <button class="edit-profile-button cancel" id="cancelEditProfileBtn"><i class="fas fa-times-circle"></i> Cancel</button>
            </div>
            <div id="editProfileStatusMessage" class="game-message"></div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Main Views
            const profileSetupView = document.getElementById('profileSetupView');
            const dashboardView = document.getElementById('dashboardView');
            const spinTheWheelGame = document.getElementById('spinTheWheelGame');
            const visualSoccerGame = document.getElementById('visualSoccerGame');
            const soccerMatchListView = document.getElementById('soccerMatchListView'); 
            const gameListContainer = document.getElementById('gameList');
            const withdrawalView = document.getElementById('withdrawalView');

            // Header Elements
            const userProfileInfo = document.getElementById('userProfileInfo');
            const userNameDisplay = document.getElementById('userNameDisplay');
            const userPhotoDisplay = document.getElementById('userPhotoDisplay');
            const depositFundsBtn = document.getElementById('depositFundsBtn');
            const withdrawFundsBtn = document.getElementById('withdrawFundsBtn');

            // Back Buttons
            const backToDashboardBtn = document.getElementById('backToDashboardBtn');
            const backToDashboardBtnSoccerList = document.getElementById('backToDashboardBtnSoccerList'); 
            const backToSoccerListBtn = document.getElementById('backToSoccerListBtn'); 
            const backToDashboardBtnWithdrawal = document.getElementById('backToDashboardBtnWithdrawal'); 

            // Payment Overlay Elements
            const paymentOverlay = document.getElementById('paymentOverlay');
            const paymentAmountDisplay = document.getElementById('paymentAmountDisplay');
            const depositAmountInput = document.getElementById('depositAmountInput'); 
            const paymentStatusMessage = document.getElementById('paymentStatusMessage'); 
            const confirmPaymentButton = document.getElementById('confirmPaymentButton'); 
            const cancelPaymentButton = document.getElementById('cancelPaymentButton'); 
            const simulateSuccessBtn = document.getElementById('simulateSuccessBtn'); 
            const simulateFailBtn = document.getElementById('simulateFailBtn');     
            const quickDepositButtons = document.querySelectorAll('.quick-deposit-btn'); // NEW

            // Withdrawal Section Elements
            const withdrawalBalanceDisplay = document.getElementById('withdrawalBalanceDisplay');
            const withdrawalAmountInput = document.getElementById('withdrawalAmount');
            const bankNameInput = document.getElementById('bankName');
            const accountNumberInput = document.getElementById('accountNumber');
            const accountNameInput = document.getElementById('accountName');
            const initiateWithdrawalButton = document.getElementById('initiateWithdrawalButton');
            const withdrawalStatusMessage = document.getElementById('withdrawalStatusMessage');

            // Profile Setup & Edit Elements
            const profileNameInput = document.getElementById('profileNameInput');
            const profilePhotoUrlInput = document.getElementById('profilePhotoUrlInput');
            const saveProfileBtn = document.getElementById('saveProfileBtn');
            const profileSetupMessage = document.getElementById('profileSetupMessage');
            const editProfileOverlay = document.getElementById('editProfileOverlay'); 
            const editProfileMessage = document.getElementById('editProfileMessage'); 
            const editProfileNameInput = document.getElementById('editProfileNameInput'); 
            const editProfilePhotoUrlInput = document.getElementById('editProfilePhotoUrlInput'); 
            const saveEditedProfileBtn = document.getElementById('saveEditedProfileBtn'); 
            const cancelEditProfileBtn = document.getElementById('cancelEditProfileBtn'); 
            const editProfileStatusMessage = document.getElementById('editProfileStatusMessage'); 
            const nextEditDateDisplay = document.getElementById('nextEditDateDisplay'); 


            // Spin the Wheel elements
            const wheelCanvas = document.getElementById('wheelCanvas');
            const wheelCtx = wheelCanvas.getContext('2d');
            const gameBalanceDisplay = document.getElementById('gameBalanceDisplay');
            const betAmountInput = document.getElementById('betAmount');
            const placeBetButton = document.getElementById('placeBetButton');
            const spinButton = document.getElementById('spinButton');
            const gameMessage = document.getElementById('gameMessage');

            // Visual Soccer elements
            const soccerListBalanceDisplay = document.getElementById('soccerListBalanceDisplay'); 
            const soccerGameBalanceDisplay = document.getElementById('soccerGameBalanceDisplay');
            const soccerBetAmountInput = document.getElementById('soccerBetAmount');
            const placeSoccerBetButton = document.getElementById('placeSoccerBetButton');
            const currentMatchTeams = document.getElementById('currentMatchTeams'); 
            const currentMatchLeague = document.getElementById('currentMatchLeague'); 
            const currentMatchTime = document.getElementById('currentMatchTime'); 
            const matchScoreDisplay = document.getElementById('matchScoreDisplay');
            const betOptionButtons = document.querySelectorAll('.bet-option-btn');
            const oddHome = document.getElementById('oddHome'); 
            const oddDraw = document.getElementById('oddDraw'); 
            const oddAway = document.getElementById('oddAway'); 
            const oddOver1_5 = document.getElementById('oddOver1_5'); 
            const oddUnder1_5 = document.getElementById('oddUnder1_5'); 
            const oddBttsYes = document.getElementById('oddBttsYes'); 
            const oddBttsNo = document.getElementById('oddBttsNo'); 
            const simulateMatchButton = document.getElementById('simulateMatchButton');
            const soccerGameMessage = document.getElementById('soccerGameMessage');
            const soccerVisualCanvas = document.getElementById('soccerVisualCanvas'); 
            const soccerVisualCtx = soccerVisualCanvas.getContext('2d'); 
            const visualMatchMessage = document.getElementById('visualMatchMessage'); 
            const llmCommentarySection = document.getElementById('llmCommentarySection'); 
            const llmCommentaryDisplay = document.getElementById('llmCommentaryDisplay'); 
            const getCommentaryBtn = document.getElementById('getCommentaryBtn'); 
            const placeNewBetBtn = document.getElementById('placeNewBetBtn'); 

            // Global State Variables
            let currentBalance = 0.00; 
            let currentBetAmountSpinWheel = 0;
            let currentBetAmountSoccer = 0;
            let selectedSoccerOutcome = null;
            let currentSelectedSoccerMatch = null; 
            let lastRequestedPaymentAmount = 0; 
            let userName = "Guest";
            let profilePhotoUrl = "";
            let profileSetupDate = 0; // Timestamp when profile was last saved/edited

            // Variables to store last match result for commentary
            let lastMatchResult = {
                homeTeam: "", awayTeam: "", homeScore: 0, awayScore: 0,
                selectedOutcome: "", betWon: false, betAmount: 0
            };

            // Flag to remember which game's bet initiated the payment request
            let gameBetPendingPayment = null; 

            const SEVEN_DAYS_IN_MS = 7 * 24 * 60 * 60 * 1000;

            // --- UI Update Functions ---
            function updateBalanceDisplay() {
                const formattedBalance = `₦${currentBalance.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                gameBalanceDisplay.textContent = formattedBalance;
                soccerGameBalanceDisplay.textContent = formattedBalance;
                soccerListBalanceDisplay.textContent = formattedBalance; 
                withdrawalBalanceDisplay.textContent = formattedBalance; 
            }

            function setGameMessage(message, color = '#555') {
                gameMessage.textContent = message;
                gameMessage.style.color = color;
            }

            function setSoccerGameMessage(message, color = '#555') {
                soccerGameMessage.textContent = message;
                soccerGameMessage.style.color = color;
            }

            function setVisualMatchMessage(message, color = '#333') { 
                visualMatchMessage.textContent = message;
                visualMatchMessage.style.color = color;
            }

            function setWithdrawalMessage(message, color = '#555') { 
                withdrawalStatusMessage.textContent = message;
                withdrawalStatusMessage.style.color = color;
            }

            function setProfileSetupMessage(message, color = '#555') {
                profileSetupMessage.textContent = message;
                profileSetupMessage.style.color = color;
            }

            function setEditProfileStatusMessage(message, color = '#555') {
                editProfileStatusMessage.textContent = message;
                editProfileStatusMessage.style.color = color;
            }

            // Centralized function to hide all major views
            function hideAllViews() { 
                const allViews = [profileSetupView, dashboardView, spinTheWheelGame, visualSoccerGame, soccerMatchListView, withdrawalView, paymentOverlay, editProfileOverlay];
                allViews.forEach(view => {
                    if (view) view.style.display = 'none'; 
                });
                // Clear all glows
                spinTheWheelGame.classList.remove('win-glow', 'lose-glow');
                visualSoccerGame.classList.remove('win-glow', 'lose-glow', 'draw-glow');
            }

            function showDashboard() {
                hideAllViews();
                dashboardView.style.display = 'block';
                renderGameCards(); 
                updateProfileDisplayInHeader(); 
                updateBalanceDisplay(); 
            }

            function showSpinTheWheel() {
                hideAllViews();
                spinTheWheelGame.style.display = 'block';
                updateBalanceDisplay();
                setGameMessage("Place your bet to activate the wheel!");
                spinButton.disabled = true;
                placeBetButton.disabled = false; 
                betAmountInput.disabled = false; 
                betAmountInput.value = 700; 
                drawWheel(wheelRotation);
                checkAndDisableBettingControls(betAmountInput.value, 'spinTheWheel');
            }

            function showSoccerMatchList() { 
                hideAllViews();
                soccerMatchListView.style.display = 'block';
                updateBalanceDisplay(); 
                availableSoccerMatches = generateSoccerMatches(); 
                renderSoccerMatches();
            }

            function showVisualSoccer(match) { 
                hideAllViews();
                visualSoccerGame.style.display = 'block';
                currentSelectedSoccerMatch = match; 
                updateBalanceDisplay();
                setSoccerGameMessage("Place your bet and select an outcome.");
                
                // Reset soccer game specific controls to initial state
                simulateMatchButton.disabled = true;
                placeSoccerBetButton.disabled = false; 
                soccerBetAmountInput.disabled = false; 
                soccerBetAmountInput.value = 1000; 
                currentBetAmountSoccer = 0; 
                betOptionButtons.forEach(btn => {
                    btn.classList.remove('selected');
                    btn.disabled = true; 
                });
                selectedSoccerOutcome = null;

                // Update match details in the view
                currentMatchTeams.textContent = `${match.homeTeam} vs ${match.awayTeam}`;
                currentMatchLeague.textContent = `League: ${match.league}`;
                currentMatchTime.textContent = `Today ${match.time}`;
                oddHome.textContent = match.odds.home.toFixed(2);
                oddDraw.textContent = match.odds.draw.toFixed(2);
                oddAway.textContent = match.odds.away.toFixed(2);
                oddOver1_5.textContent = match.odds.over1_5.toFixed(2); 
                oddUnder1_5.textContent = match.odds.under1_5.toFixed(2); 
                oddBttsYes.textContent = match.odds.btts_yes.toFixed(2); 
                oddBttsNo.textContent = match.odds.btts_no.toFixed(2); 

                // Reset visual match display
                homeScore = 0;
                awayScore = 0;
                matchScoreDisplay.textContent = '0 - 0';
                setVisualMatchMessage('Match ready! Place your bet.');
                drawSoccerVisuals(0, homeScore, awayScore); 
                cancelAnimationFrame(soccerAnimationId); 
                initPlayers(); 
                checkAndDisableBettingControls(soccerBetAmountInput.value, 'visualSoccer');
                
                // Hide commentary section on new match load
                llmCommentarySection.style.display = 'none';
                llmCommentaryDisplay.textContent = '';
                getCommentaryBtn.disabled = true;
                placeNewBetBtn.style.display = 'none'; 
            }

            function showWithdrawalView() { 
                hideAllViews();
                withdrawalView.style.display = 'block';
                updateBalanceDisplay();
                setWithdrawalMessage("Enter details to withdraw funds.");
                withdrawalAmountInput.value = '';
                bankNameInput.value = '';
                accountNumberInput.value = '';
                accountNameInput.value = '';
                initiateWithdrawalButton.disabled = false;

                if (currentBalance < parseFloat(withdrawalAmountInput.min)) {
                    initiateWithdrawalButton.disabled = true;
                    setWithdrawalMessage("Minimum withdrawal is ₦1,000. Insufficient balance.", 'red');
                }
            }

            function showEditProfileOverlay() { 
                editProfileOverlay.style.display = 'flex';
                editProfileNameInput.value = userName;
                editProfilePhotoUrlInput.value = profilePhotoUrl;
                setEditProfileStatusMessage("Update your name and profile photo.");

                const now = Date.now();
                const nextEditTime = profileSetupDate + SEVEN_DAYS_IN_MS;
                
                if (now < nextEditTime) {
                    const remainingMs = nextEditTime - now;
                    const remainingDays = Math.ceil(remainingMs / (1000 * 60 * 60 * 24));
                    const nextEditDate = new Date(nextEditTime).toLocaleDateString();
                    editProfileMessage.innerHTML = `<strong>Note:</strong> Profile changes can only be made every 7 days. Next edit available: <strong>${nextEditDate}</strong> (in ${remainingDays} days).`;
                    editProfileNameInput.disabled = true;
                    editProfilePhotoUrlInput.disabled = true;
                    saveEditedProfileBtn.disabled = true;
                } else {
                    editProfileMessage.innerHTML = `<strong>Note:</strong> Profile changes can only be made every 7 days. Next edit available: <strong>Now!</strong>`;
                    editProfileNameInput.disabled = false;
                    editProfilePhotoUrlInput.disabled = false;
                    saveEditedProfileBtn.disabled = false;
                }
                setAllGameControlsEnabled(false); 
            }

            function updateProfileDisplayInHeader() {
                userNameDisplay.textContent = userName;
                userPhotoDisplay.innerHTML = ''; 

                if (profilePhotoUrl && profilePhotoUrl.startsWith('http')) {
                    const img = document.createElement('img');
                    img.src = profilePhotoUrl;
                    img.alt = userName.charAt(0).toUpperCase();
                    img.onerror = function() {
                        this.outerHTML = `<i class="fas fa-user-circle"></i>`; 
                    };
                    userPhotoDisplay.appendChild(img);
                } else if (userName) {
                    userPhotoDisplay.textContent = userName.charAt(0).toUpperCase();
                } else {
                    userPhotoDisplay.innerHTML = `<i class="fas fa-user-circle"></i>`; 
                }
            }

            // --- Game Card Rendering (Dashboard) ---
            const games = [
                {
                    id: "spin-the-wheel",
                    title: "Spin the Wheel",
                    icon: "fa-solid fa-spinner",
                    description: "Test your luck! Pay an entry fee to spin the wheel and land on exciting prizes, cash, or even free spins. Each spin is a new adventure!",
                    link: "#",
                    available: true
                },
                { 
                    id: "visual-soccer",
                    title: "Visual Soccer",
                    icon: "fa-solid fa-futbol",
                    description: "Bet on the outcome of simulated football matches from various leagues and watch the virtual action unfold!",
                    link: "#",
                    available: true 
                },
                {
                    id: "spin-da-bottle",
                    title: "Spin da Bottle",
                    icon: "fa-solid fa-bottle-droplet",
                    description: "A classic party game re-imagined. Spin the bottle and let fate decide who takes on a truth or a dare. Perfect for group fun!",
                    link: "#",
                    available: false
                },
                {
                    id: "spin-2-win",
                    title: "Spin 2 Win",
                    icon: "fa-solid fa-award",
                    description: "Another thrilling wheel-based game! Spin to match symbols or land on winning combinations for great rewards.",
                    link: "#",
                    available: false
                },
                {
                    id: "flying-plane",
                    title: "Flying Plane Challenge",
                    icon: "fa-solid fa-plane-departure",
                    description: "Take control of a plane and navigate through obstacles. See how far you can fly without crashing!",
                    link: "#",
                    available: false
                },
                {
                    id: "coin-flip",
                    title: "Coin Flip Fortune",
                    icon: "fa-solid fa-coins",
                    description: "A simple game of chance. Predict whether the coin will land on heads or tails to double your earnings!",
                    link: "#",
                    available: false
                },
                {
                    id: "card-match",
                    title: "Card Matching Game",
                    icon: "fa-regular fa-clone",
                    description: "Flip pairs of cards to find matching symbols. Test your memory and concentration skills!",
                    link: "#",
                    available: false
                },
                {
                    id: "treasure-hunt",
                    title: "Treasure Hunt Adventure",
                    icon: "fa-solid fa-treasure-chest",
                    description: "Follow the clues to uncover hidden treasure. Navigate through a virtual map and solve puzzles to claim your reward.",
                    link: "#",
                    available: false
                },
                {
                    id: "word-scramble",
                    title: "Word Scramble Challenge",
                    icon: "fa-solid fa-puzzle-piece",
                    description: "Unscramble the jumbled letters to form valid words. Expand your vocabulary and test your anagram skills.",
                    link: "#",
                    available: false
                },
                {
                    id: "slot-machine",
                    title: "Virtual Slot Machine",
                    icon: "fa-solid fa-slot-machine",
                    description: "Pull the lever and watch the reels spin! Match the symbols to win exciting prizes in this classic casino game.",
                    link: "#",
                    available: false
                },
                {
                    id: "dart-game",
                    title: "Virtual Darts",
                    icon: "fa-solid fa-bullseye",
                    description: "Aim and throw darts at the target. Score points based on where your darts land. A game of precision and skill.",
                    link: "#",
                    available: false
                },
                {
                    id: "balloon-pop",
                    title: "Balloon Pop Frenzy",
                    icon: "fa-solid fa-balloon",
                    description: "Pop as many balloons as you can within the time limit. A fast-paced and colorful game of reflexes.",
                    link: "#",
                    available: false
                },
                {
                    id: "racing-game",
                    title: "Mini Racing Challenge",
                    icon: "fa-solid fa-car",
                    description: "Race against opponents in this fun mini-racing game. Compete for the top spot and earn rewards.",
                    link: "#",
                    available: false
                }
            ];

            function renderGameCards() {
                gameListContainer.innerHTML = '';
                games.forEach(game => {
                    const gameCard = document.createElement('div');
                    gameCard.classList.add('game-card');
                    if (!game.available) {
                        gameCard.classList.add('locked');
                    }

                    gameCard.innerHTML = `
                        <div class="icon-container">
                            <i class="${game.icon}"></i>
                        </div>
                        <h3>${game.title}</h3>
                        <p>${game.description}</p>
                        <a href="${game.link}" class="play-button">${game.available ? 'Play Now' : 'Locked'} <i class="fas fa-arrow-right ml-2"></i></a>
                    `;
                    gameListContainer.appendChild(gameCard);

                    const playButton = gameCard.querySelector('.play-button');
                    playButton.addEventListener('click', (event) => {
                        event.preventDefault();
                        if (!game.available) {
                            alert(`"${game.title}" is currently locked. Play "Spin the Wheel" to unlock more games!`);
                            return;
                        }
                        if (game.id === "spin-the-wheel") {
                            showSpinTheWheel();
                        } else if (game.id === "visual-soccer") {
                            showSoccerMatchList(); 
                        }
                    });
                });
            }

            // --- Spin the Wheel Game Logic ---
            // Spin the Wheel Globals
            let isSpinning = false;
            let wheelRotation = 0; 
            let targetSegmentIndex = -1;
            let animationFrameId; 
            let targetFinalRotation = 0; 
            let initialWheelRotationAtSpinStart = 0;
            let wheelSpinStartTime; 

            // Wheel Configuration
            const segments = [
                { text: "₦1000", color: "#FFEB3B", value: 1000, type: 'win' },
                { text: "₦5000", color: "#4CAF50", value: 5000, type: 'win' },
                { text: "Nothing", color: "#F44336", value: 0, type: 'lose' },
                { text: "₦10000", color: "#2196F3", value: 10000, type: 'win' },
                { text: "₦2000", color: "#FF9800", value: 2000, type: 'win' },
                { text: "₦0", color: "#E91E63", value: 0, type: 'lose' },
                { text: "₦7000", color: "#9C27B0", value: 7000, type: 'win' },
                { text: "₦500", color: "#00BCD4", value: 500, type: 'lose' } 
            ];
            const numSegments = segments.length;
            const arc = (2 * Math.PI) / numSegments; 
            const wheelRadius = wheelCanvas.width / 2 - 10; 

            function drawWheel(currentRotation = 0) {
                const centerX = wheelCanvas.width / 2;
                const centerY = wheelCanvas.height / 2;

                wheelCtx.clearRect(0, 0, wheelCanvas.width, wheelCanvas.height);
                wheelCtx.save();
                wheelCtx.translate(centerX, centerY);
                wheelCtx.rotate(currentRotation);

                segments.forEach((segment, i) => {
                    const startAngle = arc * i;
                    const endAngle = startAngle + arc;
                    wheelCtx.beginPath();
                    wheelCtx.arc(0, 0, wheelRadius, startAngle, endAngle);
                    wheelCtx.lineTo(0, 0);
                    wheelCtx.fillStyle = segment.color;
                    wheelCtx.fill();
                    wheelCtx.strokeStyle = "#ccc";
                    wheelCtx.lineWidth = 1;
                    wheelCtx.stroke();

                    wheelCtx.save();
                    const textAngle = startAngle + arc / 2;
                    wheelCtx.rotate(textAngle);
                    wheelCtx.textAlign = "right";
                    wheelCtx.fillStyle = "#333";
                    wheelCtx.font = "bold 18px Inter";
                    wheelCtx.fillText(segment.text, wheelRadius - 20, 0);
                    wheelCtx.restore();
                });

                wheelCtx.restore();

                wheelCtx.beginPath();
                wheelCtx.moveTo(centerX, centerY - wheelRadius - 20);
                wheelCtx.lineTo(centerX - 15, centerY - wheelRadius - 5);
                wheelCtx.lineTo(centerX + 15, centerY - wheelRadius - 5);
                wheelCtx.closePath();
                wheelCtx.fillStyle = "#333";
                wheelCtx.fill();
            }

            const SPIN_WHEEL_DURATION = 3500;

            function animateSpinFixedDuration(currentTime) {
                if (!wheelSpinStartTime) wheelSpinStartTime = currentTime;
                const elapsedTime = currentTime - wheelSpinStartTime;

                if (elapsedTime >= SPIN_WHEEL_DURATION) {
                    isSpinning = false;
                    cancelAnimationFrame(animationFrameId);
                    wheelRotation = targetFinalRotation;
                    drawWheel(wheelRotation);
                    handleSpinResult(segments[targetSegmentIndex]);
                    wheelSpinStartTime = null; 
                    return;
                }

                const progress = elapsedTime / SPIN_WHEEL_DURATION;
                const easedProgress = 1 - Math.pow(1 - progress, 3); 
                
                const totalAngleDelta = targetFinalRotation - initialWheelRotationAtSpinStart;
                wheelRotation = initialWheelRotationAtSpinStart + totalAngleDelta * easedProgress;

                drawWheel(wheelRotation);
                animationFrameId = requestAnimationFrame(animateSpinFixedDuration);
            }

            function startSpin() {
                if (isSpinning || currentBetAmountSpinWheel === 0) return;

                if (currentBalance < currentBetAmountSpinWheel) {
                    showPaymentOverlay(currentBetAmountSpinWheel, 'spinTheWheel'); 
                    return;
                }
                currentBalance -= currentBetAmountSpinWheel;
                updateBalanceDisplay();

                isSpinning = true;
                spinButton.disabled = true;
                placeBetButton.disabled = true;
                betAmountInput.disabled = true;
                spinTheWheelGame.classList.remove('win-glow', 'lose-glow');

                setGameMessage("Wheel spinning... Good luck!");

                targetSegmentIndex = Math.floor(Math.random() * numSegments);

                const angleToAlign = (3 * Math.PI / 2) - (targetSegmentIndex * arc + arc / 2);
                const normalizedAngleToAlign = (angleToAlign + 2 * Math.PI + Math.PI) % (2 * Math.PI) - Math.PI;

                const fullSpinsToAdd = Math.floor(Math.random() * 6) + 5; 
                targetFinalRotation = wheelRotation + (fullSpinsToAdd * 2 * Math.PI) + normalizedAngleToAlign;

                initialWheelRotationAtSpinStart = wheelRotation;
                wheelSpinStartTime = null; 
                requestAnimationFrame(animateSpinFixedDuration);
            }

            function handleSpinResult(segment) {
                if (segment.type === 'win') {
                    currentBalance += segment.value;
                    setGameMessage(`You won ${segment.text}! Your balance is now ₦${currentBalance.toLocaleString()}.`, 'green');
                    spinTheWheelGame.classList.add('win-glow');
                } else {
                    setGameMessage(`You landed on ${segment.text}. Your bet of ₦${currentBetAmountSpinWheel.toLocaleString()} was deducted. Current balance: ₦${currentBalance.toLocaleString()}.`, 'red'); 
                    spinTheWheelGame.classList.add('lose-glow');
                }
                updateBalanceDisplay();

                spinButton.disabled = true;
                placeBetButton.disabled = false;
                betAmountInput.disabled = false;
            }

            // --- Visual Soccer Game Logic ---
            const SOCCER_TEAMS = [
                "Real Madrid", "FC Barcelona", "Manchester United", "Liverpool FC",
                "Bayern Munich", "Paris SG", "Juventus", "Inter Milan",
                "Arsenal FC", "Chelsea FC", "Tottenham Hotspur", "Atlético Madrid",
                "Borussia Dortmund", "AC Milan", "Napoli", "Benfica",
                "Porto", "Ajax", "Roma", "Lazio", "Sevilla", "Valencia",
                "RB Leipzig", "Borussia Mönchengladbach", "Lyon", "Marseille",
                "Fiorentina", "Atalanta", "Real Betis", "Villarreal"
            ];
            const SOCCER_LEAGUES = [
                "Premier League", "La Liga", "Serie A", "Bundesliga", "Ligue 1", 
                "Champions League", "Europa League", "FA Cup" 
            ];
            // Modified SOCCER_ODDS_POOL to provide slightly lower winning payouts
            const SOCCER_ODDS_POOL = [ 
                { home: 1.55, draw: 3.40, away: 4.20, over1_5: 1.40, under1_5: 2.40, btts_yes: 1.50, btts_no: 2.00 },
                { home: 1.90, draw: 3.15, away: 2.90, over1_5: 1.45, under1_5: 2.10, btts_yes: 1.60, btts_no: 1.85 },
                { home: 1.35, draw: 3.90, away: 5.50, over1_5: 1.30, under1_5: 2.70, btts_yes: 1.40, btts_no: 2.20 },
                { home: 2.30, draw: 3.05, away: 2.70, over1_5: 1.55, under1_5: 1.90, btts_yes: 1.70, btts_no: 1.75 },
                { home: 1.70, draw: 3.30, away: 3.60, over1_5: 1.40, under1_5: 2.25, btts_yes: 1.55, btts_no: 1.95 },
                { home: 2.00, draw: 2.80, away: 3.00, over1_5: 1.60, under1_5: 1.80, btts_yes: 1.75, btts_no: 1.65 }
            ];
            // Soccer Animation Globals
            let soccerAnimationId; 
            let soccerMatchStartTime;
            const SOCCER_MATCH_DURATION_SECONDS = 90; 
            const SOCCER_ANIMATION_DURATION_MS = 10000; 
            let ballPos = { x: 0, y: 0 }; 
            let ballTarget = { x: 0, y: 0 }; 
            const ballSpeed = 3; 
            const PLAYER_RADIUS = 6;
            const PLAYER_COUNT_PER_TEAM = 5; 
            let homePlayers = [];
            let awayPlayers = [];
            let homeScore = 0;
            let awayScore = 0;
            let matchVisualState = 'pre_kickoff'; 
            let goalEvents = []; 


            function generateSoccerMatches(count = 7) { 
                const matches = [];
                const generatedTimes = new Set(); 
                for (let i = 0; i < count; i++) {
                    let team1Index = Math.floor(Math.random() * SOCCER_TEAMS.length);
                    let team2Index;
                    do {
                        team2Index = Math.floor(Math.random() * SOCCER_TEAMS.length);
                    } while (team1Index === team2Index);

                    const home = SOCCER_TEAMS[team1Index];
                    const away = SOCCER_TEAMS[team2Index];
                    const league = SOCCER_LEAGUES[Math.floor(Math.random() * SOCCER_LEAGUES.length)];
                    const odds = SOCCER_ODDS_POOL[Math.floor(Math.random() * SOCCER_ODDS_POOL.length)];
                    
                    let time;
                    do {
                        const timeHour = Math.floor(Math.random() * 6) + 16; 
                        const timeMinute = Math.floor(Math.random() * 12) * 5; 
                        time = `${String(timeHour).padStart(2, '0')}:${String(timeMinute).padStart(2, '0')}`;
                    } while (generatedTimes.has(time));
                    generatedTimes.add(time);

                    matches.push({
                        id: `match-${i}`,
                        homeTeam: home,
                        awayTeam: away,
                        league: league,
                        time: time,
                        odds: { ...odds } 
                    });
                }
                return matches;
            }

            let availableSoccerMatches = generateSoccerMatches(); 

            function renderSoccerMatches() {
                soccerMatchListContainer.innerHTML = '';
                availableSoccerMatches.forEach(match => {
                    const matchCard = document.createElement('div');
                    matchCard.classList.add('match-card');
                    matchCard.dataset.matchId = match.id; 
                    matchCard.innerHTML = `
                        <h4>${match.league} | ${match.time}</h4>
                        <div class="teams">${match.homeTeam} <span class="vs">VS</span> ${match.awayTeam}</div>
                        <div class="odds-display">
                            <span class="odd-item">H: ${match.odds.home.toFixed(2)}</span>
                            <span class="odd-item">D: ${match.odds.draw.toFixed(2)}</span>
                            <span class="odd-item">A: ${match.odds.away.toFixed(2)}</span>
                            <span class="odd-item">O1.5: ${match.odds.over1_5.toFixed(2)}</span>
                            <span class="odd-item">U1.5: ${match.odds.under1_5.toFixed(2)}</span>
                            <span class="odd-item">BTTS Y: ${match.odds.btts_yes.toFixed(2)}</span>
                            <span class="odd-item">BTTS N: ${match.odds.btts_no.toFixed(2)}</span>
                        </div>
                    `;
                    soccerMatchListContainer.appendChild(matchCard);
                });

                soccerMatchListContainer.querySelectorAll('.match-card').forEach(card => {
                    card.addEventListener('click', (event) => {
                        const matchId = event.currentTarget.dataset.matchId;
                        const selectedMatch = availableSoccerMatches.find(m => m.id === matchId);
                        if (selectedMatch) {
                            showVisualSoccer(selectedMatch);
                        }
                    });
                });
            }

            function resetSoccerGameControls() {
                simulateMatchButton.disabled = true;
                placeSoccerBetButton.disabled = false;
                soccerBetAmountInput.disabled = false;
                betOptionButtons.forEach(btn => {
                    btn.classList.remove('selected');
                    btn.disabled = true; 
                });
                selectedSoccerOutcome = null;
                visualSoccerGame.classList.remove('win-glow', 'lose-glow', 'draw-glow');
                setSoccerGameMessage("Place your bet and select an outcome.");
                setVisualMatchMessage('Match ready! Place your bet.');
                
                cancelAnimationFrame(soccerAnimationId);
                homeScore = 0;
                awayScore = 0;
                matchScoreDisplay.textContent = '0 - 0';
                drawSoccerVisuals(0, homeScore, awayScore); 
                initPlayers(); 
                goalEvents = []; 
                currentBetAmountSoccer = 0; 

                // Reset LLM commentary section
                llmCommentarySection.style.display = 'none';
                llmCommentaryDisplay.textContent = '';
                getCommentaryBtn.disabled = true;
                placeNewBetBtn.style.display = 'none'; 
                lastMatchResult = {homeTeam: "", awayTeam: "", homeScore: 0, awayScore: 0, selectedOutcome: "", betWon: false, betAmount: 0}; // Clear last match result

                checkAndDisableBettingControls(parseFloat(soccerBetAmountInput.min), 'visualSoccer');
            }

            function initPlayers() {
                homePlayers = [];
                awayPlayers = [];
                const canvas = soccerVisualCanvas;
                const fieldWidth = canvas.width;
                const fieldHeight = canvas.height;

                ballPos = { x: fieldWidth / 2, y: fieldHeight / 2 }; 
                ballTarget = { x: fieldWidth / 2, y: fieldHeight / 2 };

                for (let i = 0; i < PLAYER_COUNT_PER_TEAM; i++) {
                    homePlayers.push({
                        x: Math.random() * (fieldWidth / 2 - 20) + 10,
                        y: Math.random() * (fieldHeight - 20) + 10,
                        targetX: 0, targetY: 0, 
                        color: '#0000FF' 
                    });
                }
                for (let i = 0; i < PLAYER_COUNT_PER_TEAM; i++) {
                    awayPlayers.push({
                        x: Math.random() * (fieldWidth / 2 - 20) + fieldWidth / 2 + 10,
                        y: Math.random() * (fieldHeight - 20) + 10,
                        targetX: 0, targetY: 0, 
                        color: '#FF0000' 
                    });
                }
                setNewPlayerTargets(); 
            }

            function setNewPlayerTargets() {
                const canvas = soccerVisualCanvas;
                homePlayers.forEach(p => {
                    p.targetX = Math.random() * (canvas.width / 2 - 20) + 10;
                    p.targetY = Math.random() * (canvas.height - 20) + 10;
                });
                awayPlayers.forEach(p => {
                    p.targetX = Math.random() * (canvas.width / 2 - 20) + canvas.width / 2 + 10;
                    p.targetY = Math.random() * (canvas.height - 20) + 10;
                });
            }

            function drawSoccerVisuals(timeElapsedPercent, currentHomeScore, currentAwayScore) {
                const canvas = soccerVisualCanvas;
                const ctx = soccerVisualCtx;
                const width = canvas.width;
                const height = canvas.height;

                ctx.clearRect(0, 0, width, height);

                ctx.fillStyle = '#4CAF50'; 
                ctx.fillRect(0, 0, width, height);

                ctx.strokeStyle = '#FFFFFF';
                ctx.lineWidth = 2;

                ctx.strokeRect(0, 0, width, height);

                ctx.beginPath();
                ctx.moveTo(width / 2, 0);
                ctx.lineTo(width / 2, height);
                ctx.stroke();

                ctx.beginPath();
                ctx.arc(width / 2, height / 2, Math.min(width, height) * 0.15, 0, 2 * Math.PI);
                ctx.stroke();

                ctx.beginPath();
                ctx.arc(width / 2, height / 2, 2, 0, 2 * Math.PI);
                ctx.fillStyle = '#FFFFFF';
                ctx.fill();

                const penaltyBoxWidth = width * 0.25;
                const penaltyBoxHeight = height * 0.5;
                ctx.strokeRect(0, (height - penaltyBoxHeight) / 2, penaltyBoxWidth, penaltyBoxHeight); 
                ctx.strokeRect(width - penaltyBoxWidth, (height - penaltyBoxHeight) / 2, penaltyBoxWidth, penaltyBoxHeight); 

                const goalAreaWidth = width * 0.1;
                const goalAreaHeight = height * 0.25;
                ctx.strokeRect(0, (height - goalAreaHeight) / 2, goalAreaWidth, goalAreaHeight); 
                ctx.strokeRect(width - goalAreaWidth, (height - goalAreaHeight) / 2, goalAreaWidth, goalAreaHeight); 

                const goalWidth = 5;
                const goalHeight = height * 0.15;
                ctx.fillStyle = '#AAAAAA';
                ctx.fillRect(0, (height - goalHeight) / 2, goalWidth, goalHeight); 
                ctx.fillRect(width - goalWidth, (height - goalHeight) / 2, goalWidth, goalHeight); 

                homePlayers.forEach(p => {
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, PLAYER_RADIUS, 0, 2 * Math.PI);
                    ctx.fillStyle = p.color;
                    ctx.fill();
                    ctx.strokeStyle = '#333';
                    ctx.lineWidth = 1;
                    ctx.stroke();
                });
                awayPlayers.forEach(p => {
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, PLAYER_RADIUS, 0, 2 * Math.PI);
                    ctx.fillStyle = p.color;
                    ctx.fill();
                    ctx.strokeStyle = '#333';
                    ctx.lineWidth = 1;
                    ctx.stroke();
                });

                ctx.beginPath();
                ctx.arc(ballPos.x, ballPos.y, 5, 0, 2 * Math.PI); 
                ctx.fillStyle = '#FFFFFF';
                ctx.fill();
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 1;
                ctx.stroke();

                const simulatedMatchTime = Math.min(SOCCER_MATCH_DURATION_SECONDS, Math.floor(timeElapsedPercent * SOCCER_MATCH_DURATION_SECONDS)); 
                ctx.fillStyle = '#333';
                ctx.font = 'bold 14px Inter';
                ctx.textAlign = 'center';
                ctx.fillText(`Time: ${simulatedMatchTime}'`, width / 2, height - 10);
                ctx.textAlign = 'left';
            }

            function updateBallAndPlayersPositions() {
                const canvas = soccerVisualCanvas;
                const width = canvas.width;
                const height = canvas.height;

                const dx_ball = ballTarget.x - ballPos.x;
                const dy_ball = ballTarget.y - ballPos.y;
                const distance_ball = Math.sqrt(dx_ball * dx_ball + dy_ball * dy_ball);

                if (distance_ball > ballSpeed) {
                    ballPos.x += (dx_ball / distance_ball) * ballSpeed;
                    ballPos.y += (dy_ball / distance_ball) * ballSpeed;
                } else {
                    ballPos.x = ballTarget.x;
                    ballPos.y = ballTarget.y;
                    ballTarget = {
                        x: Math.random() * width,
                        y: Math.random() * height
                    };
                }

                const playerSpeed = 1.5;
                homePlayers.forEach(p => {
                    let target = {x: p.targetX, y: p.targetY};
                    if (Math.random() < 0.1) { 
                        target = {x: ballPos.x + (Math.random() * 20 - 10), y: ballPos.y + (Math.random() * 20 - 10)};
                    }
                    const dx = target.x - p.x;
                    const dy = target.y - p.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    if (dist > playerSpeed) {
                        p.x += (dx / dist) * playerSpeed;
                        p.y += (dy / dist) * playerSpeed;
                    } else {
                        p.targetX = Math.random() * (width / 2 - 20) + 10;
                        p.targetY = Math.random() * (height - 20) + 10;
                    }
                });
                awayPlayers.forEach(p => {
                    let target = {x: p.targetX, y: p.targetY};
                    if (Math.random() < 0.1) {
                        target = {x: ballPos.x + (Math.random() * 20 - 10), y: ballPos.y + (Math.random() * 20 - 10)};
                    }
                    const dx = target.x - p.x;
                    const dy = target.y - p.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    if (dist > playerSpeed) {
                        p.x += (dx / dist) * playerSpeed;
                        p.y += (dy / dist) * playerSpeed;
                    } else {
                        p.targetX = Math.random() * (width / 2 - 20) + width / 2 + 10;
                        p.targetY = Math.random() * (height - 20) + 10;
                    }
                });
            }


            function animateSoccerMatch(currentTime) {
                if (!soccerMatchStartTime) soccerMatchStartTime = currentTime;
                const elapsedTime = currentTime - soccerMatchStartTime;
                const timeElapsedPercent = Math.min(1, elapsedTime / SOCCER_ANIMATION_DURATION_MS);

                if (timeElapsedPercent >= 1) { 
                    cancelAnimationFrame(soccerAnimationId);
                    matchVisualState = 'fulltime';
                    setVisualMatchMessage('Full-time!', 'darkblue');
                    handleSoccerMatchResult(homeScore, awayScore);
                    soccerMatchStartTime = null; 
                    return;
                }

                updateBallAndPlayersPositions(); 
                drawSoccerVisuals(timeElapsedPercent, homeScore, awayScore);

                if (goalEvents.length > 0 && goalEvents[0].time <= elapsedTime) {
                    const goal = goalEvents.shift(); 
                    if (goal.team === 'home') {
                        homeScore++;
                    } else {
                        awayScore++;
                    }
                    matchScoreDisplay.textContent = `${homeScore} - ${awayScore}`;
                    setVisualMatchMessage(`GOAL! ${goal.team === 'home' ? currentSelectedSoccerMatch.homeTeam : currentSelectedSoccerMatch.awayTeam} scores!`, 'darkgreen');
                    ballTarget = {
                        x: goal.team === 'home' ? soccerVisualCanvas.width * 0.9 : soccerVisualCanvas.width * 0.1,
                        y: soccerVisualCanvas.height / 2
                    };
                    setTimeout(() => { 
                        setVisualMatchMessage('Match in progress...', '#333');
                        ballTarget = { x: soccerVisualCanvas.width / 2, y: soccerVisualCanvas.height / 2 }; 
                    }, 1500); 
                }

                if (timeElapsedPercent > 0.49 && timeElapsedPercent < 0.51 && matchVisualState !== 'halftime') { 
                    setVisualMatchMessage('Half-time! Teams are resting.', 'gray');
                    matchVisualState = 'halftime';
                    const tempBallSpeed = ballSpeed; 
                    ballTarget = { x: soccerVisualCanvas.width / 2, y: soccerVisualCanvas.height / 2 }; 
                    setTimeout(() => {
                        setVisualMatchMessage('Second half begins!', '#333');
                        matchVisualState = 'playing';
                    }, 2000); 
                } else if (timeElapsedPercent < 0.05 && matchVisualState === 'pre_kickoff') {
                    setVisualMatchMessage('Kick-off!', '#333');
                    matchVisualState = 'playing';
                }
                if (matchVisualState === 'playing' && visualMatchMessage.textContent.includes("GOAL!")) {
                } else if (matchVisualState === 'playing' && !visualMatchMessage.textContent.includes("Match in progress") && !visualMatchMessage.textContent.includes("Half-time!")) {
                    setVisualMatchMessage('Match in progress...', '#333');
                }


                soccerAnimationId = requestAnimationFrame(animateSoccerMatch);
            }

            function startSoccerMatchSimulation() {
                if (currentBetAmountSoccer === 0) {
                    setSoccerGameMessage("Please place a bet first.", 'red');
                    return;
                }
                if (!selectedSoccerOutcome) {
                    setSoccerGameMessage("Please select an outcome (Home Win, Draw, Away Win, Over/Under, BTTS).", 'red');
                    return;
                }

                simulateMatchButton.disabled = true;
                placeSoccerBetButton.disabled = true;
                soccerBetAmountInput.disabled = true;
                betOptionButtons.forEach(btn => btn.disabled = true); 
                setSoccerGameMessage("Simulating match... please wait.", 'blue');
                visualSoccerGame.classList.remove('win-glow', 'lose-glow', 'draw-glow');

                homeScore = 0; 
                awayScore = 0;
                matchScoreDisplay.textContent = '0 - 0'; 

                const finalOutcome = determineMatchOutcome();
                let actualHomeGoals = 0;
                let actualAwayGoals = 0;

                switch (finalOutcome) {
                    case 'home':
                        actualHomeGoals = Math.floor(Math.random() * 3) + 1; 
                        actualAwayGoals = Math.max(0, Math.floor(Math.random() * actualHomeGoals)); 
                        break;
                    case 'away':
                        actualAwayGoals = Math.floor(Math.random() * 3) + 1;
                        actualHomeGoals = Math.max(0, Math.floor(Math.random() * actualAwayGoals));
                        break;
                    case 'draw':
                        actualHomeGoals = Math.floor(Math.random() * 2); 
                        actualAwayGoals = actualHomeGoals;
                        if (actualHomeGoals === 0 && Math.random() < 0.5) { 
                            actualHomeGoals = 1;
                            actualAwayGoals = 1;
                        }
                        break;
                    case 'over1_5':
                        let totalGoalsOver = Math.floor(Math.random() * 3) + 2; 
                        actualHomeGoals = Math.floor(Math.random() * totalGoalsOver);
                        actualAwayGoals = totalGoalsOver - actualHomeGoals;
                        if ((actualHomeGoals === 0 && actualAwayGoals === 0) || (actualHomeGoals === 1 && actualAwayGoals === 0) || (actualHomeGoals === 0 && actualAwayGoals === 1)) {
                            actualHomeGoals = Math.floor(Math.random() * totalGoalsOver) + 1; 
                            actualAwayGoals = totalGoalsOver - actualHomeGoals;
                            if (actualAwayGoals < 0) actualAwayGoals = 0;
                        }
                        break;
                    case 'under1_5':
                        if (Math.random() < 0.6) { 
                            actualHomeGoals = 0;
                            actualAwayGoals = 0;
                        } else { 
                            actualHomeGoals = Math.random() < 0.5 ? 1 : 0;
                            actualAwayGoals = 1 - actualHomeGoals;
                        }
                        break;
                    case 'btts_yes':
                        actualHomeGoals = Math.floor(Math.random() * 2) + 1; 
                        actualAwayGoals = Math.floor(Math.random() * 2) + 1; 
                        break;
                    case 'btts_no':
                        if (Math.random() < 0.5) { 
                            actualHomeGoals = Math.floor(Math.random() * 3) + 1;
                            actualAwayGoals = 0;
                        } else {
                            actualHomeGoals = 0;
                            actualAwayGoals = Math.floor(Math.random() * 3) + 1;
                        }
                        if (Math.random() < 0.2 && actualHomeGoals === 0 && actualAwayGoals === 0) { 
                        }
                        break;
                }

                goalEvents = [];
                const totalGoals = actualHomeGoals + actualAwayGoals;
                for (let i = 0; i < totalGoals; i++) {
                    const goalTimeMs = Math.random() * SOCCER_ANIMATION_DURATION_MS * (Math.random() < 0.5 ? 0.45 : 1); 
                    let scorer;
                    if (actualHomeGoals > actualAwayGoals) { 
                        scorer = Math.random() < 0.6 ? 'home' : 'away';
                    } else if (actualAwayGoals > actualHomeGoals) { 
                        scorer = Math.random() < 0.6 ? 'away' : 'home';
                    } else { 
                        scorer = Math.random() < 0.5 ? 'home' : 'away';
                    }
                    goalEvents.push({ time: goalTimeMs, team: scorer });
                }
                goalEvents.sort((a, b) => a.time - b.time); 

                soccerMatchStartTime = null; 
                matchVisualState = 'pre_kickoff'; 
                requestAnimationFrame(animateSoccerMatch);
            }

            function determineMatchOutcome() {
                const odds = currentSelectedSoccerMatch.odds;
                
                let outcomeProbs = {
                    home: 1 / odds.home,
                    draw: 1 / odds.draw,
                    away: 1 / odds.away,
                    over1_5: 1 / odds.over1_5,
                    under1_5: 1 / odds.under1_5,
                    btts_yes: 1 / odds.btts_yes,
                    btts_no: 1 / odds.btts_no
                };

                const primaryOutcomes = ['home', 'draw', 'away'];
                const secondaryOutcomes = ['over1_5', 'under1_5', 'btts_yes', 'btts_no'];

                let candidates = {};

                if (selectedSoccerOutcome && primaryOutcomes.includes(selectedSoccerOutcome)) {
                    candidates = { [selectedSoccerOutcome]: outcomeProbs[selectedSoccerOutcome] };
                } else if (selectedSoccerOutcome && secondaryOutcomes.includes(selectedSoccerOutcome)) {
                    candidates = { [selectedSoccerOutcome]: outcomeProbs[selectedSoccerOutcome] };
                    primaryOutcomes.forEach(p => {
                        candidates[p] = (candidates[p] || 0) + outcomeProbs[p] * 0.5; 
                    });
                } else {
                    candidates = outcomeProbs;
                }

                const totalWeight = Object.values(candidates).reduce((sum, weight) => sum + weight, 0);
                let random = Math.random() * totalWeight;

                for (const outcome in candidates) {
                    random -= candidates[outcome];
                    if (random <= 0) {
                        return outcome;
                    }
                }

                return 'draw'; 
            }


            function handleSoccerMatchResult(finalHomeScore, finalAwayScore) {
                matchScoreDisplay.textContent = `${finalHomeScore} - ${finalAwayScore}`; 

                let predictionCorrect = false;
                let oddsMultiplier = 0;

                let actualOutcomePrimary;
                if (finalHomeScore > finalAwayScore) {
                    actualOutcomePrimary = 'home';
                } else if (finalHomeScore < finalAwayScore) {
                    actualOutcomePrimary = 'away';
                } else {
                    actualOutcomePrimary = 'draw';
                }

                let actualOutcomeOverUnder;
                const totalGoals = finalHomeScore + finalAwayScore;
                if (totalGoals > 1.5) {
                    actualOutcomeOverUnder = 'over1_5';
                } else {
                    actualOutcomeOverUnder = 'under1_5';
                }

                let actualOutcomeBtts;
                if (finalHomeScore > 0 && finalAwayScore > 0) {
                    actualOutcomeBtts = 'btts_yes';
                } else {
                    actualOutcomeBtts = 'btts_no';
                }

                if (['home', 'draw', 'away'].includes(selectedSoccerOutcome)) {
                    if (selectedSoccerOutcome === actualOutcomePrimary) {
                        predictionCorrect = true;
                        oddsMultiplier = currentSelectedSoccerMatch.odds[selectedSoccerOutcome];
                    }
                } else if (['over1_5', 'under1_5'].includes(selectedSoccerOutcome)) {
                    if (selectedSoccerOutcome === actualOutcomeOverUnder) {
                        predictionCorrect = true;
                        oddsMultiplier = currentSelectedSoccerMatch.odds[selectedSoccerOutcome];
                    }
                } else if (['btts_yes', 'btts_no'].includes(selectedSoccerOutcome)) {
                    if (selectedSoccerOutcome === actualOutcomeBtts) {
                        predictionCorrect = true;
                        oddsMultiplier = currentSelectedSoccerMatch.odds[selectedSoccerOutcome];
                    }
                }

                if (predictionCorrect) {
                    const winnings = currentBetAmountSoccer * oddsMultiplier;
                    currentBalance += winnings; 
                    setSoccerGameMessage(`CONGRATULATIONS! Your bet on ${selectedSoccerOutcome.toUpperCase()} was correct! You won ₦${winnings.toLocaleString()}!`, 'green');
                    visualSoccerGame.classList.add('win-glow');
                    lastMatchResult.betWon = true; 
                } else {
                    setSoccerGameMessage(`BET LOST! The match result was ${finalHomeScore} - ${finalAwayScore}. Your bet of ₦${currentBetAmountSoccer.toLocaleString()} was deducted. Current balance: ₦${currentBalance.toLocaleString()}.`, 'red'); 
                    visualSoccerGame.classList.add('lose-glow');
                    if (actualOutcomePrimary === 'draw') { 
                        visualSoccerGame.classList.add('draw-glow');
                    }
                    lastMatchResult.betWon = false; 
                }
                updateBalanceDisplay(); 

                // Store full match result for LLM commentary
                lastMatchResult = {
                    homeTeam: currentSelectedSoccerMatch.homeTeam,
                    awayTeam: currentSelectedSoccerMatch.awayTeam,
                    homeScore: finalHomeScore,
                    awayScore: finalAwayScore,
                    selectedOutcome: selectedSoccerOutcome,
                    betWon: predictionCorrect,
                    betAmount: currentBetAmountSoccer
                };
                llmCommentarySection.style.display = 'block'; 
                getCommentaryBtn.disabled = false; 
                placeNewBetBtn.style.display = 'inline-flex'; 
            }


            // --- Payment Overlay ---
            function showPaymentOverlay(suggestedAmount = 5000, gameId = null) {
                lastRequestedPaymentAmount = suggestedAmount; 
                gameBetPendingPayment = gameId; 
                
                depositAmountInput.value = Math.max(1000, Math.min(1000000, suggestedAmount)); 
                const event = new Event('input', { bubbles: true });
                depositAmountInput.dispatchEvent(event);

                paymentOverlay.style.display = 'flex';
                paymentStatusMessage.textContent = "Enter amount and confirm payment.";
                paymentStatusMessage.style.color = "grey";
                
                setAllGameControlsEnabled(false); 

                // Ensure buttons are reset to original state when opening overlay
                confirmPaymentButton.innerHTML = `<i class="fas fa-check-circle"></i> Auto-Authenticate Payment`; 
                simulateSuccessBtn.innerHTML = `<i class="fas fa-money-check-alt"></i> Simulate Successful Deposit`;
                simulateFailBtn.innerHTML = `<i class="fas fa-exclamation-triangle"></i> Simulate Failed Deposit`;
                confirmPaymentButton.disabled = false; 
                simulateSuccessBtn.disabled = false;
                simulateFailBtn.disabled = false;
                cancelPaymentButton.disabled = false;
            }
            
            let originalConfirmBtnHtml = '';
            let originalSimulateSuccessBtnHtml = '';
            let originalSimulateFailBtnHtml = '';

            function simulatePaymentAuthentication(forcedOutcome = null, clickedButton = null) {
                const amountToDeposit = parseFloat(depositAmountInput.value);

                if (isNaN(amountToDeposit) || amountToDeposit < 1000 || amountToDeposit > 1000000) {
                    paymentStatusMessage.textContent = "Please enter a valid deposit amount (₦1,000 - ₦1,000,000).";
                    paymentStatusMessage.style.color = "red";
                    // Only re-enable buttons if input is bad, user needs to fix it
                    confirmPaymentButton.disabled = false;
                    simulateSuccessBtn.disabled = false;
                    simulateFailBtn.disabled = false;
                    cancelPaymentButton.disabled = false; 
                    return;
                }

                // Store original button HTML before changing
                originalConfirmBtnHtml = confirmPaymentButton.innerHTML;
                originalSimulateSuccessBtnHtml = simulateSuccessBtn.innerHTML;
                originalSimulateFailBtnHtml = simulateFailBtn.innerHTML;

                // Disable all payment buttons during authentication
                confirmPaymentButton.disabled = true;
                simulateSuccessBtn.disabled = true;
                simulateFailBtn.disabled = true;
                cancelPaymentButton.disabled = true;

                paymentStatusMessage.textContent = "Authenticating payment... Please wait <i class='fas fa-spinner fa-spin'></i>";
                paymentStatusMessage.style.color = "blue";
                
                // Show spinner only on the button that was actually clicked
                if (clickedButton) {
                    clickedButton.innerHTML = `<i class="fas fa-spinner fa-spin"></i> Authenticating...`;
                }

                setTimeout(() => {
                    let transferSuccessful;
                    if (forcedOutcome === 'success') {
                        transferSuccessful = true;
                    } else if (forcedOutcome === 'failure') {
                        transferSuccessful = false;
                    } else { 
                        transferSuccessful = Math.random() < 0.7; 
                    }

                    // Restore button texts and re-enable them BEFORE hiding the overlay
                    confirmPaymentButton.innerHTML = originalConfirmBtnHtml;
                    simulateSuccessBtn.innerHTML = originalSimulateSuccessBtnHtml;
                    simulateFailBtn.innerHTML = originalSimulateFailBtnHtml;
                    confirmPaymentButton.disabled = false; 
                    simulateSuccessBtn.disabled = false;
                    simulateFailBtn.disabled = false;
                    cancelPaymentButton.disabled = false; 

                    if (transferSuccessful) {
                        currentBalance += amountToDeposit; 
                        updateBalanceDisplay();
                        setGameMessage("Payment successful! Balance updated. You can now place your bet.", 'green');
                        setSoccerGameMessage("Payment successful! Balance updated. You can now place your bet.", 'green');
                        setVisualMatchMessage("Payment successful! Balance updated.", 'green'); 
                        paymentStatusMessage.textContent = `Payment successful! ₦${amountToDeposit.toLocaleString()} added. Balance updated.`;
                        paymentStatusMessage.style.color = "green";

                        if (gameBetPendingPayment === 'visualSoccer') {
                            const betToPlace = lastRequestedPaymentAmount;
                            if (currentBalance >= betToPlace) { 
                                currentBalance -= betToPlace;
                                updateBalanceDisplay();
                                currentBetAmountSoccer = betToPlace;
                                placeSoccerBetButton.disabled = true;
                                soccerBetAmountInput.disabled = true;
                                betOptionButtons.forEach(btn => btn.disabled = false); 
                                setSoccerGameMessage(`Bet of ₦${currentBetAmountSoccer.toLocaleString()} placed! Now select your outcome.`);
                                if (selectedSoccerOutcome) {
                                    simulateMatchButton.disabled = false;
                                }
                            } else {
                                setSoccerGameMessage("Funds added, but still not enough for your last intended bet. Please try again.", 'red');
                            }
                        } else if (gameBetPendingPayment === 'spinTheWheel') {
                            const betToPlace = lastRequestedPaymentAmount;
                             if (currentBalance >= betToPlace) { 
                                currentBalance -= betToPlace;
                                updateBalanceDisplay();
                                currentBetAmountSpinWheel = betToPlace;
                                spinButton.disabled = false; 
                                placeBetButton.disabled = true;
                                betAmountInput.disabled = true;
                                setGameMessage(`Bet of ₦${currentBetAmountSpinWheel.toLocaleString()} placed! Click SPIN.`);
                             } else {
                                setGameMessage("Funds added, but still not enough for your last intended bet. Please try again.", 'red');
                             }
                        }
                        // Only hide overlay if successful
                        paymentOverlay.style.display = 'none'; 
                    } else {
                        setGameMessage("Payment authentication failed. Please try again or contact support.", 'red');
                        setSoccerGameMessage("Payment authentication failed. Please try again or contact support.", 'red');
                        setVisualMatchMessage("Payment authentication failed.", 'red'); 
                        paymentStatusMessage.textContent = "Payment failed. Please re-check details and try again.";
                        paymentStatusMessage.style.color = "red";
                        // If failed, do NOT hide the overlay. Keep it open for user to retry or cancel.
                    }
                    
                    gameBetPendingPayment = null; 

                    setAllGameControlsEnabled(true); 
                    refreshCurrentGameControlsState(); 
                }, 3000); 
            }

            // Function to enable/disable controls for all games and header actions
            function setAllGameControlsEnabled(enabled) {
                getCommentaryBtn.disabled = !enabled; 
                placeNewBetBtn.disabled = !enabled; 

                depositAmountInput.disabled = !enabled;
                withdrawalAmountInput.disabled = !enabled;
                bankNameInput.disabled = !enabled;
                accountNumberInput.disabled = !enabled;
                accountNameInput.disabled = !enabled;
                initiateWithdrawalButton.disabled = !enabled;

                depositFundsBtn.disabled = !enabled;
                withdrawFundsBtn.disabled = !enabled;

                userProfileInfo.style.pointerEvents = enabled ? 'auto' : 'none';

                // Also disable quick deposit buttons
                quickDepositButtons.forEach(btn => btn.disabled = !enabled);
            }

            // Function to specifically check if current game's betting controls should be disabled due to insufficient balance
            function checkAndDisableBettingControls(minBet, gameId) {
                if (currentBalance < minBet) {
                    if (gameId === 'spinTheWheel') {
                        placeBetButton.disabled = true;
                        betAmountInput.disabled = true;
                        spinButton.disabled = true;
                        setGameMessage("Insufficient balance. Please deposit funds.", 'red');
                    } else if (gameId === 'visualSoccer') {
                        placeSoccerBetButton.disabled = true;
                        soccerBetAmountInput.disabled = true;
                        simulateMatchButton.disabled = true;
                        betOptionButtons.forEach(btn => btn.disabled = true);
                        setSoccerGameMessage("Insufficient balance. Please deposit funds.", 'red');
                    }
                } else {
                     if (gameId === 'spinTheWheel') {
                        if (currentBetAmountSpinWheel === 0) {
                            placeBetButton.disabled = false;
                            betAmountInput.disabled = false;
                            spinButton.disabled = true; 
                        } else {
                            placeBetButton.disabled = true;
                            betAmountInput.disabled = true;
                            spinButton.disabled = isSpinning;
                        }
                    } else if (gameId === 'visualSoccer') {
                        if (currentBetAmountSoccer === 0) {
                            placeSoccerBetButton.disabled = false;
                            soccerBetAmountInput.disabled = false;
                            betOptionButtons.forEach(btn => btn.disabled = true);
                            simulateMatchButton.disabled = true;
                        } else {
                            placeSoccerBetButton.disabled = true;
                            soccerBetAmountInput.disabled = true;
                            betOptionButtons.forEach(btn => btn.disabled = false);
                            simulateMatchButton.disabled = !selectedSoccerOutcome;
                        }
                    }
                }
            }

            // Function to refresh the state of current game controls
            function refreshCurrentGameControlsState() {
                if (spinTheWheelGame.style.display === 'block') {
                    checkAndDisableBettingControls(parseFloat(betAmountInput.min), 'spinTheWheel');
                } else if (visualSoccerGame.style.display === 'block') {
                    checkAndDisableBettingControls(parseFloat(soccerBetAmountInput.min), 'visualSoccer');
                    if (lastMatchResult.homeTeam) { 
                        llmCommentarySection.style.display = 'block';
                        getCommentaryBtn.disabled = false;
                        placeNewBetBtn.style.display = 'inline-flex';
                    } else {
                        llmCommentarySection.style.display = 'none';
                        llmCommentaryDisplay.textContent = '';
                        getCommentaryBtn.disabled = true;
                        placeNewBetBtn.style.display = 'none';
                    }
                }
            }


            // --- Withdrawal Logic ---
            function initiateWithdrawal() {
                const amount = parseFloat(withdrawalAmountInput.value);
                const bankName = bankNameInput.value.trim();
                const accountNumber = accountNumberInput.value.trim();
                const accountName = accountNameInput.value.trim();

                if (isNaN(amount) || amount <= 0) {
                    setWithdrawalMessage("Please enter a valid withdrawal amount.", 'red');
                    return;
                }
                if (amount < 1000) {
                    setWithdrawalMessage("Minimum withdrawal amount is ₦1,000.", 'red');
                    return;
                }
                if (amount > currentBalance) {
                    setWithdrawalMessage(`Insufficient balance. Your current balance is ₦${currentBalance.toLocaleString()}.`, 'red');
                    return;
                }
                if (!bankName || !accountNumber || !accountName) {
                    setWithdrawalMessage("All bank details fields are required.", 'red');
                    return;
                }
                if (accountNumber.length !== 10 || !/^\d+$/.test(accountNumber)) {
                    setWithdrawalMessage("Account number must be 10 digits.", 'red');
                    return;
                }
                const registeredAccountName = userName; 
                if (accountName.toUpperCase() !== registeredAccountName.toUpperCase()) {
                    setWithdrawalMessage(`Account Name must match your COREVEST Account Name (${registeredAccountName}).`, 'red');
                    return;
                }

                initiateWithdrawalButton.disabled = true;
                setWithdrawalMessage("Processing withdrawal... Please wait <i class='fas fa-spinner fa-spin'></i>", 'blue');

                setTimeout(() => {
                    const withdrawalSuccessful = Math.random() < 0.8; 
                    if (withdrawalSuccessful) {
                        currentBalance -= amount;
                        updateBalanceDisplay();
                        setWithdrawalMessage(`Withdrawal of ₦${amount.toLocaleString()} successful! Funds will be credited within 24 hours.`, 'green');
                    } else {
                        setWithdrawalMessage("Withdrawal failed. Please try again or contact support.", 'red');
                    }
                    initiateWithdrawalButton.disabled = false; 
                }, 3000); 
            }

            // --- LLM Integration ---
            async function getLlmMatchCommentary() {
                getCommentaryBtn.disabled = true;
                llmCommentaryDisplay.innerHTML = "Generating commentary... <i class='fas fa-spinner fa-spin'></i>";

                const prompt = `Generate a concise, enthusiastic sports commentary for a simulated soccer match. 
                                The match was between ${lastMatchResult.homeTeam} and ${lastMatchResult.awayTeam}. 
                                The final score was ${lastMatchResult.homeScore} - ${lastMatchResult.awayScore}. 
                                The user bet on ${lastMatchResult.selectedOutcome.replace('_', ' ').toUpperCase()} 
                                and ${lastMatchResult.betWon ? 'WON' : 'LOST'} their bet. 
                                Focus on the result and the user's betting outcome, keep it brief and exciting. 
                                Do not mention yourself as an AI.`;
                
                try {
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                    const payload = { contents: chatHistory };
                    const apiKey = ""; 
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                    
                    const response = await fetch(apiUrl, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(payload)
                            });
                    
                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        llmCommentaryDisplay.textContent = text;
                    } else {
                        llmCommentaryDisplay.textContent = "Could not generate commentary. Please try again.";
                        console.error("Gemini API response structure unexpected:", result);
                    }
                } catch (error) {
                    llmCommentaryDisplay.textContent = "Failed to fetch commentary. Please check your network connection or try again later.";
                    console.error("Error calling Gemini API:", error);
                } finally {
                    getCommentaryBtn.disabled = false;
                }
            }


            // --- Event Listeners ---
            // Header Action Buttons
            depositFundsBtn.addEventListener('click', () => {
                showPaymentOverlay(5000, null); 
            });
            withdrawFundsBtn.addEventListener('click', showWithdrawalView);
            userProfileInfo.addEventListener('click', showEditProfileOverlay); 

            // Profile Setup Page
            profileNameInput.addEventListener('input', () => setProfileSetupMessage("")); 
            profilePhotoUrlInput.addEventListener('input', () => setProfileSetupMessage("")); 

            saveProfileBtn.addEventListener('click', () => {
                const name = profileNameInput.value.trim();
                const photoUrl = profilePhotoUrlInput.value.trim();

                if (!name) {
                    setProfileSetupMessage("Please enter your name.", 'red');
                    return;
                }

                userName = name;
                profilePhotoUrl = photoUrl;
                profileSetupDate = Date.now(); 
                localStorage.setItem('userName', userName);
                localStorage.setItem('profilePhotoUrl', profilePhotoUrl);
                localStorage.setItem('profileSetupDate', profileSetupDate);
                updateProfileDisplayInHeader();
                showDashboard();
            });

            // Edit Profile Overlay
            editProfileNameInput.addEventListener('input', () => setEditProfileStatusMessage(""));
            editProfilePhotoUrlInput.addEventListener('input', () => setEditProfileStatusMessage(""));

            saveEditedProfileBtn.addEventListener('click', () => {
                const name = editProfileNameInput.value.trim();
                const photoUrl = editProfilePhotoUrlInput.value.trim();

                if (!name) {
                    setEditProfileStatusMessage("Please enter your name.", 'red');
                    return;
                }

                userName = name;
                profilePhotoUrl = photoUrl;
                profileSetupDate = Date.now(); 
                localStorage.setItem('userName', userName);
                localStorage.setItem('profilePhotoUrl', profilePhotoUrl);
                localStorage.setItem('profileSetupDate', profileSetupDate);
                updateProfileDisplayInHeader();
                editProfileOverlay.style.display = 'none';
                setAllGameControlsEnabled(true); 
                refreshCurrentGameControlsState(); 
            });

            cancelEditProfileBtn.addEventListener('click', () => {
                editProfileOverlay.style.display = 'none';
                setAllGameControlsEnabled(true); 
                refreshCurrentGameControlsState(); 
            });


            // Spin the Wheel Game
            spinButton.addEventListener('click', startSpin);
            placeBetButton.addEventListener('click', () => {
                let bet = parseFloat(betAmountInput.value);
                if (isNaN(bet) || bet < 700) {
                    setGameMessage("Minimum bet is ₦700.", 'red');
                    spinButton.disabled = true;
                    return;
                }
                if (bet > currentBalance) {
                    setGameMessage("Insufficient balance. Please make a deposit.", 'red');
                    showPaymentOverlay(bet, 'spinTheWheel'); 
                    return;
                }
                currentBalance -= bet; 
                updateBalanceDisplay(); 

                currentBetAmountSpinWheel = bet; 
                setGameMessage(`Bet of ₦${currentBetAmountSpinWheel.toLocaleString()} placed! Click SPIN.`);
                spinButton.disabled = false;
                placeBetButton.disabled = true;
                betAmountInput.disabled = true;
            });
            backToDashboardBtn.addEventListener('click', showDashboard);

            // Visual Soccer List & Detail View
            backToDashboardBtnSoccerList.addEventListener('click', showDashboard); 
            backToSoccerListBtn.addEventListener('click', () => {
                resetSoccerGameControls(); 
                showSoccerMatchList();
            });
            
            // Handle clicking on bet outcome buttons (Home/Draw/Away, Over/Under, BTTS)
            betOptionButtons.forEach(button => {
                button.addEventListener('click', (event) => {
                    if (currentBetAmountSoccer > 0 && !button.disabled) { 
                        betOptionButtons.forEach(btn => btn.classList.remove('selected'));
                        button.classList.add('selected');
                        selectedSoccerOutcome = button.dataset.outcome;
                        setSoccerGameMessage(`You selected ${button.textContent}. Click 'Simulate Match' to proceed.`);
                        simulateMatchButton.disabled = false; 
                    } else if (currentBetAmountSoccer === 0) {
                        setSoccerGameMessage("Please place your bet amount first.", 'orange');
                    }
                });
            });

            placeSoccerBetButton.addEventListener('click', () => {
                let bet = parseFloat(soccerBetAmountInput.value);
                if (isNaN(bet) || bet < 1000) {
                    setSoccerGameMessage("Minimum bet is ₦1,000.", 'red');
                    return;
                }
                if (bet > currentBalance) {
                    setSoccerGameMessage("Insufficient balance. Please make a deposit.", 'red');
                    showPaymentOverlay(bet, 'visualSoccer'); 
                    return;
                }
                currentBalance -= bet; 
                updateBalanceDisplay(); 

                currentBetAmountSoccer = bet;
                placeSoccerBetButton.disabled = true;
                soccerBetAmountInput.disabled = true;
                betOptionButtons.forEach(btn => btn.disabled = false); 
                setSoccerGameMessage(`Bet of ₦${currentBetAmountSoccer.toLocaleString()} placed! Now select your outcome.`);
                if (selectedSoccerOutcome) { 
                    simulateMatchButton.disabled = false;
                }
            });

            simulateMatchButton.addEventListener('click', startSoccerMatchSimulation);
            getCommentaryBtn.addEventListener('click', getLlmMatchCommentary); 
            placeNewBetBtn.addEventListener('click', resetSoccerGameControls); 

            // Payment Overlay Buttons
            confirmPaymentButton.addEventListener('click', (event) => simulatePaymentAuthentication(null, event.currentTarget)); 
            simulateSuccessBtn.addEventListener('click', (event) => simulatePaymentAuthentication('success', event.currentTarget)); 
            simulateFailBtn.addEventListener('click', (event) => simulatePaymentAuthentication('failure', event.currentTarget)); 

            // NEW: Event listener for quick deposit buttons
            quickDepositButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const amount = parseFloat(button.dataset.amount);
                    depositAmountInput.value = amount;
                    // Manually trigger the input event to update display and re-evaluate button states
                    const event = new Event('input', { bubbles: true });
                    depositAmountInput.dispatchEvent(event);
                });
            });


            depositAmountInput.addEventListener('input', () => {
                let amount = parseFloat(depositAmountInput.value);
                const min = parseFloat(depositAmountInput.min);
                const max = parseFloat(depositAmountInput.max);

                if (isNaN(amount) || amount < min || amount > max) {
                    paymentAmountDisplay.textContent = "Invalid Amount";
                    confirmPaymentButton.disabled = true;
                    simulateSuccessBtn.disabled = true;
                    simulateFailBtn.disabled = true;
                    paymentStatusMessage.textContent = `Amount must be between ₦${min.toLocaleString()} and ₦${max.toLocaleString()}.`;
                    paymentStatusMessage.style.color = 'red';
                } else {
                    paymentAmountDisplay.textContent = `₦${amount.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                    confirmPaymentButton.disabled = false;
                    simulateSuccessBtn.disabled = false;
                    simulateFailBtn.disabled = false;
                    paymentStatusMessage.textContent = "Confirm payment details above.";
                    paymentStatusMessage.style.color = 'grey';
                }
            });
            cancelPaymentButton.addEventListener('click', () => {
                paymentOverlay.style.display = 'none';
                paymentStatusMessage.textContent = ""; 
                confirmPaymentButton.innerHTML = `<i class="fas fa-check-circle"></i> Auto-Authenticate Payment`; 
                simulateSuccessBtn.innerHTML = `<i class="fas fa-money-check-alt"></i> Simulate Successful Deposit`; 
                simulateFailBtn.innerHTML = `<i class="fas fa-exclamation-triangle"></i> Simulate Failed Deposit`;   
                
                gameBetPendingPayment = null; 
                setAllGameControlsEnabled(true); 
                refreshCurrentGameControlsState(); 
            });

            // Withdrawal Section Buttons
            backToDashboardBtnWithdrawal.addEventListener('click', showDashboard); 
            initiateWithdrawalButton.addEventListener('click', initiateWithdrawal); 


            // --- Initial Setup and Load Profile ---
            function loadProfile() {
                const savedName = localStorage.getItem('userName');
                const savedPhotoUrl = localStorage.getItem('profilePhotoUrl');
                const savedSetupDate = localStorage.getItem('profileSetupDate');

                if (savedName) {
                    userName = savedName;
                    profilePhotoUrl = savedPhotoUrl || "";
                    profileSetupDate = parseInt(savedSetupDate) || 0;
                    updateProfileDisplayInHeader();
                    showDashboard(); 
                } else {
                    hideAllViews(); 
                    profileSetupView.style.display = 'flex'; 
                }
            }
            
            // Initial calls
            loadProfile(); 
            drawWheel(wheelRotation); 
            initPlayers(); 
            drawSoccerVisuals(0, 0, 0); 
        });
    </script>
</body>
</html>
