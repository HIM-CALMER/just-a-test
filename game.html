<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COREVEST Games Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Universal box-sizing for easier responsive layouts */
        *, *::before, *::after {
            box-sizing: border-box;
        }

        :root {
            --primary-color: #007bff; /* Blue */
            --secondary-color: #28a745; /* Green */
            --accent-color: #84dcc6; /* Light Teal/Cyan */
            --danger-color: #dc3545; /* Red */
            --info-color: #17a2b8; /* Teal Blue */
            --purple-color: #6f42c1; /* Purple */

            --dark-text: #333;
            --light-text: #f0f0f0;
            --background-light: #f0f8ff; /* AliceBlue */
            --card-background: #fff;
            --shadow: rgba(0, 0, 0, 0.1);

            /* Enhanced Glows */
            --glow-win: 0 0 15px 5px rgba(76, 175, 80, 0.8), 0 0 30px 10px rgba(139, 195, 74, 0.6); /* Green */
            --glow-lose: 0 0 15px 5px rgba(244, 67, 54, 0.8), 0 0 30px 10px rgba(255, 82, 82, 0.6); /* Red */
            --glow-draw: 0 0 15px 5px rgba(255, 193, 7, 0.8), 0 0 30px 10px rgba(255, 215, 0, 0.6); /* Amber/Gold */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-light);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            box-sizing: border-box;
            color: var(--dark-text);
        }

        .header {
            background: linear-gradient(135deg, var(--accent-color), #a5ffd2);
            color: var(--dark-text);
            padding: 1.5rem 1rem;
            border-bottom-left-radius: 10px;
            border-bottom-right-radius: 10px;
            box-shadow: 0 4px 8px var(--shadow);
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
            max-width: 100vw;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .header p {
            font-size: 1rem;
            color: #555;
        }

        .header-actions {
            margin-top: 1rem;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .header-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .header-btn.deposit {
            background-color: var(--secondary-color);
            color: var(--light-text);
        }
        .header-btn.deposit:hover {
            background-color: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .header-btn.deposit:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .header-btn.withdraw {
            background-color: var(--danger-color);
            color: var(--light-text);
        }
        .header-btn.withdraw:hover {
            background-color: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .header-btn.withdraw:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        /* User Profile Info in Header */
        .user-profile-info {
            position: absolute;
            top: 10px;
            left: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 5px 10px;
            border-radius: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
        }
        .user-profile-info:hover {
            background-color: rgba(255, 255, 255, 1);
            transform: translateY(-1px);
        }
        .user-profile-info:active {
            transform: translateY(0);
        }

        .user-profile-info .profile-photo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            object-fit: cover;
            overflow: hidden;
        }
        .user-profile-info .profile-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .user-profile-info .profile-name {
            font-weight: 600;
            color: var(--dark-text);
            font-size: 0.95rem;
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 1rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            width: 100%; 
            padding-left: 1rem;
            padding-right: 1rem;
            box-sizing: border-box;
        }

        /* Common Page Styles (Profile Setup, Game Views, Withdrawal) */
        .page-container {
            display: none; /* Controlled by JS explicitly */
            background-color: var(--card-background);
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15); /* Stronger shadow */
            padding: 2rem;
            text-align: center;
            max-width: 700px; /* Slightly wider */
            margin: 0 auto;
            position: relative; 
            overflow: hidden; 
            width: calc(100% - 2rem); 
            margin-left: auto;
            margin-right: auto;
            box-sizing: border-box;
            transition: box-shadow 0.3s ease; /* For glow effect */
        }

        .page-container.win-glow {
            box-shadow: var(--glow-win);
        }

        .page-container.lose-glow {
            box-shadow: var(--glow-lose);
        }
        .page-container.draw-glow { 
            box-shadow: var(--glow-draw);
        }

        .page-container h2 {
            color: var(--primary-color); /* Use primary color for headings */
            font-size: 2.2rem;
            margin-bottom: 1.5rem;
            font-weight: 700;
        }

        /* Profile Setup View */
        #profileSetupView {
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            min-height: 500px;
        }
        #profileSetupView h2 {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 1.5rem;
        }
        #profileSetupView .form-group {
            margin-bottom: 1.5rem;
            width: 80%;
            max-width: 400px;
            text-align: left;
        }
        #profileSetupView .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #555;
        }
        #profileSetupView .form-group input {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1rem;
            box-sizing: border-box;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        #profileSetupView .form-group input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
            outline: none;
        }
        #profileSetupView .submit-button {
            padding: 1rem 2rem;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        #profileSetupView .submit-button:hover {
            background-color: #218838;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }
        #profileSetupView .submit-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        #profileSetupMessage {
            margin-top: 1rem;
            font-weight: bold;
            color: #555;
            min-height: 20px;
        }


        /* Dashboard specific styles */
        #dashboardView {
            width: 100%;
        }

        .game-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
            gap: 1.5rem;
            justify-content: center; 
            width: 100%;
            max-width: 100%;
            min-height: 300px; /* Ensure space for games even if they take a moment to load */
        }

        .game-card {
            background-color: var(--card-background);
            border-radius: 10px;
            box-shadow: 0 2px 5px var(--shadow);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            width: 100%; 
            max-width: 100%;
        }

        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .game-card.locked {
            opacity: 0.6;
            cursor: not-allowed;
            filter: grayscale(100%);
        }

        .game-card.locked .play-button {
            background-color: #6c757d;
            cursor: not-allowed;
        }

        .game-card.locked .play-button:hover {
            background-color: #6c757d;
        }

        .icon-container {
            font-size: 3rem;
            color: var(--secondary-color);
            background-color: #f0fff0;
            padding: 1rem;
            border-radius: 50%;
            margin-bottom: 1rem;
            display: flex;
            justify-content: center;
            align-items: center;
            min-width: 6rem; 
            min-height: 6rem;
            box-shadow: inset 0 0 8px rgba(0,0,0,0.1);
        }

        .game-card h3 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--dark-text);
            margin-bottom: 0.75rem;
        }

        .game-card p {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.6;
            margin-bottom: 1rem;
            flex-grow: 1;
        }

        .play-button {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background-color: var(--primary-color);
            color: var(--light-text);
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .play-button:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .play-button:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        /* Common Game Bet Section Styles */
        .game-balance-info {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
            font-weight: 600;
            color: #444;
        }

        .game-balance-info span {
            color: var(--secondary-color);
        }

        .bet-section {
            margin-bottom: 1.5rem;
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center;
            align-items: center;
            gap: 10px; 
            background-color: #f8f8f8;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }

        .bet-section label {
            display: block; 
            width: 100%; /* Take full width on smaller screens */
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark-text);
            text-align: center;
        }

        .bet-section input[type="number"] {
            padding: 0.75rem;
            border: 1px solid #ccc;
            border-radius: 8px;
            width: 150px; 
            max-width: 100%; 
            text-align: center;
            font-size: 1rem;
            box-sizing: border-box; 
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .bet-section input[type="number"]:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
            outline: none;
        }

        .bet-section button {
            padding: 0.75rem 1.5rem;
            background-color: var(--primary-color); /* Use primary for general bet buttons */
            color: var(--light-text);
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .bet-section button:hover:not(:disabled) {
            background-color: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .bet-section button:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        .bet-section button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background-color: #6c757d;
            box-shadow: none;
        }

        .game-message {
            margin-top: 1.5rem;
            font-size: 1.1rem;
            font-weight: 600;
            color: #555;
            min-height: 25px;
            animation: fadeIn 0.5s forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Back Button - Reusable style */
        .go-back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background-color: #6c757d; /* Grey */
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 10;
        }
        .go-back-button:hover {
            background-color: #5a6268;
            transform: translateX(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .go-back-button:active {
            transform: translateX(0);
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        /* Soccer Match List View */
        .match-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        .match-card {
            background-color: var(--card-background);
            border-radius: 10px;
            box-shadow: 0 2px 5px var(--shadow);
            padding: 1.5rem;
            text-align: center;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            cursor: pointer;
            border: 1px solid #eee;
        }
        .match-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }
        .match-card h4 {
            font-size: 1.2rem;
            color: #555;
            margin-bottom: 0.5rem;
        }
        .match-card .teams {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }
        .match-card .odds-display {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 1rem;
            font-size: 0.95rem;
            font-weight: 600;
        }
        .match-card .odd-item {
            padding: 5px 10px;
            border-radius: 5px;
            background-color: #e9ecef;
            white-space: nowrap;
            border: 1px solid #ddd;
        }


        /* Visual Soccer Game Details View */
        .visual-soccer-match-details {
            margin-top: 2rem;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background-color: #f8f8f8;
            border-radius: 8px;
            border: 1px dashed #ccc;
        }
        .visual-soccer-match-details h3 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }
        .visual-soccer-match-details .match-info {
            font-size: 1rem;
            color: #666;
            margin-bottom: 1rem;
        }
        .team-names {
            display: flex;
            justify-content: space-around;
            align-items: center;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            gap: 10px;
        }
        .team-names span {
            flex: 1;
            text-align: center;
            padding: 5px;
        }
        .vs {
            font-size: 1.2rem;
            font-weight: 600;
            color: #666;
            padding: 0 10px;
        }
        .match-score {
            font-size: 2.5rem;
            font-weight: 900;
            color: #333;
            margin-top: 1rem;
            min-height: 40px;
        }
        .bet-options {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-top: 1.5rem;
        }
        .bet-option-btn {
            padding: 0.8rem 1.5rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1 1 calc(33% - 10px);
            min-width: 120px;
            max-width: 180px;
            box-sizing: border-box;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .bet-option-btn:hover:not(:disabled) {
            background-color: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .bet-option-btn:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        .bet-option-btn.selected {
            background-color: #0056b3;
            border: 2px solid var(--accent-color);
            box-shadow: 0 0 12px rgba(0, 123, 255, 0.6); /* Stronger glow on selected */
        }
        .bet-option-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background-color: #6c757d;
            box-shadow: none;
        }
        #simulateMatchButton {
            margin-top: 2rem;
            padding: 1rem 2rem;
            background-color: var(--primary-color);
            color: var(--light-text);
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        #simulateMatchButton:hover:not(:disabled) {
            background-color: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }
        #simulateMatchButton:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        #simulateMatchButton:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background-color: #6c757d;
            box-shadow: none;
        }

        /* LLM Commentary section */
        #llmCommentarySection {
            margin-top: 2rem;
            padding: 1.5rem;
            background-color: #f0f8ff;
            border-radius: 10px;
            border: 1px solid var(--accent-color);
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.1);
        }
        #llmCommentarySection h4 {
            font-size: 1.4rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        #getCommentaryBtn {
            padding: 0.8rem 1.8rem;
            background-color: var(--purple-color); 
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-top: 1rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        #getCommentaryBtn:hover:not(:disabled) {
            background-color: #563d7c;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        #getCommentaryBtn:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        #getCommentaryBtn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background-color: #6c757d;
            box-shadow: none;
        }
        #llmCommentaryDisplay {
            font-size: 1rem;
            color: #444;
            line-height: 1.6;
            min-height: 50px;
            text-align: left;
            margin-top: 1rem;
        }
        #placeNewBetBtn { 
            padding: 0.8rem 1.8rem;
            background-color: var(--info-color); 
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-top: 1rem;
            margin-left: 10px; /* Spacing from commentary button */
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        #placeNewBetBtn:hover:not(:disabled) {
            background-color: #138496;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        #placeNewBetBtn:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        #placeNewBetBtn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background-color: #6c757d;
            box-shadow: none;
        }

        /* Visual Match Simulation Canvas */
        #soccerVisualCanvas {
            border: 2px solid var(--primary-color); /* Stronger border */
            background-color: #4CAF50;
            margin: 1.5rem auto;
            display: block;
            border-radius: 5px;
            box-shadow: inset 0 0 8px rgba(0,0,0,0.2); /* Enhanced inner shadow */
        }


        /* Coin Flip Game Specific Styles */
        #coinFlipGame .coin-container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 150px;
            height: 150px;
            margin: 2rem auto;
            border-radius: 50%;
            background-color: #FFD700; /* Gold */
            color: #333;
            font-size: 3rem;
            font-weight: bold;
            box-shadow: 0 0 10px rgba(0,0,0,0.3), inset 0 0 15px rgba(255,255,255,0.5); /* Inner white glow */
            perspective: 1000px; /* For 3D flip effect */
            transition: transform 0.6s ease-out; /* Smooth transition for result display */
        }
        #coinFlipGame .coin-container.flipping {
            animation: coinFlipAnimation 1.5s forwards;
        }

        @keyframes coinFlipAnimation {
            0% { transform: rotateY(0deg); }
            50% { transform: rotateY(180deg); }
            100% { transform: rotateY(360deg); }
        }

        #coinFlipGame .coin-options button {
            padding: 0.75rem 1.5rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        #coinFlipGame .coin-options button:hover:not(:disabled) {
            background-color: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        #coinFlipGame .coin-options button:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        #coinFlipGame .coin-options button.selected {
            background-color: #0056b3;
            border: 2px solid var(--accent-color);
            box-shadow: 0 0 12px rgba(0, 123, 255, 0.6);
        }
        #coinFlipGame .coin-options button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background-color: #6c757d;
            box-shadow: none;
        }

        /* Slot Machine Game Specific Styles */
        #slotMachineGame .slot-reels {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 2rem auto;
            padding: 20px;
            background-color: #333;
            border-radius: 10px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5), 0 5px 15px rgba(0,0,0,0.3);
            max-width: 400px;
        }
        #slotMachineGame .reel {
            width: 80px;
            height: 80px;
            background-color: #f0f0f0;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3rem;
            font-weight: bold;
            color: #555;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.2), 0 2px 5px rgba(0,0,0,0.1);
            overflow: hidden;
            border: 1px solid #ccc;
            transition: background-color 0.1s ease;
        }
        #slotMachineGame .reel.spinning {
            animation: spinReel 0.1s infinite linear; /* Faster animation during spin */
        }

        @keyframes spinReel {
            0% { transform: translateY(0); }
            100% { transform: translateY(-100%); }
        }
        
        #slotMachineGame .reel-item {
            display: block;
            min-height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.1s ease-out; /* For smooth stopping */
        }
        

        /* Payment Overlay and Withdrawal Overlay (common styling) */
        #paymentOverlay, #withdrawalOverlay, #editProfileOverlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            overflow: auto;
            animation: fadeInOverlay 0.3s forwards;
        }
        @keyframes fadeInOverlay {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .payment-box, .withdrawal-box, .edit-profile-box {
            background-color: var(--card-background);
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4); /* Stronger shadow */
            max-width: 480px; /* Slightly wider */
            width: 90%;
            color: var(--dark-text);
            box-sizing: border-box;
            margin: 20px auto;
            transform: translateY(0);
            animation: slideIn 0.3s forwards;
        }
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .payment-box h3, .withdrawal-box h3, .edit-profile-box h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.8rem;
            font-weight: 700;
        }
        .payment-box p, .withdrawal-box p, .edit-profile-box p {
            font-size: 1rem;
            margin-bottom: 10px;
            color: #666;
        }

        .payment-box .account-details {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            margin-bottom: 20px;
            font-family: 'monospace', sans-serif;
            text-align: left;
            word-break: break-all;
            border: 1px dashed #ccc;
        }

        .payment-box .account-details strong {
            display: block;
            margin-bottom: 5px;
            color: #555;
        }
        .payment-box .form-group input { /* Style for depositAmountInput */
            padding: 0.75rem;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1rem;
            box-sizing: border-box;
            width: 180px; /* Specific width */
            text-align: center; /* Center text */
            display: block; /* Make it a block element */
            margin: 0 auto; /* Center the input itself */
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .payment-box .form-group input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
            outline: none;
        }


        /* NEW: Quick Deposit Buttons Styling */
        .quick-deposit-options {
            margin-top: 15px;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }

        .quick-deposit-btn {
            padding: 0.7rem 1.2rem;
            background-color: #e0e0e0;
            color: #333;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            flex: 1 1 auto; 
            min-width: 80px; 
            max-width: 120px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .quick-deposit-btn:hover {
            background-color: #d0d0d0;
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .quick-deposit-btn:active {
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .quick-deposit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }


        /* Withdrawal Form styling */
        .withdrawal-form {
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
            margin-top: 1.5rem;
        }
        .withdrawal-form .form-group {
            background-color: #f8f8f8; 
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #eee;
            text-align: left;
        }
        .withdrawal-form .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--dark-text);
        }
        .withdrawal-form .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1rem;
            box-sizing: border-box;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .withdrawal-form .form-group input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
            outline: none;
        }

        .edit-profile-box .form-group { 
            background-color: #f8f8f8;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #eee;
            text-align: left;
            margin-bottom: 1.2rem;
        }
        .edit-profile-box .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--dark-text);
        }
        .edit-profile-box .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1rem;
            box-sizing: border-box;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .edit-profile-box .form-group input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
            outline: none;
        }


        .payment-buttons, .withdrawal-buttons, .edit-profile-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .payment-button, .withdrawal-button, .edit-profile-button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            flex-grow: 1;
            min-width: 150px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .payment-button.confirm, .withdrawal-button.confirm, .edit-profile-button.save {
            background-color: var(--secondary-color);
            color: var(--light-text);
        }
        .payment-button.confirm:hover, .withdrawal-button.confirm:hover, .edit-profile-button.save:hover:not(:disabled) {
            background-color: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .payment-button.confirm:active, .withdrawal-button.confirm:active, .edit-profile-button.save:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .payment-button.cancel, .withdrawal-button.cancel, .edit-profile-button.cancel {
            background-color: var(--danger-color);
            color: var(--light-text);
        }
        .payment-button.cancel:hover, .withdrawal-button.cancel:hover, .edit-profile-button.cancel:hover {
            background-color: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .payment-button.cancel:active, .withdrawal-button.cancel:active, .edit-profile-button.cancel:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .payment-button.simulate-success {
            background-color: var(--primary-color); 
            color: white;
        }
        .payment-button.simulate-success:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .payment-button.simulate-success:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .payment-button.simulate-fail {
            background-color: #ffc107; /* Orange */
            color: #333;
        }
        .payment-button.simulate-fail:hover {
            background-color: #e0a800;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .payment-button.simulate-fail:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .edit-profile-button.save:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background-color: #6c757d;
            box-shadow: none;
        }

        #paymentStatusMessage, #withdrawalStatusMessage, #editProfileStatusMessage {
            margin-top: 15px;
            font-weight: bold;
            min-height: 20px;
        }
        
        .withdrawal-policy-message, .edit-policy-message {
            margin-top: 1.5rem;
            font-size: 0.9rem;
            color: #666;
            font-style: italic;
            border: 1px dashed #ccc;
            padding: 10px;
            border-radius: 5px;
            background-color: #fefefe;
        }
        .withdrawal-policy-message strong, .edit-policy-message strong {
            color: var(--primary-color);
        }

        .footer {
            background-color: #333;
            color: var(--light-text);
            text-align: center;
            padding: 1rem 0;
            margin-top: 30px;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            box-shadow: 0 -2px 5px var(--shadow);
            width: 100%;
            max-width: 100vw;
        }

        .footer p {
            margin: 0;
            font-size: 0.9rem;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            .header p {
                font-size: 1rem;
            }
            .header-actions {
                flex-direction: column;
                gap: 0.75rem;
            }
            .header-btn {
                width: 80%;
                max-width: 250px;
            }
            .user-profile-info {
                top: 5px;
                left: 5px;
                padding: 3px 8px;
                gap: 5px;
            }
            .user-profile-info .profile-photo {
                width: 30px;
                height: 30px;
                font-size: 0.9rem;
            }
            .user-profile-info .profile-name {
                font-size: 0.8rem;
            }
            .game-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
            .game-card {
                padding: 1rem;
            }
            .game-card h3 {
                font-size: 1.3rem;
            }
            .game-card p {
                font-size: 0.85rem;
            }
            .bet-section input[type="number"],
            .bet-section input[type="text"] {
                width: 100%;
                max-width: 180px;
            }
            .bet-section button {
                padding: 0.75rem 1rem;
            }
            .page-container {
                padding: 1.5rem;
            }
            #profileSetupView {
                padding: 2rem;
            }
            #profileSetupView h2 {
                font-size: 2rem;
            }
            .visual-soccer-match-details h3 {
                font-size: 1.5rem;
            }
            .team-names {
                font-size: 1.2rem;
            }
            .vs {
                font-size: 1rem;
            }
            .match-score {
                font-size: 2rem;
            }
            .bet-option-btn {
                min-width: unset;
                max-width: unset;
                flex: 1 1 45%;
            }
            .match-card .teams {
                font-size: 1.3rem;
            }
            .match-card .odds-display {
                font-size: 0.9rem;
            }
            #soccerVisualCanvas {
                width: 250px;
                height: 150px;
            }
            .payment-buttons, .withdrawal-buttons, .edit-profile-buttons {
                flex-direction: column;
            }
            .payment-button, .withdrawal-button, .edit-profile-button {
                min-width: 100%;
            }
            .quick-deposit-btn {
                flex: 1 1 45%; 
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 1.5rem 0.5rem;
            }
            .header h1 {
                font-size: 1.8rem;
            }
            .header p {
                font-size: 0.9rem;
            }
            .user-profile-info {
                position: static;
                margin-bottom: 0.5rem;
                justify-content: center;
                width: 100%;
                background-color: transparent;
                box-shadow: none;
            }
            .container {
                padding: 0.5rem;
            }
            .game-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            .bet-section {
                flex-direction: column;
                gap: 10px;
            }
            .bet-section label {
                margin-bottom: 0;
            }
            .bet-section input[type="number"],
            .bet-section input[type="text"],
            .bet-section button {
                width: calc(100% - 10px);
                margin: 0 auto;
            }
            #spinButton, #simulateMatchButton {
                padding: 0.8rem 1.5rem;
                font-size: 1.1rem;
            }
            .payment-box, .withdrawal-box, .edit-profile-box {
                padding: 20px;
            }
            .bet-options {
                flex-direction: column;
            }
            .bet-option-btn {
                width: 100%;
                max-width: unset;
            }
            #soccerVisualCanvas {
                width: 200px;
                height: 120px;
            }
            .match-list {
                grid-template-columns: 1fr;
            }
            #profileSetupView .form-group {
                width: 100%;
            }
            .quick-deposit-btn {
                flex: 1 1 45%; 
            }
        }
    </style>
</head>
<body>

    <header class="header">
        <div class="user-profile-info" id="userProfileInfo">
            <div class="profile-photo" id="userPhotoDisplay"></div>
            <span class="profile-name" id="userNameDisplay">Guest User</span>
        </div>
        <h1>COREVEST Games</h1>
        <p>Your ultimate destination for exciting games!</p>
        <div class="header-actions">
            <button class="header-btn deposit" id="depositFundsBtn"><i class="fas fa-wallet"></i> Deposit Funds</button>
            <button class="header-btn withdraw" id="withdrawFundsBtn"><i class="fas fa-money-bill-wave"></i> Withdraw Funds</button>
        </div>
    </header>

    <main class="container">
        <!-- Profile Setup View (Shown initially if no profile) -->
        <div id="profileSetupView" class="page-container">
            <h2>Welcome to COREVEST Games!</h2>
            <p>Please set up your profile to get started.</p>
            <div class="form-group">
                <label for="profileNameInput">Your Name:</label>
                <input type="text" id="profileNameInput" placeholder="e.g., John Doe" required>
            </div>
            <div class="form-group">
                <label for="profilePhotoUrlInput">Profile Photo URL (Optional):</label>
                <input type="text" id="profilePhotoUrlInput" placeholder="e.g., https://example.com/your-pic.jpg">
            </div>
            <button id="saveProfileBtn" class="submit-button"><i class="fas fa-user-plus"></i> Save Profile</button>
            <div id="profileSetupMessage"></div>
        </div>

        <div id="dashboardView" class="page-container">
            <div class="game-grid" id="gameList">
            </div>
        </div>

        <!-- Visual Soccer Match List View -->
        <div id="soccerMatchListView" class="page-container">
            <button class="go-back-button" id="backToDashboardBtnSoccerList"><i class="fas fa-arrow-left"></i> Back to Dashboard</button>
            <h2>Available Soccer Matches</h2>
            <div class="game-balance-info">
                <div>Current Balance: <span id="soccerListBalanceDisplay">₦0.00</span></div>
            </div>
            <div class="match-list" id="soccerMatchListContainer">
                <!-- Matches will be dynamically loaded here -->
            </div>
        </div>

        <!-- Spin the Wheel Game Section -->
        <div id="spinTheWheelGame" class="page-container">
            <button class="go-back-button" id="backToDashboardBtn"><i class="fas fa-arrow-left"></i> Back to Dashboard</button>
            <h2>Spin the Wheel</h2>
            <div class="game-balance-info">
                <div>Current Balance: <span id="gameBalanceDisplay">₦0.00</span></div>
            </div>

            <div class="bet-section">
                <label for="betAmount">Bet Amount (₦):</label>
                <input type="number" id="betAmount" value="700" min="700" max="1000000" step="100">
                <button id="placeBetButton">Place Bet</button>
            </div>

            <canvas id="wheelCanvas" width="400" height="400"></canvas>
            <button id="spinButton" disabled>SPIN</button>

            <div id="gameMessage" class="game-message">Place your bet to activate the wheel!</div>
        </div>

        <!-- Visual Soccer Game Details View -->
        <div id="visualSoccerGame" class="page-container">
            <button class="go-back-button" id="backToSoccerListBtn"><i class="fas fa-arrow-left"></i> Back to Matches</button>
            <h2>Match Details & Bet</h2>
            <div class="game-balance-info">
                <div>Current Balance: <span id="soccerGameBalanceDisplay">₦0.00</span></div>
            </div>

            <div class="bet-section">
                <label for="soccerBetAmount">Bet Amount (₦):</label>
                <input type="number" id="soccerBetAmount" value="1000" min="1000" max="1000000" step="100">
                <button id="placeSoccerBetButton">Place Bet</button>
            </div>

            <div class="visual-soccer-match-details">
                <h3 id="currentMatchTeams">Team A vs Team B</h3>
                <p class="match-info"><span id="currentMatchLeague">League: Premier League</span> | <span id="currentMatchTime">Today 18:00</span></p>
                
                <!-- Visual Match Simulation Canvas (NEW) -->
                <canvas id="soccerVisualCanvas" width="300" height="180"></canvas>
                <div class="match-score" id="matchScoreDisplay">0 - 0</div>
                <div id="visualMatchMessage" class="game-message" style="margin-top:10px; font-weight:normal;">Kick-off!</div>

                <div class="bet-options">
                    <button class="bet-option-btn" data-outcome="home" id="betHomeButton">Home Win (x<span id="oddHome">1.8</span>)</button>
                    <button class="bet-option-btn" data-outcome="draw" id="betDrawButton">Draw (x<span id="oddDraw">3.5</span>)</button>
                    <button class="bet-option-btn" data-outcome="away" id="betAwayButton">Away Win (x<span id="oddAway">2.5</span>)</button>
                    <button class="bet-option-btn" data-outcome="over1_5" id="betOver1_5Button">Over 1.5 Goals (x<span id="oddOver1_5">1.5</span>)</button>
                    <button class="bet-option-btn" data-outcome="under1_5" id="betUnder1_5Button">Under 1.5 Goals (x<span id="oddUnder1_5">2.2</span>)</button>
                    <button class="bet-option-btn" data-outcome="btts_yes" id="betBttsYesButton">BTTS Yes (x<span id="oddBttsYes">1.7</span>)</button>
                    <button class="bet-option-btn" data-outcome="btts_no" id="betBttsNoButton">BTTS No (x<span id="oddBttsNo">2.0</span>)</button>
                </div>
            </div>

            <button id="simulateMatchButton" disabled>Simulate Match</button>
            <div id="soccerGameMessage" class="game-message">Place your bet and select an outcome.</div>

            <!-- LLM Commentary Section -->
            <div id="llmCommentarySection" style="display:none;">
                <h4>✨ Match Highlights & Commentary ✨</h4>
                <div id="llmCommentaryDisplay"></div>
                <button id="getCommentaryBtn" disabled><i class="fas fa-robot"></i> Get Match Commentary</button>
                <button id="placeNewBetBtn" style="display: none;"><i class="fas fa-redo"></i> Place New Bet</button> <!-- NEW BUTTON -->
            </div>
        </div>

        <!-- Coin Flip Game Section (NEW) -->
        <div id="coinFlipGame" class="page-container">
            <button class="go-back-button" id="backToDashboardBtnCoinFlip"><i class="fas fa-arrow-left"></i> Back to Dashboard</button>
            <h2>Coin Flip Fortune</h2>
            <div class="game-balance-info">
                <div>Current Balance: <span id="coinFlipBalanceDisplay">₦0.00</span></div>
            </div>

            <div class="bet-section">
                <label for="coinFlipBetAmount">Bet Amount (₦):</label>
                <input type="number" id="coinFlipBetAmount" value="500" min="100" max="100000" step="50">
                <button id="placeCoinFlipBetButton">Place Bet</button>
            </div>

            <div class="coin-options">
                <button id="betHeadsButton" data-outcome="heads" disabled>Heads</button>
                <button id="betTailsButton" data-outcome="tails" disabled>Tails</button>
            </div>

            <div class="coin-container" id="coinDisplay">
                <i class="fas fa-question"></i>
            </div>
            
            <button id="flipCoinButton" disabled>Flip Coin!</button>
            <div id="coinFlipMessage" class="game-message">Place your bet and choose Heads or Tails!</div>
        </div>

        <!-- Virtual Slot Machine Game Section (NEW) -->
        <div id="slotMachineGame" class="page-container">
            <button class="go-back-button" id="backToDashboardBtnSlotMachine"><i class="fas fa-arrow-left"></i> Back to Dashboard</button>
            <h2>Virtual Slot Machine</h2>
            <div class="game-balance-info">
                <div>Current Balance: <span id="slotMachineBalanceDisplay">₦0.00</span></div>
            </div>

            <div class="bet-section">
                <label for="slotMachineBetAmount">Bet Amount (₦):</label>
                <input type="number" id="slotMachineBetAmount" value="200" min="50" max="50000" step="50">
                <button id="placeSlotBetButton">Place Bet</button>
            </div>

            <div class="slot-reels">
                <div class="reel" id="reel1"></div>
                <div class="reel" id="reel2"></div>
                <div class="reel" id="reel3"></div>
            </div>

            <button id="spinSlotButton" disabled>Spin Reels!</button>
            <div id="slotMachineMessage" class="game-message">Place your bet and spin to win!</div>
        </div>

        <!-- Spin 2 Win Game Section (NEW) -->
        <div id="spin2WinGame" class="page-container">
            <button class="go-back-button" id="backToDashboardBtnSpin2Win"><i class="fas fa-arrow-left"></i> Back to Dashboard</button>
            <h2>Spin 2 Win!</h2>
            <div class="game-balance-info">
                <div>Current Balance: <span id="spin2WinBalanceDisplay">₦0.00</span></div>
            </div>

            <div class="bet-section">
                <label for="spin2WinBetAmount">Bet Amount (₦):</label>
                <input type="number" id="spin2WinBetAmount" value="1000" min="100" max="100000" step="100">
                <button id="placeSpin2WinBetButton">Place Bet</button>
            </div>

            <canvas id="spin2WinCanvas" width="400" height="400"></canvas>
            <button id="spin2WinButton" disabled>SPIN 2 WIN!</button>

            <div id="spin2WinMessage" class="game-message">Place your bet and try your luck!</div>
        </div>


        <!-- Withdrawal Section -->
        <div id="withdrawalView" class="page-container">
            <button class="go-back-button" id="backToDashboardBtnWithdrawal"><i class="fas fa-arrow-left"></i> Back to Dashboard</button>
            <h2>Withdraw Funds</h2>
            <div class="game-balance-info">
                <div>Current Balance: <span id="withdrawalBalanceDisplay">₦0.00</span></div>
            </div>

            <div class="withdrawal-form">
                <div class="form-group">
                    <label for="withdrawalAmount">Amount (₦):</label>
                    <input type="number" id="withdrawalAmount" min="1000" step="1000" placeholder="e.g., 5000">
                </div>
                <div class="form-group">
                    <label for="bankName">Bank Name:</label>
                    <input type="text" id="bankName" placeholder="e.g., COREVEST Bank">
                </div>
                <div class="form-group">
                    <label for="accountNumber">Account Number:</label>
                    <input type="text" id="accountNumber" pattern="\d{10}" title="Account number must be 10 digits" placeholder="e.g., 0123456789">
                </div>
                <div class="form-group">
                    <label for="accountName">Account Name:</label>
                    <input type="text" id="accountName" placeholder="e.g., John Doe">
                </div>
                <div class="withdrawal-policy-message">
                    <strong>Important:</strong> Your Account Name (e.g., John Doe) must exactly match the Name on your COREVEST Account for successful withdrawal. Funds will be processed within 24 hours.
                </div>
                <button class="withdrawal-button confirm" id="initiateWithdrawalButton"><i class="fas fa-paper-plane"></i> Initiate Withdrawal</button>
            </div>
            <div id="withdrawalStatusMessage" class="game-message"></div>
        </div>

    </main>

    <footer class="footer">
        <p>&copy; 2025 COREVEST Games. All rights reserved.</p>
    </footer>

    <div id="paymentOverlay">
        <div class="payment-box">
            <h3>Complete Your Payment</h3>
            <p>Please make a transfer to the account details below. Your balance will be updated automatically once payment is authenticated.</p>
            <div class="account-details">
                <strong>Bank Name:</strong> COREVEST Bank<br>
                <strong>Account Name:</strong> COREVEST Games<br>
                <strong>Account Number:</strong> 0123456789<br>
                <strong>Amount:</strong> <span id="paymentAmountDisplay">₦0.00</span>
            </div>
            <div class="form-group" style="margin-top: 15px;">
                <label for="depositAmountInput" style="text-align: center;">Enter Amount to Deposit:</label>
                <input type="number" id="depositAmountInput" value="5000" min="1000" max="1000000" step="1000" placeholder="₦1,000 - ₦1,000,000">
            </div>
            <!-- NEW: Quick Deposit Amounts -->
            <div class="quick-deposit-options">
                <button class="quick-deposit-btn" data-amount="1000">₦1,000</button>
                <button class="quick-deposit-btn" data-amount="5000">₦5,000</button>
                <button class="quick-deposit-btn" data-amount="10000">₦10,000</button>
                <button class="quick-deposit-btn" data-amount="20000">₦20,000</button>
                <button class="quick-deposit-btn" data-amount="50000">₦50,000</button>
            </div>
            <p id="paymentStatusMessage" style="color: grey;">Waiting for payment confirmation...</p>
            <div class="payment-buttons">
                <button class="payment-button confirm" id="confirmPaymentButton"><i class="fas fa-check-circle"></i> Auto-Authenticate Payment</button>
                <button class="payment-button simulate-success" id="simulateSuccessBtn"><i class="fas fa-money-check-alt"></i> Simulate Successful Deposit</button>
                <button class="payment-button simulate-fail" id="simulateFailBtn"><i class="fas fa-exclamation-triangle"></i> Simulate Failed Deposit</button>
                <button class="payment-button cancel" id="cancelPaymentButton"><i class="fas fa-times-circle"></i> Cancel Payment</button>
            </div>
        </div>
    </div>

    <!-- Edit Profile Overlay -->
    <div id="editProfileOverlay">
        <div class="edit-profile-box">
            <h3>Edit Your Profile</h3>
            <p id="editProfileMessage">Update your name and profile photo.</p>
            <div class="form-group">
                <label for="editProfileNameInput">Your Name:</label>
                <input type="text" id="editProfileNameInput" placeholder="e.g., John Doe" required>
            </div>
            <div class="form-group">
                <label for="editProfilePhotoUrlInput">Profile Photo URL (Optional):</label>
                <input type="text" id="editProfilePhotoUrlInput" placeholder="e.g., https://example.com/your-pic.jpg">
            </div>
            <div class="edit-policy-message">
                <strong>Note:</strong> Profile changes can only be made every 7 days. Next edit available: <span id="nextEditDateDisplay">Loading...</span>
            </div>
            <div class="edit-profile-buttons">
                <button class="edit-profile-button save" id="saveEditedProfileBtn"><i class="fas fa-save"></i> Save Changes</button>
                <button class="edit-profile-button cancel" id="cancelEditProfileBtn"><i class="fas fa-times-circle"></i> Cancel</button>
            </div>
            <div id="editProfileStatusMessage" class="game-message"></div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Main Views
            const profileSetupView = document.getElementById('profileSetupView');
            const dashboardView = document.getElementById('dashboardView');
            const spinTheWheelGame = document.getElementById('spinTheWheelGame');
            const visualSoccerGame = document.getElementById('visualSoccerGame');
            const soccerMatchListView = document.getElementById('soccerMatchListView'); 
            const coinFlipGame = document.getElementById('coinFlipGame'); 
            const slotMachineGame = document.getElementById('slotMachineGame'); 
            const spin2WinGame = document.getElementById('spin2WinGame'); 
            const gameListContainer = document.getElementById('gameList');
            const withdrawalView = document.getElementById('withdrawalView');

            // Header Elements
            const userProfileInfo = document.getElementById('userProfileInfo');
            const userNameDisplay = document.getElementById('userNameDisplay');
            const userPhotoDisplay = document.getElementById('userPhotoDisplay');
            const depositFundsBtn = document.getElementById('depositFundsBtn');
            const withdrawFundsBtn = document.getElementById('withdrawFundsBtn');

            // Back Buttons
            const backToDashboardBtn = document.getElementById('backToDashboardBtn');
            const backToDashboardBtnSoccerList = document.getElementById('backToDashboardBtnSoccerList'); 
            const backToSoccerListBtn = document.getElementById('backToSoccerListBtn'); 
            const backToDashboardBtnCoinFlip = document.getElementById('backToDashboardBtnCoinFlip'); 
            const backToDashboardBtnSlotMachine = document.getElementById('backToDashboardBtnSlotMachine'); 
            const backToDashboardBtnSpin2Win = document.getElementById('backToDashboardBtnSpin2Win'); 
            const backToDashboardBtnWithdrawal = document.getElementById('backToDashboardBtnWithdrawal'); 

            // Payment Overlay Elements
            const paymentOverlay = document.getElementById('paymentOverlay');
            const paymentAmountDisplay = document.getElementById('paymentAmountDisplay');
            const depositAmountInput = document.getElementById('depositAmountInput'); 
            const paymentStatusMessage = document.getElementById('paymentStatusMessage'); 
            const confirmPaymentButton = document.getElementById('confirmPaymentButton'); 
            const cancelPaymentButton = document.getElementById('cancelPaymentButton'); 
            const simulateSuccessBtn = document.getElementById('simulateSuccessBtn'); 
            const simulateFailBtn = document.getElementById('simulateFailBtn');     
            const quickDepositButtons = document.querySelectorAll('.quick-deposit-btn'); 

            // Withdrawal Section Elements
            const withdrawalBalanceDisplay = document.getElementById('withdrawalBalanceDisplay');
            const withdrawalAmountInput = document.getElementById('withdrawalAmount');
            const bankNameInput = document.getElementById('bankName');
            const accountNumberInput = document.getElementById('accountNumber');
            const accountNameInput = document.getElementById('accountName');
            const initiateWithdrawalButton = document.getElementById('initiateWithdrawalButton');
            const withdrawalStatusMessage = document.getElementById('withdrawalStatusMessage');

            // Profile Setup & Edit Elements
            const profileNameInput = document.getElementById('profileNameInput');
            const profilePhotoUrlInput = document.getElementById('profilePhotoUrlInput');
            const saveProfileBtn = document.getElementById('saveProfileBtn');
            const profileSetupMessage = document.getElementById('profileSetupMessage');
            const editProfileOverlay = document.getElementById('editProfileOverlay'); 
            const editProfileMessage = document.getElementById('editProfileMessage'); 
            const editProfileNameInput = document.getElementById('editProfileNameInput'); 
            const editProfilePhotoUrlInput = document.getElementById('editProfilePhotoUrlInput'); 
            const saveEditedProfileBtn = document.getElementById('saveEditedProfileBtn'); 
            const cancelEditProfileBtn = document.getElementById('cancelEditProfileBtn'); 
            const editProfileStatusMessage = document.getElementById('editProfileStatusMessage'); 
            const nextEditDateDisplay = document.getElementById('nextEditDateDisplay'); 


            // Spin the Wheel elements
            const wheelCanvas = document.getElementById('wheelCanvas');
            const wheelCtx = wheelCanvas.getContext('2d');
            const gameBalanceDisplay = document.getElementById('gameBalanceDisplay');
            const betAmountInput = document.getElementById('betAmount');
            const placeBetButton = document.getElementById('placeBetButton');
            const spinButton = document.getElementById('spinButton');
            const gameMessage = document.getElementById('gameMessage');

            // Visual Soccer elements
            const soccerListBalanceDisplay = document.getElementById('soccerListBalanceDisplay'); 
            const soccerGameBalanceDisplay = document.getElementById('soccerGameBalanceDisplay');
            const soccerBetAmountInput = document.getElementById('soccerBetAmount');
            const placeSoccerBetButton = document.getElementById('placeSoccerBetButton');
            const currentMatchTeams = document.getElementById('currentMatchTeams'); 
            const currentMatchLeague = document.getElementById('currentMatchLeague'); 
            const currentMatchTime = document.getElementById('currentMatchTime'); 
            const matchScoreDisplay = document.getElementById('matchScoreDisplay');
            const betOptionButtons = document.querySelectorAll('.bet-option-btn');
            const oddHome = document.getElementById('oddHome'); 
            const oddDraw = document.getElementById('oddDraw'); 
            const oddAway = document.getElementById('oddAway'); 
            const oddOver1_5 = document.getElementById('oddOver1_5'); 
            const oddUnder1_5 = document.getElementById('oddUnder1_5'); 
            const oddBttsYes = document.getElementById('oddBttsYes'); 
            const oddBttsNo = document.getElementById('oddBttsNo'); 
            const simulateMatchButton = document.getElementById('simulateMatchButton');
            const soccerGameMessage = document.getElementById('soccerGameMessage');
            const soccerVisualCanvas = document.getElementById('soccerVisualCanvas'); 
            const soccerVisualCtx = soccerVisualCanvas.getContext('2d'); 
            const visualMatchMessage = document.getElementById('visualMatchMessage'); 
            const llmCommentarySection = document.getElementById('llmCommentarySection'); 
            const llmCommentaryDisplay = document.getElementById('llmCommentaryDisplay'); 
            const getCommentaryBtn = document.getElementById('getCommentaryBtn'); 
            const placeNewBetBtn = document.getElementById('placeNewBetBtn'); 

            // Coin Flip elements
            const coinFlipBalanceDisplay = document.getElementById('coinFlipBalanceDisplay');
            const coinFlipBetAmountInput = document.getElementById('coinFlipBetAmount');
            const placeCoinFlipBetButton = document.getElementById('placeCoinFlipBetButton');
            const betHeadsButton = document.getElementById('betHeadsButton');
            const betTailsButton = document.getElementById('betTailsButton');
            const coinDisplay = document.getElementById('coinDisplay');
            const flipCoinButton = document.getElementById('flipCoinButton');
            const coinFlipMessage = document.getElementById('coinFlipMessage');
            let selectedCoinOutcome = null;
            let currentBetAmountCoinFlip = 0;

            // Slot Machine elements
            const slotMachineBalanceDisplay = document.getElementById('slotMachineBalanceDisplay');
            const slotMachineBetAmountInput = document.getElementById('slotMachineBetAmount');
            const placeSlotBetButton = document.getElementById('placeSlotBetButton');
            const reel1 = document.getElementById('reel1');
            const reel2 = document.getElementById('reel2');
            const reel3 = document.getElementById('reel3');
            const spinSlotButton = document.getElementById('spinSlotButton');
            const slotMachineMessage = document.getElementById('slotMachineMessage');
            const slotSymbols = ['🍒', '🍋', '🔔', '⭐', '💎']; 
            let currentBetAmountSlotMachine = 0;

            // Spin 2 Win elements
            const spin2WinBalanceDisplay = document.getElementById('spin2WinBalanceDisplay');
            const spin2WinBetAmountInput = document.getElementById('spin2WinBetAmount');
            const placeSpin2WinBetButton = document.getElementById('placeSpin2WinBetButton');
            const spin2WinCanvas = document.getElementById('spin2WinCanvas');
            const spin2WinCtx = spin2WinCanvas.getContext('2d');
            const spin2WinButton = document.getElementById('spin2WinButton');
            const spin2WinMessage = document.getElementById('spin2WinMessage');
            let isSpin2WinSpinning = false;
            let spin2WinRotation = 0;
            let currentBetAmountSpin2Win = 0;

            // Global State Variables
            let currentBalance = 10000.00; // Initialize with ₦10,000 for easier testing
            let currentBetAmountSpinWheel = 0;
            let currentBetAmountSoccer = 0;
            let selectedSoccerOutcome = null;
            let currentSelectedSoccerMatch = null; 
            let lastRequestedPaymentAmount = 0; 
            let userName = "Guest";
            let profilePhotoUrl = "";
            let profileSetupDate = 0; // Timestamp when profile was last saved/edited

            // Variables to store last match result for commentary
            let lastMatchResult = {
                homeTeam: "", awayTeam: "", homeScore: 0, awayScore: 0,
                selectedOutcome: "", betWon: false, betAmount: 0
            };

            // Flag to remember which game's bet initiated the payment request
            let gameBetPendingPayment = null; 

            const SEVEN_DAYS_IN_MS = 7 * 24 * 60 * 60 * 1000;
            const WIN_RATE = 0.20; // Target 20% win rate

            // --- UI Update Functions ---
            function updateBalanceDisplay() {
                const formattedBalance = `₦${currentBalance.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                gameBalanceDisplay.textContent = formattedBalance;
                soccerGameBalanceDisplay.textContent = formattedBalance;
                soccerListBalanceDisplay.textContent = formattedBalance; 
                withdrawalBalanceDisplay.textContent = formattedBalance; 
                coinFlipBalanceDisplay.textContent = formattedBalance; 
                slotMachineBalanceDisplay.textContent = formattedBalance; 
                spin2WinBalanceDisplay.textContent = formattedBalance; 
            }

            function setGameMessage(message, color = '#555') {
                gameMessage.innerHTML = message; // Use innerHTML to allow spinner icon
                gameMessage.style.color = color;
            }

            function setSoccerGameMessage(message, color = '#555') {
                soccerGameMessage.innerHTML = message;
                soccerGameMessage.style.color = color;
            }

            function setVisualMatchMessage(message, color = '#333') { 
                visualMatchMessage.innerHTML = message;
                visualMatchMessage.style.color = color;
            }

            function setCoinFlipMessage(message, color = '#555') { 
                coinFlipMessage.innerHTML = message;
                coinFlipMessage.style.color = color;
            }

            function setSlotMachineMessage(message, color = '#555') { 
                slotMachineMessage.innerHTML = message;
                slotMachineMessage.style.color = color;
            }

            function setSpin2WinMessage(message, color = '#555') { 
                spin2WinMessage.innerHTML = message;
                spin2WinMessage.style.color = color;
            }

            function setWithdrawalMessage(message, color = '#555') { 
                withdrawalStatusMessage.innerHTML = message;
                withdrawalStatusMessage.style.color = color;
            }

            function setProfileSetupMessage(message, color = '#555') {
                profileSetupMessage.innerHTML = message;
                profileSetupMessage.style.color = color;
            }

            function setEditProfileStatusMessage(message, color = '#555') {
                editProfileStatusMessage.innerHTML = message;
                editProfileStatusMessage.style.color = color;
            }

            // Centralized function to hide all major views
            function hideAllViews() { 
                const allViews = [profileSetupView, dashboardView, spinTheWheelGame, visualSoccerGame, soccerMatchListView, withdrawalView, paymentOverlay, editProfileOverlay, coinFlipGame, slotMachineGame, spin2WinGame]; 
                allViews.forEach(view => {
                    if (view) view.style.display = 'none'; 
                });
                // Clear all glows
                spinTheWheelGame.classList.remove('win-glow', 'lose-glow');
                visualSoccerGame.classList.remove('win-glow', 'lose-glow', 'draw-glow');
                coinFlipGame.classList.remove('win-glow', 'lose-glow'); 
                slotMachineGame.classList.remove('win-glow', 'lose-glow'); 
                spin2WinGame.classList.remove('win-glow', 'lose-glow'); 
            }

            function showDashboard() {
                hideAllViews();
                dashboardView.style.display = 'block';
                renderGameCards(); 
                updateProfileDisplayInHeader(); 
                updateBalanceDisplay(); 
            }

            function showSpinTheWheel() {
                hideAllViews();
                spinTheWheelGame.style.display = 'block';
                updateBalanceDisplay();
                setGameMessage("Place your bet to activate the wheel!");
                spinButton.disabled = true;
                placeBetButton.disabled = false; 
                betAmountInput.disabled = false; 
                betAmountInput.value = 700; 
                drawWheel(wheelRotation);
                checkAndDisableBettingControls(parseFloat(betAmountInput.min), 'spinTheWheel');
            }

            function showSoccerMatchList() { 
                hideAllViews();
                soccerMatchListView.style.display = 'block';
                updateBalanceDisplay(); 
                availableSoccerMatches = generateSoccerMatches(); 
                renderSoccerMatches();
            }

            function showVisualSoccer(match) { 
                hideAllViews();
                visualSoccerGame.style.display = 'block';
                currentSelectedSoccerMatch = match; 
                updateBalanceDisplay();
                setSoccerGameMessage("Place your bet and select an outcome.");
                
                // Reset soccer game specific controls to initial state
                simulateMatchButton.disabled = true;
                placeSoccerBetButton.disabled = false; 
                soccerBetAmountInput.disabled = false; 
                soccerBetAmountInput.value = 1000; 
                currentBetAmountSoccer = 0; 
                betOptionButtons.forEach(btn => {
                    btn.classList.remove('selected');
                    btn.disabled = true; 
                });
                selectedSoccerOutcome = null;

                // Update match details in the view
                currentMatchTeams.textContent = `${match.homeTeam} vs ${match.awayTeam}`;
                currentMatchLeague.textContent = `League: ${match.league}`;
                currentMatchTime.textContent = `Today ${match.time}`;
                oddHome.textContent = match.odds.home.toFixed(2);
                oddDraw.textContent = match.odds.draw.toFixed(2);
                oddAway.textContent = match.odds.away.toFixed(2);
                oddOver1_5.textContent = match.odds.over1_5.toFixed(2); 
                oddUnder1_5.textContent = match.odds.under1_5.toFixed(2); 
                oddBttsYes.textContent = match.odds.btts_yes.toFixed(2); 
                oddBttsNo.textContent = match.odds.btts_no.toFixed(2); 

                // Reset visual match display
                homeScore = 0;
                awayScore = 0;
                matchScoreDisplay.textContent = '0 - 0';
                setVisualMatchMessage('Match ready! Place your bet.');
                drawSoccerVisuals(0, homeScore, awayScore); 
                cancelAnimationFrame(soccerAnimationId); 
                initPlayers(); 
                checkAndDisableBettingControls(parseFloat(soccerBetAmountInput.min), 'visualSoccer');
                
                // Hide commentary section on new match load
                llmCommentarySection.style.display = 'none';
                llmCommentaryDisplay.textContent = '';
                getCommentaryBtn.disabled = true;
                placeNewBetBtn.style.display = 'none'; 
            }

            function showCoinFlipGame() {
                hideAllViews();
                coinFlipGame.style.display = 'block';
                updateBalanceDisplay();
                setCoinFlipMessage("Place your bet and choose Heads or Tails!");
                coinFlipBetAmountInput.value = 100;
                placeCoinFlipBetButton.disabled = false;
                coinFlipBetAmountInput.disabled = false;
                betHeadsButton.disabled = true;
                betTailsButton.disabled = true;
                flipCoinButton.disabled = true;
                betHeadsButton.classList.remove('selected');
                betTailsButton.classList.remove('selected');
                coinDisplay.innerHTML = '<i class="fas fa-question"></i>'; 
                coinDisplay.classList.remove('flipping');
                selectedCoinOutcome = null;
                currentBetAmountCoinFlip = 0;
                checkAndDisableBettingControls(parseFloat(coinFlipBetAmountInput.min), 'coinFlip');
            }

            function showSlotMachineGame() {
                hideAllViews();
                slotMachineGame.style.display = 'block';
                updateBalanceDisplay();
                setSlotMachineMessage("Place your bet and spin to win!");
                slotMachineBetAmountInput.value = 200;
                placeSlotBetButton.disabled = false;
                slotMachineBetAmountInput.disabled = false;
                spinSlotButton.disabled = true;
                // Clear reels
                reel1.textContent = '';
                reel2.textContent = '';
                reel3.textContent = '';
                currentBetAmountSlotMachine = 0;
                checkAndDisableBettingControls(parseFloat(slotMachineBetAmountInput.min), 'slotMachine');
            }

            // Show Spin 2 Win Game
            function showSpin2WinGame() {
                hideAllViews();
                spin2WinGame.style.display = 'block';
                updateBalanceDisplay();
                setSpin2WinMessage("Place your bet and try your luck!");
                spin2WinButton.disabled = true;
                placeSpin2WinBetButton.disabled = false;
                spin2WinBetAmountInput.disabled = false;
                spin2WinBetAmountInput.value = 1000; 
                drawSpin2WinWheel(spin2WinRotation);
                checkAndDisableBettingControls(parseFloat(spin2WinBetAmountInput.min), 'spin2Win');
            }


            function showWithdrawalView() { 
                hideAllViews();
                withdrawalView.style.display = 'block';
                updateBalanceDisplay();
                setWithdrawalMessage("Enter details to withdraw funds.");
                withdrawalAmountInput.value = '';
                bankNameInput.value = '';
                accountNumberInput.value = '';
                accountNameInput.value = '';
                initiateWithdrawalButton.disabled = false;

                if (currentBalance < parseFloat(withdrawalAmountInput.min)) {
                    initiateWithdrawalButton.disabled = true;
                    setWithdrawalMessage("Minimum withdrawal is ₦1,000. Insufficient balance.", 'red');
                }
            }

            function showEditProfileOverlay() { 
                editProfileOverlay.style.display = 'flex';
                editProfileNameInput.value = userName;
                editProfilePhotoUrlInput.value = profilePhotoUrl;
                setEditProfileStatusMessage("Update your name and profile photo.");

                const now = Date.now();
                const nextEditTime = profileSetupDate + SEVEN_DAYS_IN_MS;
                
                if (now < nextEditTime) {
                    const remainingMs = nextEditTime - now;
                    const remainingDays = Math.ceil(remainingMs / (1000 * 60 * 60 * 24));
                    const nextEditDate = new Date(nextEditTime).toLocaleDateString();
                    nextEditDateDisplay.textContent = `${nextEditDate} (in ${remainingDays} days)`;
                    editProfileNameInput.disabled = true;
                    editProfilePhotoUrlInput.disabled = true;
                    saveEditedProfileBtn.disabled = true;
                } else {
                    nextEditDateDisplay.textContent = `Now!`;
                    editProfileNameInput.disabled = false;
                    editProfilePhotoUrlInput.disabled = false;
                    saveEditedProfileBtn.disabled = false;
                }
                setAllGameControlsEnabled(false); 
            }

            function updateProfileDisplayInHeader() {
                userNameDisplay.textContent = userName;
                userPhotoDisplay.innerHTML = ''; 

                if (profilePhotoUrl && profilePhotoUrl.startsWith('http')) {
                    const img = document.createElement('img');
                    img.src = profilePhotoUrl;
                    img.alt = userName.charAt(0).toUpperCase();
                    img.onerror = function() {
                        this.outerHTML = `<i class="fas fa-user-circle"></i>`; 
                    };
                    userPhotoDisplay.appendChild(img);
                } else if (userName) {
                    userPhotoDisplay.textContent = userName.charAt(0).toUpperCase();
                } else {
                    userPhotoDisplay.innerHTML = `<i class="fas fa-user-circle"></i>`; 
                }
            }

            // --- Game Card Rendering (Dashboard) ---
            const games = [
                {
                    id: "spin-the-wheel",
                    title: "Spin the Wheel",
                    icon: "fa-solid fa-spinner",
                    description: "Test your luck! Pay an entry fee to spin the wheel and land on exciting prizes, cash, or even free spins. Each spin is a new adventure!",
                    link: "#",
                    available: true
                },
                { 
                    id: "visual-soccer",
                    title: "Visual Soccer",
                    icon: "fa-solid fa-futbol",
                    description: "Bet on the outcome of simulated football matches from various leagues and watch the virtual action unfold!",
                    link: "#",
                    available: true 
                },
                {
                    id: "coin-flip", 
                    title: "Coin Flip Fortune",
                    icon: "fa-solid fa-coins",
                    description: "A simple game of chance. Predict whether the coin will land on heads or tails to double your earnings!",
                    link: "#",
                    available: true 
                },
                {
                    id: "slot-machine", 
                    title: "Virtual Slot Machine",
                    icon: "fa-solid fa-slot-machine",
                    description: "Pull the lever and watch the reels spin! Match the symbols to win exciting prizes in this classic casino game.",
                    link: "#",
                    available: true 
                },
                {
                    id: "spin-2-win", 
                    title: "Spin 2 Win",
                    icon: "fa-solid fa-award",
                    description: "Another thrilling wheel-based game! Spin to match symbols or land on winning combinations for great rewards.",
                    link: "#",
                    available: true 
                },
                {
                    id: "spin-da-bottle",
                    title: "Spin da Bottle",
                    icon: "fa-solid fa-bottle-droplet",
                    description: "A classic party game re-imagined. Spin the bottle and let fate decide who takes on a truth or a dare. Perfect for group fun!",
                    link: "#",
                    available: true 
                },
                {
                    id: "flying-plane",
                    title: "Flying Plane Challenge",
                    icon: "fa-solid fa-plane-departure",
                    description: "Take control of a plane and navigate through obstacles. See how far you can fly without crashing!",
                    link: "#",
                    available: true 
                },
                {
                    id: "card-match",
                    title: "Card Matching Game",
                    icon: "fa-regular fa-clone",
                    description: "Flip pairs of cards to find matching symbols. Test your memory and concentration skills!",
                    link: "#",
                    available: true 
                },
                {
                    id: "treasure-hunt",
                    title: "Treasure Hunt Adventure",
                    icon: "fa-solid fa-treasure-chest",
                    description: "Follow the clues to uncover hidden treasure. Navigate through a virtual map and solve puzzles to claim your reward.",
                    link: "#",
                    available: true 
                },
                {
                    id: "word-scramble",
                    title: "Word Scramble Challenge",
                    icon: "fa-solid fa-puzzle-piece",
                    description: "Unscramble the jumbled letters to form valid words. Expand your vocabulary and test your anagram skills.",
                    link: "#",
                    available: true 
                },
                {
                    id: "dart-game",
                    title: "Virtual Darts",
                    icon: "fa-solid fa-bullseye",
                    description: "Aim and throw darts at the target. Score points based on where your darts land. A game of precision and skill.",
                    link: "#",
                    available: true 
                },
                {
                    id: "balloon-pop",
                    title: "Balloon Pop Frenzy",
                    icon: "fa-solid fa-balloon",
                    description: "Pop as many balloons as you can within the time limit. A fast-paced and colorful game of reflexes.",
                    link: "#",
                    available: true 
                },
                {
                    id: "racing-game",
                    title: "Mini Racing Challenge",
                    icon: "fa-solid fa-car",
                    description: "Race against opponents in this fun mini-racing game. Compete for the top spot and earn rewards.",
                    link: "#",
                    available: true 
                }
            ];

            function renderGameCards() {
                gameListContainer.innerHTML = '';
                games.forEach(game => {
                    const gameCard = document.createElement('div');
                    gameCard.classList.add('game-card');
                    if (!game.available) { 
                        gameCard.classList.add('locked');
                    }

                    gameCard.innerHTML = `
                        <div class="icon-container">
                            <i class="${game.icon}"></i>
                        </div>
                        <h3>${game.title}</h3>
                        <p>${game.description}</p>
                        <a href="${game.link}" class="play-button">${game.available ? 'Play Now' : 'Locked'} <i class="fas fa-arrow-right ml-2"></i></a>
                    `;
                    gameListContainer.appendChild(gameCard);

                    const playButton = gameCard.querySelector('.play-button');
                    playButton.addEventListener('click', (event) => {
                        event.preventDefault();
                        if (!game.available) {
                            alert(`"${game.title}" is currently locked.`);
                            return;
                        }
                        // Navigate to the correct game view
                        if (game.id === "spin-the-wheel") {
                            showSpinTheWheel();
                        } else if (game.id === "visual-soccer") {
                            showSoccerMatchList(); 
                        } else if (game.id === "coin-flip") { 
                            showCoinFlipGame();
                        } else if (game.id === "slot-machine") { 
                            showSlotMachineGame();
                        } else if (game.id === "spin-2-win") { 
                            showSpin2WinGame();
                        } else {
                            // Placeholder for other games - show a generic message
                            alert(`"${game.title}" is available, but its full functionality is not yet implemented.`);
                        }
                    });
                });
            }

            // --- Spin the Wheel Game Logic ---
            // Spin the Wheel Globals
            let isSpinning = false;
            let wheelRotation = 0; 
            let animationFrameId; 
            let targetFinalRotation = 0; 
            let initialWheelRotationAtSpinStart = 0;
            let wheelSpinStartTime; 

            // Wheel Configuration (adjusted for 20% win rate)
            const spinWheelSegments = [
                { text: "₦1000", color: "#FFEB3B", value: 1000, type: 'win', probability: 0.05 }, 
                { text: "₦5000", color: "#4CAF50", value: 5000, type: 'win', probability: 0.05 }, 
                { text: "₦10000", color: "#2196F3", value: 10000, type: 'win', probability: 0.05 }, 
                { text: "₦2000", color: "#FF9800", value: 2000, type: 'win', probability: 0.05 }, 
                // Total 20% win probability above, rest are losing
                { text: "Nothing (x0)", color: "#F44336", value: 0, type: 'lose', probability: 0.20 },
                { text: "Try Again (x0)", color: "#E91E63", value: 0, type: 'lose', probability: 0.20 },
                { text: "Bad Luck (x0)", color: "#9C27B0", value: 0, type: 'lose', probability: 0.20 },
                { text: "No Win (x0)", color: "#00BCD4", value: 0, type: 'lose', probability: 0.20 } 
            ];
            const numSegmentsSpinWheel = spinWheelSegments.length;
            const arcSpinWheel = (2 * Math.PI) / numSegmentsSpinWheel; 
            const wheelRadiusSpinWheel = wheelCanvas.width / 2 - 10; 

            function drawWheel(currentRotation = 0) {
                const centerX = wheelCanvas.width / 2;
                const centerY = wheelCanvas.height / 2;

                wheelCtx.clearRect(0, 0, wheelCanvas.width, wheelCanvas.height);
                wheelCtx.save();
                wheelCtx.translate(centerX, centerY);
                wheelCtx.rotate(currentRotation);

                spinWheelSegments.forEach((segment, i) => {
                    const startAngle = arcSpinWheel * i;
                    const endAngle = startAngle + arcSpinWheel;
                    wheelCtx.beginPath();
                    wheelCtx.arc(0, 0, wheelRadiusSpinWheel, startAngle, endAngle);
                    wheelCtx.lineTo(0, 0);
                    wheelCtx.fillStyle = segment.color;
                    wheelCtx.fill();
                    wheelCtx.strokeStyle = "#ccc";
                    wheelCtx.lineWidth = 1;
                    wheelCtx.stroke();

                    wheelCtx.save();
                    const textAngle = startAngle + arcSpinWheel / 2;
                    wheelCtx.rotate(textAngle);
                    wheelCtx.textAlign = "right";
                    wheelCtx.fillStyle = "#333";
                    wheelCtx.font = "bold 18px Inter";
                    wheelCtx.fillText(segment.text, wheelRadiusSpinWheel - 20, 0);
                    wheelCtx.restore();
                });

                wheelCtx.restore();

                wheelCtx.beginPath();
                wheelCtx.moveTo(centerX, centerY - wheelRadiusSpinWheel - 20);
                wheelCtx.lineTo(centerX - 15, centerY - wheelRadiusSpinWheel - 5);
                wheelCtx.lineTo(centerX + 15, centerY - wheelRadiusSpinWheel - 5);
                wheelCtx.closePath();
                wheelCtx.fillStyle = "#333";
                wheelCtx.fill();
            }

            const SPIN_WHEEL_DURATION = 3500;

            function animateSpinFixedDuration(currentTime) {
                if (!wheelSpinStartTime) wheelSpinStartTime = currentTime;
                const elapsedTime = currentTime - wheelSpinStartTime;

                if (elapsedTime >= SPIN_WHEEL_DURATION) {
                    isSpinning = false;
                    cancelAnimationFrame(animationFrameId);
                    wheelRotation = targetFinalRotation;
                    drawWheel(wheelRotation);
                    // Determine the actual segment based on the final rotation
                    const segmentIndexAtPointer = getSegmentIndexFromRotation(wheelRotation, numSegmentsSpinWheel, arcSpinWheel);
                    handleSpinResult(spinWheelSegments[segmentIndexAtPointer]);
                    wheelSpinStartTime = null; 
                    return;
                }

                const progress = elapsedTime / SPIN_WHEEL_DURATION;
                const easedProgress = 1 - Math.pow(1 - progress, 3); 
                
                const totalAngleDelta = targetFinalRotation - initialWheelRotationAtSpinStart;
                wheelRotation = initialWheelRotationAtSpinStart + totalAngleDelta * easedProgress;

                drawWheel(wheelRotation);
                animationFrameId = requestAnimationFrame(animateSpinFixedDuration);
            }

            function getSegmentIndexFromRotation(rotation, totalSegments, segmentArc) {
                // Normalize rotation to be within 0 and 2*PI
                let normalizedRotation = rotation % (2 * Math.PI);
                if (normalizedRotation < 0) {
                    normalizedRotation += (2 * Math.PI);
                }
                // Adjust for the pointer being at the top (3/2 PI)
                const pointerAngle = (3 * Math.PI / 2);
                let relativeAngle = (normalizedRotation - pointerAngle + 2 * Math.PI) % (2 * Math.PI);
                if (relativeAngle < 0) {
                    relativeAngle += (2 * Math.PI);
                }
                // Calculate segment index
                return Math.floor(relativeAngle / segmentArc);
            }

            function startSpin() {
                if (isSpinning || currentBetAmountSpinWheel === 0) return;

                if (currentBalance < currentBetAmountSpinWheel) {
                    showPaymentOverlay(currentBetAmountSpinWheel, 'spinTheWheel'); 
                    return;
                }
                currentBalance -= currentBetAmountSpinWheel;
                updateBalanceDisplay();

                isSpinning = true;
                spinButton.disabled = true;
                placeBetButton.disabled = true;
                betAmountInput.disabled = true;
                spinTheWheelGame.classList.remove('win-glow', 'lose-glow');

                setGameMessage("Wheel spinning... Good luck!");

                // Determine target segment based on WIN_RATE
                let targetSegment = null;
                const isWinningSpin = Math.random() < WIN_RATE;

                const winningSegmentsPool = spinWheelSegments.filter(s => s.type === 'win');
                const losingSegmentsPool = spinWheelSegments.filter(s => s.type === 'lose');

                if (isWinningSpin && winningSegmentsPool.length > 0) {
                    targetSegment = winningSegmentsPool[Math.floor(Math.random() * winningSegmentsPool.length)];
                } else if (losingSegmentsPool.length > 0) {
                    targetSegment = losingSegmentsPool[Math.floor(Math.random() * losingSegmentsPool.length)];
                } else {
                    // Fallback if no losing segments or pools are empty
                    targetSegment = spinWheelSegments[Math.floor(Math.random() * numSegmentsSpinWheel)];
                }

                const targetSegmentIndex = spinWheelSegments.indexOf(targetSegment);

                const angleToAlign = (3 * Math.PI / 2) - (targetSegmentIndex * arcSpinWheel + arcSpinWheel / 2);
                const normalizedAngleToAlign = (angleToAlign + 2 * Math.PI) % (2 * Math.PI); // Ensure positive angle
                
                const fullSpinsToAdd = Math.floor(Math.random() * 6) + 5; 
                targetFinalRotation = wheelRotation + (fullSpinsToAdd * 2 * Math.PI) + normalizedAngleToAlign;

                initialWheelRotationAtSpinStart = wheelRotation;
                wheelSpinStartTime = null; 
                requestAnimationFrame(animateSpinFixedDuration);
            }

            function handleSpinResult(segment) {
                if (segment.type === 'win') {
                    currentBalance += segment.value;
                    setGameMessage(`You won ${segment.text}! Your balance is now ₦${currentBalance.toLocaleString()}.`, 'green');
                    spinTheWheelGame.classList.add('win-glow');
                } else {
                    setGameMessage(`You landed on ${segment.text}. Your bet of ₦${currentBetAmountSpinWheel.toLocaleString()} was deducted. Current balance: ₦${currentBalance.toLocaleString()}.`, 'red'); 
                    spinTheWheelGame.classList.add('lose-glow');
                }
                updateBalanceDisplay();

                spinButton.disabled = true;
                placeBetButton.disabled = false;
                betAmountInput.disabled = false;
            }

            // --- Visual Soccer Game Logic ---
            const SOCCER_TEAMS = [
                "Real Madrid", "FC Barcelona", "Manchester United", "Liverpool FC",
                "Bayern Munich", "Paris SG", "Juventus", "Inter Milan",
                "Arsenal FC", "Chelsea FC", "Tottenham Hotspur", "Atlético Madrid",
                "Borussia Dortmund", "AC Milan", "Napoli", "Benfica",
                "Porto", "Ajax", "Roma", "Lazio", "Sevilla", "Valencia",
                "RB Leipzig", "Borussia Mönchengladbach", "Lyon", "Marseille",
                "Fiorentina", "Atalanta", "Real Betis", "Villarreal"
            ];
            const SOCCER_LEAGUES = [
                "Premier League", "La Liga", "Serie A", "Bundesliga", "Ligue 1", 
                "Champions League", "Europa League", "FA Cup" 
            ];
            // Modified SOCCER_ODDS_POOL for a more challenging experience
            const SOCCER_ODDS_POOL = [ 
                { home: 1.40, draw: 3.00, away: 4.50, over1_5: 1.30, under1_5: 2.60, btts_yes: 1.45, btts_no: 2.10 },
                { home: 1.70, draw: 3.10, away: 3.50, over1_5: 1.40, under1_5: 2.30, btts_yes: 1.55, btts_no: 1.90 },
                { home: 1.25, draw: 4.00, away: 6.00, over1_5: 1.25, under1_5: 2.80, btts_yes: 1.35, btts_no: 2.40 },
                { home: 2.10, draw: 3.00, away: 2.80, over1_5: 1.50, under1_5: 2.00, btts_yes: 1.65, btts_no: 1.80 },
            ];
            // Soccer Animation Globals
            let soccerAnimationId; 
            let soccerMatchStartTime;
            const SOCCER_MATCH_DURATION_SECONDS = 90; 
            const SOCCER_ANIMATION_DURATION_MS = 10000; 
            let ballPos = { x: 0, y: 0 }; 
            let ballTarget = { x: 0, y: 0 }; 
            const ballSpeed = 3; 
            const PLAYER_RADIUS = 6;
            const PLAYER_COUNT_PER_TEAM = 5; 
            let homePlayers = [];
            let awayPlayers = [];
            let homeScore = 0;
            let awayScore = 0;
            let matchVisualState = 'pre_kickoff'; 
            let goalEvents = []; 
            let ballVelocity = { x: 0, y: 0 };
            let goalAnimationActive = false;


            function generateSoccerMatches(count = 7) { 
                const matches = [];
                const generatedTimes = new Set(); 
                for (let i = 0; i < count; i++) {
                    let team1Index = Math.floor(Math.random() * SOCCER_TEAMS.length);
                    let team2Index;
                    do {
                        team2Index = Math.floor(Math.random() * SOCCER_TEAMS.length);
                    } while (team1Index === team2Index);

                    const home = SOCCER_TEAMS[team1Index];
                    const away = SOCCER_TEAMS[team2Index];
                    const league = SOCCER_LEAGUES[Math.floor(Math.random() * SOCCER_LEAGUES.length)];
                    const odds = SOCCER_ODDS_POOL[Math.floor(Math.random() * SOCCER_ODDS_POOL.length)];
                    
                    let time;
                    do {
                        const timeHour = Math.floor(Math.random() * 6) + 16; 
                        const timeMinute = Math.floor(Math.random() * 12) * 5; 
                        time = `${String(timeHour).padStart(2, '0')}:${String(timeMinute).padStart(2, '0')}`;
                    } while (generatedTimes.has(time));
                    generatedTimes.add(time);

                    matches.push({
                        id: `match-${i}`,
                        homeTeam: home,
                        awayTeam: away,
                        league: league,
                        time: time,
                        odds: { ...odds } 
                    });
                }
                return matches;
            }

            let availableSoccerMatches = generateSoccerMatches(); 

            function renderSoccerMatches() {
                soccerMatchListContainer.innerHTML = '';
                availableSoccerMatches.forEach(match => {
                    const matchCard = document.createElement('div');
                    matchCard.classList.add('match-card');
                    matchCard.dataset.matchId = match.id; 
                    matchCard.innerHTML = `
                        <h4>${match.league} | ${match.time}</h4>
                        <div class="teams">${match.homeTeam} <span class="vs">VS</span> ${match.awayTeam}</div>
                        <div class="odds-display">
                            <span class="odd-item">H: ${match.odds.home.toFixed(2)}</span>
                            <span class="odd-item">D: ${match.odds.draw.toFixed(2)}</span>
                            <span class="odd-item">A: ${match.odds.away.toFixed(2)}</span>
                            <span class="odd-item">O1.5: ${match.odds.over1_5.toFixed(2)}</span>
                            <span class="odd-item">U1.5: ${match.odds.under1_5.toFixed(2)}</span>
                            <span class="odd-item">BTTS Y: ${match.odds.btts_yes.toFixed(2)}</span>
                            <span class="odd-item">BTTS N: ${match.odds.btts_no.toFixed(2)}</span>
                        </div>
                    `;
                    soccerMatchListContainer.appendChild(matchCard);
                });

                soccerMatchListContainer.querySelectorAll('.match-card').forEach(card => {
                    card.addEventListener('click', (event) => {
                        const matchId = event.currentTarget.dataset.matchId;
                        const selectedMatch = availableSoccerMatches.find(m => m.id === matchId);
                        if (selectedMatch) {
                            showVisualSoccer(selectedMatch);
                        }
                    });
                });
            }

            function resetSoccerGameControls() {
                simulateMatchButton.disabled = true;
                placeSoccerBetButton.disabled = false;
                soccerBetAmountInput.disabled = false;
                betOptionButtons.forEach(btn => {
                    btn.classList.remove('selected');
                    btn.disabled = true; 
                });
                selectedSoccerOutcome = null;
                visualSoccerGame.classList.remove('win-glow', 'lose-glow', 'draw-glow');
                setSoccerGameMessage("Place your bet and select an outcome.");
                setVisualMatchMessage('Match ready! Place your bet.');
                
                cancelAnimationFrame(soccerAnimationId);
                homeScore = 0;
                awayScore = 0;
                matchScoreDisplay.textContent = '0 - 0';
                drawSoccerVisuals(0, homeScore, awayScore); 
                initPlayers(); 
                goalEvents = []; 
                currentBetAmountSoccer = 0; 

                // Reset LLM commentary section
                llmCommentarySection.style.display = 'none';
                llmCommentaryDisplay.textContent = '';
                getCommentaryBtn.disabled = true;
                placeNewBetBtn.style.display = 'none'; 
                lastMatchResult = {homeTeam: "", awayTeam: "", homeScore: 0, awayScore: 0, selectedOutcome: "", betWon: false, betAmount: 0}; 

                checkAndDisableBettingControls(parseFloat(soccerBetAmountInput.min), 'visualSoccer');
            }

            function initPlayers() {
                homePlayers = [];
                awayPlayers = [];
                const canvas = soccerVisualCanvas;
                const fieldWidth = canvas.width;
                const fieldHeight = canvas.height;

                ballPos = { x: fieldWidth / 2, y: fieldHeight / 2 }; 
                ballTarget = { x: fieldWidth / 2, y: fieldHeight / 2 };
                ballVelocity = { x: 0, y: 0 }; // Reset ball velocity

                for (let i = 0; i < PLAYER_COUNT_PER_TEAM; i++) {
                    homePlayers.push({
                        x: Math.random() * (fieldWidth * 0.4) + fieldWidth * 0.05, // Confine to left half
                        y: Math.random() * (fieldHeight - 20) + 10,
                        targetX: 0, targetY: 0, 
                        color: '#0000FF', // Blue
                        isOffensive: i < Math.ceil(PLAYER_COUNT_PER_TEAM / 2),
                        isBallCarrier: false
                    });
                }
                for (let i = 0; i < PLAYER_COUNT_PER_TEAM; i++) {
                    awayPlayers.push({
                        x: Math.random() * (fieldWidth * 0.4) + fieldWidth * 0.55, // Confine to right half
                        y: Math.random() * (fieldHeight - 20) + 10,
                        targetX: 0, targetY: 0, 
                        color: '#FF0000', // Red
                        isOffensive: i < Math.ceil(PLAYER_COUNT_PER_TEAM / 2),
                        isBallCarrier: false
                    });
                }
                setNewPlayerTargets(); 
            }

            function setNewPlayerTargets() {
                const canvas = soccerVisualCanvas;
                const width = canvas.width;
                const height = canvas.height;

                homePlayers.forEach(p => {
                    if (p.isOffensive) {
                        p.targetX = Math.random() * (width * 0.45 - 20) + width * 0.05;
                    } else { // Defensive
                        p.targetX = Math.random() * (width * 0.25 - 20) + width * 0.05;
                    }
                    p.targetY = Math.random() * (height - 20) + 10;
                });
                awayPlayers.forEach(p => {
                    if (p.isOffensive) {
                        p.targetX = Math.random() * (width * 0.45 - 20) + width * 0.5;
                    } else { // Defensive
                        p.targetX = Math.random() * (width * 0.25 - 20) + width * 0.7;
                    }
                    p.targetY = Math.random() * (height - 20) + 10;
                });
            }

            function drawSoccerVisuals(timeElapsedPercent, currentHomeScore, currentAwayScore) {
                const canvas = soccerVisualCanvas;
                const ctx = soccerVisualCtx;
                const width = canvas.width;
                const height = canvas.height;

                ctx.clearRect(0, 0, width, height);

                ctx.fillStyle = '#4CAF50'; 
                ctx.fillRect(0, 0, width, height);

                ctx.strokeStyle = '#FFFFFF';
                ctx.lineWidth = 2;

                ctx.strokeRect(0, 0, width, height);

                ctx.beginPath();
                ctx.moveTo(width / 2, 0);
                ctx.lineTo(width / 2, height);
                ctx.stroke();

                ctx.beginPath();
                ctx.arc(width / 2, height / 2, Math.min(width, height) * 0.15, 0, 2 * Math.PI);
                ctx.stroke();

                ctx.beginPath();
                ctx.arc(width / 2, height / 2, 2, 0, 2 * Math.PI);
                ctx.fillStyle = '#FFFFFF';
                ctx.fill();

                const penaltyBoxWidth = width * 0.25;
                const penaltyBoxHeight = height * 0.5;
                ctx.strokeRect(0, (height - penaltyBoxHeight) / 2, penaltyBoxWidth, penaltyBoxHeight); 
                ctx.strokeRect(width - penaltyBoxWidth, (height - penaltyBoxHeight) / 2, penaltyBoxWidth, penaltyBoxHeight); 

                const goalAreaWidth = width * 0.1;
                const goalAreaHeight = height * 0.25;
                ctx.strokeRect(0, (height - goalAreaHeight) / 2, goalAreaWidth, goalAreaHeight); 
                ctx.strokeRect(width - goalAreaWidth, (height - goalAreaHeight) / 2, goalAreaWidth, goalAreaHeight); 

                const goalWidth = 5;
                const goalHeight = height * 0.15;
                ctx.fillStyle = '#AAAAAA';
                ctx.fillRect(0, (height - goalHeight) / 2, goalWidth, goalHeight); 
                ctx.fillRect(width - goalWidth, (height - goalHeight) / 2, goalWidth, goalHeight); 

                homePlayers.forEach(p => {
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, PLAYER_RADIUS, 0, 2 * Math.PI);
                    ctx.fillStyle = p.color;
                    ctx.fill();
                    ctx.strokeStyle = '#333';
                    ctx.lineWidth = 1;
                    ctx.stroke();
                });
                awayPlayers.forEach(p => {
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, PLAYER_RADIUS, 0, 2 * Math.PI);
                    ctx.fillStyle = p.color;
                    ctx.fill();
                    ctx.strokeStyle = '#333';
                    ctx.lineWidth = 1;
                    ctx.stroke();
                });

                // Draw ball
                ctx.beginPath();
                ctx.arc(ballPos.x, ballPos.y, 5, 0, 2 * Math.PI); 
                ctx.fillStyle = '#FFFFFF';
                ctx.fill();
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 1;
                ctx.stroke();

                // Goal animation effect
                if (goalAnimationActive) {
                    const gradient = ctx.createRadialGradient(ballPos.x, ballPos.y, 5, ballPos.x, ballPos.y, 30);
                    gradient.addColorStop(0, 'rgba(255, 255, 0, 0.8)'); // Yellow
                    gradient.addColorStop(1, 'rgba(255, 255, 0, 0)');
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(ballPos.x, ballPos.y, 30, 0, 2 * Math.PI);
                    ctx.fill();
                }


                const simulatedMatchTime = Math.min(SOCCER_MATCH_DURATION_SECONDS, Math.floor(timeElapsedPercent * SOCCER_MATCH_DURATION_SECONDS)); 
                ctx.fillStyle = '#333';
                ctx.font = 'bold 14px Inter';
                ctx.textAlign = 'center';
                ctx.fillText(`Time: ${simulatedMatchTime}'`, width / 2, height - 10);
                ctx.textAlign = 'left';
            }

            // Enhanced updateBallAndPlayersPositions
            function updateBallAndPlayersPositions() {
                const canvas = soccerVisualCanvas;
                const width = canvas.width;
                const height = canvas.height;
                const playerSpeed = 1.5;
                const ballDecay = 0.98; // Ball slows down over time
                const kickForce = 5; // How strongly a player kicks

                // Move ball based on velocity
                ballPos.x += ballVelocity.x;
                ballPos.y += ballVelocity.y;

                // Apply decay to ball velocity
                ballVelocity.x *= ballDecay;
                ballVelocity.y *= ballDecay;

                // Boundary collision for ball
                if (ballPos.x < 0) { ballPos.x = 0; ballVelocity.x *= -0.8; }
                if (ballPos.x > width) { ballPos.x = width; ballVelocity.x *= -0.8; }
                if (ballPos.y < 0) { ballPos.y = 0; ballVelocity.y *= -0.8; }
                if (ballPos.y > height) { ballPos.y = height; ballVelocity.y *= -0.8; }

                // Player movement logic
                [...homePlayers, ...awayPlayers].forEach(p => {
                    let targetX = p.targetX;
                    let targetY = p.targetY;

                    // Players try to move towards the ball if it's within their general area
                    const distanceToBall = Math.sqrt(Math.pow(ballPos.x - p.x, 2) + Math.pow(ballPos.y - p.y, 2));

                    if (distanceToBall < 50) { // If ball is somewhat close
                        targetX = ballPos.x + (Math.random() * 10 - 5); // Move towards ball with slight randomness
                        targetY = ballPos.y + (Math.random() * 10 - 5);
                    } else {
                        // If far from ball, move towards their assigned area
                        if (Math.random() < 0.05) { // Occasionally set new random targets
                            if (p.color === '#0000FF') { // Home team (left half)
                                p.targetX = Math.random() * (width * 0.45 - 20) + width * 0.05;
                            } else { // Away team (right half)
                                p.targetX = Math.random() * (width * 0.45 - 20) + width * 0.55;
                            }
                            p.targetY = Math.random() * (height - 20) + 10;
                        }
                    }

                    const dx_p = targetX - p.x;
                    const dy_p = targetY - p.y;
                    const dist_p = Math.sqrt(dx_p * dx_p + dy_p * dy_p);

                    if (dist_p > playerSpeed) {
                        p.x += (dx_p / dist_p) * playerSpeed;
                        p.y += (dy_p / dist_p) * playerSpeed;
                    }

                    // Player-ball interaction (simple kick)
                    if (distanceToBall < PLAYER_RADIUS + 5) { // If player is very close to ball
                        let targetGoalX;
                        if (p.color === '#0000FF') { // Home player kicks towards away goal
                            targetGoalX = width;
                        } else { // Away player kicks towards home goal
                            targetGoalX = 0;
                        }
                        const targetGoalY = height / 2;

                        const angleToGoal = Math.atan2(targetGoalY - ballPos.y, targetGoalX - ballPos.x);
                        ballVelocity.x = Math.cos(angleToGoal) * kickForce;
                        ballVelocity.y = Math.sin(angleToGoal) * kickForce;
                    }
                });
            }

            function animateSoccerMatch(currentTime) {
                if (!soccerMatchStartTime) soccerMatchStartTime = currentTime;
                const elapsedTime = currentTime - soccerMatchStartTime;
                const timeElapsedPercent = Math.min(1, elapsedTime / SOCCER_ANIMATION_DURATION_MS);

                if (timeElapsedPercent >= 1) { 
                    cancelAnimationFrame(soccerAnimationId);
                    matchVisualState = 'fulltime';
                    setVisualMatchMessage('Full-time!', 'darkblue');
                    handleSoccerMatchResult(homeScore, awayScore);
                    soccerMatchStartTime = null; 
                    return;
                }

                if (!goalAnimationActive) { // Only update positions if no goal animation is active
                    updateBallAndPlayersPositions(); 
                }
                drawSoccerVisuals(timeElapsedPercent, homeScore, awayScore);

                if (goalEvents.length > 0 && goalEvents[0].time <= elapsedTime && !goalAnimationActive) {
                    const goal = goalEvents.shift(); 
                    if (goal.team === 'home') {
                        homeScore++;
                    } else {
                        awayScore++;
                    }
                    matchScoreDisplay.textContent = `${homeScore} - ${awayScore}`;
                    setVisualMatchMessage(`GOAL! ${goal.team === 'home' ? currentSelectedSoccerMatch.homeTeam : currentSelectedSoccerMatch.awayTeam} scores!`, 'darkgreen');
                    
                    // Activate goal animation
                    goalAnimationActive = true;
                    // Position ball near goal mouth for animation
                    ballPos = { x: goal.team === 'home' ? soccerVisualCanvas.width - 10 : 10, y: soccerVisualCanvas.height / 2 }; 
                    ballVelocity = { x: 0, y: 0 }; // Stop ball movement during celebration

                    setTimeout(() => { 
                        goalAnimationActive = false; // Deactivate animation
                        setVisualMatchMessage('Match in progress...', '#333');
                        // Reset ball to center for kick-off
                        ballPos = { x: soccerVisualCanvas.width / 2, y: soccerVisualCanvas.height / 2 };
                        ballVelocity = { x: 0, y: 0 };
                        setNewPlayerTargets(); // Reset player positions slightly for kickoff
                    }, 1500); 
                }

                if (timeElapsedPercent > 0.49 && timeElapsedPercent < 0.51 && matchVisualState !== 'halftime') { 
                    setVisualMatchMessage('Half-time! Teams are resting.', 'gray');
                    matchVisualState = 'halftime';
                    ballPos = { x: soccerVisualCanvas.width / 2, y: soccerVisualCanvas.height / 2 }; 
                    ballVelocity = { x: 0, y: 0 }; // Stop ball during half-time
                    setNewPlayerTargets(); // Reset players for second half
                    setTimeout(() => {
                        setVisualMatchMessage('Second half begins!', '#333');
                        matchVisualState = 'playing';
                    }, 2000); 
                } else if (timeElapsedPercent < 0.05 && matchVisualState === 'pre_kickoff') {
                    setVisualMatchMessage('Kick-off!', '#333');
                    matchVisualState = 'playing';
                }
                if (matchVisualState === 'playing' && !visualMatchMessage.innerHTML.includes("GOAL!")) { // Only update if not showing goal message
                    setVisualMatchMessage('Match in progress...', '#333');
                }


                soccerAnimationId = requestAnimationFrame(animateSoccerMatch);
            }

            // Enhanced `determineMatchOutcome` for 20% win rate
            function determineMatchOutcome() {
                const odds = currentSelectedSoccerMatch.odds;
                
                let outcomeProbs = {
                    home: 1 / odds.home,
                    draw: 1 / odds.draw,
                    away: 1 / odds.away,
                    over1_5: 1 / odds.over1_5,
                    under1_5: 1 / odds.under1_5,
                    btts_yes: 1 / odds.btts_yes,
                    btts_no: 1 / odds.btts_no
                };

                // Determine if user's bet wins based on WIN_RATE
                const userBetWins = Math.random() < WIN_RATE;

                // Simulate goals to match the win/loss condition
                let finalHomeGoals = 0;
                let finalAwayGoals = 0;

                if (userBetWins && selectedSoccerOutcome) {
                    // Force the outcome to be the selected one
                    switch (selectedSoccerOutcome) {
                        case 'home':
                            finalHomeGoals = Math.floor(Math.random() * 3) + 1; // 1-3 goals
                            finalAwayGoals = Math.max(0, Math.floor(Math.random() * finalHomeGoals * 0.5)); // ensure home win
                            break;
                        case 'away':
                            finalAwayGoals = Math.floor(Math.random() * 3) + 1;
                            finalHomeGoals = Math.max(0, Math.floor(Math.random() * finalAwayGoals * 0.5)); // ensure away win
                            break;
                        case 'draw':
                            finalHomeGoals = Math.floor(Math.random() * 2); // 0 or 1
                            finalAwayGoals = finalHomeGoals;
                            if (finalHomeGoals === 0 && Math.random() < 0.5) { finalHomeGoals = 1; finalAwayGoals = 1; } // ensure at least 1-1 sometimes
                            break;
                        case 'over1_5':
                            finalHomeGoals = Math.floor(Math.random() * 2) + 1; // at least 1
                            finalAwayGoals = Math.floor(Math.random() * 2) + 1; // at least 1, total >= 2
                            if (finalHomeGoals + finalAwayGoals < 2) { finalHomeGoals++; finalAwayGoals++;} // ensure at least 2 goals
                            break;
                        case 'under1_5':
                            finalHomeGoals = Math.random() < 0.5 ? 0 : 1;
                            finalAwayGoals = Math.random() < 0.5 ? 0 : 1;
                            if (finalHomeGoals + finalAwayGoals > 1) { // Force under 1.5
                                if (Math.random() < 0.5) finalHomeGoals = 0; else finalAwayGoals = 0;
                                if (finalHomeGoals > 1) finalHomeGoals = 1; if (finalAwayGoals > 1) finalAwayGoals = 1;
                            }
                            if (finalHomeGoals + finalAwayGoals > 1) {finalHomeGoals = 0; finalAwayGoals=0;}
                            break;
                        case 'btts_yes':
                            finalHomeGoals = Math.floor(Math.random() * 2) + 1;
                            finalAwayGoals = Math.floor(Math.random() * 2) + 1;
                            break;
                        case 'btts_no':
                            if (Math.random() < 0.5) { // One team scores, other doesn't
                                finalHomeGoals = Math.floor(Math.random() * 3) + 1;
                                finalAwayGoals = 0;
                            } else {
                                finalHomeGoals = 0;
                                finalAwayGoals = Math.floor(Math.random() * 3) + 1;
                            }
                            break;
                    }
                } else {
                    // Force a losing scenario
                    let possibleLosingScores = [];
                    // This is a simplified approach to generate a losing score.
                    // A more complex system would map `selectedSoccerOutcome` to `possibleLosingScores`
                    // For now, generating a random score that's likely to be a loss.
                    const outcomeTypes = ['home', 'away', 'draw', 'over1_5', 'under1_5', 'btts_yes', 'btts_no'];
                    let actualOutcome = outcomeTypes[Math.floor(Math.random() * outcomeTypes.length)];

                    // Ensure the actualOutcome is NOT the selected one if a selection was made.
                    if (selectedSoccerOutcome && actualOutcome === selectedSoccerOutcome) {
                         // Pick a different one
                        let newActualOutcome;
                        do {
                            newActualOutcome = outcomeTypes[Math.floor(Math.random() * outcomeTypes.length)];
                        } while (newActualOutcome === selectedSoccerOutcome);
                        actualOutcome = newActualOutcome;
                    }

                    switch (actualOutcome) {
                        case 'home': finalHomeGoals = Math.floor(Math.random() * 3) + 1; finalAwayGoals = Math.max(0, Math.floor(Math.random() * finalHomeGoals)); break;
                        case 'away': finalAwayGoals = Math.floor(Math.random() * 3) + 1; finalHomeGoals = Math.max(0, Math.floor(Math.random() * finalAwayGoals)); break;
                        case 'draw': finalHomeGoals = Math.floor(Math.random() * 2); finalAwayGoals = finalHomeGoals; break;
                        case 'over1_5': finalHomeGoals = Math.random() < 0.5 ? 1 : 0; finalAwayGoals = 1 - finalHomeGoals; if(finalHomeGoals + finalAwayGoals < 2 && Math.random()<0.5) {finalHomeGoals++;} break; // Ensure <= 1 goal or small chance of 2-0/0-2
                        case 'under1_5': finalHomeGoals = Math.floor(Math.random() * 2) + 1; finalAwayGoals = Math.floor(Math.random() * 2) + 1; if(finalHomeGoals + finalAwayGoals < 2 && Math.random()<0.5) {finalHomeGoals++;} break;
                        case 'btts_yes': finalHomeGoals = 0; finalAwayGoals = Math.floor(Math.random() * 3) + 1; break; // One team scores, other doesn't
                        case 'btts_no': finalHomeGoals = Math.floor(Math.random() * 2) + 1; finalAwayGoals = Math.floor(Math.random() * 2) + 1; break;
                    }
                }

                // Generate goal events based on the final scores
                goalEvents = [];
                for (let i = 0; i < finalHomeGoals; i++) {
                    const goalTimeMs = Math.random() * SOCCER_ANIMATION_DURATION_MS * (Math.random() < 0.5 ? 0.45 : 1);
                    goalEvents.push({ time: goalTimeMs, team: 'home' });
                }
                for (let i = 0; i < finalAwayGoals; i++) {
                    const goalTimeMs = Math.random() * SOCCER_ANIMATION_DURATION_MS * (Math.random() < 0.5 ? 0.45 : 1);
                    goalEvents.push({ time: goalTimeMs, team: 'away' });
                }
                goalEvents.sort((a, b) => a.time - b.time); 

                return { homeGoals: finalHomeGoals, awayGoals: finalAwayGoals };
            }


            function startSoccerMatchSimulation() {
                if (currentBetAmountSoccer === 0) {
                    setSoccerGameMessage("Please place a bet first.", 'red');
                    return;
                }
                if (!selectedSoccerOutcome) {
                    setSoccerGameMessage("Please select an outcome (Home Win, Draw, Away Win, Over/Under, BTTS).", 'red');
                    return;
                }

                simulateMatchButton.disabled = true;
                placeSoccerBetButton.disabled = true;
                soccerBetAmountInput.disabled = true;
                betOptionButtons.forEach(btn => btn.disabled = true); 
                setSoccerGameMessage("Simulating match... please wait.", 'blue');
                visualSoccerGame.classList.remove('win-glow', 'lose-glow', 'draw-glow');

                homeScore = 0; 
                awayScore = 0;
                matchScoreDisplay.textContent = '0 - 0'; 

                const simulatedResult = determineMatchOutcome(); // This now prepares goalEvents and returns score info
                homeScore = simulatedResult.homeGoals; // Update actual scores for display/commentary
                awayScore = simulatedResult.awayGoals;

                soccerMatchStartTime = null; 
                matchVisualState = 'pre_kickoff'; 
                requestAnimationFrame(animateSoccerMatch);
            }

            function handleSoccerMatchResult(finalHomeScore, finalAwayScore) {
                matchScoreDisplay.textContent = `${finalHomeScore} - ${finalAwayScore}`; 

                let predictionCorrect = false;
                let oddsMultiplier = 0;

                let actualOutcomePrimary;
                if (finalHomeScore > finalAwayScore) {
                    actualOutcomePrimary = 'home';
                } else if (finalHomeScore < finalAwayScore) {
                    actualOutcomePrimary = 'away';
                } else {
                    actualOutcomePrimary = 'draw';
                }

                let actualOutcomeOverUnder;
                const totalGoals = finalHomeScore + finalAwayScore;
                if (totalGoals > 1.5) {
                    actualOutcomeOverUnder = 'over1_5';
                } else {
                    actualOutcomeOverUnder = 'under1_5';
                }

                let actualOutcomeBtts;
                if (finalHomeScore > 0 && finalAwayScore > 0) {
                    actualOutcomeBtts = 'btts_yes';
                } else {
                    actualOutcomeBtts = 'btts_no';
                }

                if (['home', 'draw', 'away'].includes(selectedSoccerOutcome)) {
                    if (selectedSoccerOutcome === actualOutcomePrimary) {
                        predictionCorrect = true;
                        oddsMultiplier = currentSelectedSoccerMatch.odds[selectedSoccerOutcome];
                    }
                } else if (['over1_5', 'under1_5'].includes(selectedSoccerOutcome)) {
                    if (selectedSoccerOutcome === actualOutcomeOverUnder) {
                        predictionCorrect = true;
                        oddsMultiplier = currentSelectedSoccerMatch.odds[selectedSoccerOutcome];
                    }
                } else if (['btts_yes', 'btts_no'].includes(selectedSoccerOutcome)) {
                    if (selectedSoccerOutcome === actualOutcomeBtts) {
                        predictionCorrect = true;
                        oddsMultiplier = currentSelectedSoccerMatch.odds[selectedSoccerOutcome];
                    }
                }

                if (predictionCorrect) {
                    const winnings = currentBetAmountSoccer * oddsMultiplier;
                    currentBalance += winnings; 
                    setSoccerGameMessage(`CONGRATULATIONS! Your bet on ${selectedSoccerOutcome.replace('_', ' ').toUpperCase()} was correct! You won ₦${winnings.toLocaleString()}!`, 'green');
                    visualSoccerGame.classList.add('win-glow');
                    lastMatchResult.betWon = true; 
                } else {
                    setSoccerGameMessage(`BET LOST! The match result was ${finalHomeScore} - ${finalAwayScore}. Your bet of ₦${currentBetAmountSoccer.toLocaleString()} was deducted. Current balance: ₦${currentBalance.toLocaleString()}.`, 'red'); 
                    visualSoccerGame.classList.add('lose-glow');
                    if (actualOutcomePrimary === 'draw') { 
                        visualSoccerGame.classList.add('draw-glow');
                    }
                    lastMatchResult.betWon = false; 
                }
                updateBalanceDisplay(); 

                // Store full match result for LLM commentary
                lastMatchResult = {
                    homeTeam: currentSelectedSoccerMatch.homeTeam,
                    awayTeam: currentSelectedSoccerMatch.awayTeam,
                    homeScore: finalHomeScore,
                    awayScore: finalAwayScore,
                    selectedOutcome: selectedSoccerOutcome,
                    betWon: predictionCorrect,
                    betAmount: currentBetAmountSoccer
                };
                llmCommentarySection.style.display = 'block'; 
                getCommentaryBtn.disabled = false; 
                placeNewBetBtn.style.display = 'inline-flex'; 
            }

            // --- Coin Flip Game Logic ---
            function placeCoinFlipBet() {
                const bet = parseFloat(coinFlipBetAmountInput.value);
                if (isNaN(bet) || bet < 100) {
                    setCoinFlipMessage("Minimum bet is ₦100.", 'red');
                    return;
                }
                if (bet > currentBalance) {
                    setCoinFlipMessage("Insufficient balance. Please make a deposit.", 'red');
                    showPaymentOverlay(bet, 'coinFlip');
                    return;
                }
                
                currentBalance -= bet;
                updateBalanceDisplay();
                currentBetAmountCoinFlip = bet;
                setCoinFlipMessage(`Bet of ₦${currentBetAmountCoinFlip.toLocaleString()} placed! Now choose Heads or Tails.`);
                
                placeCoinFlipBetButton.disabled = true;
                coinFlipBetAmountInput.disabled = true;
                betHeadsButton.disabled = false;
                betTailsButton.disabled = false;
                flipCoinButton.disabled = true; 
            }

            function selectCoinOutcome(outcome) {
                selectedCoinOutcome = outcome;
                betHeadsButton.classList.remove('selected');
                betTailsButton.classList.remove('selected');
                if (outcome === 'heads') {
                    betHeadsButton.classList.add('selected');
                } else {
                    betTailsButton.classList.add('selected');
                }
                flipCoinButton.disabled = false;
                setCoinFlipMessage(`You selected ${outcome.toUpperCase()}. Click Flip Coin!`);
            }

            function flipCoin() {
                if (currentBetAmountCoinFlip === 0 || !selectedCoinOutcome) {
                    setCoinFlipMessage("Please place your bet and select an outcome first.", 'red');
                    return;
                }

                flipCoinButton.disabled = true;
                betHeadsButton.disabled = true;
                betTailsButton.disabled = true;
                coinFlipGame.classList.remove('win-glow', 'lose-glow');
                setCoinFlipMessage("Flipping coin... <i class='fas fa-spinner fa-spin'></i>", 'blue');
                coinDisplay.classList.add('flipping');

                setTimeout(() => {
                    // Determine result based on WIN_RATE
                    const actualResult = Math.random() < WIN_RATE ? selectedCoinOutcome : (selectedCoinOutcome === 'heads' ? 'tails' : 'heads');
                    
                    coinDisplay.innerHTML = `<i class="fas fa-coins"></i> ${actualResult.toUpperCase()}`; 
                    coinDisplay.classList.remove('flipping');
                    
                    let won = false;
                    let message = "";
                    let multiplier = 2; 

                    if (selectedCoinOutcome === actualResult) {
                        won = true;
                        const winnings = currentBetAmountCoinFlip * multiplier;
                        currentBalance += winnings;
                        message = `You won! It's ${actualResult.toUpperCase()}! You won ₦${winnings.toLocaleString()}!`;
                        setCoinFlipMessage(message, 'green');
                        coinFlipGame.classList.add('win-glow');
                    } else {
                        message = `You lost! It's ${actualResult.toUpperCase()}. Your bet of ₦${currentBetAmountCoinFlip.toLocaleString()} was deducted. Current balance: ₦${currentBalance.toLocaleString()}.`;
                        setCoinFlipMessage(message, 'red');
                        coinFlipGame.classList.add('lose-glow');
                    }
                    updateBalanceDisplay();
                    
                    // Reset for new bet
                    placeCoinFlipBetButton.disabled = false;
                    coinFlipBetAmountInput.disabled = false;
                    selectedCoinOutcome = null; 
                    betHeadsButton.classList.remove('selected');
                    betTailsButton.classList.remove('selected');
                    currentBetAmountCoinFlip = 0; 
                    flipCoinButton.disabled = true; 
                    betHeadsButton.disabled = true;
                    betTailsButton.disabled = true;
                }, 1500); 
            }

            // --- Virtual Slot Machine Game Logic ---
            let isSlotSpinning = false;

            function placeSlotBet() {
                const bet = parseFloat(slotMachineBetAmountInput.value);
                if (isNaN(bet) || bet < 50) {
                    setSlotMachineMessage("Minimum bet is ₦50.", 'red');
                    return;
                }
                if (bet > currentBalance) {
                    setSlotMachineMessage("Insufficient balance. Please make a deposit.", 'red');
                    showPaymentOverlay(bet, 'slotMachine');
                    return;
                }
                
                currentBalance -= bet;
                updateBalanceDisplay();
                currentBetAmountSlotMachine = bet;
                setSlotMachineMessage(`Bet of ₦${currentBetAmountSlotMachine.toLocaleString()} placed! Click Spin Reels!`);
                
                placeSlotBetButton.disabled = true;
                slotMachineBetAmountInput.disabled = true;
                spinSlotButton.disabled = false;
            }

            function spinReels() {
                if (isSlotSpinning || currentBetAmountSlotMachine === 0) return;

                isSlotSpinning = true;
                spinSlotButton.disabled = true;
                placeSlotBetButton.disabled = true;
                slotMachineBetAmountInput.disabled = true;
                slotMachineGame.classList.remove('win-glow', 'lose-glow');
                setSlotMachineMessage("Spinning... Good luck! <i class='fas fa-spinner fa-spin'></i>", 'blue');

                reel1.classList.add('spinning');
                reel2.classList.add('spinning');
                reel3.classList.add('spinning');

                const reelValues = [];
                let stopTime1 = Math.random() * 500 + 1500; 
                let stopTime2 = Math.random() * 500 + 2000; 
                let stopTime3 = Math.random() * 500 + 2500; 

                let reelIntervals = [
                    setInterval(() => reel1.textContent = slotSymbols[Math.floor(Math.random() * slotSymbols.length)], 50),
                    setInterval(() => reel2.textContent = slotSymbols[Math.floor(Math.random() * slotSymbols.length)], 50),
                    setInterval(() => reel3.textContent = slotSymbols[Math.floor(Math.random() * slotSymbols.length)], 50)
                ];

                // Determine results based on WIN_RATE before stopping
                const isWinningSpin = Math.random() < WIN_RATE;
                let finalReelResults = [];
                if (isWinningSpin) {
                    // Force a win scenario (e.g., three of a kind)
                    const winningSymbol = slotSymbols[Math.floor(Math.random() * slotSymbols.length)];
                    finalReelResults = [winningSymbol, winningSymbol, winningSymbol];
                } else {
                    // Force a losing scenario (no match or only two match)
                    let tempSymbols = [...slotSymbols]; 
                    finalReelResults[0] = tempSymbols[Math.floor(Math.random() * tempSymbols.length)];
                    tempSymbols.splice(tempSymbols.indexOf(finalReelResults[0]), 1); 
                    finalReelResults[1] = tempSymbols[Math.floor(Math.random() * tempSymbols.length)];
                    tempSymbols = [...slotSymbols]; 
                    finalReelResults[2] = tempSymbols[Math.floor(Math.random() * tempSymbols.length)];

                    // Ensure it's not a 3-of-a-kind unless winningSpin was true
                    if (finalReelResults[0] === finalReelResults[1] && finalReelResults[1] === finalReelResults[2]) {
                        finalReelResults[2] = slotSymbols.find(s => s !== finalReelResults[0]);
                        if (!finalReelResults[2]) { 
                            finalReelResults[2] = slotSymbols[(slotSymbols.indexOf(finalReelResults[0]) + 1) % slotSymbols.length];
                        }
                    }
                }


                setTimeout(() => {
                    clearInterval(reelIntervals[0]);
                    reel1.classList.remove('spinning');
                    reel1.textContent = finalReelResults[0];
                }, stopTime1);

                setTimeout(() => {
                    clearInterval(reelIntervals[1]);
                    reel2.classList.remove('spinning');
                    reel2.textContent = finalReelResults[1];
                }, stopTime2);

                setTimeout(() => {
                    clearInterval(reelIntervals[2]);
                    reel3.classList.remove('spinning');
                    reel3.textContent = finalReelResults[2];
                    
                    isSlotSpinning = false;
                    handleSlotResult(finalReelResults);
                    // Reset for new bet
                    placeSlotBetButton.disabled = false;
                    slotMachineBetAmountInput.disabled = false;
                    currentBetAmountSlotMachine = 0; 
                }, stopTime3);
            }

            function handleSlotResult(results) {
                let winnings = 0;
                let message = "";
                let win = false;

                if (results[0] === results[1] && results[1] === results[2]) {
                    // All three match
                    winnings = currentBetAmountSlotMachine * 10; 
                    message = `JACKPOT! Three ${results[0]}! You won ₦${winnings.toLocaleString()}!`;
                    win = true;
                } else if (results[0] === results[1] || results[1] === results[2] || results[0] === results[2]) {
                    // Two match
                    winnings = currentBetAmountSlotMachine * 2; 
                    message = `Nice! Two matching symbols! You won ₦${winnings.toLocaleString()}!`;
                    win = true;
                } else {
                    // No match
                    winnings = 0;
                    message = `No match. Your bet of ₦${currentBetAmountSlotMachine.toLocaleString()} was deducted. Current balance: ₦${currentBalance.toLocaleString()}.`;
                    win = false;
                }

                if (win) {
                    currentBalance += winnings;
                    setSlotMachineMessage(message, 'green');
                    slotMachineGame.classList.add('win-glow');
                } else {
                    setSlotMachineMessage(message, 'red');
                    slotMachineGame.classList.add('lose-glow');
                }
                updateBalanceDisplay();
            }

            // --- Spin 2 Win Game Logic ---
            const spin2WinSegments = [
                { text: "⭐ Win x5", color: "#FFD700", value: 5, type: 'win', probability: 0.05 },
                { text: "💎 Win x3", color: "#00BCD4", value: 3, type: 'win', probability: 0.05 },
                { text: "🍒 Win x2", color: "#F44336", value: 2, type: 'win', probability: 0.10 },
                { text: "Try Again", color: "#B0BEC5", value: 0, type: 'lose', probability: 0.20 },
                { text: "No Luck", color: "#607D8B", value: 0, type: 'lose', probability: 0.20 },
                { text: "Next Time", color: "#795548", value: 0, type: 'lose', probability: 0.20 },
                { text: "Lost Bet", color: "#212121", value: 0, type: 'lose', probability: 0.20 }
            ];
            const numSegmentsSpin2Win = spin2WinSegments.length;
            const arcSpin2Win = (2 * Math.PI) / numSegmentsSpin2Win;
            const wheelRadiusSpin2Win = spin2WinCanvas.width / 2 - 10;

            function drawSpin2WinWheel(currentRotation = 0) {
                const centerX = spin2WinCanvas.width / 2;
                const centerY = spin2WinCanvas.height / 2;

                spin2WinCtx.clearRect(0, 0, spin2WinCanvas.width, spin2WinCanvas.height);
                spin2WinCtx.save();
                spin2WinCtx.translate(centerX, centerY);
                spin2WinCtx.rotate(currentRotation);

                spin2WinSegments.forEach((segment, i) => {
                    const startAngle = arcSpin2Win * i;
                    const endAngle = startAngle + arcSpin2Win;
                    spin2WinCtx.beginPath();
                    spin2WinCtx.arc(0, 0, wheelRadiusSpin2Win, startAngle, endAngle);
                    spin2WinCtx.lineTo(0, 0);
                    spin2WinCtx.fillStyle = segment.color;
                    spin2WinCtx.fill();
                    spin2WinCtx.strokeStyle = "#ccc";
                    spin2WinCtx.lineWidth = 1;
                    spin2WinCtx.stroke();

                    spin2WinCtx.save();
                    const textAngle = startAngle + arcSpin2Win / 2;
                    spin2WinCtx.rotate(textAngle);
                    spin2WinCtx.textAlign = "right";
                    spin2WinCtx.fillStyle = "#333";
                    spin2WinCtx.font = "bold 18px Inter";
                    spin2WinCtx.fillText(segment.text, wheelRadiusSpin2Win - 20, 0);
                    spin2WinCtx.restore();
                });

                spin2WinCtx.restore();

                spin2WinCtx.beginPath();
                spin2WinCtx.moveTo(centerX, centerY - wheelRadiusSpin2Win - 20);
                spin2WinCtx.lineTo(centerX - 15, centerY - wheelRadiusSpin2Win - 5);
                spin2WinCtx.lineTo(centerX + 15, centerY - wheelRadiusSpin2Win - 5);
                spin2WinCtx.closePath();
                spin2WinCtx.fillStyle = "#333";
                spin2WinCtx.fill();
            }

            let spin2WinAnimationId;
            let spin2WinStartTime;
            const SPIN2WIN_DURATION = 4000; 

            function animateSpin2WinFixedDuration(currentTime) {
                if (!spin2WinStartTime) spin2WinStartTime = currentTime;
                const elapsedTime = currentTime - spin2WinStartTime;

                if (elapsedTime >= SPIN2WIN_DURATION) {
                    isSpin2WinSpinning = false;
                    cancelAnimationFrame(spin2WinAnimationId);
                    spin2WinRotation = targetFinalSpin2WinRotation;
                    drawSpin2WinWheel(spin2WinRotation);
                    const segmentIndexAtPointer = getSegmentIndexFromRotation(spin2WinRotation, numSegmentsSpin2Win, arcSpin2Win);
                    handleSpin2WinResult(spin2WinSegments[segmentIndexAtPointer]);
                    spin2WinStartTime = null;
                    return;
                }

                const progress = elapsedTime / SPIN2WIN_DURATION;
                const easedProgress = 1 - Math.pow(1 - progress, 3);
                
                const totalAngleDelta = targetFinalSpin2WinRotation - initialSpin2WinRotationAtSpinStart;
                spin2WinRotation = initialSpin2WinRotationAtSpinStart + totalAngleDelta * easedProgress;

                drawSpin2WinWheel(spin2WinRotation);
                spin2WinAnimationId = requestAnimationFrame(animateSpin2WinFixedDuration);
            }

            let targetFinalSpin2WinRotation = 0;
            let initialSpin2WinRotationAtSpinStart = 0;

            function startSpin2Win() {
                if (isSpin2WinSpinning || currentBetAmountSpin2Win === 0) return;

                if (currentBalance < currentBetAmountSpin2Win) {
                    showPaymentOverlay(currentBetAmountSpin2Win, 'spin2Win'); 
                    return;
                }
                currentBalance -= currentBetAmountSpin2Win;
                updateBalanceDisplay();

                isSpin2WinSpinning = true;
                spin2WinButton.disabled = true;
                placeSpin2WinBetButton.disabled = true;
                spin2WinBetAmountInput.disabled = true;
                spin2WinGame.classList.remove('win-glow', 'lose-glow');

                setSpin2WinMessage("Wheel spinning... Good luck!");

                // Determine target segment based on WIN_RATE for Spin 2 Win
                let targetSegment = null;
                const isWinningSpin = Math.random() < WIN_RATE;

                const winningSegmentsPool = spin2WinSegments.filter(s => s.type === 'win');
                const losingSegmentsPool = spin2WinSegments.filter(s => s.type === 'lose');

                if (isWinningSpin && winningSegmentsPool.length > 0) {
                    targetSegment = winningSegmentsPool[Math.floor(Math.random() * winningSegmentsPool.length)];
                } else if (losingSegmentsPool.length > 0) {
                    targetSegment = losingSegmentsPool[Math.floor(Math.random() * losingSegmentsPool.length)];
                } else {
                    targetSegment = spin2WinSegments[Math.floor(Math.random() * numSegmentsSpin2Win)];
                }

                const targetSegmentIndex = spin2WinSegments.indexOf(targetSegment);

                const angleToAlign = (3 * Math.PI / 2) - (targetSegmentIndex * arcSpin2Win + arcSpin2Win / 2);
                const normalizedAngleToAlign = (angleToAlign + 2 * Math.PI) % (2 * Math.PI);
                
                const fullSpinsToAdd = Math.floor(Math.random() * 7) + 6; 
                targetFinalSpin2WinRotation = spin2WinRotation + (fullSpinsToAdd * 2 * Math.PI) + normalizedAngleToAlign;

                initialSpin2WinRotationAtSpinStart = spin2WinRotation;
                spin2WinStartTime = null; 
                requestAnimationFrame(animateSpin2WinFixedDuration);
            }

            function handleSpin2WinResult(segment) {
                if (segment.type === 'win') {
                    const winnings = currentBetAmountSpin2Win * segment.value;
                    currentBalance += winnings;
                    setSpin2WinMessage(`You won ${segment.text}! You got ₦${winnings.toLocaleString()}!`, 'green');
                    spin2WinGame.classList.add('win-glow');
                } else {
                    setSpin2WinMessage(`You landed on ${segment.text}. Your bet of ₦${currentBetAmountSpin2Win.toLocaleString()} was deducted. Current balance: ₦${currentBalance.toLocaleString()}.`, 'red'); 
                    spin2WinGame.classList.add('lose-glow');
                }
                updateBalanceDisplay();

                spin2WinButton.disabled = true;
                placeSpin2WinBetButton.disabled = false;
                spin2WinBetAmountInput.disabled = false;
            }


            // --- Payment Overlay ---
            function showPaymentOverlay(suggestedAmount = 5000, gameId = null) {
                lastRequestedPaymentAmount = suggestedAmount; 
                gameBetPendingPayment = gameId; 
                
                depositAmountInput.value = Math.max(1000, Math.min(1000000, suggestedAmount)); 
                const event = new Event('input', { bubbles: true });
                depositAmountInput.dispatchEvent(event);

                paymentOverlay.style.display = 'flex';
                paymentStatusMessage.innerHTML = "Enter amount and confirm payment.";
                paymentStatusMessage.style.color = "grey";
                
                setAllGameControlsEnabled(false); 

                // Ensure buttons are reset to original state when opening overlay
                confirmPaymentButton.innerHTML = `<i class="fas fa-check-circle"></i> Auto-Authenticate Payment`; 
                simulateSuccessBtn.innerHTML = `<i class="fas fa-money-check-alt"></i> Simulate Successful Deposit`;
                simulateFailBtn.innerHTML = `<i class="fas fa-exclamation-triangle"></i> Simulate Failed Deposit`;
                confirmPaymentButton.disabled = false; 
                simulateSuccessBtn.disabled = false;
                simulateFailBtn.disabled = false;
                cancelPaymentButton.disabled = false;
            }
            
            let originalConfirmBtnHtml = '';
            let originalSimulateSuccessBtnHtml = '';
            let originalSimulateFailBtnHtml = '';

            function simulatePaymentAuthentication(forcedOutcome = null, clickedButton = null) {
                const amountToDeposit = parseFloat(depositAmountInput.value);

                if (isNaN(amountToDeposit) || amountToDeposit < 1000 || amountToDeposit > 1000000) {
                    paymentStatusMessage.textContent = "Please enter a valid deposit amount (₦1,000 - ₦1,000,000).";
                    paymentStatusMessage.style.color = "red";
                    // Only re-enable buttons if input is bad, user needs to fix it
                    confirmPaymentButton.disabled = false;
                    simulateSuccessBtn.disabled = false;
                    simulateFailBtn.disabled = false;
                    cancelPaymentButton.disabled = false; 
                    return;
                }

                // Store original button HTML before changing
                originalConfirmBtnHtml = confirmPaymentButton.innerHTML;
                originalSimulateSuccessBtnHtml = simulateSuccessBtn.innerHTML;
                originalSimulateFailBtnHtml = simulateFailBtn.innerHTML;

                // Disable all payment buttons during authentication
                confirmPaymentButton.disabled = true;
                simulateSuccessBtn.disabled = true;
                simulateFailBtn.disabled = true;
                cancelPaymentButton.disabled = true;

                paymentStatusMessage.innerHTML = "Authenticating payment... Please wait <i class='fas fa-spinner fa-spin'></i>";
                paymentStatusMessage.style.color = "blue";
                
                // Show spinner only on the button that was actually clicked
                if (clickedButton) {
                    clickedButton.innerHTML = `<i class="fas fa-spinner fa-spin"></i> Authenticating...`;
                }

                setTimeout(() => {
                    let transferSuccessful;
                    if (forcedOutcome === 'success') {
                        transferSuccessful = true;
                    } else if (forcedOutcome === 'failure') {
                        transferSuccessful = false;
                    } else { 
                        transferSuccessful = Math.random() < 0.7; 
                    }

                    // Restore button texts and re-enable them BEFORE hiding the overlay
                    confirmPaymentButton.innerHTML = originalConfirmBtnHtml;
                    simulateSuccessBtn.innerHTML = originalSimulateSuccessBtnHtml;
                    simulateFailBtn.innerHTML = originalSimulateFailBtnHtml;
                    confirmPaymentButton.disabled = false; 
                    simulateSuccessBtn.disabled = false;
                    simulateFailBtn.disabled = false;
                    cancelPaymentButton.disabled = false; 

                    if (transferSuccessful) {
                        currentBalance += amountToDeposit; 
                        updateBalanceDisplay();
                        setGameMessage("Payment successful! Balance updated. You can now place your bet.", 'green');
                        setSoccerGameMessage("Payment successful! Balance updated. You can now place your bet.", 'green');
                        setVisualMatchMessage("Payment successful! Balance updated.", 'green'); 
                        setCoinFlipMessage("Payment successful! Balance updated.", 'green'); 
                        setSlotMachineMessage("Payment successful! Balance updated.", 'green'); 
                        setSpin2WinMessage("Payment successful! Balance updated.", 'green'); 
                        paymentStatusMessage.textContent = `Payment successful! ₦${amountToDeposit.toLocaleString()} added. Balance updated.`;
                        paymentStatusMessage.style.color = "green";

                        // Automatically proceed with game bet if payment was requested for a specific game
                        if (gameBetPendingPayment === 'visualSoccer') {
                            const betToPlace = lastRequestedPaymentAmount;
                            if (currentBalance >= betToPlace) { 
                                currentBalance -= betToPlace;
                                updateBalanceDisplay();
                                currentBetAmountSoccer = betToPlace;
                                placeSoccerBetButton.disabled = true;
                                soccerBetAmountInput.disabled = true;
                                betOptionButtons.forEach(btn => btn.disabled = false); 
                                setSoccerGameMessage(`Bet of ₦${currentBetAmountSoccer.toLocaleString()} placed! Now select your outcome.`);
                                if (selectedSoccerOutcome) {
                                    simulateMatchButton.disabled = false;
                                }
                            } else {
                                setSoccerGameMessage("Funds added, but still not enough for your last intended bet. Please try again.", 'red');
                            }
                        } else if (gameBetPendingPayment === 'spinTheWheel') {
                            const betToPlace = lastRequestedPaymentAmount;
                             if (currentBalance >= betToPlace) { 
                                currentBalance -= betToPlace;
                                updateBalanceDisplay();
                                currentBetAmountSpinWheel = betToPlace;
                                spinButton.disabled = false; 
                                placeBetButton.disabled = true;
                                betAmountInput.disabled = true;
                                setGameMessage(`Bet of ₦${currentBetAmountSpinWheel.toLocaleString()} placed! Click SPIN.`);
                             } else {
                                setGameMessage("Funds added, but still not enough for your last intended bet. Please try again.", 'red');
                             }
                        } else if (gameBetPendingPayment === 'coinFlip') { 
                            const betToPlace = lastRequestedPaymentAmount;
                            if (currentBalance >= betToPlace) {
                                currentBalance -= betToPlace;
                                updateBalanceDisplay();
                                currentBetAmountCoinFlip = betToPlace;
                                placeCoinFlipBetButton.disabled = true;
                                coinFlipBetAmountInput.disabled = true;
                                betHeadsButton.disabled = false;
                                betTailsButton.disabled = false;
                                setCoinFlipMessage(`Bet of ₦${currentBetAmountCoinFlip.toLocaleString()} placed! Now choose Heads or Tails.`);
                                if (selectedCoinOutcome) {
                                    flipCoinButton.disabled = false;
                                }
                            } else {
                                setCoinFlipMessage("Funds added, but still not enough for your last intended bet. Please try again.", 'red');
                            }
                        } else if (gameBetPendingPayment === 'slotMachine') { 
                            const betToPlace = lastRequestedPaymentAmount;
                            if (currentBalance >= betToPlace) {
                                currentBalance -= betToPlace;
                                updateBalanceDisplay();
                                currentBetAmountSlotMachine = betToPlace;
                                placeSlotBetButton.disabled = true;
                                slotMachineBetAmountInput.disabled = true;
                                spinSlotButton.disabled = false;
                                setSlotMachineMessage(`Bet of ₦${currentBetAmountSlotMachine.toLocaleString()} placed! Click Spin Reels!`);
                            } else {
                                setSlotMachineMessage("Funds added, but still not enough for your last intended bet. Please try again.", 'red');
                            }
                        } else if (gameBetPendingPayment === 'spin2Win') { 
                            const betToPlace = lastRequestedPaymentAmount;
                            if (currentBalance >= betToPlace) {
                                currentBalance -= betToPlace;
                                updateBalanceDisplay();
                                currentBetAmountSpin2Win = betToPlace;
                                placeSpin2WinBetButton.disabled = true;
                                spin2WinBetAmountInput.disabled = true;
                                spin2WinButton.disabled = false;
                                setSpin2WinMessage(`Bet of ₦${currentBetAmountSpin2Win.toLocaleString()} placed! Click SPIN 2 WIN!`);
                            } else {
                                setSpin2WinMessage("Funds added, but still not enough for your last intended bet. Please try again.", 'red');
                            }
                        }

                        // Only hide overlay if successful
                        paymentOverlay.style.display = 'none'; 
                    } else {
                        setGameMessage("Payment authentication failed. Please try again or contact support.", 'red');
                        setSoccerGameMessage("Payment authentication failed. Please try again or contact support.", 'red');
                        setVisualMatchMessage("Payment authentication failed.", 'red'); 
                        setCoinFlipMessage("Payment authentication failed. Please try again or contact support.", 'red'); 
                        setSlotMachineMessage("Payment authentication failed. Please try again or contact support.", 'red'); 
                        setSpin2WinMessage("Payment authentication failed. Please try again or contact support.", 'red'); 
                        paymentStatusMessage.textContent = "Payment failed. Please re-check details and try again.";
                        paymentStatusMessage.style.color = "red";
                        // If failed, do NOT hide the overlay. Keep it open for user to retry or cancel.
                    }
                    
                    gameBetPendingPayment = null; 

                    setAllGameControlsEnabled(true); 
                    refreshCurrentGameControlsState(); 
                }, 3000); 
            }

            // Function to enable/disable controls for all games and header actions
            function setAllGameControlsEnabled(enabled) {
                getCommentaryBtn.disabled = !enabled; 
                placeNewBetBtn.disabled = !enabled; 

                depositAmountInput.disabled = !enabled;
                withdrawalAmountInput.disabled = !enabled;
                bankNameInput.disabled = !enabled;
                accountNumberInput.disabled = !enabled;
                accountNameInput.disabled = !enabled;
                initiateWithdrawalButton.disabled = !enabled;

                depositFundsBtn.disabled = !enabled;
                withdrawFundsBtn.disabled = !enabled;

                userProfileInfo.style.pointerEvents = enabled ? 'auto' : 'none';

                // Also disable quick deposit buttons
                quickDepositButtons.forEach(btn => btn.disabled = !enabled);
            }

            // Function to specifically check if current game's betting controls should be disabled due to insufficient balance
            function checkAndDisableBettingControls(minBet, gameId) {
                if (currentBalance < minBet) {
                    if (gameId === 'spinTheWheel') {
                        placeBetButton.disabled = true;
                        betAmountInput.disabled = true;
                        spinButton.disabled = true;
                        setGameMessage("Insufficient balance. Please deposit funds.", 'red');
                    } else if (gameId === 'visualSoccer') {
                        placeSoccerBetButton.disabled = true;
                        soccerBetAmountInput.disabled = true;
                        simulateMatchButton.disabled = true;
                        betOptionButtons.forEach(btn => btn.disabled = true);
                        setSoccerGameMessage("Insufficient balance. Please deposit funds.", 'red');
                    } else if (gameId === 'coinFlip') { 
                        placeCoinFlipBetButton.disabled = true;
                        coinFlipBetAmountInput.disabled = true;
                        betHeadsButton.disabled = true;
                        betTailsButton.disabled = true;
                        flipCoinButton.disabled = true;
                        setCoinFlipMessage("Insufficient balance. Please deposit funds.", 'red');
                    } else if (gameId === 'slotMachine') { 
                        placeSlotBetButton.disabled = true;
                        slotMachineBetAmountInput.disabled = true;
                        spinSlotButton.disabled = true;
                        setSlotMachineMessage("Insufficient balance. Please deposit funds.", 'red');
                    } else if (gameId === 'spin2Win') { 
                        placeSpin2WinBetButton.disabled = true;
                        spin2WinBetAmountInput.disabled = true;
                        spin2WinButton.disabled = true;
                        setSpin2WinMessage("Insufficient balance. Please deposit funds.", 'red');
                    }
                } else {
                     if (gameId === 'spinTheWheel') {
                        if (currentBetAmountSpinWheel === 0) {
                            placeBetButton.disabled = false;
                            betAmountInput.disabled = false;
                            spinButton.disabled = true; 
                        } else {
                            placeBetButton.disabled = true;
                            betAmountInput.disabled = true;
                            spinButton.disabled = isSpinning;
                        }
                    } else if (gameId === 'visualSoccer') {
                        if (currentBetAmountSoccer === 0) {
                            placeSoccerBetButton.disabled = false;
                            soccerBetAmountInput.disabled = false;
                            betOptionButtons.forEach(btn => btn.disabled = true);
                            simulateMatchButton.disabled = true;
                        } else {
                            placeSoccerBetButton.disabled = true;
                            soccerBetAmountInput.disabled = true;
                            betOptionButtons.forEach(btn => btn.disabled = false);
                            simulateMatchButton.disabled = !selectedSoccerOutcome;
                        }
                    } else if (gameId === 'coinFlip') { 
                        if (currentBetAmountCoinFlip === 0) {
                            placeCoinFlipBetButton.disabled = false;
                            coinFlipBetAmountInput.disabled = false;
                            betHeadsButton.disabled = true;
                            betTailsButton.disabled = true;
                            flipCoinButton.disabled = true;
                        } else {
                            placeCoinFlipBetButton.disabled = true;
                            coinFlipBetAmountInput.disabled = true;
                            betHeadsButton.disabled = false;
                            betTailsButton.disabled = false;
                            flipCoinButton.disabled = !selectedCoinOutcome;
                        }
                    } else if (gameId === 'slotMachine') { 
                        if (currentBetAmountSlotMachine === 0) {
                            placeSlotBetButton.disabled = false;
                            slotMachineBetAmountInput.disabled = false;
                            spinSlotButton.disabled = true;
                        } else {
                            placeSlotBetButton.disabled = true;
                            slotMachineBetAmountInput.disabled = true;
                            spinSlotButton.disabled = isSlotSpinning;
                        }
                    } else if (gameId === 'spin2Win') { 
                        if (currentBetAmountSpin2Win === 0) {
                            placeSpin2WinBetButton.disabled = false;
                            spin2WinBetAmountInput.disabled = false;
                            spin2WinButton.disabled = true;
                        } else {
                            placeSpin2WinBetButton.disabled = true;
                            spin2WinBetAmountInput.disabled = true;
                            spin2WinButton.disabled = isSpin2WinSpinning;
                        }
                    }
                }
            }

            // Function to refresh the state of current game controls based on which game is active
            function refreshCurrentGameControlsState() {
                if (spinTheWheelGame.style.display === 'block') {
                    checkAndDisableBettingControls(parseFloat(betAmountInput.min), 'spinTheWheel');
                } else if (visualSoccerGame.style.display === 'block') {
                    checkAndDisableBettingControls(parseFloat(soccerBetAmountInput.min), 'visualSoccer');
                    if (lastMatchResult.homeTeam) { 
                        llmCommentarySection.style.display = 'block';
                        getCommentaryBtn.disabled = false;
                        placeNewBetBtn.style.display = 'inline-flex';
                    } else {
                        llmCommentarySection.style.display = 'none';
                        llmCommentaryDisplay.textContent = '';
                        getCommentaryBtn.disabled = true;
                        placeNewBetBtn.style.display = 'none';
                    }
                } else if (coinFlipGame.style.display === 'block') { 
                    checkAndDisableBettingControls(parseFloat(coinFlipBetAmountInput.min), 'coinFlip');
                } else if (slotMachineGame.style.display === 'block') { 
                    checkAndDisableBettingControls(parseFloat(slotMachineBetAmountInput.min), 'slotMachine');
                } else if (spin2WinGame.style.display === 'block') { 
                    checkAndDisableBettingControls(parseFloat(spin2WinBetAmountInput.min), 'spin2Win');
                }
            }


            // --- Withdrawal Logic ---
            function initiateWithdrawal() {
                const amount = parseFloat(withdrawalAmountInput.value);
                const bankName = bankNameInput.value.trim();
                const accountNumber = accountNumberInput.value.trim();
                const accountName = accountNameInput.value.trim();

                if (isNaN(amount) || amount <= 0) {
                    setWithdrawalMessage("Please enter a valid withdrawal amount.", 'red');
                    return;
                }
                if (amount < 1000) {
                    setWithdrawalMessage("Minimum withdrawal amount is ₦1,000.", 'red');
                    return;
                }
                if (amount > currentBalance) {
                    setWithdrawalMessage(`Insufficient balance. Your current balance is ₦${currentBalance.toLocaleString()}.`, 'red');
                    return;
                }
                if (!bankName || !accountNumber || !accountName) {
                    setWithdrawalMessage("All bank details fields are required.", 'red');
                    return;
                }
                if (accountNumber.length !== 10 || !/^\d+$/.test(accountNumber)) {
                    setWithdrawalMessage("Account number must be 10 digits.", 'red');
                    return;
                }
                const registeredAccountName = userName; 
                if (accountName.toUpperCase() !== registeredAccountName.toUpperCase()) {
                    setWithdrawalMessage(`Account Name must match your COREVEST Account Name (${registeredAccountName}).`, 'red');
                    return;
                }

                initiateWithdrawalButton.disabled = true;
                setWithdrawalMessage("Processing withdrawal... Please wait <i class='fas fa-spinner fa-spin'></i>", 'blue');

                setTimeout(() => {
                    const withdrawalSuccessful = Math.random() < 0.8; 
                    if (withdrawalSuccessful) {
                        currentBalance -= amount;
                        updateBalanceDisplay();
                        setWithdrawalMessage(`Withdrawal of ₦${amount.toLocaleString()} successful! Funds will be credited within 24 hours.`, 'green');
                    } else {
                        setWithdrawalMessage("Withdrawal failed. Please try again or contact support.", 'red');
                    }
                    initiateWithdrawalButton.disabled = false; 
                }, 3000); 
            }

            // --- LLM Integration ---
            async function getLlmMatchCommentary() {
                getCommentaryBtn.disabled = true;
                llmCommentaryDisplay.innerHTML = "Generating commentary... <i class='fas fa-spinner fa-spin'></i>";

                const prompt = `Generate a concise, enthusiastic sports commentary for a simulated soccer match. 
                                The match was between ${lastMatchResult.homeTeam} and ${lastMatchResult.awayTeam}. 
                                The final score was ${lastMatchResult.homeScore} - ${lastMatchResult.awayScore}. 
                                The user bet on ${lastMatchResult.selectedOutcome.replace('_', ' ').toUpperCase()} 
                                and ${lastMatchResult.betWon ? 'WON' : 'LOST'} their bet. 
                                Focus on the result and the user's betting outcome, keep it brief and exciting. 
                                Do not mention yourself as an AI.`;
                
                try {
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                    const payload = { contents: chatHistory };
                    const apiKey = ""; 
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                    
                    const response = await fetch(apiUrl, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(payload)
                            });
                    
                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        llmCommentaryDisplay.textContent = text;
                    } else {
                        llmCommentaryDisplay.textContent = "Could not generate commentary. Please try again.";
                        console.error("Gemini API response structure unexpected:", result);
                    }
                } catch (error) {
                    llmCommentaryDisplay.textContent = "Failed to fetch commentary. Please check your network connection or try again later.";
                    console.error("Error calling Gemini API:", error);
                } finally {
                    getCommentaryBtn.disabled = false;
                }
            }


            // --- Event Listeners ---
            // Header Action Buttons
            depositFundsBtn.addEventListener('click', () => {
                showPaymentOverlay(5000, null); 
            });
            withdrawFundsBtn.addEventListener('click', showWithdrawalView);
            userProfileInfo.addEventListener('click', showEditProfileOverlay); 

            // Profile Setup Page
            profileNameInput.addEventListener('input', () => setProfileSetupMessage("")); 
            profilePhotoUrlInput.addEventListener('input', () => setProfileSetupMessage("")); 

            saveProfileBtn.addEventListener('click', () => {
                const name = profileNameInput.value.trim();
                const photoUrl = profilePhotoUrlInput.value.trim();

                if (!name) {
                    setProfileSetupMessage("Please enter your name.", 'red');
                    return;
                }

                userName = name;
                profilePhotoUrl = photoUrl;
                profileSetupDate = Date.now(); 
                localStorage.setItem('userName', userName);
                localStorage.setItem('profilePhotoUrl', profilePhotoUrl);
                localStorage.setItem('profileSetupDate', profileSetupDate);
                updateProfileDisplayInHeader();
                showDashboard(); // Crucial: Ensure dashboard is shown after profile setup
            });

            // Edit Profile Overlay
            editProfileNameInput.addEventListener('input', () => setEditProfileStatusMessage(""));
            editProfilePhotoUrlInput.addEventListener('input', () => setEditProfileStatusMessage(""));

            saveEditedProfileBtn.addEventListener('click', () => {
                const name = editProfileNameInput.value.trim();
                const photoUrl = editProfilePhotoUrlInput.value.trim();

                if (!name) {
                    setEditProfileStatusMessage("Please enter your name.", 'red');
                    return;
                }

                userName = name;
                profilePhotoUrl = photoUrl;
                profileSetupDate = Date.now(); 
                localStorage.setItem('userName', userName);
                localStorage.setItem('profilePhotoUrl', profilePhotoUrl);
                localStorage.setItem('profileSetupDate', profileSetupDate);
                updateProfileDisplayInHeader();
                editProfileOverlay.style.display = 'none';
                setAllGameControlsEnabled(true); 
                refreshCurrentGameControlsState(); 
            });

            cancelEditProfileBtn.addEventListener('click', () => {
                editProfileOverlay.style.display = 'none';
                setAllGameControlsEnabled(true); 
                refreshCurrentGameControlsState(); 
            });


            // Spin the Wheel Game
            spinButton.addEventListener('click', startSpin);
            placeBetButton.addEventListener('click', () => {
                let bet = parseFloat(betAmountInput.value);
                if (isNaN(bet) || bet < 700) {
                    setGameMessage("Minimum bet is ₦700.", 'red');
                    spinButton.disabled = true;
                    return;
                }
                if (bet > currentBalance) {
                    setGameMessage("Insufficient balance. Please make a deposit.", 'red');
                    showPaymentOverlay(bet, 'spinTheWheel'); 
                    return;
                }
                currentBalance -= bet; 
                updateBalanceDisplay(); 

                currentBetAmountSpinWheel = bet; 
                setGameMessage(`Bet of ₦${currentBetAmountSpinWheel.toLocaleString()} placed! Click SPIN.`);
                spinButton.disabled = false;
                placeBetButton.disabled = true;
                betAmountInput.disabled = true;
            });
            backToDashboardBtn.addEventListener('click', showDashboard);

            // Visual Soccer List & Detail View
            backToDashboardBtnSoccerList.addEventListener('click', showDashboard); 
            backToSoccerListBtn.addEventListener('click', () => {
                resetSoccerGameControls(); 
                showSoccerMatchList();
            });
            
            // Handle clicking on bet outcome buttons (Home/Draw/Away, Over/Under, BTTS)
            betOptionButtons.forEach(button => {
                button.addEventListener('click', (event) => {
                    if (currentBetAmountSoccer > 0 && !button.disabled) { 
                        betOptionButtons.forEach(btn => btn.classList.remove('selected'));
                        button.classList.add('selected');
                        selectedSoccerOutcome = button.dataset.outcome;
                        setSoccerGameMessage(`You selected ${button.textContent}. Click 'Simulate Match' to proceed.`);
                        simulateMatchButton.disabled = false; 
                    } else if (currentBetAmountSoccer === 0) {
                        setSoccerGameMessage("Please place your bet amount first.", 'orange');
                    }
                });
            });

            placeSoccerBetButton.addEventListener('click', () => {
                let bet = parseFloat(soccerBetAmountInput.value);
                if (isNaN(bet) || bet < 1000) {
                    setSoccerGameMessage("Minimum bet is ₦1,000.", 'red');
                    return;
                }
                if (bet > currentBalance) {
                    setSoccerGameMessage("Insufficient balance. Please make a deposit.", 'red');
                    showPaymentOverlay(bet, 'visualSoccer'); 
                    return;
                }
                currentBalance -= bet; 
                updateBalanceDisplay(); 

                currentBetAmountSoccer = bet;
                placeSoccerBetButton.disabled = true;
                soccerBetAmountInput.disabled = true;
                betOptionButtons.forEach(btn => btn.disabled = false); 
                setSoccerGameMessage(`Bet of ₦${currentBetAmountSoccer.toLocaleString()} placed! Now select your outcome.`);
                if (selectedSoccerOutcome) { 
                    simulateMatchButton.disabled = false;
                }
            });

            simulateMatchButton.addEventListener('click', startSoccerMatchSimulation);
            getCommentaryBtn.addEventListener('click', getLlmMatchCommentary); 
            placeNewBetBtn.addEventListener('click', resetSoccerGameControls); 

            // Coin Flip Game Event Listeners
            backToDashboardBtnCoinFlip.addEventListener('click', showDashboard);
            placeCoinFlipBetButton.addEventListener('click', placeCoinFlipBet);
            betHeadsButton.addEventListener('click', () => selectCoinOutcome('heads'));
            betTailsButton.addEventListener('click', () => selectCoinOutcome('tails'));
            flipCoinButton.addEventListener('click', flipCoin);

            // Slot Machine Game Event Listeners
            backToDashboardBtnSlotMachine.addEventListener('click', showDashboard);
            placeSlotBetButton.addEventListener('click', placeSlotBet);
            spinSlotButton.addEventListener('click', spinReels);

            // Spin 2 Win Game Event Listeners
            backToDashboardBtnSpin2Win.addEventListener('click', showDashboard);
            placeSpin2WinBetButton.addEventListener('click', () => {
                let bet = parseFloat(spin2WinBetAmountInput.value);
                if (isNaN(bet) || bet < 100) {
                    setSpin2WinMessage("Minimum bet is ₦100.", 'red');
                    return;
                }
                if (bet > currentBalance) {
                    setSpin2WinMessage("Insufficient balance. Please make a deposit.", 'red');
                    showPaymentOverlay(bet, 'spin2Win'); 
                    return;
                }
                currentBalance -= bet;
                updateBalanceDisplay();

                currentBetAmountSpin2Win = bet;
                setSpin2WinMessage(`Bet of ₦${currentBetAmountSpin2Win.toLocaleString()} placed! Click SPIN 2 WIN!`);
                spin2WinButton.disabled = false;
                placeSpin2WinBetButton.disabled = true;
                spin2WinBetAmountInput.disabled = true;
            });
            spin2WinButton.addEventListener('click', startSpin2Win);


            // Payment Overlay Buttons
            confirmPaymentButton.addEventListener('click', (event) => simulatePaymentAuthentication(null, event.currentTarget)); 
            simulateSuccessBtn.addEventListener('click', (event) => simulatePaymentAuthentication('success', event.currentTarget)); 
            simulateFailBtn.addEventListener('click', (event) => simulatePaymentAuthentication('failure', event.currentTarget)); 

            // Event listener for quick deposit buttons
            quickDepositButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const amount = parseFloat(button.dataset.amount);
                    depositAmountInput.value = amount;
                    // Manually trigger the input event to update display and re-evaluate button states
                    const event = new Event('input', { bubbles: true });
                    depositAmountInput.dispatchEvent(event);
                });
            });


            depositAmountInput.addEventListener('input', () => {
                let amount = parseFloat(depositAmountInput.value);
                const min = parseFloat(depositAmountInput.min);
                const max = parseFloat(depositAmountInput.max);

                if (isNaN(amount) || amount < min || amount > max) {
                    paymentAmountDisplay.textContent = "Invalid Amount";
                    confirmPaymentButton.disabled = true;
                    simulateSuccessBtn.disabled = true;
                    simulateFailBtn.disabled = true;
                    paymentStatusMessage.textContent = `Amount must be between ₦${min.toLocaleString()} and ₦${max.toLocaleString()}.`;
                    paymentStatusMessage.style.color = 'red';
                } else {
                    paymentAmountDisplay.textContent = `₦${amount.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                    confirmPaymentButton.disabled = false;
                    simulateSuccessBtn.disabled = false;
                    simulateFailBtn.disabled = false;
                    paymentStatusMessage.textContent = "Confirm payment details above.";
                    paymentStatusMessage.style.color = 'grey';
                }
            });
            cancelPaymentButton.addEventListener('click', () => {
                paymentOverlay.style.display = 'none';
                paymentStatusMessage.textContent = ""; 
                confirmPaymentButton.innerHTML = `<i class="fas fa-check-circle"></i> Auto-Authenticate Payment`; 
                simulateSuccessBtn.innerHTML = `<i class="fas fa-money-check-alt"></i> Simulate Successful Deposit`; 
                simulateFailBtn.innerHTML = `<i class="fas fa-exclamation-triangle"></i> Simulate Failed Deposit`;   
                
                gameBetPendingPayment = null; 
                setAllGameControlsEnabled(true); 
                refreshCurrentGameControlsState(); 
            });

            // Withdrawal Section Buttons
            backToDashboardBtnWithdrawal.addEventListener('click', showDashboard); 
            initiateWithdrawalButton.addEventListener('click', initiateWithdrawal); 


            // --- Initial Setup and Load Profile ---
            function loadProfile() {
                const savedName = localStorage.getItem('userName');
                const savedPhotoUrl = localStorage.getItem('profilePhotoUrl');
                const savedSetupDate = localStorage.getItem('profileSetupDate');

                if (savedName) {
                    userName = savedName;
                    profilePhotoUrl = savedPhotoUrl || "";
                    profileSetupDate = parseInt(savedSetupDate) || 0;
                    updateProfileDisplayInHeader();
                    showDashboard(); 
                } else {
                    hideAllViews(); 
                    profileSetupView.style.display = 'flex'; 
                }
            }
            
            // Initial calls
            loadProfile(); 
            drawWheel(wheelRotation); 
            initPlayers(); 
            drawSoccerVisuals(0, 0, 0); 
            drawSpin2WinWheel(spin2WinRotation); 
        });
    </script>
</body>
</html>
