<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grow-with-Core - Login/Register</title>
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
    <meta name="theme-color" content="#212121"> <!-- Dark brand color -->
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the authentication page */
        body {
            font-family: "Inter", sans-serif;
            /* Deeper, more vibrant gradient background for a premium feel */
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #e0e0e0;
            padding: 1.5rem; /* Increased padding for better spacing on small screens */
            box-sizing: border-box;
            overflow: hidden; /* Hide overflow for subtle background animation */

            /* New: Subtle background animation */
            background-size: 200% 200%;
            animation: gradientMove 15s ease infinite alternate;
        }

        /* New: Keyframes for subtle background animation */
        @keyframes gradientMove {
            0% { background-position: 0% 0%; }
            100% { background-position: 100% 100%; }
        }

        .auth-container {
            background-color: #222222; /* Slightly darker container background */
            border-radius: 2.75rem; /* Even more rounded corners */
            /* More pronounced, multi-layered shadow for depth */
            box-shadow: 0 35px 80px rgba(0, 0, 0, 0.6), inset 0 0 20px rgba(255, 255, 255, 0.05);
            padding: 3.5rem; /* Increased padding */
            max-width: 550px; /* Slightly wider max width */
            width: 100%;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1); /* Slightly more defined border */
            position: relative; /* For potential pseudo-elements or absolute positioning */
            overflow: hidden; /* Ensure inner elements don't break rounded corners */
        }

        .auth-title {
            font-size: 2.8rem; /* Slightly larger title */
            font-weight: 800; /* Bolder */
            color: #c0d0e0; /* Softer blue-grey for titles */
            margin-bottom: 2.5rem; /* Increased margin */
            position: relative;
            padding-bottom: 0.85rem;
            letter-spacing: 0.06em; /* Slight letter spacing */
            text-shadow: 0 0 8px rgba(192, 208, 224, 0.2); /* Subtle glow for titles */
        }

        .auth-title::after {
            content: '';
            position: absolute;
            left: 50%;
            bottom: 0;
            transform: translateX(-50%);
            width: 110px;
            height: 6px;
            /* Vibrant green gradient underline */
            background: linear-gradient(90deg, #5CB85C, #6FC06F);
            border-radius: 4px;
            box-shadow: 0 0 10px rgba(92, 184, 92, 0.6); /* Glow for the underline */
        }

        .form-section-title {
            font-size: 2rem; /* Adjusted size for form titles */
            font-weight: 700;
            color: #d0d0d0;
            margin-bottom: 1.8rem; /* Adjusted margin */
            text-shadow: 0 0 5px rgba(208, 208, 208, 0.1);
        }

        .form-group {
            margin-bottom: 1.8rem; /* Increased spacing between form groups */
            text-align: left;
        }

        .form-group label {
            display: block;
            color: #c0d0d0; /* Softer label color */
            font-size: 1rem; /* Slightly larger label font */
            font-weight: 600;
            margin-bottom: 0.8rem; /* Increased space between label and input */
        }

        .form-input {
            background-color: #3a3a3a; /* Darker input background */
            border: 1px solid #666666; /* Darker, more defined border */
            color: #e0e0e0; /* Lighter text in inputs */
            border-radius: 0.85rem; /* More rounded inputs */
            padding: 1.1rem 1.4rem; /* Increased padding */
            width: 100%;
            box-shadow: inset 0 3px 6px rgba(0, 0, 0, 0.4); /* Deeper inner shadow */
            transition: border-color 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
            font-size: 1.05rem;
        }

        .form-input:focus {
            border-color: #5CB85C; /* Vibrant green focus border */
            box-shadow: 0 0 0 5px rgba(92, 184, 92, 0.6), inset 0 3px 6px rgba(0, 0, 0, 0.4); /* Green focus ring with inner shadow */
            outline: none;
            background-color: #3f3f3f; /* Slightly lighter on focus */
        }

        .btn-primary {
            /* More vibrant green gradient button with stronger shadow */
            background: linear-gradient(90deg, #4CAF50 0%, #5CB85C 100%);
            color: white;
            font-weight: 700;
            padding: 1.2rem 2.8rem; /* Larger padding for a more substantial button */
            border-radius: 1.1rem;
            transition: all 0.3s ease;
            box-shadow: 0 10px 25px rgba(76, 175, 80, 0.7); /* Stronger green shadow */
            border: none;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.08em; /* More letter spacing */
            font-size: 1.15rem; /* Larger font size */
            position: relative;
            overflow: hidden;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 300%;
            height: 300%;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 50%;
            transition: all 0.4s ease-out;
            transform: translate(-50%, -50%) scale(0);
            opacity: 0;
        }

        .btn-primary:hover::before {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }

        .btn-primary:hover {
            transform: translateY(-5px); /* More pronounced lift */
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.55), 0 0 15px rgba(76, 175, 80, 0.8); /* Stronger shadow with glow */
            filter: brightness(1.15); /* Slight brightness increase on hover */
        }

        .btn-primary:active {
            transform: translateY(0); /* Press effect */
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.4);
            filter: brightness(1);
        }

        .toggle-link {
            color: #90CAF9; /* Lighter blue for links */
            font-weight: 600;
            margin-top: 2rem; /* Increased margin */
            display: block;
            cursor: pointer;
            transition: color 0.2s ease, text-decoration 0.2s ease;
            font-size: 0.95rem; /* Slightly larger link font */
        }

        .toggle-link:hover {
            color: #BBDEFB; /* Even lighter on hover */
            text-decoration: underline;
        }

        .message-box {
            margin-top: 2rem; /* Increased margin */
            padding: 1.2rem; /* Increased padding */
            border-radius: 0.85rem;
            font-weight: 600;
            text-align: center;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
            font-size: 0.95rem; /* Slightly larger message font */
        }

        .message-box.success {
            background-color: rgba(92, 184, 92, 0.25);
            color: #76E076;
            border: 1px solid rgba(92, 184, 92, 0.5); /* Added border */
        }

        .message-box.error {
            background-color: rgba(255, 107, 107, 0.25);
            color: #FF6B6B;
            border: 1px solid rgba(255, 107, 107, 0.5); /* Added border */
        }

        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid #fff;
            border-radius: 50%;
            width: 18px; /* Slightly larger spinner */
            height: 18px;
            animation: spin 1s linear infinite;
            margin-left: 10px; /* Increased margin */
            display: inline-block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive adjustments */
        @media (max-width: 640px) {
            .auth-container {
                padding: 2rem; /* Smaller padding on very small screens */
                border-radius: 2rem;
            }
            .auth-title {
                font-size: 2.2rem;
                margin-bottom: 1.8rem;
            }
            .form-section-title {
                font-size: 1.6rem;
                margin-bottom: 1.5rem;
            }
            .form-group {
                margin-bottom: 1.2rem;
            }
            .form-group label {
                font-size: 0.9rem;
                margin-bottom: 0.5rem;
            }
            .form-input {
                padding: 0.9rem 1.2rem;
                font-size: 0.95rem;
            }
            .btn-primary {
                padding: 1rem 2rem;
                font-size: 1rem;
            }
            .toggle-link {
                margin-top: 1.5rem;
                font-size: 0.85rem;
            }
            .message-box {
                margin-top: 1.5rem;
                padding: 1rem;
                font-size: 0.85rem;
            }
            .loading-spinner {
                width: 14px;
                height: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="auth-container">
        <h1 class="auth-title">Grow-with-Core</h1>

        <!-- Login Form -->
        <div id="loginForm">
            <h2 class="form-section-title">Login to Your Account</h2>
            <div class="form-group">
                <label for="loginEmail">Email Address</label>
                <input type="email" id="loginEmail" class="form-input" placeholder="Enter your email">
            </div>
            <div class="form-group">
                <label for="loginPassword">Password</label>
                <input type="password" id="loginPassword" class="form-input" placeholder="Enter your password">
            </div>
            <button id="loginBtn" class="btn-primary">
                <span>Login</span>
            </button>
            <p id="loginMessage" class="message-box hidden"></p>
            <a href="#" id="showRegisterLink" class="toggle-link">Don't have an account? Register here.</a>
        </div>

        <!-- Register Form -->
        <div id="registerForm" class="hidden">
            <h2 class="form-section-title">Create New Account</h2>
            <div class="form-group">
                <label for="registerEmail">Email Address</label>
                <input type="email" id="registerEmail" class="form-input" placeholder="Enter your email">
            </div>
            <div class="form-group">
                <label for="registerPassword">Password</label>
                <input type="password" id="registerPassword" class="form-input" placeholder="Choose a password">
            </div>
            <button id="registerBtn" class="btn-primary">
                <span>Register</span>
            </button>
            <p id="registerMessage" class="message-box hidden"></p>
            <a href="#" id="showLoginLink" class="toggle-link">Already have an account? Login here.</a>
        </div>
    </div>

    <!-- PWA Install Button and Message (placed outside auth-container for better visibility) -->
    <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 text-center">
        <button id="installAppButton" class="install-button hidden mb-2">Install App</button>
        <p id="installMessage" class="text-sm text-gray-400"></p>
    </div>

    <script>
        // IMPORTANT SECURITY NOTE:
        // Storing user credentials (even hashed) directly in localStorage is HIGHLY INSECURE
        // for a real-world application. This implementation is provided to meet your specific
        // request for local storage persistence without a backend, but it is crucial to
        // understand its limitations. For production, a secure backend with proper authentication
        // and database storage (like Firebase) would be essential. Never use this approach
        // for sensitive user data in a live environment.

        // DOM Elements
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');

        const loginEmailInput = document.getElementById('loginEmail');
        const loginPasswordInput = document.getElementById('loginPassword');
        const loginBtn = document.getElementById('loginBtn');
        const loginMessage = document.getElementById('loginMessage');

        const registerEmailInput = document.getElementById('registerEmail');
        const registerPasswordInput = document.getElementById('registerPassword');
        const registerBtn = document.getElementById('registerBtn');
        const registerMessage = document.getElementById('registerMessage');

        const showRegisterLink = document.getElementById('showRegisterLink');
        const showLoginLink = document.getElementById('showLoginLink');

        /**
         * Displays a message in the specified message box.
         * @param {HTMLElement} messageBox The message box element.
         * @param {string} message The message text.
         * @param {string} type 'success' or 'error'.
         */
        function showMessage(messageBox, message, type) {
            messageBox.textContent = message;
            messageBox.classList.remove('hidden', 'success', 'error');
            messageBox.classList.add(type);
            setTimeout(() => {
                messageBox.classList.add('hidden');
            }, 3000); // Hide message after 3 seconds
        }

        /**
         * Shows a loading state for a button.
         * @param {HTMLElement} button The button element.
         * @param {string} loadingText The text to display while loading.
         */
        function startLoading(button, loadingText = 'Processing...') {
            button.disabled = true;
            button.querySelector('span').textContent = loadingText;
            const spinner = document.createElement('div');
            spinner.classList.add('loading-spinner');
            button.appendChild(spinner);
        }

        /**
         * Hides the loading state for a button.
         * @param {HTMLElement} button The button element.
         * @param {string} originalText The original text of the button.
         */
        function stopLoading(button, originalText) {
            button.disabled = false;
            button.querySelector('span').textContent = originalText;
            const spinner = button.querySelector('.loading-spinner');
            if (spinner) {
                spinner.remove();
            }
        }

        // Event Listeners for form toggling
        showRegisterLink.addEventListener('click', (e) => {
            e.preventDefault();
            loginForm.classList.add('hidden');
            registerForm.classList.remove('hidden');
            loginMessage.classList.add('hidden'); // Hide any previous login messages
            registerMessage.classList.add('hidden'); // Clear register message on toggle
            registerEmailInput.value = ''; // Clear inputs on toggle
            registerPasswordInput.value = '';
        });

        showLoginLink.addEventListener('click', (e) => {
            e.preventDefault();
            registerForm.classList.add('hidden');
            loginForm.classList.remove('hidden');
            registerMessage.classList.add('hidden'); // Hide any previous register messages
            loginMessage.classList.add('hidden'); // Clear login message on toggle
            loginEmailInput.value = ''; // Clear inputs on toggle
            loginPasswordInput.value = '';
        });

        // Register Button Logic
        registerBtn.addEventListener('click', () => {
            const email = registerEmailInput.value.trim();
            const password = registerPasswordInput.value.trim();

            if (!email || !password) {
                showMessage(registerMessage, 'Please fill in all fields.', 'error');
                return;
            }

            if (password.length < 6) {
                showMessage(registerMessage, 'Password must be at least 6 characters long.', 'error');
                return;
            }

            startLoading(registerBtn, 'Registering...');

            // Simulate API call delay
            setTimeout(() => {
                const existingUser = localStorage.getItem(`user_${email}`);
                if (existingUser) {
                    showMessage(registerMessage, 'Account with this email already exists.', 'error');
                    stopLoading(registerBtn, 'Register');
                } else {
                    // Store user credentials in localStorage
                    localStorage.setItem(`user_${email}`, JSON.stringify({ email, password }));
                    showMessage(registerMessage, 'Account created successfully! You can now log in.', 'success');
                    stopLoading(registerBtn, 'Register');
                    // Optionally switch to login form after successful registration
                    setTimeout(() => {
                        registerForm.classList.add('hidden');
                        loginForm.classList.remove('hidden');
                        loginEmailInput.value = email; // Pre-fill login email
                        registerEmailInput.value = ''; // Clear register form
                        registerPasswordInput.value = '';
                    }, 1500);
                }
            }, 1000);
        });

        // Login Button Logic
        loginBtn.addEventListener('click', () => {
            const email = loginEmailInput.value.trim();
            const password = loginPasswordInput.value.trim();

            if (!email || !password) {
                showMessage(loginMessage, 'Please enter your email and password.', 'error');
                return;
            }

            startLoading(loginBtn, 'Logging in...');

            // Simulate API call delay
            setTimeout(() => {
                const storedUser = localStorage.getItem(`user_${email}`);
                if (storedUser) {
                    const userData = JSON.parse(storedUser);
                    if (userData.password === password) {
                        showMessage(loginMessage, 'Login successful! Redirecting...', 'success');
                        stopLoading(loginBtn, 'Login');
                        // Redirect to addup.html on successful login
                        // Pass user ID/email via localStorage for the dashboard to pick up
                        localStorage.setItem('currentUserEmail', email);
                        localStorage.setItem('currentUserId', email.replace(/[^a-zA-Z0-9]/g, '_')); // Simple ID from email
                        window.location.href = 'addup.html'; // Changed from dashboard.html to addup.html
                    } else {
                        showMessage(loginMessage, 'Incorrect password.', 'error');
                        stopLoading(loginBtn, 'Login');
                    }
                } else {
                    showMessage(loginMessage, 'User not found. Please register.', 'error');
                    stopLoading(loginBtn, 'Login');
                }
            }, 1000);
        });

        // --- PWA Specific JavaScript (Install Button Logic) ---
        // This code handles the "Add to Home Screen" prompt.
        let deferredPrompt; // This variable will store the event that triggers the install prompt.
        const installAppButton = document.getElementById('installAppButton'); // Get your custom install button element.
        const installMessage = document.getElementById('installMessage'); // Get the message element.

        // Event listener for 'beforeinstallprompt':
        // This event fires when the browser determines that the PWA can be installed.
        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent the default mini-infobar from appearing on mobile.
            e.preventDefault();
            // Stash the event so it can be triggered later by your custom button.
            deferredPrompt = e;
            // Show your custom install button to the user.
            installAppButton.classList.remove('hidden');
            installMessage.textContent = 'Click the button below to install this app!';
            console.log('beforeinstallprompt event fired. Custom install button shown.');
        });

        // Event listener for your custom install button click:
        installAppButton.addEventListener('click', async () => {
            if (deferredPrompt) {
                // Show the browser's native install prompt.
                deferredPrompt.prompt();
                // Wait for the user to respond to the prompt (accept or dismiss).
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response to the A2HS prompt: ${outcome}`);
                // The prompt can only be used once, so clear the deferredPrompt.
                deferredPrompt = null;
                // Hide your custom install button after the prompt has been shown.
                installAppButton.classList.add('hidden');
                if (outcome === 'accepted') {
                    console.log('App installed successfully!');
                    installMessage.textContent = 'App installed successfully!';
                } else {
                    console.log('Installation cancelled.');
                    installMessage.textContent = 'Installation cancelled. You can still install it from your browser menu.';
                }
            }
        });

        // Event listener for 'appinstalled':
        // This event fires if the user successfully installs the PWA.
        window.addEventListener('appinstalled', () => {
            console.log('PWA was installed!');
            // Hide the install button if the app is already installed.
            installAppButton.classList.add('hidden');
            installMessage.textContent = 'App installed successfully!';
        });

        // Check if the app is already running in standalone mode (i.e., it's installed).
        // This helps hide the install button if the user has already installed it.
        if (window.matchMedia('(display-mode: standalone)').matches || navigator.standalone) {
            console.log('App is running in standalone mode.');
            installAppButton.classList.add('hidden'); // Hide install button if already installed
            installMessage.textContent = 'You are running this app in standalone mode!';
        }
    </script>
</body>
</html>
