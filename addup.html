<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>Grow-with-Core Dashboard</title>
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
    <meta name="theme-color" content="#212121"> <!-- Dark brand color -->
    <!-- Tailwind CSS CDN for easy styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN for portfolio allocation chart -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Paystack Checkout.js CDN for payment integration -->
    <script src="https://js.paystack.co/v1/inline.js"></script>
    <style>
        /* Custom styles for the dashboard with darker theme and enhanced imagery */
        body {
            font-family: "Inter", sans-serif; /* Using Inter font */
            /* Deeper, more vibrant gradient background for a premium feel */
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%); /* Even darker, more subtle gradient */
            min-height: 100vh; /* Ensure full viewport height */
            margin: 0;
            padding: 1rem; /* Smaller padding on mobile */
            box-sizing: border-box;
            color: #e0e0e0; /* Lighter text for dark background */
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to top for better content flow */
            overflow-x: hidden; /* Prevent horizontal scroll */

            /* New: Subtle background animation */
            background-size: 250% 250%; /* Slightly larger for more movement */
            animation: gradientMove 20s ease infinite alternate; /* Slower animation for subtlety */
            transition: background-position 0.5s ease; /* Smooth transition for background position */
        }

        /* New: Keyframes for subtle background animation */
        @keyframes gradientMove {
            0% { background-position: 0% 0%; }
            100% { background-position: 100% 100%; }
        }

        .dashboard-container {
            background-color: #222222; /* Slightly darker container background */
            border-radius: 2.75rem; /* Even more rounded corners */
            /* More pronounced, multi-layered shadow for depth */
            box-shadow: 0 35px 80px rgba(0, 0, 0, 0.6), inset 0 0 20px rgba(255, 255, 255, 0.05);
            padding: 2rem; /* Adjusted padding for mobile (slightly less) */
            max-width: 1300px; /* Slightly wider max width */
            width: 100%;
            display: grid;
            gap: 1.6rem; /* Adjusted gap between sections for mobile (slightly less) */
            grid-template-columns: 1fr; /* Single column for mobile */
            margin-top: 1.5rem; /* Space from top */
            margin-bottom: 1.5rem; /* Space from bottom */
            border: 1px solid rgba(255, 255, 255, 0.1); /* Slightly more defined border */
        }

        @media (min-width: 768px) {
            body {
                padding: 25px; /* Restore larger padding on desktop */
            }
            .dashboard-container {
                padding: 3rem; /* Slightly reduced padding on desktop */
                gap: 2.2rem; /* Adjusted gap on desktop (slightly less) */
                grid-template-columns: 2.5fr 1fr; /* More balanced distribution */
            }
        }

        .card {
            /* Richer card gradient with subtle inner shadow */
            background: linear-gradient(45deg, #303030 0%, #404040 100%); /* Deeper card gradient */
            border-radius: 2.25rem; /* More rounded card corners */
            padding: 1.6rem; /* Adjusted card padding for mobile (slightly less) */
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4), inset 0 0 12px rgba(255, 255, 255, 0.03); /* Enhanced card shadow */
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out, background 0.3s ease-in-out;
            border: 1px solid rgba(255, 255, 255, 0.08); /* Subtle light border for definition */
        }

        @media (min-width: 768px) {
            .card {
                padding: 2.5rem; /* Restore larger card padding on desktop (slightly less) */
            }
        }

        .card:hover {
            transform: translateY(-12px); /* More pronounced lift effect on hover */
            box-shadow: 0 28px 55px rgba(0, 0, 0, 0.6); /* Stronger shadow on hover */
            background: linear-gradient(45deg, #353535 0%, #454545 100%); /* Slightly lighter on hover */
        }

        .section-title {
            font-size: 2.1rem; /* Slightly larger title on mobile */
            font-weight: 800; /* Bolder */
            color: #c0d0e0; /* Softer blue-grey for titles */
            margin-bottom: 1.5rem; /* Adjusted space below title */
            text-align: center;
            position: relative;
            padding-bottom: 0.6rem; /* Adjusted padding */
            letter-spacing: 0.06em; /* Slight letter spacing */
            text-shadow: 0 0 8px rgba(192, 208, 224, 0.2); /* Subtle glow for titles */
        }

        @media (min-width: 768px) {
            .section-title {
                font-size: 2.8rem; /* Restore larger title on desktop (slightly less) */
                margin-bottom: 2rem; /* Restore larger space (slightly less) */
                padding-bottom: 0.8rem; /* Restore padding (slightly less) */
            }
        }

        .section-title::after {
            content: '';
            position: absolute;
            left: 50%;
            bottom: 0;
            transform: translateX(-50%);
            width: 75px; /* Slightly narrower underline on mobile */
            height: 4px; /* Slightly thinner underline on mobile */
            /* Vibrant green gradient underline */
            background: linear-gradient(90deg, #5CB85C, #6FC06F); /* Brighter green gradient */
            border-radius: 4px;
            box-shadow: 0 0 10px rgba(92, 184, 92, 0.6); /* Glow for the underline */
        }

        @media (min-width: 768px) {
            .section-title::after {
                width: 90px; /* Restore wider underline on desktop */
                height: 5px; /* Restore thicker underline on desktop */
            }
        }

        .btn-primary {
            /* More vibrant green gradient button with stronger shadow */
            background: linear-gradient(90deg, #4CAF50 0%, #5CB85C 100%); /* Brighter green gradient */
            color: white;
            font-weight: 700; /* Bolder text */
            padding: 0.9rem 1.8rem; /* Slightly larger padding on mobile */
            border-radius: 0.85rem; /* Slightly more rounded */
            transition: all 0.3s ease;
            box-shadow: 0 10px 25px rgba(76, 175, 80, 0.7); /* Stronger green shadow */
            border: none;
            cursor: pointer;
            text-transform: uppercase; /* Uppercase text */
            letter-spacing: 0.06em; /* Slight letter spacing */
            font-size: 0.95rem; /* Slightly larger font on mobile */
            position: relative;
            overflow: hidden;
            display: flex; /* Ensure flex for spinner */
            align-items: center;
            justify-content: center;
        }

        @media (min-width: 768px) {
            .btn-primary {
                padding: 1.1rem 2.5rem; /* Restore larger padding on desktop */
                border-radius: 1.1rem; /* Restore more rounded */
                font-size: 1.05rem; /* Restore font size */
            }
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 300%;
            height: 300%;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 50%;
            transition: all 0.4s ease-out;
            transform: translate(-50%, -50%) scale(0);
            opacity: 0;
        }

        .btn-primary:hover::before {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }

        .btn-primary:hover {
            transform: translateY(-5px); /* More pronounced lift */
            box-shadow: 0 18px 35px rgba(0, 0, 0, 0.6), 0 0 18px rgba(76, 175, 80, 0.8); /* Stronger shadow with glow */
            filter: brightness(1.15); /* Slight brightness increase on hover */
        }

        .btn-primary:active {
            transform: translateY(0); /* Press effect */
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.4);
            filter: brightness(1);
        }

        input[type="number"], input[type="text"], input[type="email"], input[type="password"], textarea, select {
            background-color: #3a3a3a; /* Darker input background */
            border: 1px solid #666666; /* Darker, more defined border */
            color: #e0e0e0; /* Lighter text in inputs */
            border-radius: 0.6rem; /* Slightly more rounded on mobile */
            padding: 0.8rem 1.1rem; /* Slightly larger padding on mobile */
            width: 100%;
            box-shadow: inset 0 3px 6px rgba(0, 0, 0, 0.4); /* Deeper inner shadow */
            transition: border-color 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
            font-size: 0.95rem; /* Slightly larger font on mobile */
        }

        @media (min-width: 768px) {
            input[type="number"], input[type="text"], input[type="email"], input[type="password"], textarea, select {
                border-radius: 0.8rem; /* Restore rounded inputs on desktop */
                padding: 1rem 1.3rem; /* Restore larger padding on desktop */
                font-size: 1.05rem; /* Restore font size */
            }
        }

        input[type="number"]:focus, input[type="text"]:focus, input[type="email"]:focus, input[type="password"]:focus, textarea:focus, select:focus {
            border-color: #5CB85C; /* Vibrant green focus border */
            box-shadow: 0 0 0 5px rgba(92, 184, 92, 0.6), inset 0 3px 6px rgba(0, 0, 0, 0.4); /* Green focus ring with inner shadow */
            outline: none;
            background-color: #3f3f3f; /* Slightly lighter on focus */
        }

        .metric-box {
            /* Metric box gradient with more contrast */
            background: linear-gradient(135deg, #4a4a4a 0%, #3a3a3a 100%);
            border-radius: 1.1rem; /* Slightly less rounded on mobile */
            padding: 1.3rem; /* Adjusted padding for mobile */
            text-align: center;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3); /* Stronger shadow */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255, 255, 255, 0.1); /* Subtle light border */
            transition: transform 0.2s ease;
            /* New: Animation for metric updates */
            animation: fadeInScale 0.5s ease-out;
        }

        /* New: Keyframes for metric box update animation */
        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        @media (min-width: 768px) {
            .metric-box {
                border-radius: 1.3rem; /* Restore rounded on desktop */
                padding: 1.9rem; /* Restore padding on desktop */
            }
        }

        .metric-box:hover {
            transform: translateY(-4px); /* Slightly more lift on hover */
        }

        .metric-value {
            font-size: 2.1rem; /* Slightly larger metric values on mobile */
            font-weight: 900; /* Extra bold */
            color: #76E076; /* Brighter, more prominent green for key values */
            margin-bottom: 0.6rem; /* Adjusted margin */
            text-shadow: 0 0 8px rgba(118, 224, 118, 0.6); /* Text glow for depth */
        }

        @media (min-width: 768px) {
            .metric-value {
                font-size: 2.9rem; /* Restore larger metric values on desktop */
                margin-bottom: 0.8rem; /* Restore margin */
            }
        }

        .metric-label {
            font-size: 0.98rem; /* Slightly larger label on mobile */
            color: #c0d0e0; /* Softer grey for labels */
            font-weight: 600; /* Bolder label */
        }

        @media (min-width: 768px) {
            .metric-label {
                font-size: 1.18rem; /* Restore larger label on desktop */
            }
        }

        /* SVG Icon styling */
        .icon-svg {
            width: 32px; /* Slightly larger icons on mobile */
            height: 32px;
            fill: currentColor; /* Use parent's text color */
            margin-right: 10px; /* Adjusted space */
            vertical-align: middle;
            color: #76E076; /* Green for icons */
            filter: drop-shadow(0 0 7px rgba(118, 224, 118, 0.7)); /* Stronger glow for icons */
        }

        @media (min-width: 768px) {
            .icon-svg {
                width: 38px; /* Restore larger icons on desktop */
                height: 38px;
                margin-right: 12px; /* Restore space */
            }
        }

        /* Investment item styling */
        .investment-item {
            display: grid; /* Use CSS Grid for better control */
            grid-template-columns: auto 1fr; /* Icon + content */
            grid-template-rows: auto auto; /* Name/Type and Value/Profit */
            gap: 0.6rem 1.3rem; /* Adjusted gaps for mobile */
            align-items: center;
            padding: 1.2rem 1.5rem; /* Adjusted padding for mobile */
            background-color: #3a3a3a; /* Darker background for list items */
            border-radius: 0.8rem; /* Slightly more rounded on mobile */
            margin-bottom: 1.1rem; /* Adjusted space between items */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: background-color 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
            border: 1px solid rgba(255, 255, 255, 0.07);
            position: relative; /* For pseudo-elements or absolute positioning */
            overflow: hidden; /* Hide overflow for subtle effects */
            cursor: pointer; /* Indicate clickable */
        }

        @media (min-width: 768px) {
            .investment-item {
                gap: 0.7rem 1.6rem; /* Restore gaps on desktop */
                padding: 1.7rem 2.1rem; /* Restore padding on desktop */
                border-radius: 1.1rem; /* Restore rounded on desktop */
                margin-bottom: 1.3rem; /* Restore margin */
            }
        }

        .investment-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px; /* Slightly thicker vertical line on mobile */
            height: 100%;
            background: linear-gradient(to bottom, #76E076, #5CB85C); /* Brighter green gradient line */
            border-radius: 0.7rem 0 0 0.7rem; /* Rounded top-left, bottom-left */
            transition: width 0.2s ease-in-out;
        }

        @media (min-width: 768px) {
            .investment-item::before {
                width: 7px; /* Restore width on desktop */
            }
        }

        .investment-item:hover::before {
            width: 12px; /* Slightly wider on hover */
        }

        .investment-item:hover {
            background-color: #4a4a4a; /* Slightly lighter on hover */
            transform: translateX(10px); /* More pronounced slide effect on hover */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.45); /* Stronger shadow on hover */
        }

        .investment-icon-wrapper {
            grid-row: 1 / span 2; /* Span two rows */
            display: flex;
            align-items: center;
            justify-content: center;
            width: 42px; /* Slightly larger width for icon area on mobile */
            height: 42px; /* Slightly larger height for icon area on mobile */
            background-color: #3d4758; /* Darker background for icon */
            border-radius: 50%; /* Circular icon background */
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.4); /* Inner shadow for icon circle */
        }

        @media (min-width: 768px) {
            .investment-icon-wrapper {
                width: 48px; /* Restore width on desktop */
                height: 48px; /* Restore height on desktop */
            }
        }

        .investment-icon {
            width: 24px; /* Slightly larger icon inside wrapper on mobile */
            height: 24px;
            fill: #76E076; /* Green color for the icon itself */
            filter: drop-shadow(0 0 5px rgba(118, 224, 118, 0.6)); /* Subtle glow */
        }

        @media (min-width: 768px) {
            .investment-icon {
                width: 28px; /* Restore icon size on desktop */
                height: 28px;
            }
        }

        .investment-name {
            font-weight: 700; /* Bolder name */
            color: #e8e8e8; /* Even lighter text for name */
            font-size: 1.2rem; /* Slightly larger font on mobile */
            grid-column: 2 / 3; /* Place in second column */
        }

        @media (min-width: 768px) {
            .investment-name {
                font-size: 1.35rem; /* Restore font size on desktop */
            }
        }

        .investment-type {
            font-size: 0.95rem; /* Slightly larger type text on mobile */
            color: #b5b5b5; /* Softer grey */
            grid-column: 2 / 3; /* Place in second column */
        }

        @media (min-width: 768px) {
            .investment-type {
                font-size: 1.05rem; /* Restore font size on desktop */
            }
        }

        .investment-values {
            grid-column: 2 / 3; /* Place in second column */
            display: flex;
            flex-direction: column; /* Stack values vertically on mobile */
            align-items: flex-start; /* Align to start on mobile */
            width: 100%; /* Take full width of its grid cell */
            padding-top: 0.6rem; /* Adjusted space from type */
            border-top: 1px solid rgba(255, 255, 255, 0.07); /* Separator line */
            margin-top: 0.6rem; /* Adjusted space from separator */
        }

        @media (min-width: 768px) {
            .investment-values {
                flex-direction: row; /* Restore horizontal layout on desktop */
                justify-content: space-between; /* Restore space-between on desktop */
                align-items: center; /* Restore alignment on desktop */
                padding-top: 0.7rem; /* Restore padding */
                margin-top: 0.7rem; /* Restore margin */
            }
        }

        .investment-value {
            font-weight: 800; /* Extra bold for value */
            color: #f0f0f0; /* Even lighter for value */
            font-size: 1.1rem; /* Slightly larger font on mobile */
            margin-bottom: 0.4rem; /* Space between stacked values */
        }

        @media (min-width: 768px) {
            .investment-value {
                font-size: 1.3rem; /* Restore font size on desktop */
                margin-bottom: 0; /* Remove margin when horizontal */
            }
        }

        .profit {
            color: #76E076; /* Brighter green for profit */
            font-weight: 700;
            text-shadow: 0 0 5px rgba(118, 224, 118, 0.5); /* Stronger glow for profit text */
        }

        .loss {
            color: #FF6B6B; /* Brighter red for loss */
            font-weight: 700;
            text-shadow: 0 0 5px rgba(255, 107, 107, 0.5); /* Stronger glow for loss text */
        }

        /* Expanded Investment Details */
        .investment-details-expanded {
            grid-column: 1 / -1; /* Span full width */
            background-color: #2d2d2d;
            border-radius: 0.85rem;
            padding: 1rem; /* Adjusted padding for mobile */
            margin-top: 1rem; /* Adjusted margin */
            border: 1px solid rgba(255, 255, 255, 0.12);
            animation: slideDown 0.3s ease-out forwards;
            overflow: hidden; /* Ensure content doesn't overflow during animation */
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.3); /* Inner shadow for expanded details */
        }
        @keyframes slideDown {
            from { max-height: 0; opacity: 0; padding-top: 0; padding-bottom: 0; }
            to { max-height: 250px; opacity: 1; padding-top: 1rem; padding-bottom: 1rem; } /* Max height to allow content */
        }

        .investment-details-expanded p {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem; /* Adjusted margin */
            font-size: 0.9rem; /* Slightly larger font on mobile */
            color: #d0d0d0;
        }
        .investment-details-expanded p svg {
            margin-right: 8px; /* Adjusted margin */
            color: #90D0D0; /* Teal for detail icons */
            width: 18px; /* Slightly larger icons */
            height: 18px;
        }
        .investment-details-expanded .detail-label {
            font-weight: 600;
            color: #c0d0e0;
            margin-right: 5px; /* Adjusted margin */
        }

        @media (min-width: 768px) {
            .investment-details-expanded {
                padding: 1.2rem; /* Restore padding on desktop */
                margin-top: 1.2rem; /* Restore margin */
            }
            .investment-details-expanded p {
                margin-bottom: 0.6rem; /* Restore margin */
                font-size: 1.0rem; /* Restore font size */
            }
            .investment-details-expanded p svg {
                margin-right: 10px; /* Restore margin */
                width: 20px; /* Restore icon size */
                height: 20px;
            }
            .investment-details-expanded .detail-label {
                margin-right: 6px; /* Restore margin */
            }
        }


        /* Quick Links */
        .sidebar-content a {
            color: #90CAF9; /* Lighter blue for links */
            font-weight: 600;
        }
        .sidebar-content a:hover {
            color: #BBDEFB; /* Even lighter on hover */
            text-decoration: underline; /* Underline on hover */
        }

        /* Daily Percentage Animation (kept for consistency, but logic changed in JS) */
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.9; }
            100% { transform: scale(1); opacity: 1; }
        }

        .daily-percentage-animated {
            animation: pulse 2s infinite ease-in-out;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85); /* Darker overlay */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(10px); /* More pronounced frosted glass effect */
            padding: 1.5rem; /* Add padding to overlay for small screens */
            box-sizing: border-box;
        }

        .modal-content {
            background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%); /* Darker modal background */
            padding: 1.8rem; /* Adjusted padding for mobile */
            border-radius: 1.2rem; /* Slightly more rounded on mobile */
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.7); /* Stronger shadow */
            width: 100%; /* Full width on mobile */
            max-width: 580px; /* Slightly wider default max-width */
            position: relative;
            animation: fadeIn 0.3s ease-out;
            border: 1px solid rgba(255, 255, 255, 0.18); /* Subtle border */
            overflow-y: auto; /* Allow scrolling if content overflows */
            max-height: 90vh; /* Limit height on mobile */
        }

        @media (min-width: 768px) {
            .modal-content {
                padding: 2.8rem; /* Restore larger padding on desktop */
                border-radius: 1.7rem; /* Restore rounded on desktop */
                max-height: auto; /* Remove max height on desktop */
            }
        }

        /* Specific style for the Invest Modal to make it larger */
        #investModal .modal-content {
            max-width: 900px; /* Larger width for invest modal */
            display: grid;
            grid-template-columns: 1fr; /* Single column on mobile */
            gap: 1.8rem; /* Adjusted gap for mobile */
        }

        @media (min-width: 768px) {
            #investModal .modal-content {
                grid-template-columns: 1fr 1.5fr; /* Two columns for larger screens */
                gap: 2.5rem; /* Restore gap on desktop */
            }
        }

        /* Specific style for the Investment Details Modal to make it larger */
        #investmentDetailsModal .modal-content {
            max-width: 900px; /* Larger width for invest modal */
            display: grid;
            grid-template-columns: 1fr; /* Single column on mobile */
            gap: 1.8rem; /* Adjusted gap for mobile */
        }

        @media (min-width: 768px) {
            #investmentDetailsModal .modal-content {
                grid-template-columns: 1fr 1.5fr; /* Two columns for larger screens */
                gap: 2.5rem; /* Restore gap on desktop */
            }
        }

        /* Specific style for the Feedback Modal to make it larger */
        #feedbackModal .modal-content {
            max-width: 650px; /* Adjusted width for feedback modal */
        }

        /* New: Specific style for Profile Setup Modal */
        #profileSetupModal .modal-content {
            max-width: 550px; /* Adjusted width for profile modal */
        }


        .modal-close-btn {
            position: absolute;
            top: 1rem; /* Adjusted position for mobile */
            right: 1rem; /* Adjusted position for mobile */
            background: none;
            border: none;
            font-size: 1.8rem; /* Slightly larger close button on mobile */
            color: #b0b0b0;
            cursor: pointer;
            transition: color 0.2s ease, transform 0.2s ease;
        }

        @media (min-width: 768px) {
            .modal-close-btn {
                top: 1.5rem; /* Restore position on desktop */
                right: 1.5rem; /* Restore position on desktop */
                font-size: 2.2rem; /* Restore size on desktop */
            }
        }
        .modal-close-btn:hover {
            color: #e0e0e0;
            transform: rotate(90deg);
        }

        .modal-title {
            font-size: 1.9rem; /* Slightly larger modal title on mobile */
            font-weight: 700;
            color: #c0d0e0;
            margin-bottom: 2rem; /* Adjusted space */
            text-align: center;
            grid-column: 1 / -1; /* Span all columns in grid */
            text-shadow: 0 0 5px rgba(192, 208, 224, 0.2);
        }

        @media (min-width: 768px) {
            .modal-title {
                font-size: 2.4rem; /* Restore size on desktop */
                margin-bottom: 2.5rem; /* Restore space */
            }
        }

        .transaction-item {
            background-color: #3a3a3a;
            border-radius: 0.8rem;
            padding: 1.1rem 1.3rem; /* Adjusted padding for mobile */
            margin-bottom: 0.8rem; /* Adjusted margin */
            display: flex;
            flex-direction: column; /* Stack details vertically on mobile */
            align-items: flex-start; /* Align to start on mobile */
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.07);
            transition: background-color 0.2s ease, transform 0.1s ease;
        }

        @media (min-width: 768px) {
            .transaction-item {
                padding: 1.2rem 1.8rem; /* Restore padding on desktop */
                margin-bottom: 1rem; /* Restore margin */
                flex-direction: row; /* Restore horizontal layout on desktop */
                justify-content: space-between; /* Restore space-between on desktop */
                align-items: center; /* Restore alignment on desktop */
                border-radius: 1rem; /* Restore rounded on desktop */
            }
        }
        .transaction-item:hover {
            background-color: #424242;
            transform: translateX(4px); /* Slightly more movement */
        }

        .transaction-item div {
            flex-grow: 1;
        }

        .transaction-type {
            font-weight: 700;
            color: #76E076; /* Green for positive transactions */
            font-size: 1.1rem; /* Adjusted font size */
        }
        .transaction-type.withdrawal {
            color: #FF6B6B; /* Red for negative transactions */
        }

        .transaction-amount {
            font-weight: 700;
            text-align: left; /* Align left on mobile */
            font-size: 1.1rem; /* Adjusted font size */
            margin-top: 0.4rem; /* Space when stacked */
            color: #f0f0f0;
        }
        @media (min-width: 768px) {
            .transaction-amount {
                text-align: right; /* Restore align right on desktop */
                margin-top: 0; /* Remove margin when horizontal */
            }
            }
        .transaction-date {
            font-size: 0.85rem; /* Slightly larger font on mobile */
            color: #b0b0b0;
            text-align: left; /* Align left on mobile */
        }
        @media (min-width: 768px) {
            .transaction-date {
                font-size: 0.95rem; /* Restore font size on desktop */
                text-align: right; /* Restore align right on desktop */
            }
        }

        /* User ID display */
        #userIdDisplay {
            word-break: break-all; /* Ensures long IDs wrap */
            font-size: 0.8rem; /* Slightly larger font on mobile */
            color: #a0a0a0;
            margin-top: 1.2rem; /* Adjusted margin */
            text-align: center;
            padding: 0.6rem; /* Adjusted padding */
            background-color: #383838; /* Slightly darker background */
            border-radius: 0.6rem; /* Adjusted rounded corners */
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3); /* Deeper inner shadow */
        }
        @media (min-width: 768px) {
            #userIdDisplay {
                font-size: 0.9rem; /* Restore font size on desktop */
                margin-top: 1.4rem; /* Restore margin */
                padding: 0.7rem; /* Restore padding */
                border-radius: 0.7rem; /* Restore rounded corners */
            }
        }

        /* New styles for investment details in modal */
        .investment-details-card {
            background-color: #3a3a3a;
            border-radius: 0.9rem; /* Slightly more rounded on mobile */
            padding: 1.5rem; /* Adjusted padding for mobile */
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.4); /* Deeper inner shadow */
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        @media (min-width: 768px) {
            .investment-details-card {
                border-radius: 1.2rem; /* Restore rounded on desktop */
                padding: 2rem; /* Restore padding on desktop */
            }
        }

        .investment-details-card h4 {
            font-size: 1.5rem; /* Slightly larger h4 on mobile */
            font-weight: 700;
            color: #76E076;
            margin-bottom: 1.1rem; /* Adjusted margin */
            text-shadow: 0 0 5px rgba(118, 224, 118, 0.3);
        }
        @media (min-width: 768px) {
            .investment-details-card h4 {
                font-size: 1.7rem; /* Restore size on desktop */
                margin-bottom: 1.3rem; /* Restore margin */
            }
        }

        .investment-details-card p {
            font-size: 0.95rem; /* Slightly larger font on mobile */
            color: #e0e0e0;
            margin-bottom: 0.6rem; /* Adjusted margin */
            display: flex;
            align-items: flex-start; /* Align to start for multi-line descriptions */
        }
        @media (min-width: 768px) {
            .investment-details-card p {
                font-size: 1.05rem; /* Restore font size on desktop */
                margin-bottom: 0.7rem; /* Restore margin */
                align-items: center; /* Restore alignment on desktop */
            }
        }
        .investment-details-card p svg {
            margin-right: 9px; /* Adjusted margin */
            color: #90D0D0;
            flex-shrink: 0; /* Prevent icon from shrinking */
            width: 21px; /* Slightly larger size */
            height: 21px;
        }
        @media (min-width: 768px) {
            .investment-details-card p svg {
                margin-right: 11px; /* Restore margin */
                width: 23px; /* Restore size */
                height: 23px;
            }
        }

        .investment-details-card .detail-label {
            font-weight: 600;
            color: #c0d0e0;
        }

        /* Flex container for duration input and unit */
        .duration-input-group {
            display: flex;
            flex-direction: column; /* Stack on mobile */
            gap: 0.7rem; /* Adjusted gap */
            align-items: flex-start;
        }
        @media (min-width: 768px) {
            .duration-input-group {
                flex-direction: row; /* Restore row on desktop */
                gap: 14px; /* Restore gap */
                align-items: center;
            }
        }
        .duration-input-group input {
            flex-grow: 1;
        }
        .duration-input-group select {
            width: 100%; /* Full width on mobile */
            min-width: unset; /* Remove min-width on mobile */
        }
        @media (min-width: 768px) {
            .duration-input-group select {
                width: auto; /* Restore auto width on desktop */
                min-width: 120px; /* Restore min-width on desktop */
            }
        }

        /* Styles for confirmation modal */
        .confirmation-modal-content {
            background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%);
            padding: 1.8rem; /* Adjusted padding for mobile */
            border-radius: 1.2rem; /* Slightly more rounded on mobile */
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.6);
            width: 90%;
            max-width: 480px;
            text-align: center;
            position: relative;
            animation: fadeIn 0.3s ease-out;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        @media (min-width: 768px) {
            .confirmation-modal-content {
                padding: 2.8rem; /* Restore padding on desktop */
                border-radius: 1.7rem; /* Restore rounded on desktop */
            }
        }
        .confirmation-modal-content h3 {
            font-size: 1.7rem; /* Slightly larger h3 on mobile */
            color: #c0d0e0;
            margin-bottom: 1.4rem; /* Adjusted margin */
            text-shadow: 0 0 5px rgba(192, 208, 224, 0.2);
        }
        @media (min-width: 768px) {
            .confirmation-modal-content h3 {
                font-size: 2.1rem; /* Restore size on desktop */
                margin-bottom: 2rem; /* Restore margin */
            }
        }
        .confirmation-modal-content p {
            color: #e0e0e0;
            margin-bottom: 2rem; /* Adjusted margin */
            font-size: 1rem; /* Slightly larger font on mobile */
        }
        @media (min-width: 768px) {
            .confirmation-modal-content p {
                margin-bottom: 2.5rem; /* Restore margin */
                font-size: 1.1rem; /* Restore font size */
            }
        }
        .confirmation-modal-buttons {
            display: flex;
            flex-direction: column; /* Stack buttons on mobile */
            gap: 1.2rem; /* Adjusted gap */
        }
        @media (min-width: 768px) {
            .confirmation-modal-buttons {
                flex-direction: row; /* Restore row on desktop */
                justify-content: space-around;
                gap: 1.5rem; /* Restore gap */
            }
        }

        /* Success/Error Message in Modals (now used for toasts) */
        .modal-message {
            margin-top: 1.2rem; /* Adjusted margin */
            font-weight: 600;
            padding: 0.8rem; /* Adjusted padding */
            border-radius: 0.6rem; /* Adjusted rounded corners */
            text-align: center;
            font-size: 0.95rem; /* Slightly larger font on mobile */
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
        }
        @media (min-width: 768px) {
            .modal-message {
                margin-top: 1.4rem; /* Restore margin */
                padding: 1rem; /* Restore padding */
                border-radius: 0.7rem; /* Restore rounded corners */
                font-size: 1.1rem; /* Restore font size */
            }
        }
        .modal-message.success {
            background-color: rgba(92, 184, 92, 0.25); /* Green background */
            color: #76E076; /* Green text */
        }
        .modal-message.error {
            background-color: rgba(255, 107, 107, 0.25); /* Red background */
            color: #FF6B6B; /* Red text */
        }
        .modal-message.info {
            background-color: rgba(144, 208, 208, 0.25); /* Teal background */
            color: #90D0D0; /* Teal text */
        }

        /* New: Toast Notification Styles */
        #toastContainer {
            position: fixed;
            top: 25px; /* Slightly lower */
            right: 25px; /* Slightly further from edge */
            z-index: 1100; /* Above modals */
            display: flex;
            flex-direction: column;
            gap: 12px; /* Slightly more gap between toasts */
            pointer-events: none; /* Allow clicks to pass through */
        }

        .toast-message {
            background-color: #3a3a3a;
            color: #e0e0e0;
            padding: 14px 22px; /* Slightly larger padding */
            border-radius: 9px; /* Slightly more rounded */
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.35); /* Stronger shadow */
            opacity: 0;
            transform: translateY(-25px); /* Slightly more movement */
            animation: slideInToast 0.4s forwards, fadeOutToast 0.5s 2.5s forwards;
            min-width: 260px; /* Slightly wider */
            max-width: 360px; /* Slightly wider */
            text-align: center;
            font-weight: 600;
            pointer-events: auto; /* Re-enable clicks on the toast itself */
            border: 1px solid rgba(255, 255, 255, 0.12); /* Slightly more defined border */
        }

        .toast-message.success {
            background-color: #4CAF50;
            color: white;
            border-color: #66BB6A;
        }

        .toast-message.error {
            background-color: #EF5350;
            color: white;
            border-color: #FF6B6B;
        }

        .toast-message.info {
            background-color: #26A69A;
            color: white;
            border-color: #4DB6AC;
        }

        /* New: Toast animations */
        @keyframes slideInToast {
            from { opacity: 0; transform: translateY(-25px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeOutToast {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-25px); }
        }

        /* New: Loading Spinner Styles */
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid #fff;
            border-radius: 50%;
            width: 18px; /* Slightly larger */
            height: 18px; /* Slightly larger */
            animation: spin 1s linear infinite;
            margin-left: 10px; /* Slightly more margin */
            display: inline-block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Style for input error feedback */
        .input-error {
            border-color: #FF6B6B;
            box-shadow: 0 0 0 6px rgba(255, 107, 107, 0.35); /* Slightly larger shadow */
        }
        .error-text {
            color: #FF6B6B;
            font-size: 0.9rem; /* Slightly larger */
            margin-top: 0.3rem; /* Adjusted margin */
            margin-left: 0.6rem; /* Adjusted margin */
        }

        /* Styles for the new projection table */
        .projection-table-header {
            display: flex;
            justify-content: space-between;
            font-weight: 700;
            color: #c0d0e0;
            padding-bottom: 0.6rem; /* Slightly more padding */
            margin-bottom: 0.6rem; /* Slightly more margin */
            border-bottom: 1px solid rgba(255, 255, 255, 0.12); /* Slightly more defined */
            font-size: 0.95rem; /* Slightly larger header font on mobile */
        }
        .projection-table-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0; /* Slightly more padding */
            border-bottom: 1px dashed rgba(255, 255, 255, 0.06); /* Slightly more defined */
            font-size: 0.9rem; /* Slightly larger row font on mobile */
        }
        .projection-table-row:last-child {
            border-bottom: none;
        }
        .projection-table-row span {
            flex: 1;
            text-align: right;
        }
        .projection-table-row span:first-child {
            text-align: left;
            flex: 0.8; /* Adjust width for day column */
        }
        .projection-table-container {
            max-height: 380px; /* Slightly taller for more content */
            overflow-y: auto;
            background-color: #2d2d2d;
            border-radius: 0.7rem; /* Slightly more rounded */
            padding: 1.2rem; /* Slightly more padding */
            border: 1px solid rgba(255, 255, 255, 0.1); /* Slightly more defined */
            box-shadow: inset 0 3px 7px rgba(0,0,0,0.4); /* Deeper inner shadow */
        }
        .projection-table-empty-message {
            text-align: center;
            color: #a0a0a0;
            padding: 2.5rem; /* Slightly more padding */
            font-style: italic;
        }

        /* New style for the total projected amount */
        #finalProjectedTotal {
            font-size: 1.6rem; /* Slightly larger */
            font-weight: 800;
            color: #76E076;
            text-align: center;
            margin-top: 1.8rem; /* Slightly more margin */
            padding-top: 1.2rem; /* Slightly more padding */
            border-top: 2px solid rgba(118, 224, 118, 0.4); /* Stronger border */
            text-shadow: 0 0 12px rgba(118, 224, 118, 0.8); /* Stronger glow */
        }

        @media (min-width: 768px) {
            .projection-table-header {
                font-size: 1.05rem; /* Restore header font on desktop */
            }
            .projection-table-row {
                font-size: 1rem; /* Restore row font on desktop */
            }
            #finalProjectedTotal {
                font-size: 1.9rem; /* Slightly larger */
            }
        }

        /* Auth Container Specific Styles (now unused, but kept for reference if needed) */
        #auth-container {
            display: none; /* Hide permanently */
        }

        /* New Feature: Investment Goal Tracker Styles */
        .goal-tracker-container {
            margin-top: 2rem; /* Slightly more margin */
            text-align: center;
        }
        .goal-progress-bar {
            width: 100%;
            background-color: #3a3a3a;
            border-radius: 0.6rem; /* Slightly more rounded */
            height: 1.3rem; /* Thicker progress bar */
            overflow: hidden;
            margin-top: 1.2rem; /* Slightly more margin */
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.3);
        }
        .goal-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #5CB85C, #76E076); /* Green gradient fill */
            border-radius: 0.6rem;
            width: 0%;
            transition: width 1s ease-out; /* Smooth animation for progress */
            box-shadow: 0 0 10px rgba(118, 224, 118, 0.8); /* Stronger glow on fill */
        }
        .goal-percentage {
            font-weight: 700;
            color: #76E076;
            margin-top: 0.6rem; /* Slightly more margin */
            font-size: 1.15rem; /* Slightly larger */
        }
        .goal-amount-display {
            font-size: 1.25rem; /* Slightly larger */
            font-weight: 600;
            color: #e0e0e0;
            margin-top: 0.6rem; /* Slightly more margin */
        }
        .goal-name-display {
            font-size: 1.5rem; /* Slightly larger */
            font-weight: 700;
            color: #c0d0e0;
            margin-bottom: 0.9rem; /* Slightly more margin */
        }

        /* New Feature: Daily Market Insights Styles */
        .market-insight-card {
            background: linear-gradient(45deg, #303030 0%, #404040 100%);
            border-radius: 2.25rem;
            padding: 1.8rem;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4), inset 0 0 12px rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            margin-top: 2rem; /* Slightly more margin */
        }
        .market-insight-text {
            font-size: 1rem; /* Slightly larger */
            color: #d0d0d0;
            line-height: 1.6;
            margin-bottom: 1.2rem; /* Slightly more margin */
        }
        .market-insight-source {
            font-size: 0.85rem; /* Slightly larger */
            color: #a0a0a0;
            font-style: italic;
        }
        .market-insight-icon {
            width: 26px; /* Slightly larger */
            height: 26px;
            margin-right: 12px; /* Slightly more margin */
            color: #90D0D0; /* Teal color for insight icons */
            vertical-align: middle;
        }

        /* Improved Form Layouts */
        .form-group {
            margin-bottom: 1rem; /* Consistent spacing */
        }
        .form-group label {
            display: block; /* Ensure label is on its own line */
            margin-bottom: 0.5rem; /* Space between label and input */
            font-size: 0.95rem; /* Slightly larger label font for better fit */
            font-weight: 600; /* Make labels a bit bolder */
            color: #c0d0e0; /* Softer color for labels */
        }
        .form-group input, .form-group select, .form-group textarea {
            margin-top: 0; /* Remove default margin-top if label is block */
        }

        /* Adjustments for smaller screens on specific elements */
        @media (max-width: 640px) {
            .main-content, .sidebar-content {
                padding-left: 0.8rem; /* Increased padding */
                padding-right: 0.8rem; /* Increased padding */
            }
            .dashboard-container {
                padding: 1.8rem; /* Reduce overall container padding on very small screens */
                gap: 1.6rem;
            }
            .card {
                padding: 1.4rem; /* Reduce card padding on very small screens */
            }
            .section-title {
                font-size: 1.9rem; /* Slightly smaller title on very small screens */
                margin-bottom: 1.6rem;
            }
            .metric-value {
                font-size: 1.9rem; /* Smaller metric values on very small screens */
            }
            .metric-label {
                font-size: 0.9rem; /* Smaller labels on very small screens */
            }
            .btn-primary {
                padding: 0.9rem 1.6rem; /* Smaller button padding */
                font-size: 0.9rem; /* Smaller button font */
            }
            input[type="number"], input[type="text"], input[type="email"], input[type="password"], textarea, select {
                padding: 0.8rem 1.1rem; /* Smaller input padding */
                font-size: 0.9rem; /* Smaller input font */
            }
            .modal-content {
                padding: 1.8rem; /* Smaller modal padding */
            }
            .modal-title {
                font-size: 1.7rem; /* Smaller modal title */
                margin-bottom: 1.8rem;
            }
            .transaction-item {
                padding: 1rem 1.3rem; /* Smaller transaction item padding */
                font-size: 0.95rem;
            }
            .investment-item {
                padding: 1.1rem 1.3rem;
                gap: 0.5rem 1.1rem;
            }
            .investment-name {
                font-size: 1.1rem;
            }
            .investment-type {
                font-size: 0.85rem;
            }
            .investment-value {
                font-size: 1rem;
            }
        }

        /* New style for the Maximize Your Experience card */
        .maximize-experience-card {
            background: linear-gradient(135deg, #353535 0%, #454545 100%); /* Different, slightly lighter gradient for this card */
            border-radius: 2.5rem; /* More rounded */
            padding: 2.2rem; /* Adjusted padding */
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.6), inset 0 0 18px rgba(255, 255, 255, 0.05); /* Stronger shadow */
            border: 2px solid rgba(255, 255, 255, 0.15); /* More prominent border */
            margin-top: 3rem; /* More space above it */
        }
        .maximize-experience-card ul li {
            margin-bottom: 1.2rem; /* More space between list items */
            align-items: flex-start; /* Ensure icons align to top for multi-line text */
        }
        .maximize-experience-card ul li:last-child {
            margin-bottom: 0;
        }
        .maximize-experience-card svg {
            margin-top: 0.25rem; /* Adjust icon vertical alignment */
        }

        /* New: Profile Card specific styles */
        #profileCard {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 2rem;
        }
        #profileAvatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: #5CB85C; /* Green background for avatar */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: 700;
            color: white;
            margin-bottom: 1rem;
            box-shadow: 0 0 15px rgba(92, 184, 92, 0.7); /* Glow around avatar */
            border: 3px solid rgba(255, 255, 255, 0.2);
        }
        #profileFullName {
            font-size: 1.8rem;
            font-weight: 800;
            color: #e0e0e0;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 8px rgba(224, 224, 224, 0.2);
        }
        #profileBio {
            font-size: 1rem;
            color: #b0b0b0;
            line-height: 1.5;
            margin-bottom: 1.5rem;
        }
        #profileSetupCta {
            text-align: center;
            color: #a0a0a0;
            margin-top: 1rem;
        }
        #profileSetupCta button {
            margin-top: 0.8rem;
        }
    </style>
</head>
<body>
    <!-- Authentication Container (This section is now permanently hidden via CSS, as login/create account functionality has been removed for a direct dashboard experience.) -->
    <div id="auth-container" style="display: none;">
        <!-- Content for login/create account forms would go here if enabled -->
    </div>

    <!-- Main Dashboard Container -->
    <div id="dashboard-container" class="dashboard-container">
        <!-- Main Content Area -->
        <div class="main-content">
            <h1 class="section-title text-center mb-6">Grow-with-Core Dashboard</h1>
            <p class="text-center text-gray-400 mb-8 max-w-2xl mx-auto text-sm sm:text-base">
                Welcome to your Grow-with-Core investment hub. Explore real-time investment simulations, manage your portfolio, and track your financial journey.
            </p>

            <!-- User ID Display -->
            <div id="userIdDisplay" class="mb-8">
                Loading User ID...
            </div>

            <!-- New: My Profile Section -->
            <div class="card mb-10" id="profileCard">
                <h2 class="section-title">My Profile</h2>
                <div id="profileContent">
                    <!-- Profile content will be rendered here by JS -->
                    <div id="profileAvatar">?</div>
                    <p id="profileFullName" class="text-xl font-semibold">Guest User</p>
                    <p id="profileBio" class="text-gray-400 text-sm">Set up your profile to personalize your experience!</p>
                    <div id="profileSetupCta">
                        <button id="openProfileSetupModalBtn" class="btn-primary mt-4">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user-cog mr-2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="10" r="3"/><path d="M7.9 20.9c-.7-.7-1.4-1.5-1.9-2.4a6.5 6.5 0 0 1-.5-3.5c.3-1.4.9-2.7 1.8-3.8.9-1.1 2.1-2 3.4-2.7.7-.4 1.5-.7 2.3-.9.8-.2 1.6-.3 2.5-.2.9.1 1.7.4 2.5.8.8.4 1.5.9 2.1 1.6.6.7 1.1 1.5 1.4 2.4.3.9.4 1.9.3 2.9-.1 1-.4 2-.8 2.9-.4.9-.9 1.7-1.6 2.4"/><path d="M19 12v1"/><path d="M19.5 14.5l.7.7"/><path d="M18 17h1"/><path d="M14.5 19.5l.7.7"/><path d="M12 20v1"/><path d="M9.5 19.5l-.7.7"/><path d="M7 17H6"/><path d="M4.5 14.5l-.7.7"/></svg>
                            <span>Set Up Your Profile</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Investment Overview Section -->
            <div class="card mb-10">
                <h2 class="section-title">Investment Overview</h2>
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-8">
                    <div class="metric-box">
                        <div class="icon-svg">
                            <!-- Wallet icon for available balance -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-wallet"><path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h12a2 2 0 0 1 0 4H5a2 2 0 0 0 0 4h12a2 2 0 0 0 2-2v-3"/><path d="M10 12h6"/></svg>
                        </div>
                        <div class="metric-value" id="availableBalance">0.00</div>
                        <div class="metric-label">Available Balance</div>
                    </div>
                    <div class="metric-box">
                        <div class="icon-svg">
                            <!-- Hand holding dollar icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-hand-holding-dollar"><path d="M11 15h2a2 2 0 0 0 2-2V7h-2.5a2 2 0 0 1-2-2M12 7V4m-3 6H6a2 2 0 1 0 0 4h3"/><path d="M18 13h2a2 2 0 0 1 0 4h-3l-5 5V3l5 5z"/></svg>
                        </div>
                        <div class="metric-value" id="totalInvested">0.00</div>
                        <div class="metric-label">Total Invested</div>
                    </div>
                    <div class="metric-box">
                        <div class="icon-svg">
                            <!-- Trending Up icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trending-up"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
                        </div>
                        <div class="metric-value" id="currentValue">0.00</div>
                        <div class="metric-label">Current Value</div>
                    </div>
                    <div class="metric-box">
                        <div class="icon-svg">
                            <!-- Piggy Bank icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-piggy-bank"><path d="M19 5c-1.5 0-2.8 1.4-3 2H4"/><path d="M2 8v8a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-1.5"/><path d="M22 12a4 4 0 0 0-4-4H6a4 4 0 0 0 4 4v.5c0 2.2 1.8 4 4 4h12a4 4 0 0 0 4-4V12z"/><path d="M2 16h.01"/><path d="M21 16h.01"/></svg>
                        </div>
                        <div class="metric-value" id="totalProfitLoss">0.00</div>
                        <div class="metric-label">Total Profit/Loss</div>
                    </div>
                </div>

                <h3 class="text-xl font-semibold text-gray-400 mb-4 text-center">Your Active Investments</h3>
                <div id="investmentList">
                    <!-- Investment items will be populated here by JavaScript -->
                    <p class="text-center text-gray-500" id="noInvestmentsMessage">No active investments yet. Start by investing!</p>
                </div>
            </div>

            <!-- New Feature: Investment Goal Tracker -->
            <div class="card mb-10">
                <h2 class="section-title">Investment Goal Tracker</h2>
                <div id="goalTrackerContent" class="goal-tracker-container">
                    <!-- Content populated by JS -->
                    <p class="text-gray-500">Set a financial goal to track your progress!</p>
                    <button id="setGoalBtn" class="btn-primary mt-4">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-target"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>
                        <span>Set a Goal</span>
                    </button>
                </div>
            </div>

            <!-- Portfolio Allocation Chart Section -->
            <div class="card mb-10">
                <h2 class="section-title">Portfolio Allocation</h2>
                <div class="p-2 sm:p-4">
                    <canvas id="portfolioChart"></canvas>
                </div>
                <p class="text-sm text-gray-400 mt-4 text-center">Visual representation of your investment distribution.</p>
            </div>

            <!-- New: Transaction History Section -->
            <div class="card mb-10">
                <h2 class="section-title">Transaction History</h2>
                <div class="flex flex-col sm:flex-row gap-4 mb-6">
                    <div class="flex-1">
                        <label for="transactionFilter" class="block text-gray-300 text-sm font-bold mb-2">Filter by Type</label>
                        <select id="transactionFilter" class="form-select w-full">
                            <option value="All">All Transactions</option>
                            <option value="Deposit">Deposits</option>
                            <option value="Withdrawal">Withdrawals</option>
                            <option value="Investment">Investments</option>
                            <option value="Cash Out">Cash Outs</option>
                        </select>
                    </div>
                    <div class="flex-1">
                        <label for="transactionSort" class="block text-gray-300 text-sm font-bold mb-2">Sort by</label>
                        <select id="transactionSort" class="form-select w-full">
                            <option value="dateDesc">Date (Newest First)</option>
                            <option value="dateAsc">Date (Oldest First)</option>
                            <option value="amountDesc">Amount (High to Low)</option>
                            <option value="amountAsc">Amount (Low to High)</option>
                        </select>
                    </div>
                </div>
                <div id="transactionHistoryList" class="space-y-3">
                    <!-- Transaction items will be populated here by JavaScript -->
                    <p class="text-center text-gray-500" id="noTransactionsMessage">No transactions recorded yet.</p>
                </div>
            </div>

            <!-- New Feature: Daily Market Insights -->
            <div class="market-insight-card mb-10">
                <h2 class="section-title">Daily Market Insights</h2>
                <div id="marketInsightContent">
                    <!-- Content populated by JS -->
                    <p class="text-gray-500">Loading daily insights...</p>
                </div>
            </div>


            <!-- New: Maximize Your Experience Section -->
            <div class="card maximize-experience-card mb-10">
                <h2 class="section-title">Maximize Your Grow-with-Core Experience</h2>
                <p class="text-gray-400 mb-6 text-center text-sm sm:text-base">
                    Unlock the full potential of your dashboard. Heres how you can make the most of Grow-with-Core:
                </p>
                <ul class="space-y-4 text-gray-300 text-sm sm:text-base">
                    <li class="flex items-start">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-wallet-plus mr-3 mt-1 text-green-400 flex-shrink-0"><path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h12a2 2 0 0 1 0 4H5a2 2 0 0 0 0 4h12a2 2 0 0 0 2-2v-3"/><path d="M10 12h6"/><path d="M12 10v4"/></svg>
                        <div>
                            <span class="font-bold text-white">Invest Now:</span> Click the "Invest Now" button in the Quick Actions section to explore various investment opportunities and project your potential returns.
                        </div>
                    </li>
                    <li class="flex items-start">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-wallet-minus mr-3 mt-1 text-red-400 flex-shrink-0"><path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h12a2 2 0 0 1 0 4H5a2 2 0 0 0 0 4h12a2 2 0 0 0 2-2v-3"/><path d="M10 12h6"/><path d="M12 10v4"/></svg>
                        <div>
                            <span class="font-bold text-white">Cash Out:</span> Once an investment matures, use the "Cash Out" option to realize your profits and add funds back to your available balance.
                        </div>
                    </li>
                    <li>
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-dollar-sign mr-3 mt-1 text-green-400 flex-shrink-0"><circle cx="12" cy="12" r="10"/><path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"/><path d="M12 3v18"/></svg>
                        <div>
                            <span class="font-bold text-white">Deposit Funds:</span> Easily add more funds to your account balance using the secure Paystack integration.
                        </div>
                    </li>
                    <li>
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-credit-card mr-3 mt-1 text-red-400 flex-shrink-0"><rect width="20" height="14" x="2" y="5" rx="2"/><path d="M2 10h20"/></svg>
                        <div>
                            <span class="font-bold text-white">Withdraw Funds:</span> Transfer funds from your available balance to your external accounts.
                        </div>
                    </li>
                    <li class="flex items-start">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-activity mr-3 mt-1 text-blue-400 flex-shrink-0"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
                        <div>
                            <span class="font-bold text-white">Track Performance:</span> Monitor your "Daily Performance" and review all your financial activities in the "Transaction History" section.
                        </div>
                    </li>
                    <li class="flex items-start">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-square-more mr-3 mt-1 text-purple-400 flex-shrink-0"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/><path d="M8 10h.01"/><path d="M12 10h.01"/><path d="M16 10h.01"/></svg>
                        <div>
                            <span class="font-bold text-white">Provide Feedback:</span> Use the "Feedback/Support" button to share your thoughts or get assistance.
                        </div>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Sidebar / Daily Performance & Quick Links -->
        <div class="sidebar-content">
            <!-- Daily Performance Section -->
            <div class="card mb-6 sm:mb-10">
                <h2 class="section-title">Daily Performance</h2>
                <div class="metric-box">
                    <div class="icon-svg">
                        <!-- Activity icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-activity"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
                    </div>
                    <div class="metric-value text-green-400 daily-percentage-animated" id="dailyPercentage">+0.00%</div>
                    <div class="metric-label">Today's Market Gain</div>
                    <p class="text-xs text-gray-400 mt-1 sm:mt-2">Based on simulated market data.</p>
                </div>
            </div>

            <!-- Quick Actions Section -->
            <div class="card">
                <h2 class="section-title">Quick Actions</h2>
                <ul class="space-y-3 sm:space-y-4">
                    <li>
                        <button id="openInvestModalBtn" class="btn-primary w-full">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-wallet-plus mr-2"><path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h12a2 2 0 0 1 0 4H5a2 2 0 0 0 0 4h12a2 2 0 0 0 2-2v-3"/><path d="M10 12h6"/><path d="M12 10v4"/></svg>
                            <span>Invest Now</span>
                        </button>
                    </li>
                    <li>
                        <button id="openCashOutModalBtn" class="btn-primary w-full !bg-red-600 hover:!bg-red-700">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-wallet-minus mr-2"><path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h12a2 2 0 0 1 0 4H5a2 2 0 0 0 0 4h12a2 2 0 0 0 2-2v-3"/><path d="M10 12h6"/><path d="M12 10v4"/></svg>
                            <span>Cash Out</span>
                        </button>
                    </li>
                    <li>
                        <button id="openDepositModalBtn" class="btn-primary w-full">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-dollar-sign mr-2"><circle cx="12" cy="12" r="10"/><path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"/><path d="M12 3v18"/></svg>
                            <span>Deposit Funds</span>
                        </button>
                    </li>
                    <li>
                        <button id="openWithdrawModalBtn" class="btn-primary w-full !bg-red-600 hover:!bg-red-700">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-credit-card mr-2"><rect width="20" height="14" x="2" y="5" rx="2"/><path d="M2 10h20"/></svg>
                            <span>Withdraw Funds</span>
                        </button>
                    </li>
                    <li>
                        <button id="openProfileSetupModalBtnSidebar" class="btn-primary w-full !bg-blue-600 hover:!bg-blue-700">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user-cog mr-2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="10" r="3"/><path d="M7.9 20.9c-.7-.7-1.4-1.5-1.9-2.4a6.5 6.5 0 0 1-.5-3.5c.3-1.4.9-2.7 1.8-3.8.9-1.1 2.1-2 3.4-2.7.7-.4 1.5-.7 2.3-.9.8-.2 1.6-.3 2.5-.2.9.1 1.7.4 2.5.8.8.4 1.5.9 2.1 1.6.6.7 1.1 1.5 1.4 2.4.3.9.4 1.9.3 2.9-.1 1-.4 2-.8 2.9-.4.9-.9 1.7-1.6 2.4"/><path d="M19 12v1"/><path d="M19.5 14.5l.7.7"/><path d="M18 17h1"/><path d="M14.5 19.5l.7.7"/><path d="M12 20v1"/><path d="M9.5 19.5l-.7.7"/><path d="M7 17H6"/><path d="M4.5 14.5l-.7.7"/></svg>
                            <span>Set Up Profile</span>
                        </button>
                    </li>
                    <li>
                        <button id="openFeedbackModalBtn" class="btn-primary w-full !bg-purple-600 hover:!bg-purple-700">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-square-more mr-2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/><path d="M8 10h.01"/><path d="M12 10h.01"/><path d="M16 10h.01"/></svg>
                            <span>Feedback / Support</span>
                        </button>
                    </li>
                    <li>
                        <button id="openResetDataModalBtn" class="btn-primary w-full !bg-gray-700 hover:!bg-gray-800">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-rotate-ccw mr-2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.76 2.75L3 8"/><path d="M3 3v5h5"/></svg>
                            <span>Reset All Data</span>
                        </button>
                    </li>
                    <li>
                        <button id="startFreshBtn" class="btn-primary w-full !bg-blue-600 hover:!bg-blue-700">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-ccw mr-2"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.76 2.75L3 8"/><path d="M3 3v5h5"/></svg>
                            <span>Start Fresh</span>
                        </button>
                    </li>
                    <li>
                        <button id="logoutBtn" class="btn-primary w-full !bg-red-800 hover:!bg-red-900">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-out mr-2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>
                            <span>Logout</span>
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Modals -->

    <!-- Invest Modal -->
    <div id="investModal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-btn" id="closeInvestModalBtn">&times;</button>
            <h3 class="modal-title">Make a New Investment</h3>

            <!-- Left column: Investment Details & Inputs -->
            <div class="space-y-4">
                <div class="form-group">
                    <label for="investmentCategory">Investment Category</label>
                    <select id="investmentCategory" class="form-select">
                        <option value="">Select Category</option>
                        <option value="Farming">Farming</option>
                        <option value="Rearing">Rearing</option>
                        <option value="Other Opportunities">Other Opportunities</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="investmentType">Investment Type</label>
                    <select id="investmentType" class="form-select" disabled>
                        <option value="">Select Type</option>
                    </select>
                </div>

                <!-- Investment Details Display -->
                <div id="investmentTypeDetails" class="investment-details-card hidden">
                    <h4 id="detailsTypeName"></h4>
                    <p><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-info"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg><span class="detail-label">Description:</span> <span id="detailsDescription"></span></p>
                    <p><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-dollar-sign"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 1 1 0 7H6"/></svg><span class="detail-label">Typical Daily Return:</span> <span id="detailsReturnRange"></span></p>
                    <p><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg><span class="detail-label">Minimum Duration:</span> <span id="detailsMinDuration"></span></p>
                </div>

                <div class="form-group">
                    <label for="investmentAmount">Investment Amount ()</label>
                    <input type="number" id="investmentAmount" class="form-input" placeholder="e.g., 10000" min="5000">
                    <p id="investmentAmountError" class="error-text hidden"></p>
                </div>
                <div class="form-group">
                    <label for="investmentDuration">Investment Duration</label>
                    <div class="duration-input-group">
                        <input type="number" id="investmentDuration" class="form-input" placeholder="e.g., 12" min="1">
                        <select id="investmentDurationUnit" class="form-select">
                            <option value="months">Months</option>
                            <option value="years">Years</option>
                        </select>
                    </div>
                    <p id="investmentDurationError" class="error-text hidden"></p>
                </div>
                <button id="submitInvestmentBtn" class="btn-primary w-full">
                    <span>Invest</span>
                </button>
            </div>

            <!-- Right column: Projection Breakdown -->
            <div class="investment-details-card flex flex-col justify-between">
                <h4 class="text-center">Projected Daily Growth Breakdown</h4>
                <div id="projectionTableContainer" class="projection-table-container flex-grow">
                    <!-- Projection details will be populated here by JavaScript -->
                    <p class="projection-table-empty-message">Enter investment details to see a daily breakdown.</p>
                </div>
                <p class="text-sm text-gray-400 text-center mt-2 sm:mt-4" id="projectionInfo">
                    This breakdown illustrates your projected investment growth with **daily additions**, where a fluctuating percentage (4.5% to 5%) of your initial investment is added each day.
                </p>
                <p class="text-xs text-gray-500 text-center mt-2" id="projectionBasisLabel"></p>
                <div id="finalProjectedTotal" class="hidden"></div>
            </div>
        </div>
    </div>

    <!-- Cash Out Modal -->
    <div id="cashOutModal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-btn" id="closeCashOutModalBtn">&times;</button>
            <h3 class="modal-title">Cash Out Investment</h3>
            <div class="space-y-4">
                <div class="form-group">
                    <label for="cashOutInvestmentSelect">Select Investment</label>
                    <select id="cashOutInvestmentSelect" class="form-select">
                        <option value="">Select an active investment</option>
                    </select>
                    <p id="cashOutInvestmentSelectError" class="error-text hidden"></p>
                </div>
                <div class="form-group">
                    <label for="cashOutAmount">Amount to Cash Out ()</label>
                    <input type="number" id="cashOutAmount" class="form-input" placeholder="e.g., 5000" min="100">
                    <p id="cashOutAmountError" class="error-text hidden"></p>
                </div>
                <button id="submitCashOutBtn" class="btn-primary w-full !bg-red-600 hover:!bg-red-700">
                    <span>Confirm Cash Out</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Deposit Funds Modal -->
    <div id="depositModal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-btn" id="closeDepositModalBtn">&times;</button>
            <h3 class="modal-title">Deposit Funds via Paystack</h3>
            <div class="space-y-4">
                <div class="form-group">
                    <label for="depositEmail">Your Email</label>
                    <input type="email" id="depositEmail" class="form-input" placeholder="e.g., your@email.com" required>
                    <p id="depositEmailError" class="error-text hidden"></p>
                </div>
                <div class="form-group">
                    <label for="depositAmount">Deposit Amount ()</label>
                    <input type="number" id="depositAmount" class="form-input" placeholder="e.g., 20000" min="100" required>
                    <p id="depositAmountError" class="error-text hidden"></p>
                </div>
                <button id="submitDepositBtn" class="btn-primary w-full">
                    <span>Proceed to Paystack</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Withdraw Funds Modal -->
    <div id="withdrawModal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-btn" id="closeWithdrawModalBtn">&times;</button>
            <h3 class="modal-title">Withdraw Funds</h3>
            <div class="space-y-4">
                <div class="form-group">
                    <label for="withdrawAmount">Withdraw Amount ()</label>
                    <input type="number" id="withdrawAmount" class="form-input" placeholder="e.g., 5000" min="100">
                    <p id="withdrawAmountError" class="error-text hidden"></p>
                </div>
                <div class="form-group">
                    <label for="bankName">Bank Name</label>
                    <input type="text" id="bankName" class="form-input" placeholder="e.g., Zenith Bank">
                    <p id="bankNameError" class="error-text hidden"></p>
                </div>
                <div class="form-group">
                    <label for="accountNumber">Account Number</label>
                    <input type="text" id="accountNumber" class="form-input" placeholder="e.g., 0123456789">
                    <p id="accountNumberError" class="error-text hidden"></p>
                </div>
                <div class="form-group">
                    <label for="accountName">Account Name</label>
                    <input type="text" id="accountName" class="form-input" placeholder="e.g., John Doe">
                    <p id="accountNameError" class="error-text hidden"></p>
                </div>
                <button id="submitWithdrawBtn" class="btn-primary w-full !bg-red-600 hover:!bg-red-700">
                    <span>Confirm Withdrawal</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Reset Data Confirmation Modal -->
    <div id="resetDataModal" class="modal-overlay hidden">
        <div class="confirmation-modal-content">
            <button class="modal-close-btn" id="closeResetDataModalBtn">&times;</button>
            <h3>Confirm Data Reset</h3>
            <p>Are you sure you want to reset ALL your investment data? This will clear your balance, investments, and transactions. This action cannot be undone.</p>
            <div class="confirmation-modal-buttons">
                <button id="confirmResetDataBtn" class="btn-primary !bg-red-600 hover:!bg-red-700">
                    <span>Yes, Reset All</span>
                </button>
                <button id="cancelResetDataBtn" class="btn-primary !bg-gray-500 hover:!bg-gray-600">
                    <span>Cancel</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Investment Details Modal -->
    <div id="investmentDetailsModal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-btn" id="closeInvestmentDetailsModalBtn">&times;</button>
            <h3 class="modal-title">Investment Details</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Left Column: Basic Details -->
                <div class="investment-details-card">
                    <h4 id="detailModalTypeName"></h4>
                    <p><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tag"><path d="M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414L12.586 22.414a2 2 0 0 0 2.828 0l7.172-7.172a2 2 0 0 0 0-2.828L12.586 2.586z"/><circle cx="7.5" cy="7.5" r=".5" fill="currentColor"/></svg><span class="detail-label">Category:</span> <span id="detailModalCategory"></span></p>
                    <p><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-dollar-sign"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 1 1 0 7H6"/></svg><span class="detail-label">Initial Amount:</span> <span id="detailModalInitialAmount"></span></p>
                    <p><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trending-up"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg><span class="detail-label">Current Value:</span> <span id="detailModalCurrentValue"></span></p>
                    <p><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bar-chart-2"><line x1="18" x2="18" y1="20" y2="10"/><line x1="12" x2="12" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="14"/></svg><span class="detail-label">Total Profit/Loss:</span> <span id="detailModalProfitLoss"></span></p>
                    <p><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg><span class="detail-label">Invest Date:</span> <span id="detailModalInvestDate"></span></p>
                    <p><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg><span class="detail-label">Duration:</span> <span id="detailModalDuration"></span></p>
                    <p><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-circle"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg><span class="detail-label">Maturity:</span> <span id="detailModalMaturity"></span></p>
                </div>
                <!-- Right Column: Daily Growth History -->
                <div class="investment-details-card">
                    <h4 class="text-center">Daily Growth History</h4>
                    <div id="investmentHistoryTableContainer" class="projection-table-container">
                        <p class="projection-table-empty-message">No history available for this investment.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- New Feature: Set Goal Modal -->
    <div id="setGoalModal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-btn" id="closeSetGoalModalBtn">&times;</button>
            <h3 class="modal-title">Set Your Investment Goal</h3>
            <div class="space-y-4">
                <div class="form-group">
                    <label for="goalNameInput">Goal Name</label>
                    <input type="text" id="goalNameInput" class="form-input" placeholder="e.g., New Car, Down Payment">
                    <p id="goalNameError" class="error-text hidden"></p>
                </div>
                <div class="form-group">
                    <label for="goalAmountInput">Target Amount ()</label>
                    <input type="number" id="goalAmountInput" class="form-input" placeholder="e.g., 500000" min="1000">
                    <p id="goalAmountError" class="error-text hidden"></p>
                </div>
                <button id="submitGoalBtn" class="btn-primary w-full">
                    <span>Save Goal</span>
                </button>
                <button id="clearGoalBtn" class="btn-primary w-full !bg-gray-500 hover:!bg-gray-600">
                    <span>Clear Goal</span>
                </button>
            </div>
        </div>
    </div>

    <!-- New Feature: Feedback Modal -->
    <div id="feedbackModal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-btn" id="closeFeedbackModalBtn">&times;</button>
            <h3 class="modal-title">Provide Feedback / Get Support</h3>
            <div class="space-y-4">
                <div class="form-group">
                    <label for="feedbackType">Type</label>
                    <select id="feedbackType" class="form-select">
                        <option value="Feedback">General Feedback</option>
                        <option value="Bug Report">Bug Report</option>
                        <option value="Feature Request">Feature Request</option>
                        <option value="Support">Support Request</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="feedbackMessage">Your Message</label>
                    <textarea id="feedbackMessage" class="form-input" rows="5" placeholder="Tell us what you think or what you need help with..."></textarea>
                    <p id="feedbackMessageError" class="error-text hidden"></p>
                </div>
                <button id="submitFeedbackBtn" class="btn-primary w-full">
                    <span>Submit</span>
                </button>
            </div>
        </div>
    </div>

    <!-- New Feature: Profile Setup Modal -->
    <div id="profileSetupModal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-btn" id="closeProfileSetupModalBtn">&times;</button>
            <h3 class="modal-title">Set Up Your Profile</h3>
            <div class="space-y-4">
                <div class="form-group">
                    <label for="profileFullNameInput">Full Name</label>
                    <input type="text" id="profileFullNameInput" class="form-input" placeholder="e.g., Jane Doe">
                    <p id="profileFullNameError" class="error-text hidden"></p>
                </div>
                <div class="form-group">
                    <label for="profileBioInput">Short Bio / Tagline</label>
                    <textarea id="profileBioInput" class="form-input" rows="3" placeholder="e.g., Passionate investor and farmer."></textarea>
                    <p id="profileBioError" class="error-text hidden"></p>
                </div>
                <button id="submitProfileBtn" class="btn-primary w-full">
                    <span>Save Profile</span>
                </button>
            </div>
        </div>
    </div>


    <!-- New: Toast Notification Container -->
    <div id="toastContainer"></div>

    <script>
        // IMPORTANT SECURITY NOTE:
        // Storing user credentials (even hashed) and sensitive financial data directly in localStorage
        // is HIGHLY INSECURE for a real-world application. This implementation is provided to meet
        // your specific request for local storage persistence without a backend, but it is crucial
        // to understand its limitations. For production, a secure backend with proper authentication
        // and database storage (like Firebase, which was previously used) would be essential.

        // Global state for current user's data
        // Initialize with a default anonymous user ID and email for direct dashboard experience
        let currentUserId = 'guest_user';
        let currentUserEmail = 'guest@growwithcore.com';
        let userInvestments = [];
        let userTransactions = [];
        let userAccountBalance = 0;
        let investmentGoal = null; // Stores the user's investment goal
        let userProfile = { fullName: '', bio: '' }; // New: Stores user profile data

        // Paystack Public Key (from user's request)
        const paystackPublicKey = 'pk_live_fa0e4bf22ce6b0279a243185d983ec121b99979c';

        // DOM Elements
        const dashboardContainer = document.getElementById('dashboard-container');

        const availableBalanceEl = document.getElementById('availableBalance');
        const totalInvestedEl = document.getElementById('totalInvested');
        const currentValueEl = document.getElementById('currentValue');
        const totalProfitLossEl = document.getElementById('totalProfitLoss');
        const investmentListEl = document.getElementById('investmentList');
        const noInvestmentsMessage = document.getElementById('noInvestmentsMessage');
        const transactionHistoryListEl = document.getElementById('transactionHistoryList');
        const noTransactionsMessage = document.getElementById('noTransactionsMessage');
        const userIdDisplay = document.getElementById('userIdDisplay');
        const dailyPercentageEl = document.getElementById('dailyPercentage');
        const toastContainer = document.getElementById('toastContainer');

        // Modals
        const investModal = document.getElementById('investModal');
        const cashOutModal = document.getElementById('cashOutModal');
        const depositModal = document.getElementById('depositModal');
        const withdrawModal = document.getElementById('withdrawModal');
        const resetDataModal = document.getElementById('resetDataModal');
        const investmentDetailsModal = document.getElementById('investmentDetailsModal');
        const setGoalModal = document.getElementById('setGoalModal');
        const feedbackModal = document.getElementById('feedbackModal');
        const profileSetupModal = document.getElementById('profileSetupModal'); // New: Profile Setup Modal

        // Invest Modal specific elements
        const investmentCategorySelect = document.getElementById('investmentCategory');
        const investmentTypeSelect = document.getElementById('investmentType');
        const investmentAmountInput = document.getElementById('investmentAmount');
        const investmentAmountError = document.getElementById('investmentAmountError');
        const investmentDurationInput = document.getElementById('investmentDuration');
        const investmentDurationUnitSelect = document.getElementById('investmentDurationUnit');
        const investmentDurationError = document.getElementById('investmentDurationError');
        const investmentTypeDetails = document.getElementById('investmentTypeDetails');
        const detailsTypeName = document.getElementById('detailsTypeName');
        const detailsDescription = document.getElementById('detailsDescription');
        const detailsReturnRange = document.getElementById('detailsReturnRange');
        const detailsMinDuration = document.getElementById('detailsMinDuration');
        const projectionInfo = document.getElementById('projectionInfo');
        const projectionBasisLabel = document.getElementById('projectionBasisLabel');
        const projectionTableContainer = document.getElementById('projectionTableContainer');
        const finalProjectedTotalEl = document.getElementById('finalProjectedTotal');

        // Cash Out Modal specific elements
        const cashOutInvestmentSelect = document.getElementById('cashOutInvestmentSelect');
        const cashOutInvestmentSelectError = document.getElementById('cashOutInvestmentSelectError');
        const cashOutAmountInput = document.getElementById('cashOutAmount');
        const cashOutAmountError = document.getElementById('cashOutAmountError');

        // Deposit Modal specific elements
        const depositEmailInput = document.getElementById('depositEmail');
        const depositEmailError = document.getElementById('depositEmailError');
        const depositAmountInput = document.getElementById('depositAmount');
        const depositAmountError = document.getElementById('depositAmountError');

        // Withdraw Modal specific elements
        const withdrawAmountInput = document.getElementById('withdrawAmount');
        const withdrawAmountError = document.getElementById('withdrawAmountError');
        const bankNameInput = document.getElementById('bankName');
        const bankNameError = document.getElementById('bankNameError');
        const accountNumberInput = document.getElementById('accountNumber');
        const accountNumberError = document.getElementById('accountNumberError');
        const accountNameInput = document.getElementById('accountName');
        const accountNameError = document.getElementById('accountNameError');

        // Transaction History Filter/Sort elements
        const transactionFilterSelect = document.getElementById('transactionFilter');
        const transactionSortSelect = document.getElementById('transactionSort');

        // Investment Details Modal specific elements
        const detailModalTypeName = document.getElementById('detailModalTypeName');
        const detailModalCategory = document.getElementById('detailModalCategory');
        const detailModalInitialAmount = document.getElementById('detailModalInitialAmount');
        const detailModalCurrentValue = document.getElementById('detailModalCurrentValue');
        const detailModalProfitLoss = document.getElementById('detailModalProfitLoss');
        const detailModalInvestDate = document.getElementById('detailModalInvestDate');
        const detailModalDuration = document.getElementById('detailModalDuration');
        const detailModalMaturity = document.getElementById('detailModalMaturity');
        const investmentHistoryTableContainer = document.getElementById('investmentHistoryTableContainer');

        // Goal Tracker elements
        const goalTrackerContent = document.getElementById('goalTrackerContent');
        const setGoalBtn = document.getElementById('setGoalBtn');
        const goalNameInput = document.getElementById('goalNameInput');
        const goalNameError = document.getElementById('goalNameError');
        const goalAmountInput = document.getElementById('goalAmountInput');
        const goalAmountError = document.getElementById('goalAmountError');
        const submitGoalBtn = document.getElementById('submitGoalBtn');
        const clearGoalBtn = document.getElementById('clearGoalBtn');

        // Feedback Modal elements
        const feedbackTypeSelect = document.getElementById('feedbackType');
        const feedbackMessageTextarea = document.getElementById('feedbackMessage');
        const feedbackMessageError = document.getElementById('feedbackMessageError');
        const submitFeedbackBtn = document.getElementById('submitFeedbackBtn');
        
        // Market Insights elements
        const marketInsightContent = document.getElementById('marketInsightContent');
        
        // Logout button
        const logoutBtn = document.getElementById('logoutBtn');

        // New: Profile Setup elements
        const profileCard = document.getElementById('profileCard');
        const profileAvatar = document.getElementById('profileAvatar');
        const profileFullNameEl = document.getElementById('profileFullName');
        const profileBioEl = document.getElementById('profileBio');
        const profileSetupCta = document.getElementById('profileSetupCta');
        const openProfileSetupModalBtn = document.getElementById('openProfileSetupModalBtn'); // Button within profile card
        const openProfileSetupModalBtnSidebar = document.getElementById('openProfileSetupModalBtnSidebar'); // Button in sidebar
        const profileFullNameInput = document.getElementById('profileFullNameInput');
        const profileFullNameError = document.getElementById('profileFullNameError');
        const profileBioInput = document.getElementById('profileBioInput');
        const profileBioError = document.getElementById('profileBioError');
        const submitProfileBtn = document.getElementById('submitProfileBtn');


        // Investment types data
        const investmentTypes = {
            "Farming": {
                "Crop Farming": { description: "Invest in staple crops like maize, rice, or cassava. High demand, steady returns.", minDurationMonths: 1, typicalAnnualReturn: 4.5, returnRange: "Fixed 4.5% to 5% Daily on Initial Amount" },
                "Organic Farming": { description: "Support eco-friendly farming practices. Premium market, sustainable growth.", minDurationMonths: 1, typicalAnnualReturn: 4.5, returnRange: "Fixed 4.5% to 5% Daily on Initial Amount" },
                "Livestock Feed Production": { description: "Invest in the production of animal feed. Essential for rearing, consistent demand.", minDurationMonths: 1, typicalAnnualReturn: 4.5, returnRange: "Fixed 4.5% to 5% Daily on Initial Amount" },
                "Greenhouse Farming": { description: "Modern farming technique for controlled environments. High yield, less weather dependent.", minDurationMonths: 1, typicalAnnualReturn: 4.5, returnRange: "Fixed 4.5% to 5% Daily on Initial Amount" },
                "Aquaponics": { description: "Sustainable system combining aquaculture and hydroponics. Efficient and eco-friendly.", minDurationMonths: 1, typicalAnnualReturn: 4.5, returnRange: "Fixed 4.5% to 5% Daily on Initial Amount" },
                "Hydroponics": { description: "Growing plants without soil using mineral nutrient solutions. Water-efficient, high-density yields.", minDurationMonths: 1, typicalAnnualReturn: 4.5, returnRange: "Fixed 4.5% to 5% Daily on Initial Amount" },
                "Vertical Farming": { description: "Growing crops in vertically stacked layers. Maximizes space, ideal for urban areas.", minDurationMonths: 1, typicalAnnualReturn: 4.5, returnRange: "Fixed 4.5% to 5% Daily on Initial Amount" },
                "Sustainable Farming": { description: "Focuses on long-term productivity and environmental health. Ethical investment.", minDurationMonths: 1, typicalAnnualReturn: 4.5, returnRange: "Fixed 4.5% to 5% Daily on Initial Amount" },
                "Specialty Crops": { description: "Invest in high-value, niche crops. Higher potential returns, but can be more volatile.", minDurationMonths: 1, typicalAnnualReturn: 4.5, returnRange: "Fixed 4.5% to 5% Daily on Initial Amount" },
                "Fruit and Vegetable Farming": { description: "Direct investment in fresh produce. Consistent local market demand.", minDurationMonths: 1, typicalAnnualReturn: 4.5, returnRange: "Fixed 4.5% to 5% Daily on Initial Amount" }
            },
            "Rearing": {
                "Cattle Rearing": { description: "Invest in cattle for meat and dairy. Long-term growth potential.", minDurationMonths: 1, typicalAnnualReturn: 4.5, returnRange: "Fixed 4.5% to 5% Daily on Initial Amount" },
                "Poultry Farming": { description: "Fast-cycle investment in chicken production. Quick returns.", minDurationMonths: 1, typicalAnnualReturn: 4.5, returnRange: "Fixed 4.5% to 5% Daily on Initial Amount" },
                "Pig Farming": { description: "Investment in pig breeding and fattening. Good demand for pork products.", minDurationMonths: 1, typicalAnnualReturn: 4.5, returnRange: "Fixed 4.5% to 5% Daily on Initial Amount" },
                "Sheep or Goat Rearing": { description: "Flexible investment in small ruminants. Lower initial capital, steady market.", minDurationMonths: 1, typicalAnnualReturn: 4.5, returnRange: "Fixed 4.5% to 5% Daily on Initial Amount" },
                "Fish Farming": { description: "Aquaculture investment for various fish species. Growing demand for protein.", minDurationMonths: 1, typicalAnnualReturn: 4.5, returnRange: "Fixed 4.5% to 5% Daily on Initial Amount" },
                "Beekeeping": { description: "Invest in honey production and pollination services. Environmentally friendly.", minDurationMonths: 1, typicalAnnualReturn: 4.5, returnRange: "Fixed 4.5% to 5% Daily on Initial Amount" },
                "Rabbit Rearing": { description: "Quick breeding cycle, low space requirement. Niche market potential.", minDurationMonths: 1, typicalAnnualReturn: 4.5, returnRange: "Fixed 4.5% to 5% Daily on Initial Amount" },
                "Game Farming": { description: "Rearing of wild animals for meat or tourism. Specialized, potentially high returns.", minDurationMonths: 1, typicalAnnualReturn: 4.5, returnRange: "Fixed 4.5% to 5% Daily on Initial Amount" },
                "Dairy Goat Farming": { description: "Focus on milk production from goats. Growing market for dairy alternatives.", minDurationMonths: 1, typicalAnnualReturn: 4.5, returnRange: "Fixed 4.5% to 5% Daily on Initial Amount" },
                "Quail Farming": { description: "Small-scale, high-density farming for meat and eggs. Very quick turnover.", minDurationMonths: 1, typicalAnnualReturn: 4.5, returnRange: "Fixed 4.5% to 5% Daily on Initial Amount" }
            },
            "Other Opportunities": {
                "Agricultural Technology": { description: "Fund innovative tech solutions for agriculture. High growth, higher risk.", minDurationMonths: 1, typicalAnnualReturn: 4.5, returnRange: "Fixed 4.5% to 5% Daily on Initial Amount" },
                "Farm Equipment": { description: "Invest in modern farm machinery. Essential infrastructure, steady income.", minDurationMonths: 1, typicalAnnualReturn: 4.5, returnRange: "Fixed 4.5% to 5% Daily on Initial Amount" },
                "Agricultural Processing": { description: "Value-addition to raw agricultural products. Stable demand, diverse markets.", minDurationMonths: 1, typicalAnnualReturn: 4.5, returnRange: "Fixed 4.5% to 5% Daily on Initial Amount" },
                "Farm-to-Table": { description: "Support direct consumer access to farm produce. Growing trend, community focus.", minDurationMonths: 1, typicalAnnualReturn: 4.5, returnRange: "Fixed 4.5% to 5% Daily on Initial Amount" },
                "Agricultural Consulting": { description: "Invest in expertise and advisory services for farmers. Intellectual capital growth.", minDurationMonths: 1, typicalAnnualReturn: 4.5, returnRange: "Fixed 4.5% to 5% Daily on Initial Amount" },
                "Farm Management": { description: "Professional management services for agricultural enterprises. Operational efficiency.", minDurationMonths: 1, typicalAnnualReturn: 4.5, returnRange: "Fixed 4.5% to 5% Daily on Initial Amount" },
                "Agricultural Education": { description: "Invest in training and development for future farmers. Long-term societal impact.", minDurationMonths: 1, typicalAnnualReturn: 4.5, returnRange: "Fixed 4.5% to 5% Daily on Initial Amount" },
                "Sustainable Agriculture": { description: "Projects promoting environmentally sound farming. Impact investing, long-term returns.", minDurationMonths: 1, typicalAnnualReturn: 4.5, returnRange: "Fixed 4.5% to 5% Daily on Initial Amount" },
                "Agricultural Research": { description: "Funding R&D for new crop varieties, pest control, etc. High risk, potentially high reward.", minDurationMonths: 1, typicalAnnualReturn: 4.5, returnRange: "Fixed 4.5% to 5% Daily on Initial Amount" }
            }
        };

        // SVG Icons for investment categories
        const investmentCategoryIcons = {
            "Farming": `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-wheat investment-icon"><path d="M2 22s1-4 4-4 4 4 4 4 1-4 4-4 4 4 4 4 1-4 4-4"/><path d="M7 18c-1-1-1-2 0-3c1-1 2-1 3-2"/><path d="M10 16c-1-1-1-2 0-3c1-1 2-1 3-2"/><path d="M13 14c-1-1-1-2 0-3c1-1 2-1 3-2"/></svg>`,
            "Rearing": `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-beef investment-icon"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 18c-4.418 0-8-3.582-8-8s3.582-8 8-8 8 3.582 8 8-3.582 8-8 8z"/><path d="M12 12c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4z"/><path d="M12 16c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4z"/><path d="M12 20c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4z"/></svg>`,
            "Other Opportunities": `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-box investment-icon"><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></svg>`
        };

        // Simulated Market Insights
        const marketInsights = [
            { title: "Global Grain Prices Surge", text: "Wheat and corn futures saw significant gains today due to unexpected weather patterns in major producing regions.", icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bar-chart-2 market-insight-icon"><line x1="18" x2="18" y1="20" y2="10"/><line x1="12" x2="12" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="14"/></svg>` },
            { title: "Livestock Demand Rises", text: "Growing middle-class populations are driving up demand for protein, benefiting cattle and poultry markets.", icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trending-up market-insight-icon"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>` },
            { title: "Agri-Tech Innovations", text: "New drone technology for crop monitoring is gaining traction, promising increased efficiency and yields for modern farms.", icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-lightbulb market-insight-icon"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1.3.5 2.6 1.5 3.5.8.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/><path d="M12 22v-4"/></svg>` },
            { title: "Sustainable Farming Trends", text: "Consumer preference for ethically sourced and environmentally friendly produce is boosting sustainable agriculture investments.", icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-leaf market-insight-icon"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z"/><path d="M2 21c0-3 1.85-4.5 6-4.5C15.25 16.5 17 18 17 21"/></svg>` },
            { title: "Global Food Security Concerns", text: "Geopolitical events are highlighting the importance of local food production, making domestic agricultural investments more attractive.", icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-globe market-insight-icon"><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20A14.5 14.5 0 0 0 12 2"/><path d="M2 12h20"/></svg>` }
        ];


        let portfolioChart;

        /**
         * Calculates the maturity date for an investment.
         * @param {string} investDateString ISO string of investment date.
         * @param {number} duration The duration number.
         * @param {string} durationUnit The duration unit ('months' or 'years').
         * @returns {Date} The calculated maturity date.
         */
        function calculateMaturityDate(investDateString, duration, durationUnit) {
            const investDate = new Date(investDateString);
            let maturityDate = new Date(investDate);
            if (durationUnit === 'months') {
                maturityDate.setMonth(investDate.getMonth() + duration);
            } else if (durationUnit === 'years') {
                maturityDate.setFullYear(investDate.getFullYear() + duration);
            }
            return maturityDate;
        }

        /**
         * Loads user data from localStorage for the current user.
         * The user ID is now fixed to 'guest_user' for a direct dashboard experience.
         * Also loads the new 'investmentGoal' and 'userProfile' data.
         */
        function loadUserData() {
            // Retrieve current user email from localStorage (set by login page)
            const storedCurrentUserEmail = localStorage.getItem('currentUserEmail');
            if (storedCurrentUserEmail) {
                currentUserEmail = storedCurrentUserEmail;
                currentUserId = currentUserEmail.replace(/[^a-zA-Z0-9]/g, '_'); // Derive user ID from email
            } else {
                // Fallback for direct access without login, or if login data was cleared
                currentUserEmail = 'guest@growwithcore.com';
                currentUserId = 'guest_user';
            }

            userIdDisplay.textContent = `User: ${currentUserEmail}`;

            const storedInvestments = localStorage.getItem(`growWithCoreInvestments_${currentUserId}`);
            const storedTransactions = localStorage.getItem(`growWithCoreTransactions_${currentUserId}`);
            const storedBalance = localStorage.getItem(`growWithCoreAccountBalance_${currentUserId}`);
            const storedGoal = localStorage.getItem(`growWithCoreInvestmentGoal_${currentUserId}`);
            const storedProfile = localStorage.getItem(`growWithCoreUserProfile_${currentUserId}`); // New: Load profile

            userInvestments = storedInvestments ? JSON.parse(storedInvestments) : [];
            userTransactions = storedTransactions ? JSON.parse(storedTransactions) : [];
            userAccountBalance = storedBalance ? parseFloat(storedBalance) : 0;
            investmentGoal = storedGoal ? JSON.parse(storedGoal) : null;
            userProfile = storedProfile ? JSON.parse(storedProfile) : { fullName: '', bio: '' }; // New: Parse profile

            // Simulate growth for existing investments on load and calculate maturity
            userInvestments.forEach(inv => {
                const daysSinceInvest = Math.floor((new Date().getTime() - new Date(inv.investDate).getTime()) / (1000 * 60 * 60 * 24));
                
                // Recalculate currentValue based on fixed daily profit with fluctuation
                inv.currentValue = inv.initialAmount; // Start with initial amount
                for (let i = 0; i < daysSinceInvest; i++) {
                    // Generate a random daily percentage between 4.5% and 5%
                    const dailyPercentage = (Math.random() * (5.0 - 4.5) + 4.5) / 100;
                    inv.currentValue += inv.initialAmount * dailyPercentage;
                }
                inv.profit = inv.currentValue - inv.initialAmount;

                // Ensure maturityDate is set for older investments
                if (!inv.maturityDate) {
                    inv.maturityDate = calculateMaturityDate(inv.investDate, inv.duration, inv.durationUnit).toISOString();
                }
            });

            // Save updated current values and maturity dates back to ensure consistency
            saveUserData();
            updateDashboard();

            // Ensure dashboard is visible (auth container is hidden by CSS anyway)
            dashboardContainer.classList.remove('hidden');
        }

        /**
         * Saves current user data to localStorage.
         * Data is saved for the fixed 'guest_user' ID.
         * Also saves the new 'investmentGoal' and 'userProfile' data.
         */
        function saveUserData() {
            localStorage.setItem(`growWithCoreInvestments_${currentUserId}`, JSON.stringify(userInvestments));
            localStorage.setItem(`growWithCoreAccountBalance_${currentUserId}`, userAccountBalance.toString());
            localStorage.setItem(`growWithCoreTransactions_${currentUserId}`, JSON.stringify(userTransactions));
            localStorage.setItem(`growWithCoreInvestmentGoal_${currentUserId}`, JSON.stringify(investmentGoal));
            localStorage.setItem(`growWithCoreUserProfile_${currentUserId}`, JSON.stringify(userProfile)); // New: Save profile
        }

        /**
         * Updates all dashboard metrics and lists, including new features.
         */
        function updateDashboard() {
            const animateMetricUpdate = (element, newValue) => {
                const oldValue = parseFloat(element.textContent.replace(/|,/g, '')) || 0;
                if (oldValue !== newValue) {
                    element.style.opacity = 0;
                    element.style.transform = 'scale(0.9)';
                    setTimeout(() => {
                        element.textContent = formatNaira(newValue);
                        element.style.opacity = 1;
                        element.style.transform = 'scale(1)';
                    }, 50);
                } else {
                    element.textContent = formatNaira(newValue);
                }
            };

            animateMetricUpdate(availableBalanceEl, userAccountBalance);

            let totalInvested = userInvestments.reduce((sum, inv) => sum + inv.initialAmount, 0);
            let currentValue = userInvestments.reduce((sum, inv) => sum + inv.currentValue, 0);
            let totalProfitLoss = currentValue - totalInvested;

            animateMetricUpdate(totalInvestedEl, totalInvested);
            animateMetricUpdate(currentValueEl, currentValue);
            animateMetricUpdate(totalProfitLossEl, totalProfitLoss);

            totalProfitLossEl.classList.toggle('profit', totalProfitLoss >= 0);
            totalProfitLossEl.classList.toggle('loss', totalProfitLoss < 0);

            const minDailyRate = 4.5;
            const maxDailyRate = 5.0;
            const displayedDailyGain = (Math.random() * (maxDailyRate - minDailyRate) + minDailyRate);

            dailyPercentageEl.textContent = `${displayedDailyGain >= 0 ? '+' : ''}${displayedDailyGain.toFixed(2)}%`;
            dailyPercentageEl.classList.toggle('text-green-400', displayedDailyGain >= 0);
            dailyPercentageEl.classList.toggle('text-red-400', displayedDailyGain < 0);

            investmentListEl.innerHTML = '';
            if (userInvestments.length === 0) {
                noInvestmentsMessage.classList.remove('hidden');
            } else {
                noInvestmentsMessage.classList.add('hidden');
                userInvestments.forEach(inv => {
                    const profitLossClass = inv.profit >= 0 ? 'profit' : 'loss';
                    
                    const investmentItemDiv = document.createElement('div');
                    investmentItemDiv.classList.add('investment-item');
                    investmentItemDiv.dataset.investmentId = inv.id; // Store ID for click handling

                    investmentItemDiv.innerHTML = `
                        <div class="investment-icon-wrapper">${investmentCategoryIcons[inv.category] || ''}</div>
                        <div class="investment-name">${inv.type}</div>
                        <div class="investment-type">Category: ${inv.category}</div>
                        <div class="investment-values">
                            <span class="investment-value">Invested: ${formatNaira(inv.initialAmount)}</span>
                            <span class="investment-value">Current: ${formatNaira(inv.currentValue)}</span>
                            <span class="${profitLossClass}">P/L: ${formatNaira(inv.profit)}</span>
                        </div>
                    `;
                    investmentListEl.appendChild(investmentItemDiv);

                    // Add event listener to open new details modal
                    investmentItemDiv.addEventListener('click', () => openInvestmentDetailsModal(inv.id));
                });
            }

            renderTransactionHistory();
            updatePortfolioChart();
            updateGoalTracker();
            displayRandomMarketInsight();
            updateProfileDisplay(); // New: Update profile display
        }

        /**
         * Renders the transaction history based on current filter and sort settings.
         */
        function renderTransactionHistory() {
            transactionHistoryListEl.innerHTML = '';
            let filteredTransactions = [...userTransactions];

            // Apply filter
            const filterType = transactionFilterSelect.value;
            if (filterType !== 'All') {
                filteredTransactions = filteredTransactions.filter(tx => tx.type === filterType);
            }

            // Apply sort
            const sortOrder = transactionSortSelect.value;
            filteredTransactions.sort((a, b) => {
                const dateA = new Date(a.date).getTime();
                const dateB = new Date(b.date).getTime();
                const amountA = a.amount;
                const amountB = b.amount;

                switch (sortOrder) {
                    case 'dateDesc': return dateB - dateA;
                    case 'dateAsc': return dateA - dateB;
                    case 'amountDesc': return amountB - amountA;
                    case 'amountAsc': return amountA - amountB;
                    default: return 0;
                }
            });

            if (filteredTransactions.length === 0) {
                noTransactionsMessage.classList.remove('hidden');
            } else {
                noTransactionsMessage.classList.add('hidden');
                filteredTransactions.forEach(tx => {
                    const typeClass = (tx.type === 'Withdrawal' || tx.type === 'Cash Out') ? 'withdrawal' : '';
                    transactionHistoryListEl.innerHTML += `
                        <div class="transaction-item">
                            <div>
                                <div class="transaction-type ${typeClass}">${tx.type}</div>
                                <div class="text-gray-500 text-sm">${tx.description}</div>
                            </div>
                            <div class="text-right">
                                <div class="transaction-amount ${typeClass}">${formatNaira(tx.amount)}</div>
                                <div class="transaction-date">${new Date(tx.date).toLocaleString()}</div>
                            </div>
                        </div>
                    `;
                });
            }
        }

        /**
         * Updates the portfolio allocation chart.
         */
        function updatePortfolioChart() {
            const portfolioData = {};
            userInvestments.forEach(inv => {
                portfolioData[inv.category] = (portfolioData[inv.category] || 0) + inv.currentValue;
            });

            const labels = Object.keys(portfolioData);
            const data = Object.values(portfolioData);

            const backgroundColors = [
                '#4CAF50', '#2196F3', '#FFC107', '#E91E63', '#9C27B0',
                '#00BCD4', '#FF9800', '#795548', '#607D8B', '#F44336'
            ];

            if (portfolioChart) {
                portfolioChart.data.labels = labels;
                portfolioChart.data.datasets[0].data = data;
                portfolioChart.data.datasets[0].backgroundColor = labels.map((_, i) => backgroundColors[i % backgroundColors.length]);
                portfolioChart.update();
            } else {
                const ctx = document.getElementById('portfolioChart').getContext('2d');
                portfolioChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: labels.map((_, i) => backgroundColors[i % backgroundColors.length]),
                            hoverOffset: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#e0e0e0', // Legend text color
                                    font: {
                                        size: 14
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed !== null) {
                                            label += formatNaira(context.parsed);
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        /**
         * Formats a number as Nigerian Naira ().
         * @param {number} amount The amount to format.
         * @returns {string} The formatted currency string.
         */
        function formatNaira(amount) {
            return new Intl.NumberFormat('en-NG', {
                style: 'currency',
                currency: 'NGN',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount);
        }

        /**
         * Displays a toast notification.
         * @param {string} message The message text.
         * @param {string} type 'success', 'error', or 'info'.
         */
        function showToast(message, type) {
            const toast = document.createElement('div');
            toast.classList.add('toast-message', type);
            toast.textContent = message;
            toastContainer.appendChild(toast);

            // Remove toast after animation
            toast.addEventListener('animationend', (event) => {
                if (event.animationName === 'fadeOutToast') {
                    toast.remove();
                }
            });
        }

        /**
         * Shows a loading state for a button.
         * @param {HTMLElement} button The button element.
         * @param {string} loadingText The text to display while loading.
         */
        function startLoading(button, loadingText = 'Processing...') {
            button.disabled = true;
            button.querySelector('span').textContent = loadingText;
            const spinner = document.createElement('div');
            spinner.classList.add('loading-spinner');
            button.appendChild(spinner);
        }

        /**
         * Hides the loading state for a button.
         * @param {HTMLElement} button The button element.
         * @param {string} originalText The original text of the button.
         */
        function stopLoading(button, originalText) {
            button.disabled = false;
            button.querySelector('span').textContent = originalText;
            const spinner = button.querySelector('.loading-spinner');
            if (spinner) {
                spinner.remove();
            }
        }

        /**
         * Shows validation error for an input.
         * @param {HTMLElement} inputElement The input element.
         * @param {HTMLElement} errorElement The error text element.
         */
        function showInputError(inputElement, errorElement, message) {
            inputElement.classList.add('input-error');
            errorElement.textContent = message;
            errorElement.classList.remove('hidden');
        }

        /**
         * Clears validation error for an input.
         * @param {HTMLElement} inputElement The input element.
         * @param {HTMLElement} errorElement The error text element.
         */
        function clearInputError(inputElement, errorElement) {
            inputElement.classList.remove('input-error');
            errorElement.classList.add('hidden');
            errorElement.textContent = '';
        }

        /**
         * Debounce utility function to limit how often a function is called.
         * @param {Function} func The function to debounce.
         * @param {number} delay The delay in milliseconds.
         * @returns {Function} The debounced function.
         */
        function debounce(func, delay) {
            let timeout;
            return function(...args) {
                const context = this;
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(context, args), delay);
            };
        }

        // Event Listeners for Modals - Buttons to open modals
        document.getElementById('openInvestModalBtn').addEventListener('click', () => openModal('investModal'));
        document.getElementById('openCashOutModalBtn').addEventListener('click', () => openModal('cashOutModal'));
        document.getElementById('openDepositModalBtn').addEventListener('click', () => openModal('depositModal'));
        document.getElementById('openWithdrawModalBtn').addEventListener('click', () => openModal('withdrawModal'));
        document.getElementById('openResetDataModalBtn').addEventListener('click', () => openModal('resetDataModal'));
        document.getElementById('openFeedbackModalBtn').addEventListener('click', () => openModal('feedbackModal'));
        setGoalBtn.addEventListener('click', () => openModal('setGoalModal'));
        openProfileSetupModalBtn.addEventListener('click', () => openModal('profileSetupModal')); // New: Open Profile Setup from card
        openProfileSetupModalBtnSidebar.addEventListener('click', () => openModal('profileSetupModal')); // New: Open Profile Setup from sidebar

        // Event Listeners for Modals - Buttons to close modals
        document.getElementById('closeInvestModalBtn').addEventListener('click', () => closeModal('investModal'));
        document.getElementById('closeCashOutModalBtn').addEventListener('click', () => closeModal('cashOutModal'));
        document.getElementById('closeDepositModalBtn').addEventListener('click', () => closeModal('depositModal'));
        document.getElementById('closeWithdrawModalBtn').addEventListener('click', () => closeModal('withdrawModal'));
        document.getElementById('closeResetDataModalBtn').addEventListener('click', () => closeModal('resetDataModal'));
        document.getElementById('cancelResetDataBtn').addEventListener('click', () => closeModal('resetDataModal'));
        document.getElementById('closeInvestmentDetailsModalBtn').addEventListener('click', () => closeModal('investmentDetailsModal'));
        document.getElementById('closeSetGoalModalBtn').addEventListener('click', () => closeModal('setGoalModal'));
        document.getElementById('closeFeedbackModalBtn').addEventListener('click', () => closeModal('feedbackModal'));
        document.getElementById('closeProfileSetupModalBtn').addEventListener('click', () => closeModal('profileSetupModal')); // New: Close Profile Setup Modal

        // Event Listeners for Modals - Close modal when clicking outside content
        investModal.addEventListener('click', (e) => { if (e.target === investModal) closeModal('investModal'); });
        cashOutModal.addEventListener('click', (e) => { if (e.target === cashOutModal) closeModal('cashOutModal'); });
        depositModal.addEventListener('click', (e) => { if (e.target === depositModal) closeModal('depositModal'); });
        withdrawModal.addEventListener('click', (e) => { if (e.target === withdrawModal) closeModal('withdrawModal'); });
        resetDataModal.addEventListener('click', (e) => { if (e.target === resetDataModal) closeModal('resetDataModal'); });
        investmentDetailsModal.addEventListener('click', (e) => { if (e.target === investmentDetailsModal) closeModal('investmentDetailsModal'); });
        setGoalModal.addEventListener('click', (e) => { if (e.target === setGoalModal) closeModal('setGoalModal'); });
        feedbackModal.addEventListener('click', (e) => { if (e.target === feedbackModal) closeModal('feedbackModal'); });
        profileSetupModal.addEventListener('click', (e) => { if (e.target === profileSetupModal) closeModal('profileSetupModal'); }); // New: Close Profile Setup Modal

        /**
         * Opens a specified modal by removing the 'hidden' class and preparing its content.
         * @param {string} modalId The ID of the modal to open.
         */
        function openModal(modalId) {
            // Check for withdrawal conditions before opening the withdraw modal
            if (modalId === 'withdrawModal') {
                const hasMadeInvestment = userInvestments.length > 0;
                const hasMaturedInvestment = userInvestments.some(inv => new Date(inv.maturityDate) <= new Date());

                if (!hasMadeInvestment) {
                    showToast('You must make an investment before you can withdraw.', 'error');
                    return; // Prevent modal from opening
                }
                if (!hasMaturedInvestment) {
                    showToast('You can only withdraw once an investment has matured.', 'error');
                    return; // Prevent modal from opening
                }
            }

            document.getElementById(modalId).classList.remove('hidden');

            // Specific modal preparations
            if (modalId === 'investModal') {
                // Reset form fields
                investmentCategorySelect.value = '';
                investmentTypeSelect.innerHTML = '<option value="">Select Type</option>';
                investmentTypeSelect.disabled = true;
                investmentAmountInput.value = '';
                investmentDurationInput.value = '';
                investmentDurationUnitSelect.value = 'months';
                investmentTypeDetails.classList.add('hidden');
                projectionTableContainer.innerHTML = '<p class="projection-table-empty-message">Enter investment details to see a daily breakdown.</p>';
                finalProjectedTotalEl.classList.add('hidden');
                projectionBasisLabel.textContent = ''; // Clear projection basis label
                clearInputError(investmentAmountInput, investmentAmountError);
                clearInputError(investmentDurationInput, investmentDurationError);
            } else if (modalId === 'cashOutModal') {
                populateCashOutInvestments();
                cashOutAmountInput.value = '';
                clearInputError(cashOutInvestmentSelect, cashOutInvestmentSelectError);
                clearInputError(cashOutAmountInput, cashOutAmountError);
            } else if (modalId === 'depositModal') {
                depositEmailInput.value = currentUserEmail; // Pre-fill with current user's email
                depositAmountInput.value = '';
                clearInputError(depositEmailInput, depositEmailError);
                clearInputError(depositAmountInput, depositAmountError);
            } else if (modalId === 'withdrawModal') {
                withdrawAmountInput.value = '';
                bankNameInput.value = ''; // Clear new fields
                accountNumberInput.value = ''; // Clear new fields
                accountNameInput.value = ''; // Clear new fields
                clearInputError(withdrawAmountInput, withdrawAmountError);
                clearInputError(bankNameInput, bankNameError); // Clear new errors
                clearInputError(accountNumberInput, accountNumberError); // Clear new errors
                clearInputError(accountNameInput, accountNameError); // Clear new errors
            } else if (modalId === 'setGoalModal') {
                if (investmentGoal) {
                    goalNameInput.value = investmentGoal.name;
                    goalAmountInput.value = investmentGoal.amount;
                    submitGoalBtn.querySelector('span').textContent = 'Update Goal';
                } else {
                    goalNameInput.value = '';
                    goalAmountInput.value = '';
                    submitGoalBtn.querySelector('span').textContent = 'Save Goal';
                }
                clearInputError(goalNameInput, goalNameError);
                clearInputError(goalAmountInput, goalAmountError);
            } else if (modalId === 'feedbackModal') {
                feedbackTypeSelect.value = 'Feedback';
                feedbackMessageTextarea.value = '';
                clearInputError(feedbackMessageTextarea, feedbackMessageError);
            } else if (modalId === 'profileSetupModal') { // New: Prepare Profile Setup Modal
                profileFullNameInput.value = userProfile.fullName;
                profileBioInput.value = userProfile.bio;
                clearInputError(profileFullNameInput, profileFullNameError);
                clearInputError(profileBioInput, profileBioError);
            }
        }

        /**
         * Closes a specified modal by adding the 'hidden' class.
         * @param {string} modalId The ID of the modal to close.
         */
        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        // Invest Modal Logic
        investmentCategorySelect.addEventListener('change', () => {
            const category = investmentCategorySelect.value;
            investmentTypeSelect.innerHTML = '<option value="">Select Type</option>';
            investmentTypeSelect.disabled = true;
            investmentTypeDetails.classList.add('hidden');
            projectionTableContainer.innerHTML = '<p class="projection-table-empty-message">Enter investment details to see a daily breakdown.</p>';
            finalProjectedTotalEl.classList.add('hidden');
            projectionBasisLabel.textContent = ''; // Clear projection basis label

            if (category && investmentTypes[category]) {
                for (const type in investmentTypes[category]) {
                    const option = document.createElement('option');
                    option.value = type;
                    option.textContent = type;
                    investmentTypeSelect.appendChild(option);
                }
                investmentTypeSelect.disabled = false;
            }
        });

        investmentTypeSelect.addEventListener('change', () => {
            const category = investmentCategorySelect.value;
            const type = investmentTypeSelect.value;
            if (category && type && investmentTypes[category] && investmentTypes[category][type]) {
                const details = investmentTypes[category][type];
                detailsTypeName.textContent = type;
                detailsDescription.textContent = details.description;
                detailsReturnRange.textContent = details.returnRange;
                detailsMinDuration.textContent = `${details.minDurationMonths} month${details.minDurationMonths !== 1 ? 's' : ''}`;
                investmentTypeDetails.classList.remove('hidden');
                // Trigger projection calculation if amount and duration are already filled
                calculateProjectionDebounced();
            } else {
                investmentTypeDetails.classList.add('hidden');
                projectionTableContainer.innerHTML = '<p class="projection-table-empty-message">Enter investment details to see a daily breakdown.</p>';
                finalProjectedTotalEl.classList.add('hidden');
                projectionBasisLabel.textContent = '';
            }
        });

        // Debounced function for projection calculation
        const calculateProjectionDebounced = debounce(() => {
            const amount = parseFloat(investmentAmountInput.value);
            const duration = parseInt(investmentDurationInput.value);
            const unit = investmentDurationUnitSelect.value;
            const category = investmentCategorySelect.value;
            const type = investmentTypeSelect.value;

            clearInputError(investmentAmountInput, investmentAmountError);
            clearInputError(investmentDurationInput, investmentDurationError);

            if (isNaN(amount) || amount < 5000) {
                showInputError(investmentAmountInput, investmentAmountError, 'Amount must be at least 5,000.');
                projectionTableContainer.innerHTML = '<p class="projection-table-empty-message">Enter investment details to see a daily breakdown.</p>';
                finalProjectedTotalEl.classList.add('hidden');
                projectionBasisLabel.textContent = '';
                return;
            }
            if (isNaN(duration) || duration < 1) {
                showInputError(investmentDurationInput, investmentDurationError, 'Duration must be at least 1.');
                projectionTableContainer.innerHTML = '<p class="projection-table-empty-message">Enter investment details to see a daily breakdown.</p>';
                finalProjectedTotalEl.classList.add('hidden');
                projectionBasisLabel.textContent = '';
                return;
            }

            if (!category || !type || !investmentTypes[category] || !investmentTypes[category][type]) {
                showToast('Please select an investment category and type.', 'error');
                projectionTableContainer.innerHTML = '<p class="projection-table-empty-message">Select an investment type to see projections.</p>';
                finalProjectedTotalEl.classList.add('hidden');
                projectionBasisLabel.textContent = '';
                return;
            }

            const details = investmentTypes[category][type];
            let totalDays = duration;
            if (unit === 'months') {
                totalDays *= 30; // Approximate months to 30 days
            } else if (unit === 'years') {
                totalDays *= 365; // Approximate years to 365 days
            }

            if (duration < details.minDurationMonths && unit === 'months') {
                showInputError(investmentDurationInput, investmentDurationError, `Minimum duration for ${type} is ${details.minDurationMonths} month(s).`);
                projectionTableContainer.innerHTML = '<p class="projection-table-empty-message">Enter investment details to see a daily breakdown.</p>';
                finalProjectedTotalEl.classList.add('hidden');
                projectionBasisLabel.textContent = '';
                return;
            }
            
            let currentProjectedValue = amount;
            let tableHtml = `
                <div class="projection-table-header">
                    <span>Day</span>
                    <span>Daily Gain</span>
                    <span>Total Value</span>
                </div>
            `;
            const dailyProjections = [];

            // Calculate daily projections
            for (let day = 1; day <= totalDays; day++) {
                const dailyPercentage = (Math.random() * (5.0 - 4.5) + 4.5) / 100; // Random between 4.5% and 5%
                const dailyGain = amount * dailyPercentage; // Daily gain is based on initial amount
                currentProjectedValue += dailyGain;
                dailyProjections.push({
                    day: day,
                    dailyGain: dailyGain,
                    totalValue: currentProjectedValue
                });
            }

            // Display only up to the first 30 days, or all if less than 30
            const displayLimit = 30;
            const displayedProjections = dailyProjections.slice(0, displayLimit);

            displayedProjections.forEach(proj => {
                tableHtml += `
                    <div class="projection-table-row">
                        <span>Day ${proj.day}</span>
                        <span class="profit">${formatNaira(proj.dailyGain)}</span>
                        <span>${formatNaira(proj.totalValue)}</span>
                    </div>
                `;
            });

            if (totalDays > displayLimit) {
                tableHtml += `
                    <div class="projection-table-row text-center text-gray-500">
                        <span>...</span>
                        <span>...</span>
                        <span>...</span>
                    </div>
                `;
            }

            projectionTableContainer.innerHTML = tableHtml;
            finalProjectedTotalEl.textContent = `Projected Total: ${formatNaira(currentProjectedValue)}`;
            finalProjectedTotalEl.classList.remove('hidden');
            projectionBasisLabel.textContent = `Projection for ${totalDays} day${totalDays !== 1 ? 's' : ''}`;
        }, 300); // Debounce by 300ms

        investmentAmountInput.addEventListener('input', calculateProjectionDebounced);
        investmentDurationInput.addEventListener('input', calculateProjectionDebounced);
        investmentDurationUnitSelect.addEventListener('change', calculateProjectionDebounced);

        submitInvestmentBtn.addEventListener('click', () => {
            const category = investmentCategorySelect.value;
            const type = investmentTypeSelect.value;
            const amount = parseFloat(investmentAmountInput.value);
            const duration = parseInt(investmentDurationInput.value);
            const unit = investmentDurationUnitSelect.value;

            let hasError = false;
            clearInputError(investmentAmountInput, investmentAmountError);
            clearInputError(investmentDurationInput, investmentDurationError);

            if (!category || !type) {
                showToast('Please select an investment category and type.', 'error');
                hasError = true;
            }
            if (isNaN(amount) || amount < 5000) {
                showInputError(investmentAmountInput, investmentAmountError, 'Amount must be at least 5,000.');
                hasError = true;
            }
            if (isNaN(duration) || duration < 1) {
                showInputError(investmentDurationInput, investmentDurationError, 'Duration must be at least 1.');
                hasError = true;
            }

            const details = investmentTypes[category]?.[type];
            if (details && duration < details.minDurationMonths && unit === 'months') {
                showInputError(investmentDurationInput, investmentDurationError, `Minimum duration for ${type} is ${details.minDurationMonths} month(s).`);
                hasError = true;
            }

            if (hasError) {
                showToast('Please correct the investment details.', 'error');
                return;
            }

            if (userAccountBalance < amount) {
                showToast('Insufficient balance. Please deposit funds.', 'error');
                return;
            }

            startLoading(submitInvestmentBtn, 'Investing...');

            setTimeout(() => {
                const investDate = new Date();
                const maturityDate = calculateMaturityDate(investDate.toISOString(), duration, unit);

                const newInvestment = {
                    id: Date.now().toString(), // Unique ID
                    category,
                    type,
                    initialAmount: amount,
                    currentValue: amount, // Starts at initial amount
                    profit: 0,
                    investDate: investDate.toISOString(),
                    duration: duration,
                    durationUnit: unit,
                    maturityDate: maturityDate.toISOString(), // Store maturity date
                    dailyGrowthHistory: [{ date: investDate.toISOString(), value: amount, gain: 0 }] // Initial entry
                };

                userInvestments.push(newInvestment);
                userAccountBalance -= amount;

                // Add transaction record
                userTransactions.unshift({
                    id: Date.now().toString() + '_tx',
                    type: 'Investment',
                    amount: amount,
                    description: `Investment in ${type}`,
                    date: new Date().toISOString()
                });

                saveUserData();
                updateDashboard();
                showToast('Investment successful!', 'success');
                closeModal('investModal');
                stopLoading(submitInvestmentBtn, 'Invest');
            }, 1500);
        });

        // Cash Out Modal Logic
        function populateCashOutInvestments() {
            cashOutInvestmentSelect.innerHTML = '<option value="">Select an active investment</option>';
            // Only list matured investments for cash out
            const maturedInvestments = userInvestments.filter(inv => new Date(inv.maturityDate) <= new Date());

            if (maturedInvestments.length === 0) {
                const option = document.createElement('option');
                option.value = '';
                option.textContent = 'No matured investments available';
                option.disabled = true;
                cashOutInvestmentSelect.appendChild(option);
                cashOutInvestmentSelect.disabled = true;
                cashOutAmountInput.disabled = true; // Disable amount input if no matured investments
                showToast('No matured investments to cash out.', 'info');
            } else {
                maturedInvestments.forEach(inv => {
                    const option = document.createElement('option');
                    option.value = inv.id;
                    option.textContent = `${inv.type} (Current: ${formatNaira(inv.currentValue)}) - Matured`;
                    cashOutInvestmentSelect.appendChild(option);
                });
                cashOutInvestmentSelect.disabled = false;
                cashOutAmountInput.disabled = false;
            }
        }

        cashOutInvestmentSelect.addEventListener('change', () => {
            const selectedInvestmentId = cashOutInvestmentSelect.value;
            const selectedInvestment = userInvestments.find(inv => inv.id === selectedInvestmentId);
            if (selectedInvestment) {
                cashOutAmountInput.value = selectedInvestment.currentValue.toFixed(2); // Pre-fill with current value
                cashOutAmountInput.max = selectedInvestment.currentValue.toFixed(2); // Set max
            } else {
                cashOutAmountInput.value = '';
                cashOutAmountInput.max = '';
            }
            clearInputError(cashOutInvestmentSelect, cashOutInvestmentSelectError);
            clearInputError(cashOutAmountInput, cashOutAmountError);
        });

        submitCashOutBtn.addEventListener('click', () => {
            const selectedInvestmentId = cashOutInvestmentSelect.value;
            const cashOutAmount = parseFloat(cashOutAmountInput.value);

            let hasError = false;
            clearInputError(cashOutInvestmentSelect, cashOutInvestmentSelectError);
            clearInputError(cashOutAmountInput, cashOutAmountError);

            if (!selectedInvestmentId) {
                showInputError(cashOutInvestmentSelect, cashOutInvestmentSelectError, 'Please select an investment.');
                hasError = true;
            }
            if (isNaN(cashOutAmount) || cashOutAmount <= 0) {
                showInputError(cashOutAmountInput, cashOutAmountError, 'Please enter a valid amount to cash out.');
                hasError = true;
            }

            const selectedInvestment = userInvestments.find(inv => inv.id === selectedInvestmentId);
            if (!selectedInvestment) {
                showToast('Selected investment not found.', 'error');
                hasError = true;
            } else if (cashOutAmount > selectedInvestment.currentValue) {
                showInputError(cashOutAmountInput, cashOutAmountError, `Amount cannot exceed current value (${formatNaira(selectedInvestment.currentValue)}).`);
                hasError = true;
            } else if (new Date(selectedInvestment.maturityDate) > new Date()) { // Double-check maturity
                showToast('This investment has not yet matured and cannot be cashed out.', 'error');
                hasError = true;
            }

            if (hasError) {
                showToast('Please correct the cash out details.', 'error');
                return;
            }

            startLoading(submitCashOutBtn, 'Cashing Out...');

            setTimeout(() => {
                userAccountBalance += cashOutAmount;
                userInvestments = userInvestments.filter(inv => inv.id !== selectedInvestmentId); // Remove investment

                // Add transaction record
                userTransactions.unshift({
                    id: Date.now().toString() + '_tx',
                    type: 'Cash Out',
                    amount: cashOutAmount,
                    description: `Cashed out from ${selectedInvestment.type} investment`,
                    date: new Date().toISOString()
                });

                saveUserData();
                updateDashboard();
                showToast('Cash out successful!', 'success');
                closeModal('cashOutModal');
                stopLoading(submitCashOutBtn, 'Confirm Cash Out');
            }, 1500);
        });

        // Deposit Modal Logic (Paystack Integration)
        function isValidEmail(email) {
            return /\S+@\S+\.\S+/.test(email);
        }

        submitDepositBtn.addEventListener('click', () => {
            const email = depositEmailInput.value.trim();
            const amount = parseFloat(depositAmountInput.value); // Amount in Naira

            let hasError = false;
            clearInputError(depositEmailInput, depositEmailError);
            clearInputError(depositAmountInput, depositAmountError);

            if (!email) {
                showInputError(depositEmailInput, depositEmailError, 'Email is required.');
                hasError = true;
            } else if (!isValidEmail(email)) {
                showInputError(depositEmailInput, depositEmailError, 'Please enter a valid email address.');
                hasError = true;
            }
            if (isNaN(amount) || amount <= 0) {
                showInputError(depositAmountInput, depositAmountError, 'Please enter a valid amount.');
                hasError = true;
            } else if (amount < 100) {
                showInputError(depositAmountInput, depositAmountError, 'Minimum deposit is 100.');
                hasError = true;
            }

            if (hasError) {
                showToast('Please correct the deposit details.', 'error');
                return;
            }

            startLoading(submitDepositBtn, 'Opening Paystack...');
            closeModal('depositModal'); // Close the deposit modal before opening Paystack

            // Initialize Paystack payment
            // Paystack amount is in kobo, so multiply by 100
            const paystackAmount = amount * 100;
            const reference = `GWC_${Date.now()}_${Math.random().toString(36).substring(2, 11)}`; // Unique reference

            const handler = PaystackPop.setup({
                key: paystackPublicKey, // Replace with your public key
                email: email,
                amount: paystackAmount,
                ref: reference, // unique transaction reference
                onClose: function(){
                    // This function is called if the user closes the modal without completing payment
                    showToast('Payment cancelled by user.', 'info');
                    stopLoading(submitDepositBtn, 'Proceed to Paystack');
                },
                callback: function(response){
                    // This function is called when the payment is successful
                    // In a real application, you would send response.reference to your backend
                    // to verify the transaction using your SECRET KEY.
                    // For this client-side simulation, we'll directly update the balance.

                    if (response.status === 'success') {
                        userAccountBalance += amount; // Add the actual Naira amount
                        userTransactions.unshift({
                            id: Date.now().toString() + '_tx',
                            type: 'Deposit',
                            amount: amount,
                            description: `Deposit via Paystack (Ref: ${response.reference})`,
                            date: new Date().toISOString()
                        });
                        saveUserData();
                        updateDashboard();
                        showToast('Deposit successful!', 'success');
                    } else {
                        // Handle other statuses if necessary, though 'success' is the main one for callback
                        showToast('Payment not successful. Please try again.', 'error');
                    }
                    stopLoading(submitDepositBtn, 'Proceed to Paystack');
                }
            });
            handler.openIframe(); // Open the Paystack payment modal
        });

        // Withdraw Modal Logic
        submitWithdrawBtn.addEventListener('click', () => {
            const withdrawAmount = parseFloat(withdrawAmountInput.value);
            const bankName = bankNameInput.value.trim();
            const accountNumber = accountNumberInput.value.trim();
            const accountName = accountNameInput.value.trim();

            let hasError = false;
            clearInputError(withdrawAmountInput, withdrawAmountError);
            clearInputError(bankNameInput, bankNameError);
            clearInputError(accountNumberInput, accountNumberError);
            clearInputError(accountNameInput, accountNameError);

            // Withdrawal amount validation
            if (isNaN(withdrawAmount) || withdrawAmount <= 0) {
                showInputError(withdrawAmountInput, withdrawAmountError, 'Please enter a valid amount to withdraw.');
                hasError = true;
            } else if (withdrawAmount < 100) {
                showInputError(withdrawAmountInput, withdrawAmountError, 'Minimum withdrawal is 100.');
                hasError = true;
            } else if (withdrawAmount > userAccountBalance) {
                showInputError(withdrawAmountInput, withdrawAmountError, `Insufficient balance. Available: ${formatNaira(userAccountBalance)}`);
                hasError = true;
            }

            // Account details validation
            if (!bankName) {
                showInputError(bankNameInput, bankNameError, 'Bank Name is required.');
                hasError = true;
            }
            if (!accountNumber || !/^\d{10}$/.test(accountNumber)) {
                showInputError(accountNumberInput, accountNumberError, 'Account Number must be 10 digits.');
                hasError = true;
            }
            if (!accountName) {
                showInputError(accountNameInput, accountNameError, 'Account Name is required.');
                hasError = true;
            }

            // New: Check for matured investments (re-check here to prevent direct submission if modal was somehow opened)
            const hasMadeInvestment = userInvestments.length > 0;
            const hasMaturedInvestment = userInvestments.some(inv => new Date(inv.maturityDate) <= new Date());
            if (!hasMadeInvestment) {
                showToast('You must make an investment before you can withdraw.', 'error');
                hasError = true;
            } else if (!hasMaturedInvestment) {
                showToast('You can only withdraw once an investment has matured.', 'error');
                hasError = true;
            }

            if (hasError) {
                showToast('Please correct the withdrawal details.', 'error');
                return;
            }

            startLoading(submitWithdrawBtn, 'Processing Withdrawal...');

            setTimeout(() => {
                userAccountBalance -= withdrawAmount;

                // Add transaction record with account details
                userTransactions.unshift({
                    id: Date.now().toString() + '_tx',
                    type: 'Withdrawal',
                    amount: withdrawAmount,
                    description: `Withdrawal to ${accountName} (${accountNumber}, ${bankName})`,
                    date: new Date().toISOString()
                });

                saveUserData();
                updateDashboard();
                showToast('Withdrawal successful!', 'success');
                closeModal('withdrawModal');
                stopLoading(submitWithdrawBtn, 'Confirm Withdrawal');
            }, 1500);
        });

        // Reset Data Logic
        document.getElementById('confirmResetDataBtn').addEventListener('click', () => {
            startLoading(document.getElementById('confirmResetDataBtn'), 'Resetting...');
            
            setTimeout(() => {
                localStorage.removeItem(`growWithCoreInvestments_${currentUserId}`);
                localStorage.removeItem(`growWithCoreAccountBalance_${currentUserId}`);
                localStorage.removeItem(`growWithCoreTransactions_${currentUserId}`);
                localStorage.removeItem(`growWithCoreInvestmentGoal_${currentUserId}`);
                localStorage.removeItem(`growWithCoreUserProfile_${currentUserId}`); // New: Clear profile

                userInvestments = [];
                userTransactions = [];
                userAccountBalance = 0;
                investmentGoal = null;
                userProfile = { fullName: '', bio: '' }; // Reset profile in memory

                saveUserData(); // Save the empty state
                updateDashboard();
                showToast('All data has been reset!', 'info');
                closeModal('resetDataModal');
                stopLoading(document.getElementById('confirmResetDataBtn'), 'Yes, Reset All');
            }, 1000);
        });

        // Start Fresh Button Logic
        document.getElementById('startFreshBtn').addEventListener('click', () => {
            // This button will simulate a "fresh start" by clearing all user data
            // and then redirecting to the login page.
            startLoading(document.getElementById('startFreshBtn'), 'Starting Fresh...');

            setTimeout(() => {
                // Clear all relevant localStorage items for the current user
                localStorage.removeItem(`growWithCoreInvestments_${currentUserId}`);
                localStorage.removeItem(`growWithCoreAccountBalance_${currentUserId}`);
                localStorage.removeItem(`growWithCoreTransactions_${currentUserId}`);
                localStorage.removeItem(`growWithCoreInvestmentGoal_${currentUserId}`);
                localStorage.removeItem(`growWithCoreUserProfile_${currentUserId}`); // New: Clear profile
                localStorage.removeItem('currentUserEmail'); // Clear current user session
                localStorage.removeItem('currentUserId');
                localStorage.removeItem('rememberedEmail'); // Clear remembered email from login page

                // Redirect to the login page
                window.location.href = 'index.html';
            }, 1500); // Simulate a short delay for the "fresh start"
        });

        // Logout Button Logic
        logoutBtn.addEventListener('click', () => {
            startLoading(logoutBtn, 'Logging Out...');
            setTimeout(() => {
                // Clear only the current session data, not all user data
                localStorage.removeItem('currentUserEmail');
                localStorage.removeItem('currentUserId');
                // Optionally keep 'rememberedEmail' if the user checked "remember me" on login
                // For this scenario, we'll clear it to ensure a full logout experience.
                localStorage.removeItem('rememberedEmail');

                // Redirect to the login page
                window.location.href = 'index.html';
            }, 1000);
        });


        // Transaction History Filter/Sort Event Listeners
        transactionFilterSelect.addEventListener('change', renderTransactionHistory);
        transactionSortSelect.addEventListener('change', renderTransactionHistory);

        /**
         * Opens the investment details modal and populates it with data for the given investment ID.
         * @param {string} investmentId The ID of the investment to display.
         */
        function openInvestmentDetailsModal(investmentId) {
            const investment = userInvestments.find(inv => inv.id === investmentId);
            if (!investment) {
                showToast('Investment details not found.', 'error');
                return;
            }

            detailModalTypeName.textContent = investment.type;
            detailModalCategory.textContent = investment.category;
            detailModalInitialAmount.textContent = formatNaira(investment.initialAmount);
            detailModalCurrentValue.textContent = formatNaira(investment.currentValue);
            detailModalProfitLoss.textContent = formatNaira(investment.profit);
            detailModalProfitLoss.classList.toggle('profit', investment.profit >= 0);
            detailModalProfitLoss.classList.toggle('loss', investment.profit < 0);
            detailModalInvestDate.textContent = new Date(investment.investDate).toLocaleDateString();
            detailModalDuration.textContent = `${investment.duration} ${investment.durationUnit}`;
            
            // Calculate and display maturity date
            const maturityDate = calculateMaturityDate(investment.investDate, investment.duration, investment.durationUnit);
            detailModalMaturity.textContent = maturityDate.toLocaleDateString();

            // Populate daily growth history table
            investmentHistoryTableContainer.innerHTML = '';
            if (investment.dailyGrowthHistory && investment.dailyGrowthHistory.length > 0) {
                let tableHtml = `
                    <div class="projection-table-header">
                        <span>Date</span>
                        <span>Daily Gain</span>
                        <span>Total Value</span>
                    </div>
                `;
                // Sort history by date descending for display
                const sortedHistory = [...investment.dailyGrowthHistory].sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());

                sortedHistory.forEach(historyItem => {
                    const gainClass = historyItem.gain >= 0 ? 'profit' : 'loss';
                    tableHtml += `
                        <div class="projection-table-row">
                            <span>${new Date(historyItem.date).toLocaleDateString()}</span>
                            <span class="${gainClass}">${formatNaira(historyItem.gain)}</span>
                            <span>${formatNaira(historyItem.value)}</span>
                        </div>
                    `;
                });
                investmentHistoryTableContainer.innerHTML = tableHtml;
            } else {
                investmentHistoryTableContainer.innerHTML = '<p class="projection-table-empty-message">No daily growth history available.</p>';
            }

            openModal('investmentDetailsModal');
        }

        // Investment Goal Tracker Logic
        function updateGoalTracker() {
            goalTrackerContent.innerHTML = ''; // Clear previous content

            if (investmentGoal) {
                const totalInvested = userInvestments.reduce((sum, inv) => sum + inv.currentValue, 0);
                const progressPercentage = Math.min(100, (totalInvested / investmentGoal.amount) * 100);

                goalTrackerContent.innerHTML = `
                    <p class="goal-name-display">${investmentGoal.name}</p>
                    <p class="goal-amount-display">Target: ${formatNaira(investmentGoal.amount)}</p>
                    <p class="goal-amount-display">Current Progress: ${formatNaira(totalInvested)}</p>
                    <div class="goal-progress-bar">
                        <div class="goal-progress-fill" style="width: ${progressPercentage.toFixed(2)}%;"></div>
                    </div>
                    <p class="goal-percentage">${progressPercentage.toFixed(2)}% Achieved</p>
                    <button id="editGoalBtn" class="btn-primary mt-4">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-edit mr-2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                        <span>Edit Goal</span>
                    </button>
                    <button id="removeGoalBtn" class="btn-primary mt-4 !bg-red-600 hover:!bg-red-700 ml-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2 mr-2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
                        <span>Remove Goal</span>
                    </button>
                `;
                document.getElementById('editGoalBtn').addEventListener('click', () => openModal('setGoalModal'));
                document.getElementById('removeGoalBtn').addEventListener('click', () => {
                    investmentGoal = null;
                    saveUserData();
                    updateGoalTracker();
                    showToast('Investment goal cleared!', 'info');
                });
            } else {
                goalTrackerContent.innerHTML = `
                    <p class="text-gray-500">Set a financial goal to track your progress!</p>
                    <button id="setGoalBtn" class="btn-primary mt-4">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-target"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>
                        <span>Set a Goal</span>
                    </button>
                `;
                document.getElementById('setGoalBtn').addEventListener('click', () => openModal('setGoalModal'));
            }
        }

        submitGoalBtn.addEventListener('click', () => {
            const name = goalNameInput.value.trim();
            const amount = parseFloat(goalAmountInput.value);

            let hasError = false;
            clearInputError(goalNameInput, goalNameError);
            clearInputError(goalAmountInput, goalAmountError);

            if (!name) {
                showInputError(goalNameInput, goalNameError, 'Goal name is required.');
                hasError = true;
            }
            if (isNaN(amount) || amount <= 0) {
                showInputError(goalAmountInput, goalAmountError, 'Please enter a valid target amount.');
                hasError = true;
            } else if (amount < 1000) {
                showInputError(goalAmountInput, goalAmountError, 'Target amount must be at least 1,000.');
                hasError = true;
            }

            if (hasError) {
                showToast('Please correct the goal details.', 'error');
                return;
            }

            startLoading(submitGoalBtn, 'Saving...');

            setTimeout(() => {
                investmentGoal = { name, amount };
                saveUserData();
                updateGoalTracker();
                showToast('Investment goal saved!', 'success');
                closeModal('setGoalModal');
                stopLoading(submitGoalBtn, 'Save Goal');
            }, 1000);
        });

        clearGoalBtn.addEventListener('click', () => {
            startLoading(clearGoalBtn, 'Clearing...');
            setTimeout(() => {
                investmentGoal = null;
                saveUserData();
                updateGoalTracker();
                showToast('Investment goal cleared!', 'info');
                closeModal('setGoalModal');
                stopLoading(clearGoalBtn, 'Clear Goal');
            }, 500);
        });

        // Daily Market Insights Logic
        function displayRandomMarketInsight() {
            const randomIndex = Math.floor(Math.random() * marketInsights.length);
            const insight = marketInsights[randomIndex];
            marketInsightContent.innerHTML = `
                <h3 class="text-lg font-semibold text-gray-200 mb-2 flex items-center">
                    ${insight.icon}
                    ${insight.title}
                </h3>
                <p class="market-insight-text">${insight.text}</p>
                <p class="market-insight-source">Source: Simulated Market Data</p>
            `;
        }

        // Feedback Modal Logic
        submitFeedbackBtn.addEventListener('click', () => {
            const type = feedbackTypeSelect.value;
            const message = feedbackMessageTextarea.value.trim();

            let hasError = false;
            clearInputError(feedbackMessageTextarea, feedbackMessageError);

            if (!message) {
                showInputError(feedbackMessageTextarea, feedbackMessageError, 'Your message cannot be empty.');
                hasError = true;
            } else if (message.length < 10) {
                showInputError(feedbackMessageTextarea, feedbackMessageError, 'Message must be at least 10 characters long.');
                hasError = true;
            }

            if (hasError) {
                showToast('Please enter your feedback message.', 'error');
                return;
            }

            startLoading(submitFeedbackBtn, 'Sending...');

            setTimeout(() => {
                // In a real application, this would send data to a backend (e.g., Firebase, email service)
                console.log(`Feedback Type: ${type}, Message: ${message}`);
                showToast('Thank you for your feedback!', 'success');
                closeModal('feedbackModal');
                stopLoading(submitFeedbackBtn, 'Submit');
            }, 1500);
        });

        // New Feature: Profile Setup Logic
        function updateProfileDisplay() {
            if (userProfile.fullName) {
                profileFullNameEl.textContent = userProfile.fullName;
                profileBioEl.textContent = userProfile.bio || 'No bio set yet.';
                profileAvatar.textContent = userProfile.fullName.charAt(0).toUpperCase(); // First letter as avatar
                profileSetupCta.classList.add('hidden'); // Hide CTA if profile is set
            } else {
                profileFullNameEl.textContent = 'Guest User';
                profileBioEl.textContent = 'Set up your profile to personalize your experience!';
                profileAvatar.textContent = '?';
                profileSetupCta.classList.remove('hidden'); // Show CTA if profile is not set
            }
        }

        submitProfileBtn.addEventListener('click', () => {
            const fullName = profileFullNameInput.value.trim();
            const bio = profileBioInput.value.trim();

            let hasError = false;
            clearInputError(profileFullNameInput, profileFullNameError);
            clearInputError(profileBioInput, profileBioError);

            if (!fullName) {
                showInputError(profileFullNameInput, profileFullNameError, 'Full Name is required.');
                hasError = true;
            } else if (fullName.length < 3) {
                showInputError(profileFullNameInput, profileFullNameError, 'Full Name must be at least 3 characters.');
                hasError = true;
            }

            if (hasError) {
                showToast('Please correct the profile details.', 'error');
                return;
            }

            startLoading(submitProfileBtn, 'Saving Profile...');

            setTimeout(() => {
                userProfile.fullName = fullName;
                userProfile.bio = bio;
                saveUserData();
                updateProfileDisplay(); // Update the dashboard with new profile
                showToast('Profile saved successfully!', 'success');
                closeModal('profileSetupModal');
                stopLoading(submitProfileBtn, 'Save Profile');
            }, 1000);
        });


        // Initialize dashboard on page load
        document.addEventListener('DOMContentLoaded', loadUserData);

        // Service Worker for PWA (if manifest.json exists)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>
</body>
</html>
